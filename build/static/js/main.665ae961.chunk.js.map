{"version":3,"sources":["../config/environments/production_ish/config.js","components/application/45x45_day-night-2.png","../node_modules/@ionic/core/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","../node_modules/ionicons/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","../../ishlibjs/node_modules/@stencil/core/internal/client lazy /^/.//.*$/ include: //.entry/.js$/ exclude: //.system/.entry/.js$/ groupOptions: {} namespace object","../../ishlibjs/node_modules/@ionic/core/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","shared/C.jsx","../../src/shared/C.jsx","../../src/components/users/AuthWidget.jsx","../../src/components/users/LoginModal.jsx","../../src/components/users/RegisterModal.jsx","../../src/components/users/index.jsx","../../src/shared/request.jsx","../../src/shared/S.jsx","../../src/shared/index.jsx","../../src/components/users/JwtContext.jsx","../../src/components/users/PasswordLogin.jsx","../../src/components/users/Scratchpad.jsx","../../src/components/SideMenu/index.jsx","shared/Api.jsx","components/TwofoldLayout/index.jsx","components/application/BottomDrawer.jsx","components/application/MainHeader.jsx","components/application/MapuiLayout.jsx","components/application/MapuiMobileLayout.jsx","components/application/Menu.jsx","components/application/MenuLeft.jsx","components/application/Metaline.jsx","components/application/PurchaseModal.jsx","components/application/Rating.jsx","components/application/UnlockModal.jsx","components/application/Voteable.jsx","components/users/Account.jsx","components/users/MyAccountWidget.jsx","components/users/index.jsx","shared/AppMock.jsx","shared/AppRouter.jsx","shared/Collapsible.jsx","shared/request.jsx","shared/S.jsx","shared/TwofoldContext.jsx","shared/useWindowSize.jsx","shared/index.jsx","components/cities/CitiesList.jsx","components/newsitems/NewsitemGallery.jsx","components/newsitems/NewsitemPhoto.jsx","components/newsitems/NewsitemReport.jsx","components/newsitems/NewsitemVideo.jsx","components/newsitems/Newsitems.jsx","components/newsitems/NewsitemContainer.jsx","components/newsitems/ItemIcon.jsx","components/newsitems/index.js","components/venues/Venues.jsx","components/cities/CitiesShow.jsx","components/galleries/GalleriesShow.jsx","components/galleries/MyGalleries.jsx","components/locations/Breadcrumbs.jsx","resources/reports/ReportsForm.jsx","resources/reports/ReportsShow.jsx","components/locations/ItemModal.jsx","resources/markers/MarkerModal.jsx","resources/markers/MarkersList.jsx","resources/markers/MarkerForm.jsx","resources/markers/index.jsx","components/locations/LocationsShowDesktop.jsx","components/locations/LocationsShowMobile.jsx","components/locations/MapPanel.jsx","components/locations/MapPanelNoZoom.jsx","components/locations/RatedRestrictionModal.jsx","components/3d_locations/Crosshair.jsx","components/3d_locations/PointerLockControls.js","components/3d_locations/Equirectangular.jsx","components/3d_locations/TouchControls.jsx","components/3d_locations/RotationPad.jsx","components/3d_locations/Equirectangular2.jsx","components/3d_locations/Equirectangular4.jsx","components/3d_locations/ThreePanelV1.jsx","components/3d_locations/ThreePanelV2.jsx","components/3d_locations/ThreePanelV3.jsx","components/3d_locations/ThreePanelV4.jsx","components/locations/WrappedMapPanel.jsx","components/locations/ZoomCtrl.jsx","components/sites/Features.jsx","components/sites/SitesShow.jsx","components/sites/SitesShow1.jsx","components/videos/Videos.jsx","AppDesktop.jsx","AppMobile.jsx","AppWrapper.jsx","serviceWorker.js","index.jsx"],"names":["module","exports","map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","keys","Object","webpackEmptyAsyncContext","C","actions","new","show","anonUser","bottomDrawerOpen","collapsible","description","extra1","extra2","extra3","markers","collapsibles","current_user","foldedCenter","foldedLeft","foldedRight","horizontal","item_types","gallery","report","photo","video","jwt_token","layout_onecol","layout_mapui","locations","earth","map_panel_types","Equirectangular","MapPanel","MapPanelNoZoom","ThreePanelV1","ThreePanelV4","names","editorMode","rated","nc17","ratedConfirmation","theme","themes","dark","light","twofoldPercent","variants","bordered","floating","inline","transparent","vertical","scratchpad","RegisterWithEmailBtn","props","LoginWithEmailBtn","AuthWidget","useContext","currentUser","setCurrentUser","setLoginModalOpen","setRegisterModalOpen","onClick","JSON","LoginModal","loginModalOpen","useApi","useState","email","setEmail","password","setPassword","api","doPasswordLogin","toast","logg","err","className","styles","isOpen","overlayClassName","style","flexDirection","htmlFor","name","type","value","onChange","onKeyDown","justifyContent","marginTop","RegisterModal","registerModalOpen","password2","setPassword2","zIndex","for","r","localStorage","doRegister","AuthContext","createContext","AuthContextProvider","children","defaultUser","localCurrentUser","_setCurrentUser","user","moreProps","_FacebookLogin","Plugins","FACEBOOK_PERMISSIONS","FacebookLogin","permissions","result","request","config","accessToken","token","resp","axios","S","borderWidth","bottomDrawerClosedHeight","bottomDrawerOpenHeight","breadcrumbsHeight","thinBorderWidth","thinBorderRadius","thinBorder","colors","text","background","blue","darkGrey","lightGrey","red","border","cardBackground","Actions","styled","Btn","CloseBtn","p","PropTypes","isRequred","_FlexCol","FlexCol","FlexRow","a","b","c","window","console","React","JwtContext","JwtContextProvider","maybeUser","useEffect","object","string","getItem","deleteNewsitem","apiOrigin","data","post","doUnlock","kind","path","getCities","get","getCity","slug","getGallery","getMyAccount","getPayments","getReport","getTag","tag","loginPath","longTermTokenPath","postLogin","router","setItem","stringify","myVideosPath","applicationHome","domain","params","LongLine","div","orientation","propTypes","Drawer","_Drawer","getLibrary","provider","Web3","Inner0","Inner1","borderHeight","Inner2","WClosed","BottomDrawer","TwofoldContext","layout","setBottomDrawerOpen","IconButton","aria-label","fontSize","anchor","elevation","open","onClose","BackdropProps","invisible","variant","paddingRight","Header","Root","MainHeader","MenuLeft","MapuiContainer","bottomDrawerHeight","MapuiLayout","MapuiMobileLayout","newspaperOutline","bus","person","powerOutline","W0","SideMenu","drawerOpen","setDrawerOpen","history","useHistory","position","top","left","margin","button","key","push","homeLocation","bookmarks","idx","W","withRouter","created_at","username","city","tags","pp_date","i","stripePromise","loadStripe","_PurchaseModal","purchaseModalOpen","setPurchaseModalOpen","stripe","useStripe","elements","useElements","handleSubmit","event","preventDefault","getElement","CardElement","client_secret","confirmCardPayment","payment_method","card","error","message","paymentIntent","status","response","ariaHideApp","onSubmit","disabled","PurchaseModal","Rating","rate","rating","setRating","iconMapping","0","starOutline","1","starHalf","2","star","Array","fill","icon","Btn0","BtnRow","modalStyle","overlay","content","maxWidth","UnlockModal","itemToUnlock","setItemToUnlock","setRatedConfirmation","item_type","closable","cost","premium_tier","n_unlocks","IconUp","_ArrowUpward","IconDown","_ArrowDownward","WCount","Voteable","item","isPushNotificationsAvailable","Capacitor","isPluginAvailable","greeterAddress","tokenAddress","PasswordLogin","LoginRow","Account","greeting","setGreetingValue","notifications","setNotifications","setScratchpad","register","PushNotifications","addListener","showToast","alert","_n","n","logg2","ns","nofitication","msg","Toast","requestAccount","ethereum","method","fetchGreeting","ethers","providers","Web3Provider","contract","Contract","Greeter","abi","greet","log","account","Token","balanceOf","balance","toString","signer","getSigner","setGreeting","transaction","wait","transfer","userAccount","amount","transation","checkPermissions","res","receive","requestPermissions","Grid","container","spacing","xs","src","alt","target","placeholder","setUserAccount","setAmount","to","length","notif","title","body","color","expand","BuyBtn","span","Cell","_Img","Img","injected","InjectedConnector","W1","AuthedWidget","setEditorMode","defaultChecked","icons","MyAccountWidget","avatar","setAvatar","useWeb3React","active","activate","library","connector","deactivate","ex","myBodies","bodyNFT","tokensOfOwner","tokenURI","image","profile_photo_url","FbLogin","doFbLogin","login","Logout","removeItem","AppRouter","cityVenuesPath","cityPath","Gt","Inner","Label","WTransparent","Collapsible","ctx","CollapsibleContext","setCollapsibles","label","shape","bool","isRequired","settings","baseURL","create","lightTheme","darkTheme","TwofoldContextProvider","setLayout","toggleTheme","zoom","setZoom","parse","_setBottomDrawerOpen","setLocalCurrentUser","mountedRef","useRef","current","fn","closure","setTimeout","clearTimeout","is_purchasing","_setEditorMode","folded","setFolded","_itemToUnlock","_setItemToUnlock","tmp","location","setLocation","mapPanelWidth","setMapPanelWidth","mapPanelHeight","setMapPanelHeight","_setRatedConfirmation","showItem","setShowItem","showUrl","setShowUrl","setTwofoldPercent","localZoom","setLocalZoom","Provider","m","t","which","useWindowSize","size","setSize","useLayoutEffect","updateSize","innerWidth","innerHeight","addEventListener","removeEventListener","BackIcon","IonIcon","BackBtn","goBack","arrowBack","ChevronLeft","_ChevronLeft","ChevronRight","_ChevronRight","Card","_Box","cursor","CollapsibleContextProvider","defaultCollapsibles","descr","_setCollapsibles","inflector","slice","ms","split","charAt","toUpperCase","join","toLowerCase","_Circle","Loading","replace","MenuIcon","_MenuIcon","PurchasedIcon","d","substring","WBordered","_WBorderedItem","WBorderedItem","WidgetContainer","Wrapper","Counts","Count","_IonIcon","Number","Cities","cities","setCities","filteredCities","setFilteredCities","showLoading","setShowLoading","ev","filter","indexOf","trim","funnel","bookmark","n_reports","n_galleries","n_videos","videocam","onDidDismiss","duration","Images","ImageLarge","img","ImageThumb1","ImageThumb2","NewsitemGallery","photos","thumb_url","array","NewsitemPhoto","large_url","NewsitemReport","NewsitemVideo","display","youtube_id","width","height","frameBorder","allow","allowFullScreen","maxHeight","preload","controls","url","_EditModeActions","EditModeActions","confirm","newsitem_id","Newsitems","newsitems","newsitem","Col","Row","Title","h2","navigateToItem","boxShadow","NewsitemContainer","is_premium","is_purchased","alignItems","overflowWrap","dangerouslySetInnerHTML","__html","subhead","_W0","ItemIcon","useTheme","Diamond","number","GenericNewsitem","Address","_Ra","RightArrow","Venue","Venues","venues","filteredVenues","setFilteredVenues","venue","includes","address","CitiesShow","match","thisPath","useLocation","setCity","backgroundImage","hero_img","backgroundSize","pin","pathname","exact","render","GalleriesShow","setGallery","ph","MyGalleries","galleries","setGalleries","g","B0","B1","WDayNight","T0","DayNightToggle2","rotating","setRotating","debug","WBreadcrumbs","Breadcrumbs","breadcrumbs","out","textDecoration","arrayOf","ReportForm","ReportsShow","ItemModal","useParams","action","locationPath","reportname","ReportsForm","MarkerModal","MarkerContext","markerModalOpen","setMarkerModalOpen","_Marker","Marker","_W","MarkersList","goto","title_img_path","MarkerForm","MarkerContextProvider","marker","setMarker","_D","Description","WH","Handle","w","offsetX","setOffsetX","dragging","setDragging","onMouseUp","onMouseMove","clientX","movedBy","movedByPercent","prev","onMouseDown","pageX","onMouseLeave","pointer","IframeModal","scrolling","allowtransparency","Left","Right","LocationsShowDesktop","windowWidth","windowHeight","loading","setLoading","setMarkers","mapPanelRef","offsetWidth","offsetHeight","itemType","item_slug","ref","marginBottom","flexWrap","labels","_Description","LocationsShowMobile","map_panel_type","withZoom","Div1","ZoomCtrl","right","padding","div1Ref","scroll","behavior","y","centerOffsetY","x","centerOffsetX","img_path","h","nextZoomByWidth","nextZoomByHeight","nextZoom","Math","min","RatedRestrictionModal","Crosshair","_euler","Euler","_vector","Vector3","_changeEvent","_lockEvent","_unlockEvent","_PI_2","PI","PointerLockControls","camera","domElement","undefined","warn","document","isLocked","minPolarAngle","maxPolarAngle","scope","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","setFromQuaternion","quaternion","max","setFromEuler","dispatchEvent","onPointerlockChange","ownerDocument","pointerLockElement","onPointerlockError","connect","disconnect","dispose","this","getObject","getDirection","direction","v","copy","applyQuaternion","moveForward","distance","setFromMatrixColumn","matrix","crossVectors","up","addScaledVector","moveRight","lock","requestPointerLock","unlock","exitPointerLock","EventDispatcher","TouchControls","options","THREE","RotationPad","self","$","extend","speedFactor","delta","rotationFactor","maxPitch","hitTest","hitTestDistance","isRightMouseDown","rotationMatrices","hitObjects","moveBackward","moveLeft","lockMoveForward","lockMoveBackward","lockMoveLeft","lockMoveRight","ztouch","xtouch","velocity","cameraHolder","Object3D","calculateCameraRotation","dx","dy","factor","ry","fpsBody","rotation","rx","add","scene","enabled","mouse","Vector2","rotationPad","on","detail","deltaX","deltaY","setRotation","movementPad","MovementPad","abs","middle","stopPropagation","keyCode","clientY","originalEvent","rotationMatrixF","Matrix4","makeRotationY","rotationMatrixB","rotationMatrixL","rotationMatrixR","prepareRotationMatrices","update","z","translateX","translateY","translateZ","unlockAllDirections","index","cameraDirection","getDirection2","clone","applyMatrix4","intersects","Raycaster","intersectObject","getObjectByName","set","applyEuler","boolean","prototype","addToScene","setPosition","stopMouseMoving","camHolder","getHitObjects","eventRepeatTimeout","newLeft","newTop","angle","mouseDown","handleRef","handleEl","regionRef","regionEl","regionData","handleData","resetHandlePosition","animate","centerY","radius","centerX","opacity","pageY","offset","pow","atan2","cos","sin","round","css","parseInt","sendEvent","moveEvent","Event","bubbles","trigger","targetTouches","touches","Blocker","Equirectangular2","renderer","texture","markerObjects","blockerRef","wContainerRef","instructionsRef","fog","canJump","axes","wContainer","floorGeometry","rotateX","loadTexture","wrapS","wrapT","repeat","floorMaterial","floor","textureLoader","assetPath","load","rt","fromEquirectangularTexture","antialias","setPixelRatio","devicePixelRatio","clientWidth","clientHeight","appendChild","onWindowResize","init","prevTime","performance","now","canvas","needResize","resizeRendererToDisplaySize","aspect","updateProjectionMatrix","requestAnimationFrame","time","intersections","intersectObjects","onObject","normalize","Loc","raycaster","objects","attributes","l","count","vertex","fromBufferAttribute","random","setXYZ","toNonIndexed","colorsFloor","setHSL","setAttribute","vertexColors","manager","traverse","child","isMesh","material","geometry","scale","onProgress","loaded","total","OBJLoader","obj","xhr","lengthComputable","percentComplete","cube","ray","origin","markerObjectsIdxs","pMat","uniforms","main_color","border_color","thickness","center","vertexShader","fragmentShader","texturePath","modelPath","modelPath2","onError","mtlLoader","MTLLoader","setPath","materials","objLoader","setMaterials","uuid","loader","Location","clock","directionalLight","fillLight1","plc","sphereGeometry","sphereMaterial","spheres","sphereIdx","worldOctree","Octree","playerCollider","Capsule","playerVelocity","playerDirection","playerOnFloor","mouseTime","keyStates","vector1","vector2","vector3","order","castShadow","shadow","near","far","bottom","mapSize","bias","sphere","receiveShadow","mesh","collider","shadowMap","outputEncoding","toneMapping","GLTFLoader","gltf","fromGraphNode","anisotropy","getWorldDirection","end","impulse","exp","multiplyScalar","throwBall","updateSpheres","deltaTime","forEach","sphereIntersect","normal","dot","depth","damping","addVectors","start","sphere_center","r2","point","d2","distanceToSquared","subVectors","v1","v2","sub","sqrt","playerSphereCollision","s1","j","s2","spheresCollisions","getForwardVector","getSideVector","cross","updatePlayer","deltaPosition","translate","capsuleIntersect","playerCollisions","speedDelta","getDelta","modelName","wrappedOnLoad","WrappedMapPanel","forwardRef","Equirectangular4","ThreePanelV2","ThreePanelV3","Features","features","f","inner_html","sm","SitesShow","site","setSite","SitesShow1","artTag","homeRow1Tag","interestingLocationsTag","useStyles","makeStyles","paper","textAlign","palette","secondary","redBorder","root","flexGrow","overflow","VideoItem","Video","video_url","Videos","videos","setVideos","jwtToken","classes","AppDesktop","Container","Route","main","from","component","CitiesList","__Container","_Container","AppMobile","paddingBottom","AppWrapper","os","setOs","Device","getInfo","info","operatingSystem","setTheme","childProps","Boolean","hostname","ReactDOM","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"k1nBACAA,EAAOC,QAAU,CACf,UAAa,+BACb,aAAgB,YAEhB,OAAU,mBAEV,aAAgB,0BAEhB,cAAgB,I,uh0DCTlBD,EAAOC,QAAU,k/H,sGCAjB,IAAIC,EAAM,CACT,8BAA+B,CAC9B,IACA,GAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,sBAAuB,CACtB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,qBAAsB,CACrB,IACA,IAED,mCAAoC,CACnC,IACA,IAED,uBAAwB,CACvB,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,8BAA+B,CAC9B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,sBAAuB,CACtB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,gCAAiC,CAChC,IACA,KAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WAC7B,IAAI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","file":"static/js/main.665ae961.chunk.js","sourcesContent":["\nmodule.exports = {\n  \"apiOrigin\": \"https://manager.piousbox.com\",\n  \"appIndexPath\": \"src/index\", // @TODO: remove\n\n  \"domain\": \"tgm.piousbox.com\", // required! 20210831\n\n  \"homeLocation\": \"/en/locations/show/root\",\n\n  \"requireLogin\": false,\n};\n","module.exports = \"data:image/png;base64,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\"","var map = {\n\t\"./ion-action-sheet.entry.js\": [\n\t\t956,\n\t\t7\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t957,\n\t\t8\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t958,\n\t\t10\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t959,\n\t\t21\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t960,\n\t\t22\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t961,\n\t\t61\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t962,\n\t\t23\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t963,\n\t\t24\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t964,\n\t\t25\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t965,\n\t\t26\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t966,\n\t\t62\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t967,\n\t\t13\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t968,\n\t\t27\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t969,\n\t\t63\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t970,\n\t\t64\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t971,\n\t\t28\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t972,\n\t\t29\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t973,\n\t\t30\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t974,\n\t\t31\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t975,\n\t\t32\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t976,\n\t\t11\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t977,\n\t\t18\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t978,\n\t\t12\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t979,\n\t\t33\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t980,\n\t\t34\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t981,\n\t\t35\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t982,\n\t\t14\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t983,\n\t\t20\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t984,\n\t\t65\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t985,\n\t\t36\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t986,\n\t\t37\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t987,\n\t\t38\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t988,\n\t\t39\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t989,\n\t\t66\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t990,\n\t\t16\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t991,\n\t\t67\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t992,\n\t\t40\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t993,\n\t\t19\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t994,\n\t\t41\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t995,\n\t\t42\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t996,\n\t\t43\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t997,\n\t\t15\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t998,\n\t\t68\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 518;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t999,\n\t\t75\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 520;\nmodule.exports = webpackAsyncContext;","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 551;","var map = {\n\t\"./ion-accordion_2.entry.js\": [\n\t\t1000,\n\t\t47\n\t],\n\t\"./ion-action-sheet.entry.js\": [\n\t\t1001,\n\t\t84\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t1002,\n\t\t85\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t1003,\n\t\t86\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t1004,\n\t\t87\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t1005,\n\t\t48\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t1006,\n\t\t88\n\t],\n\t\"./ion-breadcrumb_2.entry.js\": [\n\t\t1007,\n\t\t49\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t1008,\n\t\t89\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t1009,\n\t\t90\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t1010,\n\t\t91\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t1011,\n\t\t92\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t1012,\n\t\t93\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t1013,\n\t\t9\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t1014,\n\t\t50\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t1015,\n\t\t94\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t1016,\n\t\t95\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t1017,\n\t\t96\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t1018,\n\t\t97\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t1019,\n\t\t51\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t1020,\n\t\t98\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t1021,\n\t\t52\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t1022,\n\t\t99\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t1023,\n\t\t100\n\t],\n\t\"./ion-picker-column-internal.entry.js\": [\n\t\t1024,\n\t\t101\n\t],\n\t\"./ion-picker-internal.entry.js\": [\n\t\t1025,\n\t\t102\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t1026,\n\t\t103\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t1027,\n\t\t104\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t1028,\n\t\t105\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t1029,\n\t\t44\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t1030,\n\t\t53\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t1031,\n\t\t54\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t1032,\n\t\t106\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t1033,\n\t\t107\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t1034,\n\t\t17\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t1035,\n\t\t45\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t1036,\n\t\t108\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t1037,\n\t\t109\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t1038,\n\t\t110\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t1039,\n\t\t111\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t1040,\n\t\t112\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t1041,\n\t\t113\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t1042,\n\t\t114\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t1043,\n\t\t115\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t1044,\n\t\t116\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t1045,\n\t\t46\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t1046,\n\t\t117\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 552;\nmodule.exports = webpackAsyncContext;","\n/**\n * Constants\n */\nconst C = {\n\n  // A\n  actions: { // CRUD\n    new: 'new',\n    show: 'show',\n  },\n  anonUser: {}, // as opposed to null\n\n  // B\n  bottomDrawerOpen: 'bottom-drawer-open', // localStorage\n\n  // C\n  collapsible: {\n    description: \"descr-sec\",\n    extra1: \"extra1-sec\",\n    extra2: \"extra2-sec\",\n    extra3: \"extra3-sec\",\n    map: \"map-sec\",\n    markers: \"markers-sec\",\n  },\n  collapsibles: 'collapsibles', // localStorage\n  current_user: 'current_user',\n\n  // F\n  foldedCenter: 'folded-center',\n  foldedLeft: 'folded-left', // twofoldContext\n  foldedRight: 'folded-right',\n\n  // H\n  horizontal: 'horizontal',\n\n  // I\n  item_types: {\n    gallery: 'Gallery',\n    report: 'Report',\n    photo: 'Photo',\n    video: 'Video',\n  },\n\n  // J\n  jwt_token: 'jwt_token',\n\n  // L\n  layout_onecol: 'onecol',\n  layout_mapui: 'mapui',\n  locations: {\n    earth: 'earth',\n  },\n\n  // M\n  map_panel_types: {\n    Equirectangular: \"Equirectangular\",\n    MapPanel: \"MapPanel\",\n    MapPanelNoZoom: \"MapPanelNoZoom\",\n    ThreePanelV1: \"ThreePanelV1\",\n    ThreePanelV4: \"ThreePanelV4\",\n  },\n\n  // N\n  names: { // for localStorage\n    editorMode: 'editorMode',\n  },\n\n  // R\n  rated: {\n    nc17: 'nc-17',\n  },\n  ratedConfirmation: 'rated-confirmation', // localStorage\n\n  // T\n  theme: 'theme',\n  themes: {\n    dark: 'dark',\n    light: 'light',\n  },\n  twofoldPercent: 'twofold-percent', // localStorage\n\n  // V\n  variants: {\n    bordered: 'bordered', // for Newsitems\n    floating: 'floating', // for main-menu btn\n    inline: 'inline',     // for main-menu btn\n    transparent: 'transparent', // for markers on Right\n  },\n  vertical: 'vertical',\n}\nexport default C\n","\n/**\n * Constants\n *\n * * C.anonUser\n * * C.current_user\n * * C.jwt_token\n * * C.item_types\n *\n */\nconst C = {\n\n  // A\n  anonUser: {}, // as opposed to null\n\n  // B\n  bottomDrawerOpen: 'bottom-drawer-open', // localStorage\n\n  // C\n  collapsible: {\n    description: \"descr-sec\",\n    extra1: \"extra1-sec\",\n    extra2: \"extra2-sec\",\n    extra3: \"extra3-sec\",\n    map: \"map-sec\",\n    markers: \"markers-sec\",\n  },\n  collapsibles: 'collapsibles', // localStorage\n  current_user: 'current_user',\n\n  // F\n  foldedCenter: 'folded-center',\n  foldedLeft: 'folded-left', // twofoldContext\n  foldedRight: 'folded-right',\n\n  // H\n  horizontal: 'horizontal',\n\n  // I\n  item_types: {\n    gallery: 'Gallery',\n    report: 'Report',\n    video: 'Video',\n  },\n\n  // J\n  jwt_token: 'jwt_token',\n\n  // L\n  layout_onecol: 'onecol',\n  layout_mapui: 'mapui',\n  locations: {\n    earth: 'earth',\n  },\n\n  // M\n  map_panel_types: {\n    Equirectangular: \"Equirectangular\",\n    MapPanel: \"MapPanel\",\n    MapPanelNoZoom: \"MapPanelNoZoom\",\n    ThreePanelV1: \"ThreePanelV1\",\n    ThreePanelV4: \"ThreePanelV4\",\n  },\n\n  // N\n  names: { // for localStorage\n    scratchpad: 'Scratchpad',\n  },\n\n  // R\n  rated: {\n    nc17: 'nc-17',\n  },\n  ratedConfirmation: 'rated-confirmation', // localStorage\n\n  // T\n  theme: 'theme',\n  themes: {\n    dark: 'dark',\n    light: 'light',\n  },\n  twofoldPercent: 'twofold-percent', // localStorage\n\n  // V\n  variants: {\n    bordered: 'bordered', // for Newsitems\n    floating: 'floating', // for main-menu btn\n    inline: 'inline',     // for main-menu btn\n    transparent: 'transparent', // for markers on Right\n  },\n  vertical: 'vertical',\n}\nexport default C\n","\nimport React, { Fragment as F, useContext, } from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\n\nimport {\n  AuthContext, AuthContextProvider,\n  FacebookLogin,\n  LoginModal, LoginWithEmail,\n  RegisterModal, RegisterWithEmail,\n} from \"$components/users\"\n\nimport {\n  Btn,\n  C,\n  FlexCol, FlexRow,\n\n  logg,\n} from \"$shared\"\n\n\nconst RegisterWithEmailBtn = (props) => {\n  return <Btn {...props} >Register with Email</Btn>\n}\nconst LoginWithEmailBtn = (props) => {\n  return <Btn {...props} >Login with Email</Btn>\n}\n\n\n/**\n * If user is logged in, display the email/handle and allow logout.\n * If user is not logged in, allow registration and login via Fb, and email+passwd.\n**/\nconst AuthWidget = (props) => {\n  // logg(props, 'AuthWidget')\n\n  const {\n    currentUser, setCurrentUser,\n    setLoginModalOpen,\n    setRegisterModalOpen,\n  } = useContext(AuthContext)\n  // logg(useContext(AuthContext), 'AuthWidgetUsedAuthContext')\n\n  // @TODO: does this belong here?\n  const doLogout = () => {\n    setCurrentUser(JSON.stringify(C.anonUser))\n  }\n\n  if (currentUser?.email) {\n    return <FlexRow>\n      [{currentUser.email} <Btn onClick={doLogout} >Logout</Btn> ]\n    </FlexRow>\n  }\n\n  return <F>\n    <FlexCol>\n      <FacebookLogin />\n      <RegisterWithEmailBtn onClick={() => { setRegisterModalOpen(true) }} />\n      <LoginWithEmailBtn    onClick={() => { setLoginModalOpen(true) }} />\n    </FlexCol>\n\n    <RegisterModal />\n    <LoginModal />\n\n  </F>\n};\nAuthWidget.propTypes = {\n  // none so far\n}\n\nexport default AuthWidget\n","\n/*\n * components / users / PasswordLoginModal.jsx\n**/\nimport React, { Fragment as F, useContext, useState, } from 'react'\nimport Modal from \"react-modal\"\nimport { ToastContainer, toast } from 'react-toastify'\nimport 'react-toastify/dist/ReactToastify.css'\nimport styled from 'styled-components'\n\nimport {\n  Btn,\n  C, CloseBtn,\n  FlexCol, FlexRow,\n  logg,\n  request,\n} from \"$shared\"\nimport {\n  AuthContext, AuthContextProvider,\n} from './'\n\nimport styles from './LoginModal.scss'\n\n/**\n * LoginModal\n**/\nconst LoginModal = (props) => {\n  // logg(props, 'LoginModal, ishlibjs')\n\n  const {\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n    useApi,\n  } = useContext(AuthContext)\n  // logg(useContext(AuthContext), 'LoginModalUsedAuthContext2')\n\n  const [ email, setEmail ] = useState('')\n  const [ password, setPassword ] = useState('')\n  const api = useApi()\n\n  const doPasswordLogin = async (email, password) => {\n    api.postLogin({ email, password }).then((r) => {\n      setLoginModalOpen(false)\n      toast('Login Successful.')\n    }).catch((err) => {\n      logg(err, 'e323')\n      toast(\"Login failed\")\n      setCurrentUser(C.anonUser)\n    })\n  }\n\n  return <Modal\n    className={`LoginModal ${styles.LoginModal}`}\n    isOpen={loginModalOpen}\n    overlayClassName={styles.LoginModalOverlay}\n    // portalClassName={'LoginModalPortal'}\n  >\n    <FlexRow style={{ flexDirection: 'row-reverse' }} >\n      <CloseBtn onClick={() => setLoginModalOpen(false)} />\n    </FlexRow>\n    <FlexCol>\n      <label htmlFor='email'>Email</label>\n      <input name='email' type='email' value={email} onChange={(e) => setEmail(e.target.value)    } />\n\n      <label htmlFor='password'>Password</label>\n      <input name='password' type='password' value={password} onChange={(e) => setPassword(e.target.value) }\n        onKeyDown={(e) => { if (e.key === 'Enter') { doPasswordLogin(email, password) } }}\n      />\n      <FlexRow style={{\n        justifyContent: 'space-between',\n        marginTop: '0.4em',\n      }} >\n        <span>Forgot?</span>\n        <Btn onClick={() => doPasswordLogin(email, password)}>Password Login</Btn>\n      </FlexRow>\n    </FlexCol>\n  </Modal>\n}\n\nexport default LoginModal\n","\nimport React, { useContext, useState, } from 'react'\nimport Modal from \"react-modal\"\n\nimport {\n  AuthContext,\n  Btn,\n  FlexCol, FlexRow,\n  logg,\n} from '$shared'\n\n/**\n * RegisterModal\n**/\nconst RegisterModal = (props) => {\n  // logg(props, 'RegisterModal')\n\n  const {\n    currentUser, setCurrentUser,\n    registerModalOpen, setRegisterModalOpen,\n    useApi,\n  } = useContext(AuthContext)\n  // logg(useContext(AuthContext), 'registerModalUsedContext')\n\n  const api = useApi()\n  const [ email, setEmail ] = useState('')\n  const [ password, setPassword ] = useState('')\n  const [ password2, setPassword2 ] = useState('')\n\n  const doRegister = async (email, password, password2) => {\n    if (password !== password2) {\n      return toast('Passwords do not match')\n    }\n    api.doRegister({ email, password }).then((r) => {\n      logg(r, 'registered')\n      localStorage.setItem(C.jwt_token, r.jwt_token)\n      localStorage.setItem(C.current_user, JSON.stringify(r))\n      setCurrentUser(r)\n      setRegisterModalOpen(false)\n    }).catch((e) => {\n      logg(e, 'e322')\n      toast(\"Registration failed\")\n    })\n  }\n\n  return <Modal style={{ zIndex: 3 }} isOpen={registerModalOpen} >\n    <div onClick={() => setRegisterModalOpen(false)}>[x]</div>\n    <FlexCol>\n      <label for='email'>Email</label>\n      <input type='email'    name='email'     value={email}    onChange={(e) => setEmail(e.target.value)    } />\n\n      <label for='password'>Password</label>\n      <input type='password' name='password'  value={password} onChange={(e) => setPassword(e.target.value) } />\n\n      <label for='password2'>Confirm Password</label>\n      <input type='password' name='password2' value={password2} onChange={(e) => setPassword2(e.target.value) } />\n\n      <FlexRow>\n        <Btn onClick={() => doRegister(email, password, password2) }>Register</Btn>\n        <Btn onClick={() => setRegisterModalOpen(false) }>Cancel</Btn>\n      </FlexRow>\n    </FlexCol>\n  </Modal>\n}\n\nexport default RegisterModal\n","\nimport { Plugins } from '@capacitor/core'\nimport React, { createContext, useContext, useState } from 'react'\n\nimport {\n  Btn,\n  C,\n  logg,\n} from '$shared'\n\nexport { default as loginModalStyles } from './LoginModal.scss'\n\n/* A */\nconst AuthContext = createContext({})\nconst AuthContextProvider = ({children, ...props }) => {\n  let { currentUser, setCurrentUser } = props\n  // logg(props, 'AuthContextProvider')\n\n  let defaultUser = localStorage.getItem(C.current_user)\n  defaultUser = defaultUser ? JSON.parse(defaultUser) : C.anonUser\n\n  const [ localCurrentUser, _setCurrentUser ] = useState(defaultUser)\n  const setLocalCurrentUser = (user) => {\n    localStorage.setItem(C.jwt_token, user.jwt_token)\n    localStorage.setItem(C.current_user, JSON.stringify(user))\n    _setCurrentUser(user)\n  }\n  if (!currentUser) {\n    currentUser = localCurrentUser\n    setCurrentUser = setLocalCurrentUser\n  }\n\n  // @TODO: make these also cascading from the props\n  const [ loginModalOpen, setLoginModalOpen ] = useState(false)\n  const [ registerModalOpen, setRegisterModalOpen ] = useState(false)\n  const moreProps = {\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n    registerModalOpen, setRegisterModalOpen,\n  }\n\n  return <AuthContext.Provider value={{ ...props, ...moreProps }} >\n    { children }\n  </AuthContext.Provider>\n}\n\nexport {\n  AuthContext, AuthContextProvider,\n}\nexport { default as AuthWidget } from './AuthWidget'\n\n\n/* F */\nconst { FacebookLogin: _FacebookLogin } = Plugins\n\nconst FACEBOOK_PERMISSIONS = ['email']\n\n\n/**\n * FacebookLogin\n**/\nexport const FacebookLogin = (props) => {\n\n  const {\n    currentUser, setCurrentUser,\n    useApi,\n  } = useContext(AuthContext)\n\n  const api = useApi()\n\n  const doFbLogin = async () => {\n    const result = await _FacebookLogin.login({ permissions: FACEBOOK_PERMISSIONS });\n    if (result.accessToken) {\n      request.post(`${config.apiOrigin}${api.longTermTokenPath}`, { accessToken: result.accessToken.token }).then((resp) => {\n        localStorage.setItem(C.jwt_token, resp.data.jwt_token)\n        localStorage.setItem(C.current_user, JSON.stringify(resp.data) )\n        setCurrentUser(resp.data)\n      }).catch((err) => {\n        logg(err, `Could not post request to ${config.apiOrigin}${api.longTermTokenPath}`)\n      })\n    } else {\n      // Canceled by user.\n      logg('canceled')\n    }\n  }\n  return <Btn onClick={doFbLogin}>Login or Register with Facebook</Btn>\n}\n\n/* L */\nexport { default as LoginModal } from \"./LoginModal\"\n\n/* R */\nexport { default as RegisterModal } from \"./RegisterModal\"\n\n\n","\nimport axios from \"axios\"\n\n/*\nimport config from \"config\"\n\nconst settings = {\n  baseURL: config.apiOrigin\n}\n\nexport default axios.create(settings)\n*/\n\nexport default axios.create({})\n","\n/**\n * Style Constants\n */\nconst S = {\n  // Twofold layout\n  borderWidth: '10px',\n  bottomDrawerClosedHeight: '20px',\n  bottomDrawerOpenHeight: '115px',\n  breadcrumbsHeight: '30px',\n\n  thinBorderWidth: '2px',\n  thinBorderRadius: '5px',\n}\n\nconst lightTheme = {\n  ...S,\n  thinBorder: '2px solid black',\n  colors: {\n    text: 'black',\n    background: '#dedede',\n    blue: '#6aa3e9',\n    darkGrey: '#605d5d',\n    lightGrey: '#988b8b',\n    red: 'red',\n    border: 'black',\n    cardBackground: 'white'\n  }\n}\n\nconst darkTheme = {\n  ...S,\n  thinBorder: '2px solid white',\n  colors: {\n    text: 'white',\n    background: '#292929',\n    blue: '#73b0fa',\n    darkGrey: '#b3afaf',\n    lightGrey: '#4a4343',\n    red: '#eb83a8',\n    border: 'white',\n    cardBackground: '#1a1a1a'\n  }\n}\n\nexport default {\n  lightTheme,\n  darkTheme\n}","/*\n *  $shared / index\n */\nimport { arrowBack, closeOutline, } from 'ionicons/icons'\nimport { CircularProgress as _CircularProgress } from '@material-ui/core'\nimport _Box from '@material-ui/core/Box'\nimport {\n  ChevronLeft as _ChevronLeft,\n  ChevronRight as _ChevronRight,\n  Close as _Close,\n  Menu as _MenuIcon,\n} from '@material-ui/icons'\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from 'react'\nimport {\n  Route as _Route, useHistory,\n} from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport C from './C'\nimport { AuthContext, AuthContextProvider, } from '$components/users'\n\n/* A */\nconst Actions = styled.div`\n\n  // @TODO: this should use variables, for Modal inner size.\n  position: fixed; // for GalleriesShow\n  top: 60px;\n  right: 60px;\n\n  display: flex;\n  flex-direction: row-reverse;\n`;\nexport { Actions, AuthContext, AuthContextProvider, }\n\n/* B */\n\n/**\n * Back Button\n */\n// const BackIcon = styled(IonIcon)\n// @TODO: reintroduce IonIcon maybe?\nconst BackIcon = styled.div`\n  margin-right: 5px;\n  cursor: pointer;\n`;\nexport const BackBtn = () => {\n  const history = useHistory()\n  return <BackIcon onClick={history.goBack} icon={arrowBack}></BackIcon>\n}\n\n/**\n * Just your regular shadowed box. Pointer cursor. TDD\n */\nexport const Btn = styled.div`\n  border: 1px solid gray;\n  border-radius: 5px;\n  cursor: pointer;\n  display: inline-block;\n  padding: .3em 1em;\n`;\n\n\n/* C */\nexport { default as C } from './C'\nexport const ChevronLeft = styled(_ChevronLeft)`\n  color: ${(p) => p.theme.colors.text}\n`;\nexport const ChevronRight = styled(_ChevronRight)`\n  color: ${(p) => p.theme.colors.text}\n`;\n\n/**\n * Card\n */\nexport const Card = styled(_Box)`\n  margin-bottom: 1em;\n  padding: 1em;\n  background: white;\n  cursor: ${p => p.cursor ? p.cursor : 'auto'};\n\n  display: flex;\n  flex-direction: column;\n`;\n\n/**\n * CloseBtn\n**/\nexport const CloseBtn = ({ children, ...props }) => {\n  return <_Close {...props} />\n};\nCloseBtn.propTypes = {\n  onClick: PropTypes.func.isRequred,\n}\n\n/* D */\n\n/* F */\n\n/**\n * FlexCol\n**/\nconst _FlexCol = styled.div`\n  display: flex;\n  flex-direction: column;\n\n  > * {\n    margin: auto .4em; // @TODO: standardize this size!\n  }\n`;\nexport const FlexCol = ({ children, ...props }) => <_FlexCol className=\"FlexCol\" {...props} >{children}</_FlexCol>\n\n/**\n * FlexRow\n**/\nexport const FlexRow = styled.div`\n  display: flex;\n\n  > * {\n    // margin: auto .4em; // @TODO: why? the LoginModal needs no margins!\n  }\n`;\n\n\n/* I */\n\n/**\n * Like the rails inflector, has methods:\n * tableize()\n */\nexport const inflector = {\n  tableize: (m) => {\n    switch(m) {\n      case 'Gallery':\n        return 'galleries'\n      default:\n      return `${m.toLowerCase()}s`\n    }\n  },\n}\n\n/* L */\n\n\n// From: https://codepen.io/charlyarg/pen/GByKja\nconst _Circle = styled.div`\n  position: fixed;\n  z-index: 999;\n  overflow: show;\n  margin: auto;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  width: 50px;\n  height: 50px;\n`;\nexport const Loading = (p) => <_Circle><_CircularProgress /></_Circle>\n\n/**\n * Usage: logg(someObject, 'label')\n *\n * This development-grade logger can be used instead of console.log() with some advantages:\n * * It encourages consistent labeling of logs. By labeling each log line, you can have dozens of log lines\n * written per action, and still know which log line comes from where.\n * The recommended label is the component name, or function name.\n * * If the label is present, the logged object is placed in the window, allowing you to inspect it in the console. The\n * label becomes the name of the object (stripped to [0-9a-zA-Z\\-_] chars). If you're logging a function, you can execute it.\n * If you log more than one thing, they can interact, allowing you to validate control flow.\n * * the logger can be turned off by making this function simply return.\n */\nconst logg = (a, b=\"\", c=null) => {\n  c = \"string\" === typeof c ? c : b.replace(/\\W/g, \"\");\n  if (c.length > 0) {\n    window[c] = a;\n  }\n\n  console.log(`+++ ${b}:`, a); // eslint-disable-line no-console\n};\n// optimized for Android (e.g. it inspects and doesn't use window)\nconst logg2 = (a, b=\"\", c=null) => {\n  console.log(`+++ ${b}:`, a.inspect); // eslint-disable-line no-console\n};\nexport { logg, logg2 };\n\n/* M */\nexport const MenuIcon = styled(_MenuIcon)`\n  color: ${(p) => p.theme.colors.text}\n`;\n\n/* P */\n\n/**\n * pretty print date\n */\nexport const pp_date = (d) => (d || \"\" ).substring(0, 10)\n\n/* R */\n\nexport { default as request } from \"./request\"\n\n/* S */\nexport { default as S } from \"./S\"\n\n/* T */\n\nexport const TwofoldContext = React.createContext({})\nexport const TwofoldContextProvider = ({ children, ...props }) => {\n  // logg(props, 'TwofoldContextProvider')\n  const {\n    currentUser, setCurrentUser,\n    layout, setLayout,\n    loginModalOpen, setLoginModalOpen,\n    theme, toggleTheme,\n    useApi,\n  } = props\n\n  const api = useApi()\n\n  useEffect(() => {\n    let closure = setTimeout(async () => {\n      const result = await api.getMyAccount()\n      setCurrentUser(result)\n    }, 1 * 1000)\n    return () => clearTimeout(closure)\n  }, [currentUser.is_purchasing])\n\n  /* B */\n  // @TODO: does localStorage work like this on mobile?\n  // @TODO: try and catch\n  const [ bottomDrawerOpen, _setBottomDrawerOpen ] = useState(JSON.parse(localStorage.getItem(C.bottomDrawerOpen)))\n  const setBottomDrawerOpen = (m) => {\n    localStorage.setItem(C.bottomDrawerOpen, JSON.stringify(m))\n    _setBottomDrawerOpen(m)\n  }\n\n  /* F */\n  const [ folded, setFolded ] = useState()\n\n  /* I */\n  const [ itemToUnlock, _setItemToUnlock ] = useState({})\n  const setItemToUnlock = (item) => {\n    if (itemToUnlock.id !== item.id && !loginModalOpen) {\n      _setItemToUnlock(item)\n    }\n  }\n\n  /* M */\n  const [ mapPanelWidth, setMapPanelWidth ] = useState(null)\n  const [ mapPanelHeight, setMapPanelHeight ] = useState(null)\n\n  /* P */\n  const [ purchaseModalIsOpen, setPurchaseModalIsOpen ] = useState(false)\n\n  /* R */\n  const [ ratedConfirmation, _setRatedConfirmation ] = useState(JSON.parse(localStorage.getItem(C.ratedConfirmation)))\n  const setRatedConfirmation = (which) => {\n    localStorage.setItem(C.ratedConfirmation, JSON.stringify(which))\n    _setRatedConfirmation(which)\n  }\n\n  /* S */\n  const [ showItem, setShowItem ] = useState(false)\n  const [ showUrl, setShowUrl ] = useState(false)\n\n  /* T */\n  let tmp, defaultTwofoldPercent = 0.5\n  if (tmp = localStorage.getItem(C.twofoldPercent)) {\n    try {\n      defaultTwofoldPercent = JSON.parse(tmp)\n    } catch (err) {\n      logg(err, 'cannot get twofoldPercent from localStorage')\n    }\n  }\n  const [ twofoldPercent, setTwofoldPercent ] = useState(0.5)\n\n  /* Z */\n  const [ zoom, setZoom ] = useState(1)\n\n  return <TwofoldContext.Provider value={{\n    bottomDrawerOpen, setBottomDrawerOpen,\n\n    currentUser, setCurrentUser, // @TODO: move this to an AppWrapper context\n\n    folded, setFolded,\n\n    itemToUnlock, setItemToUnlock,\n\n    layout, setLayout,\n    loginModalOpen, setLoginModalOpen,\n\n    mapPanelHeight, setMapPanelHeight,\n    mapPanelWidth, setMapPanelWidth,\n\n    purchaseModalIsOpen, setPurchaseModalIsOpen,\n\n    ratedConfirmation, setRatedConfirmation,\n\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n\n    twofoldPercent, setTwofoldPercent,\n\n    useApi,\n\n    zoom, setZoom,\n\n    theme, toggleTheme,\n  }} >{ children }</TwofoldContext.Provider>\n}\nTwofoldContextProvider.PropTypes = {\n\n  currentUser: PropTypes.object.isRequired,\n  setCurrentUser: PropTypes.func.isRequired,\n\n  useApi: PropTypes.func.isRequred,\n}\n\n/* U */\nexport { default as useWindowSize } from './useWindowSize'\n\n/* W */\n\n/**\n * Wrapper Bordered. This expects a list? _vp_ 2021-11-02\n * Used in collapsibles and MarkersList\n */\nexport const WBordered = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.cardBackground};\n  padding: .5em;\n\n  margin-bottom: 1em;\n`;\n\n/**\n * Wrapper Bordered Item. Is padded, margined.\n */\nexport const WBorderedItem = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.cardBackground};\n  color: ${p => p.theme.colors.text};\n\n  margin: 0 .5em .5em 0;\n  padding: .5em;\n\n  text-align: center;\n\n  width: 18%;\n  max-width: 140px;\n  min-width: 120px;\n`;\n\n\nexport const WidgetContainer = ({ children, ...props }) => {\n  return <WBordered {...props} >{ children }</WBordered>\n}\n\nexport const Wrapper = styled.div`\n  height: 100vh;\n`;\n\n/* Z */\n\nexport const ZoomContext = React.createContext({})\n\n\n\n","/**\n * ishjs / jwt_manager\n */\n\nimport PropTypes from 'prop-types'\nimport React, { useContext, useEffect, useState } from 'react'\nimport styled from 'styled-components'\n\nimport { Btn, C, logg, request } from \"$shared\" // @TODO: alias $shared\n\n\n\n// @TODO: testdrive this context,\n// @TODO: replace TwofoldContext in guydme with the one from ishjs.\nexport const JwtContext = React.createContext({})\nconst JwtContextProvider = ({ children, ...props }) => {\n  logg(props, 'JwtContextProvider')\n  const {\n    api,\n  } = props\n\n  const maybeUser = JSON.parse(localStorage.getItem(C.current_user)) || C.anonUser\n  const [ currentUser, setCurrentUser ] = useState(maybeUser)\n  const [ loginModalOpen, setLoginModalOpen ] = useState({})\n\n  // call to verify creds\n  useEffect(() => {\n    // request.get(`${config.apiOrigin}${config.routes.myAccountPath}`).then((r) => r.data).then((resp) => {\n    api.getMyAccount().then((resp) => {\n      localStorage.setItem(C.current_user, JSON.stringify(resp))\n      setCurrentUser(resp) // must be done *after* setting C.jwt_token\n    }).catch((e) => {\n      logg(e, 'e322')\n      // toast(\"Login failed\") // @TODO: re-add toast\n      setCurrentUser(C.anonUser)\n      localStorage.removeItem(C.current_user)\n      localStorage.removeItem(C.jwt_token)\n    })\n  }, [])\n\n  return <JwtContext.Provider value={{\n    api,\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n  }} >{ children }</JwtContext.Provider>\n}\nJwtContextProvider.props = {\n  api: PropTypes.object,\n}\nexport { JwtContextProvider }\n\n// @TODO: move to shared?\nconst FlexRow = styled.div`\n  display: flex;\n\n  > * {\n    margin: auto .4em;\n  }\n`;\n\nconst W1 = styled.div`\n  border: 1px solid red;\n`;\n\nconst W2 = styled.div`\n  display: flex;\n`;\n\nexport const SimpleJwtRow = () => {\n  const {\n    api,\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n  } = useContext(JwtContext)\n  logg(useContext(JwtContext), 'SimpleJwtRowUsedJwtContext')\n\n  return <W1>\n    <FlexRow>\n      { /* <FbLogin /> */ }\n      { currentUser.email && <W2>\n        <i>{currentUser.email}</i>\n        <Logout />\n      </W2>}\n      { !currentUser.email && <LoginWithPassword /> }\n    </FlexRow>\n  </W1>\n}\n\n\n\nconst _W = styled.div`\n  display: flex;\n\n  > * {\n    // margin: auto .4em;\n  }\n`;\n\nexport const LoginWithPassword = (props) => {\n  // logg(useContext(JwtContext), 'useContext(JwtContext)')\n  const {\n    api,\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n  } = useContext(JwtContext)\n  const [ email, setEmail ] = useState('')\n  const [ password, setPassword ] = useState('')\n\n  const doPasswordLogin = async (email, password) => {\n    // logg(`${config.apiOrigin}${config.routes.loginWithPasswordPath}`, 'doPasswordLogin')\n    // request.post(`${config.apiOrigin}${config.routes.loginWithPasswordPath}`, { email, password }).then((r) => r.data\n    api.postLoginWithPassword({ email, password }).then((resp) => {\n      logg(resp, 'ze resp')\n\n      localStorage.setItem(C.jwt_token, resp.jwt_token)\n      localStorage.setItem(C.current_user, JSON.stringify(resp))\n      setCurrentUser(resp) // must be done *after* setting C.jwt_token\n      setLoginModalOpen(false)\n    }).catch((e) => {\n      logg(e, 'e322')\n      toast(\"Login failed\")\n      setCurrentUser(C.anonUser)\n    })\n  }\n\n  return <_W>\n    <input type='email' value={email} onChange={(e) => setEmail(e.target.value) } /><br />\n    <input type='password' value={password} onChange={(e) => setPassword(e.target.value) }\n      onKeyDown={(e) => {\n        if (e.key === 'Enter') { doPasswordLogin(email, password) }\n      }}\n    />\n    <Btn onClick={() => doPasswordLogin(email, password)}>Login</Btn>\n  </_W>\n}\n\n\nexport const Logout = () => {\n  const { currentUser, setCurrentUser } = useContext(JwtContext)\n  const doLogout = () => {\n    localStorage.removeItem(C.jwt_token)\n    localStorage.removeItem(C.current_user)\n    setCurrentUser({})\n  }\n  return <Btn onClick={doLogout}>Logout</Btn>\n}\n","/*\n * ishjs / components / users / PasswordLogin\n */\n\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useState, } from 'react'\nimport { ToastContainer, toast } from 'react-toastify'\nimport 'react-toastify/dist/ReactToastify.css'\nimport styled from 'styled-components'\n\nimport {\n  Btn, C, logg, request,\n} from \"$shared\"\nimport {\n  AuthContext,\n} from './'\n\nconst _W = styled.div`\n  display: flex;\n\n  > * {\n    // margin: auto .4em;\n  }\n`;\n\n/**\n * Exchange your email and password for a jwt token.\n * api.doLogin() must be present.\n * Requires being wrapped in TwofoldContext, which should have:\n * * currentUser, setCurrentUser,\n * * useApi\n *\n * Sets `C.current_user` and `C.jwt_token` in local storage.\n *\n * Allows logout. (@TODO: not implemented)\n */\nconst PasswordLogin = (props) => {\n  // logg(props, 'PasswordLogin')\n\n  const {\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n    useApi,\n  } = useContext(SimpleContext)\n  // logg(useContext(SimpleContext), 'PasswordLoginUsedContext')\n\n  const [ email, setEmail ] = useState('')\n  const [ password, setPassword ] = useState('')\n\n  const api = useApi()\n\n  // api.doLogin = `${config.apiOrigin}${api.loginPath}`\n  const doPasswordLogin = async (email, password) => {\n    api.postLogin({ email, password }).then((resp) => {\n      // localStorage.setItem(C.jwt_token, resp.jwt_token)\n      // localStorage.setItem(C.current_user, JSON.stringify(resp))\n      // setCurrentUser(resp) // must be done *after* setting C.jwt_token\n\n      setLoginModalOpen(false)\n    }).catch((e) => {\n      logg(e, 'e322')\n      toast(\"Login failed\")\n      setCurrentUser(C.anonUser)\n    })\n  }\n\n  return <_W>\n    <input type='email'    value={email}    onChange={(e) => setEmail(e.target.value)    } /><br />\n    <input type='password' value={password} onChange={(e) => setPassword(e.target.value) }\n      onKeyDown={(e) => { if (e.key === 'Enter') { doPasswordLogin(email, password) } }}\n    />\n    <Btn onClick={() => doPasswordLogin(email, password)}>Password Login</Btn>\n  </_W>\n}\nPasswordLogin.propTypes = {\n  // none so far\n}\n\nexport default PasswordLogin\n","\nimport React, { Fragment as F, useContext, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\n\nimport {\n  AuthContext,\n} from '$components/users'\nimport {\n  Actions,\n  Btn,\n  C,\n  logg,\n} from '$shared'\n\nconst W0 = styled.div`\n`;\n\n\n/**\n * A single text area that saves locally and in the cloud.\n */\nconst Scratchpad = (props) => {\n  // logg(props, 'Scratchpad')\n\n  const {\n    useApi,\n  } = useContext(AuthContext)\n\n  const api = useApi()\n\n  const [ txt, setTxt ] = useState(localStorage.getItem(C.names.scratchpad) || '')\n\n  const doSave = () => {\n    localStorage.setItem(C.names.scratchpad, txt)\n    api.postProfile({ scratchpad: txt }).then((data) => {\n      // toast('Updated profile.')\n    }).catch((err) => {\n      logg('Cannot update profile:', err)\n      // toast('e54 - Cannot update profile.')\n    })\n  }\n\n  return <W0>\n    <textarea name='scratchpad' rows='20' cols='40'\n      onChange={(e) => setTxt(e.target.value) }\n      value={txt}\n    / >\n    <Actions>\n      <Btn onClick={doSave}>Save</Btn>\n    </Actions>\n  </W0>\n}\nScratchpad.propTypes = {\n  // none so far\n}\n\nexport default Scratchpad\n","import { IonApp, IonButtons, IonMenuButton } from '@ionic/react'\nimport Drawer from '@material-ui/core/Drawer'\nimport Fab from '@material-ui/core/Fab'\nimport IconButton from '@material-ui/core/IconButton'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport {\n  C,\n  logg,\n  MenuIcon,\n} from \"$shared\"\n\nconst W0 = styled.div`\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  align-content: space-between;\n`;\n\n\nconst SideMenu = ({ children, ...props }) => {\n  const { listItems } = props\n  // logg(props, 'SideMenu')\n\n  const [ drawerOpen, setDrawerOpen ] = React.useState(false)\n  const [ loading, setLoading ] = useState(false)\n  const history = useHistory()\n\n  return <F>\n\n    { /* @TODO: probably remove from here, too many variations of the button, it gotta be separate */ }\n    { props.variant === C.variants.floating ?\n      <Fab onClick={() => setDrawerOpen(true)} style={{ position: 'absolute', top: 0, left: 0, margin: '.5em', zIndex: 1 }} aria-label='main menu'><MenuIcon /></Fab>\n      : <MenuIcon onClick={() => setDrawerOpen(true)} /> }\n\n    <Drawer anchor={\"left\"} open={drawerOpen} onClose={() => setDrawerOpen(false)} >\n      <W0>\n        <List>\n\n          { listItems.map( ({ label, key, path }) => <ListItem button key={key}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(path())\n            } } >{ label }\n          </ListItem> )}\n\n        </List>\n\n        { children }\n      </W0>\n    </Drawer>\n\n  </F>\n}\n\nSideMenu.propTypes = {\n  listItems: PropTypes.array.isRequired, // @TODO: specify: key, label, path\n  variant: PropTypes.string,\n}\nexport default SideMenu\n","import React, { useContext } from 'react'\n\nimport config from \"config\"\nimport {\n  AuthContext,\n} from 'ishlibjs'\n\nimport { C,\n  logg, // eslint-disable-line no-unused-vars\n  request,\n} from \"$shared\"\n\nconst useApi = () => {\n  const {\n    setCurrentUser,\n    setLoginModalOpen,\n  } = useContext(AuthContext)\n\n  const token = localStorage.getItem(C.jwt_token)\n\n  return {\n\n    deleteNewsitem: ({ id }) => {\n      return request.delete(`${config.apiOrigin}/api/newsitems/${id}?jwt_token=${token}`).then((r) => r.data).then((r) => {\n        return r\n      })\n    },\n    doRegister: ({email, password }) => {\n      return request.post(`${config.apiOrigin}/api/users`, { email, password }).then((r) => r.data).then((r) => {\n        logg(r, 'done registered')\n        return r\n      })\n    },\n    /* Returns current user */\n    doUnlock: ({ kind, id }) => {\n      const jwt_token = localStorage.getItem('jwt_token')\n      const path = `/api/payments/unlock?kind=${kind}&id=${id}&jwt_token=${jwt_token}`\n      return request.post(`${config.apiOrigin}${path}`).then((r) => r.data)\n    },\n\n    getCities: ()   => request.get(`${config.apiOrigin}/api/cities`).then((r) => r.data),\n    getCity: (slug) => request.get(`${config.apiOrigin}/api/cities/view/${slug}`),\n    getGallery: (slug) => request.get(`${config.apiOrigin}/api/galleries/view/${slug}?jwt_token=${token}`).then((r) => r.data.gallery),\n\n    getMyAccount: () => request.post(`/api/my/account`, { jwt_token: token, }).then((r) => r.data),\n\n    getPayments: () => request.get(`${config.apiOrigin}/api/payments2?jwt_token=${token}`).then((r) => r.data),\n\n    getReport: (slug) => request.get(`${config.apiOrigin}/api/reports/view/${slug}?jwt_token=${token}`).then((r) => r.data.report),\n\n    getTag: (tag) => request.get(`${config.apiOrigin}/api/tags/view/${tag.slug}`).then((r) => r.data),\n\n    loginPath: '/api/users/login.json',\n    longTermTokenPath: '/api/users/long_term_token',\n\n    postLogin: ({ email, password }) => {\n      return request.post(`${config.apiOrigin}${config.router.loginPath}`, { email, password }).then((r) => r.data).then((resp) => {\n        logg(resp, 'got this resp')\n\n        localStorage.setItem(C.jwt_token, resp.jwt_token)\n        localStorage.setItem(C.current_user, JSON.stringify(resp))\n        setCurrentUser(resp) // must be done *after* setting C.jwt_token\n        setLoginModalOpen(false)\n      }).catch((e) => {\n        logg(e, 'e322')\n        toast(\"Login failed\")\n        setCurrentUser(C.anonUser)\n      })\n    },\n\n    myVideosPath: \"/api/my/videos\", // @TODO: remove\n\n    applicationHome: () => {\n      request.get(`${config.apiOrigin}/api/sites/view/${config.domain}`, { params: { jwt_token: token } }).then((r) => {\n        return r.data\n      })\n    }\n  }\n\n}\n\nexport default useApi\n","/*\n * components / TwofoldLayout / index.jsx\n */\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\n\nimport { C, logg } from \"$shared\"\n\n/**\n * LongLine\n *\n * Turns out I need this still - part of the layout.\n */\nconst LongLine = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n\n  flex-grow: 1;\n\n  width: ${p => p.orientation === C.horizontal ? 'auto' : '10px'};\n  height: ${p => p.orientation === C.horizontal ? '10px' : 'auto'};\n\n  padding: 2px;\n  background: ${p => p.theme.colors.background};\n`;\nLongLine.propTypes = {\n  orientation: PropTypes.string, // 'horizontal' or 'vertical'\n}\n\nexport { LongLine }\n","\nimport _Drawer from '@material-ui/core/Drawer'\nimport IconButton from '@material-ui/core/IconButton'\nimport React, { Fragment as F, useContext, useState } from 'react'\nimport styled from 'styled-components'\nimport Web3 from 'web3'\nimport { useWeb3React, Web3ReactProvider } from \"@web3-react/core\"\nimport { InjectedConnector } from '@web3-react/injected-connector'\n\nimport { LongLine } from \"$components/TwofoldLayout\"\nimport { MyAccountWidget } from \"$components/users\"\nimport { C, logg, MenuIcon, S, TwofoldContext, } from \"$shared\"\n\nconst Drawer = styled(_Drawer)`\n  .MuiDrawer-paper {\n    // border: 1px solid cyan;\n\n    background: ${p=>p.theme.colors.background};\n  }\n\n  .MuiDrawer-paperAnchorDockedBottom {\n    border-top: 0;\n  }\n\n`;\n\nfunction getLibrary(provider) {\n  return new Web3(provider)\n}\n\nconst Inner0 = styled.div`\n  display: flex;\n  align-items: flex-start;\n  color: ${p => p.theme.colors.text};\n`;\n\nconst Inner1 = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n\n  background: ${p=>p.theme.colors.background};\n  height: calc(${p=>p.theme.bottomDrawerOpenHeight} + 1*${p=>p.theme.borderHeight});\n  margin: ${p=>p.theme.borderWidth};\n\n  flex-grow: 1;\n`;\n\n// TODO: I may not need this\nconst Inner2 = styled.div`\n  // border: 1px solid green;\n\n  background: ${p=>p.theme.colors.cardBackground};\n  height: 100px;\n  display: flex;\n`;\n\nconst WClosed = styled.div`\n  // border: 1px solid yellow;\n\n  position: absolute;\n  bottom: -10px;\n  // left: 10px;\n\n  width: calc(100% - 2*${p=>p.theme.borderWidth});\n\n  display: flex;\n  align-items: center;\n`;\n\n/**\n * BottomDrawer\n */\nconst BottomDrawer = (props) => {\n  // logg(props, 'BottomDrawer')\n\n  const { bottomDrawerOpen, layout, setBottomDrawerOpen } = useContext(TwofoldContext)\n\n  // @TODO: move the component to layout_onecol then\n  if (layout === C.layout_onecol) { return null; }\n\n  return <F>\n\n    <WClosed>\n      <IconButton\n        aria-label=\"open drawer\"\n        onClick={() => setBottomDrawerOpen(true)}\n      ><MenuIcon\n        fontSize=\"small\"\n      /></IconButton>\n      <LongLine orientation={C.horizontal} />\n    </WClosed>\n\n\n    <Drawer anchor={\"bottom\"}\n      elevation={1}\n      open={bottomDrawerOpen}\n      onClose={() => setBottomDrawerOpen(false)}\n      BackdropProps={{ invisible: true }}\n      variant={\"persistent\"}\n    >\n      <Inner0 >\n        <IconButton\n          aria-label=\"open drawer\"\n          onClick={() => setBottomDrawerOpen(false)}\n          style={{ paddingRight: 0 }}\n        ><MenuIcon\n          fontSize=\"small\"\n        /></IconButton>\n\n        <Inner1 >\n          <Inner2 >\n\n            {/* @TODO: move this upstream */}\n            <Web3ReactProvider getLibrary={getLibrary}>\n              <MyAccountWidget />\n            </Web3ReactProvider>\n\n          </Inner2>\n        </Inner1>\n      </Inner0>\n    </Drawer>\n  </F>\n}\n\nexport default BottomDrawer\n","import React from 'react'\nimport styled from 'styled-components'\n\nimport { logg, C, } from \"$shared\"\nimport { MenuLeft, } from \"$components/application\"\n\nconst Header = styled.div`\n  // border: 1px solid red;\n\n  flex-grow: 1;\n\n  text-align: center;\n  font-size: 2em;\n\n\n`;\n\nconst Root = styled.div`\n  // border: 1px solid blue;\n\n  display: flex;\n  justify-content: center;\n  line-height: 2em;\n  padding: 2em 0;\n`;\n\n/*\n * @TODO: likely destroy this file\n */\nconst MainHeader = (props) => {\n  // logg(props, 'MainMenu')\n\n  return <Root>\n    <MenuLeft variant={C.variants.inline} />\n    <Header>My Local Guide</Header>\n  </Root>\n}\n\nexport default MainHeader\n","\nimport React from 'react'\nimport styled from 'styled-components'\n\nconst MapuiContainer = styled.div`\n  // border: 1px solid purple;\n\n  background: white;\n\n  overflow: hidden;\n  margin: 10px;\n  height: calc(100vh - ${p => p.borderWidth*2}px - ${p => p.bottomDrawerOpen ? `${p.bottomDrawerHeight - p.borderWidth/2}px` : '0px' });\n`\n\nexport {\n  MapuiContainer,\n}\n\nconst MapuiLayout = (props) => {\n  return <MapuiContainer {...props} />\n}\n\nexport default MapuiLayout\n","\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, request, S, TwofoldContext, ZoomContext } from \"$shared\"\n\nconst MapuiContainer = styled.div`\n  // border: 1px solid cyan;\n  // background: white;\n\n  overflow-y: auto;\n\n  height: calc(100vh\n    - ${p => p.bottomDrawerOpen ? p.bottomDrawerOpenHeight : p.bottomDrawerClosedHeight });\n`;\n\nexport {\n  MapuiContainer,\n}\n\nconst MapuiMobileLayout = (props) => {\n  const { bottomDrawerOpen } = useContext(TwofoldContext)\n  return <MapuiContainer {...props} {...{ bottomDrawerOpen }} {...S} />\n}\n\nexport default MapuiMobileLayout\n","\n\n/*\n * @TODO: Likely destroy this file\n */\n\nimport {\n  IonContent,\n  IonIcon,\n  IonItem,\n  IonLabel,\n  IonList,\n  IonMenu,\n  IonMenuToggle,\n  IonHeader,\n  IonToolbar,\n  IonTitle,\n} from '@ionic/react';\n\nimport React from 'react';\nimport { newspaperOutline, bus, person, powerOutline } from 'ionicons/icons';\nimport './application.scss';\n\nconst appPages = [\n  {\n    title: 'Homefeed',\n    icon: newspaperOutline,\n    url: \"/en\"\n  },\n  {\n    title: 'Cities',\n    icon: bus,\n    url: \"/en/cities\"\n  },\n  {\n    title: 'My Account',\n    icon: person,\n    url: \"/en/account\"\n  },\n  {\n    title: 'Account2',\n    icon: person,\n    url: \"/en/account2\"\n  },\n  {\n    title: 'Login',\n    icon: powerOutline\n  }\n];\n\n/**\n * 20210529 - I think this is obsolete somehow, I'm using MyDrawer in App.jsx\n *\n */\nconst Menu = () => {\n  return (\n    <IonMenu contentId=\"main\" type=\"overlay\">\n      <IonHeader>\n        <IonToolbar color=\"primary\">\n          <IonTitle>Menu</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent>\n        <img src=\"/assets/hero.png\" />\n        <IonList id=\"inbox-list\">\n          { appPages.map((appPage, index) => <IonMenuToggle key={index} autoHide={false}>\n            <IonItem\n              routerLink={appPage.url}\n              routerDirection=\"none\"\n              lines=\"none\"\n              detail={false}>\n              <IonIcon\n                slot=\"start\"\n                ios={appPage.icon}\n                md={appPage.icon} />\n              <IonLabel>{appPage.title}</IonLabel>\n            </IonItem>\n          </IonMenuToggle>) }\n        </IonList>\n      </IonContent>\n    </IonMenu>\n  )\n}\n\nexport default Menu\n","import { IonApp, IonButtons, IonMenuButton } from '@ionic/react'\nimport Drawer from '@material-ui/core/Drawer'\nimport Fab from '@material-ui/core/Fab'\nimport IconButton from '@material-ui/core/IconButton'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport { Menu } from \"$components/application\"\nimport { Api, C, Debug, logg, MenuIcon, TwofoldContext, } from \"$shared\"\n\nconst _LeftWrapper = styled.div`\n  // border: 1px solid green;\n`;\n\nconst W0 = styled.div`\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  align-content: space-between;\n`;\n\n\nconst SideMenu = (props) => {\n  // logg(props, 'SideMenu')\n\n  const [ drawerOpen, setDrawerOpen ] = React.useState(false)\n  const [ loading, setLoading ] = useState(false)\n  const history = useHistory()\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  return <F>\n\n    { /* <Menu /> */ }\n\n    { /* @TODO: probably remove from here, too many variations of the button, it gotta be separate */ }\n    { props.variant === C.variants.floating ?\n      <Fab onClick={() => setDrawerOpen(true)} style={{ position: 'absolute', top: 0, left: 0, margin: '.5em' }} aria-label='main menu'><MenuIcon /></Fab>\n      : <MenuIcon onClick={() => setDrawerOpen(true)} /> }\n\n    <Drawer anchor={\"left\"} open={drawerOpen} onClose={() => setDrawerOpen(false)} >\n      <W0>\n        <List>\n\n          <ListItem button key={'newsfeed'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(config.homeLocation)\n            } } >Home\n          </ListItem>\n\n          { /* <ListItem button key={'three'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/locations/show/threev1\")\n            } } >Three\n          </ListItem>\n\n          <ListItem button key={'three'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/locations/show/construct03d\")\n            } } >Construct0 3D\n          </ListItem>\n\n          <ListItem button key={'cities'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/cities\")\n            } }>\n            <span >Cities</span>\n          </ListItem>\n\n          <ListItem button key={'map 1'} >\n            <span onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/locations\")\n            } }>The Directory</span>\n          </ListItem> */ }\n\n          { currentUser && currentUser.bookmarks?.map((b, idx) =>\n            <ListItem button key={idx}\n              onClick={() => {\n                setDrawerOpen(false)\n                history.push(`/en/locations/show/${b.slug}`)\n              } } >\n              <span >{b.name}</span>\n            </ListItem>\n          ) }\n\n          <ListItem button key={'account'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(`/en/locations/show/${currentUser.id}`)\n            } } >\n            <span >Account</span>\n          </ListItem>\n\n          <ListItem>\n            Version 0.0.0\n          </ListItem>\n\n        </List>\n        { /* <W2>\n          { loading && 'Loading...' }\n          { currentUser && <F>\n            {currentUser.email}<br />\n            {currentUser.n_stars}<br />\n            some action\n          </F> }\n        </W2> */ }\n      </W0>\n    </Drawer>\n  </F>\n}\n\nSideMenu.propTypes = {\n  variant: PropTypes.string,\n}\nexport default SideMenu\n","import React from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport \"./application.scss\";\nimport styled from 'styled-components'\n\nimport { Api, logg, request, pp_date } from \"$shared\"\n\nconst W = styled.div`\n  margin: .5em 0;\n  color: ${p=>p.theme.colors.text};\n`\n\nconst Metaline = (props) => {\n  // logg(props, 'Metaline')\n\n  const { created_at, username, city, tags = [] } = props;\n\n  function navigateToCity(){\n    props.history.push(`/en/cities/travel-to/${city.slug}/show/newsfeed`);\n  }\n\n  return (\n    <W>\n      { created_at && <span className=\"date\"> On {pp_date(created_at)} </span>}\n      { username && <>by <span className=\"user\"> {username} </span></> }\n      { city     && <>in <span className=\"city\" onClick={navigateToCity}> {city.name} </span></> }\n      { tags     && tags.map((tag, i) => <span key={i} className=\"tags\">{tag.name}</span>) }\n    </W>\n  );\n\n}\n\nexport default withRouter(Metaline);","\n\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { CardElement, Elements, useElements, useStripe, } from '@stripe/react-stripe-js'\nimport { loadStripe } from '@stripe/stripe-js'\nimport styled from 'styled-components'\n\nimport {\n  Btn,\n  logg,\n  request,\n  S,\n  TwofoldContext,\n} from \"$shared\"\n\nconst stripePromise = loadStripe('pk_test_qr1QPmSpLdBFt1F7itdWJOj3') // @TODO: this is active, but change.\n\nconst _PurchaseModal = (props) => {\n\n  const {\n    purchaseModalOpen, setPurchaseModalOpen,\n  } = useContext(TwofoldContext)\n  // logg(useContext(TwofoldContext), 'PurchaseModalUsedTwofoldContext')\n\n  const stripe = useStripe()\n  const elements = useElements()\n\n  // buy unlocks (coins)\n  // @TODO: rename\n  const handleSubmit = async (event) => {\n    event.preventDefault()\n\n    if (!stripe || !elements) { return }\n    const cardElement = elements.getElement(CardElement)\n    let client_secret = await api.getPayments()\n\n    const result = await stripe.confirmCardPayment(client_secret.client_secret, {\n      payment_method: {\n        card: elements.getElement(CardElement),\n      },\n    })\n\n    if (result.error) {\n      logg(result.error.message, 'error message')\n    } else {\n      if (result.paymentIntent.status === 'succeeded') {\n        let response = await api.getMyAccount()\n        logg(response, 'tr2')\n        setCurrentUser(response)\n        setPurchaseModalOpen(false)\n      }\n    }\n  }\n\n  return <F>\n\n    <Btn>Spend $</Btn>\n\n    <Modal isOpen={purchaseModalOpen} ariaHideApp={false} >\n      <h1>\n        Buy unlocks\n        <span onClick={() => { setPurchaseModalOpen(false) } } >[x]</span>\n      </h1>\n      <form onSubmit={handleSubmit} >\n        <CardElement />\n        <button type=\"submit\" disabled={!stripe} >Pay</button>\n      </form>\n    </Modal>\n  </F>\n}\nconst PurchaseModal = (props) => <Elements stripe={stripePromise}><_PurchaseModal {...props} /></Elements>;\nexport default PurchaseModal\n","import React, { useEffect, useState } from \"react\";\nimport { IonIcon } from \"@ionic/react\";\nimport { starOutline, starHalf, star } from 'ionicons/icons';\nimport \"./application.scss\";\n\nconst Rating = (props) => {\n\n  let rate = props.rate;\n  let [rating, setRating] = useState([]);\n\n  let iconMapping = {\n    0: starOutline,\n    1: starHalf,\n    2: star\n  };\n\n  useEffect(() => {\n\n    let rating = (new Array(5)).fill(0);\n    let i = 0;\n    while (rate > 0) {\n      if (rate < 1) {\n        rating[i] = 1;\n      } else {\n        rating[i] = 2;\n      }\n      rate--;\n      i++;\n    }\n\n    setRating(rating);\n\n  }, []);\n\n  return (\n    <div className=\"rating\">\n      { rating.map((r, i) => <IonIcon key={i} className=\"stars\" icon={iconMapping[r]} ></IonIcon>) }\n    </div>\n  )\n\n}\n\nexport default Rating;","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useRef, } from 'react'\nimport Modal from \"react-modal\"\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport './UnlockModal.scss'\nimport { Btn, C, logg, request, TwofoldContext, useApi, } from \"$shared\"\n\nconst Btn0 = styled.div`\n  display: inline;\n  cursor: pointer;\n`;\nconst BtnRow = styled.div`\n  display: flex;\n  justify-content: space-around;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst modalStyle = {\n  overlay: {},\n  content: {\n    margin: 'auto',\n    maxWidth: '400px',\n\n  }\n}\n\n/**\n * UnlockModal\n */\nconst UnlockModal = (props) => {\n  // logg(props, 'UnlockModal')\n\n  const {\n    currentUser, setCurrentUser,\n    itemToUnlock, setItemToUnlock,\n    loginModalOpen, setLoginModalOpen,\n    purchaseModalOpen, setPurchaseModalOpen,\n    ratedConfirmation, setRatedConfirmation,\n  } = useContext(TwofoldContext)\n  // logg(useContext(TwofoldContext), 'unlockModalUsedTwofoldContext')\n\n  const history = useHistory()\n  const api = useApi()\n\n  const doUnlock = async () => {\n    // @TODO: check how many unlocks I have, and offer to purchase more if not enough.\n    await api.doUnlock({ kind: itemToUnlock.item_type, id: itemToUnlock.id }).then((r) => {\n      setItemToUnlock({})\n\n      // @TODO: fix this mess\n\n      setCurrentUser(r)\n      // refresh the newsfeed?\n    }).catch((e) => {\n      logg(e, 'e19')\n    })\n  }\n\n  /* @TODO: this was here before, but should not be, right? _vp_ 2022-03-19 */\n  // const mountedRef = useRef('init')\n  // useEffect(() => {\n  //   const fn = async () => {\n  //     const r = await api.getMyAccount()\n  //     if (r) {\n  //       setCurrentUser(r)\n  //     }\n  //   }\n  //   fn()\n  //   return () => mountedRef.current = null\n  // }, [itemToUnlock.id])\n\n  if (!itemToUnlock.id) { return null }\n\n  let closable = typeof itemToUnlock.closable === 'undefined' ? true : itemToUnlock.closable\n\n  // @TODO: this is messy\n  let gohome = () => {\n    setItemToUnlock({})\n    setRatedConfirmation(true)\n    history.push(config.homeLocation)\n  }\n\n  const cost = itemToUnlock.premium_tier\n\n  return (<Modal style={modalStyle} ariaHideApp={false} isOpen={!!itemToUnlock.id} >\n    <Header>\n      <h1>Unlock this item?</h1>\n      { closable && <Btn0 onClick={() => closable && setItemToUnlock(false) } >&times;</Btn0> }\n    </Header>\n    <p>To access this content, please unlock it first. It costs {cost} coin(s) to unlock.</p>\n    { currentUser && <F>\n      <p>You have <b>{currentUser.n_unlocks}</b> unlocks.</p>\n      { currentUser.n_unlocks >= cost && <Btn onClick={doUnlock} >Unlock</Btn> }\n      { currentUser.n_unlocks < cost && <F>\n        <p>You don't have enough unlocks.</p>\n        <Btn onClick={() => { setPurchaseModalOpen(true) ; setItemToUnlock(false)} } >Purchase more.</Btn>\n      </F> }\n    </F> }\n    { !currentUser && <F>\n      <p>You have to be logged in to unlock content. <a onClick={() => { setLoginModalOpen(true) ; setItemToUnlock(false) }}>Please login.</a></p>\n    </F> }\n    <BtnRow>\n      { !closable && <Btn onClick={gohome} >Go Home</Btn> }\n    </BtnRow>\n  </Modal>)\n\n}\n\nexport default UnlockModal\n","\nimport {\n  ArrowDownward as _ArrowDownward,\n  ArrowUpward as _ArrowUpward,\n} from '@material-ui/icons'\nimport React from 'react'\nimport styled from 'styled-components'\n\nimport {\n  FlexCol, FlexRow,\n  logg,\n} from 'ishlibjs'\n\nconst IconUp = _ArrowUpward\n\nconst IconDown = _ArrowDownward\n\nconst WCount = styled.div``;\n\n/**\n * Voteable\n**/\nconst Voteable = (props) => {\n  // logg(props, 'Voteable')\n  const { item } = props\n\n  return <FlexCol>\n    <IconUp />\n    <WCount>555</WCount>\n    <IconDown />\n  </FlexCol>\n}\nVoteable.propTypes = {\n\n};\n\nexport default Voteable\n","\nimport { Capacitor } from '@capacitor/core'\nimport { PushNotifications } from '@capacitor/push-notifications'\nimport { Toast } from \"@capacitor/toast\"\nimport { ethers } from 'ethers'\nimport {\n  IonButton, IonButtons,\n  IonCard, IonCardContent, IonContent,\n  IonFooter,\n  IonHeader,\n  IonItem,\n  IonLabel, IonListHeader, IonList,\n  IonMenuButton,\n  IonPage,\n  IonText, IonTitle, IonToolbar,\n} from '@ionic/react'\nimport { Container, Grid } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport React, {\n  Fragment as F,\n  useContext, useEffect, useState,\n} from \"react\"\nimport { Link } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { FbLogin, Logout, } from \"./\"\nimport { C, logg, logg2, TwofoldContext } from \"$shared\"\nimport { MenuLeft } from \"$components/application\"\nimport Greeter from '$src/artifacts/contracts/Greeter.sol/Greeter.json'\nimport Token from '$src/artifacts/contracts/Token.sol/Token.json'\n\nconst isPushNotificationsAvailable = Capacitor.isPluginAvailable('PushNotifications')\n\n// Update with the contract address logged out to the CLI when it was deployed\nconst greeterAddress = \"0x4bE9765Ca063E73E0aaEd227fd6731473508DbE0\"\nconst tokenAddress = \"0xffa52d00685aC60e65457922aEae2c2783c0cB0E\"\n\nexport const PasswordLogin = () => {\n  return <div>PasswordLogin - @TODO: remove</div>\n}\n\nconst LoginRow = styled.div`\n  display: flex;\n  // border: 1px solid yellow;\n\n  > * {\n    margin: auto .4em;\n  }\n`;\n\nconst Account = (props) => {\n  // logg(props, 'Account')\n\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  const [ greeting, setGreetingValue ] = useState(\"\")\n  const [notifications, setNotifications] = useState([])\n  const [ scratchpad, setScratchpad ] = useState(\"\")\n  const saveScratchpad = () => {}\n\n  // push notifications\n  const register = () => {\n    // Register with Apple / Google to receive push via APNS/FCM\n    PushNotifications.register()\n\n    // On success, we should be able to receive notifications\n    PushNotifications.addListener('registration', (token) => {\n      showToast('Push registration success')\n    })\n\n    // Some issue with our setup and push will not work\n    PushNotifications.addListener('registrationError', (error) => {\n      alert('Error on registration: ' + JSON.stringify(error))\n    })\n\n    // Show us the notification payload if the app is open on our device\n    PushNotifications.addListener('pushNotificationReceived', (_n) => {\n      const n = _n\n      logg2(n, 'pushNotificationReceived')\n      setNotifications((ns) => {\n        logg2(ns, 'setNofitications')\n        return [...ns, { ...n, type: 'foreground' }]\n      })\n    })\n\n    // Method called when tapping on a notification\n    PushNotifications.addListener('pushNotificationActionPerformed', ({ nofitication: n }) => {\n      logg2(n, 'pushNotificationActionPerformed')\n      setNotifications((ns) => {\n        logg2(ns, 'setNofitications')\n        return [...ns, { ...n, type: 'action' }]\n      })\n    })\n  }\n\n  const showToast = async (msg) => await Toast.show({ text: msg })\n\n  // push notifications\n  useEffect(() => {\n    if (!isPushNotificationsAvailable) { return }\n\n    PushNotifications.checkPermissions().then((res) => {\n        if (res.receive === 'granted') {\n          register()\n        } else {\n          PushNotifications.requestPermissions().then((res) => {\n            if (res.receive === 'denied') {\n              showToast('Push Notification permission denied')\n            } else {\n              showToast('Push Notification permission granted')\n              register()\n            }\n          })\n        }\n      })\n  }, [])\n\n  // request access to the user's MetaMask account\n  async function requestAccount() {\n    await window.ethereum.request({ method: 'eth_requestAccounts' });\n  }\n\n  // call the smart contract, read the current greeting value\n  async function fetchGreeting() {\n    if (typeof window.ethereum !== 'undefined') {\n      const provider = new ethers.providers.Web3Provider(window.ethereum)\n      const contract = new ethers.Contract(greeterAddress, Greeter.abi, provider)\n      try {\n        const data = await contract.greet()\n        setGreetingValue(data)\n        // console.log('data: ', data)\n      } catch (err) {\n        console.log(\"Error: \", err)\n      }\n    }\n  }\n\n  async function getBalance() {\n    if (typeof window.ethereum !== 'undefined') {\n      const [account] = await window.ethereum.request({ method: 'eth_requestAccounts' })\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const contract = new ethers.Contract(tokenAddress, Token.abi, provider)\n      const balance = await contract.balanceOf(account);\n      console.log(\"Balance: \", balance.toString());\n    }\n  }\n\n  // call the smart contract, send an update\n  async function setGreeting() {\n    if (!greeting) return\n    if (typeof window.ethereum !== 'undefined') {\n      await requestAccount()\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const signer = provider.getSigner()\n      const contract = new ethers.Contract(greeterAddress, Greeter.abi, signer)\n      const transaction = await contract.setGreeting(greeting)\n      await transaction.wait()\n      fetchGreeting()\n    }\n  }\n\n  async function sendCoins() {\n    if (typeof window.ethereum !== 'undefined') {\n      await requestAccount()\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const signer = provider.getSigner();\n      const contract = new ethers.Contract(tokenAddress, Token.abi, signer);\n      const transation = await contract.transfer(userAccount, amount);\n      await transation.wait();\n      console.log(`${amount} Coins successfully sent to ${userAccount}`);\n    }\n  }\n\n  return <IonPage>\n    <Grid container>\n      <MenuLeft variant={C.variants.inline} />\n      <h1>Account</h1>\n    </Grid>\n    <IonContent className=\"ion-padding\">\n\n      <Grid container spacing={2} >\n        <Grid item xs={12}>\n          <Grid container>\n            <Grid item xs={6}>\n              <img src=\"/assets/accounts/default-avatar.png\" alt=\"profile pic\" />\n\n              { /* NFT */ }\n              <div>\n                <button onClick={fetchGreeting}>Fetch Greeting</button>\n                <br />\n                <button onClick={setGreeting}>Set Greeting</button>\n                <br />\n                <input value={greeting} onChange={e => setGreetingValue(e.target.value)} placeholder=\"Set greeting\" />\n              </div>\n              <hr />\n              <div>\n                <button onClick={getBalance}>Get Balance</button>\n                <br />\n                <button onClick={sendCoins}>Send Coins</button>\n                <br />\n                <input onChange={e => setUserAccount(e.target.value)} placeholder=\"Account ID\" />\n                <br />\n                <input onChange={e => setAmount(e.target.value)} placeholder=\"Amount\" />\n              </div>\n\n            </Grid>\n            <Grid item xs={6}>\n              { !!currentUser\n                && <F>\n                  <h4>{currentUser.email}</h4>\n                  <ul>\n                    <li><Link to={\"/en/account/my/galleries\"} >My Galleries</Link></li>\n                    <li><a onClick={() => props.history.push(\"/en/account/my/videos\")}>My Videos</a></li>\n                    <li><Logout /></li>\n                  </ul>\n                </F>\n                || <F>\n                  <h4>Not logged in</h4>\n\n                  <LoginRow>\n                    <FbLogin />\n                    <PasswordLogin />\n                  </LoginRow>\n\n                </F> }\n            </Grid>\n          </Grid>\n          <Grid container spacing={2}>\n            <Grid item xs={6} >\n              <textarea value={scratchpad} onChange={setScratchpad} />\n              <button type='submit' onClick={saveScratchpad}>Save Scratchpad</button>\n            </Grid>\n          </Grid>\n        </Grid>\n      </Grid>\n\n      <hr />\n      { /* push notifications */ }\n      { notifications.length && <IonList>\n        { notifications.map((notif) => <IonItem key={notif.id}>\n          <IonLabel>\n            <IonText><h3 className=\"notif-title\">{ notif.title }</h3></IonText>\n            <p>{ notif.body }</p>\n            { notif.type==='foreground' && <p>This data was received in foreground</p> }\n            { notif.type==='action' && <p>This data was received on tap</p> }\n          </IonLabel>\n        </IonItem>) }\n      </IonList> || 'no notifications so far' }\n\n    </IonContent>\n    <IonFooter>\n      <IonToolbar>\n        { isPushNotificationsAvailable && <IonButton\n          color=\"success\" expand=\"full\" onClick={register}>Register for Push</IonButton>\n          || <div><h1>Push notifications not available</h1></div> }\n      </IonToolbar>\n    </IonFooter>\n  </IonPage>\n}\n\nexport default Account\n","\nimport { ethers } from 'ethers'\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from \"react\"\nimport Toggle from 'react-toggle'\nimport styled from 'styled-components'\nimport Web3 from 'web3'\nimport { useWeb3React, Web3ReactProvider } from \"@web3-react/core\"\nimport { InjectedConnector } from '@web3-react/injected-connector'\n\nimport config from \"config\"\nimport {\n  AuthContext, AuthWidget,\n  FlexCol, FlexRow,\n} from 'ishlibjs'\n\nimport {\n  PurchaseModal,\n} from '$components/application'\nimport {\n  FbLogin2,\n} from \"./\"\nimport {\n  Btn,\n  Card,\n  logg,\n  request,\n  S,\n  TwofoldContext,\n} from \"$shared\"\n\nimport \"react-toggle/style.css\"\n\nimport bodyNFT from '$src/artifacts/contracts/Body.sol/BodyNFT.json'\n\n/*\n * ropsten, _vp_ 2021-10-26\n * Dana, nude 1 (nude 3)\n */\nconst bodyAddress = '0x3e1a03a9e1682f4dd95413e0be69e5b7bccaf15d'\n\nconst BuyBtn = styled.span`\n  border: 1px solid ${p => p.theme.colors.text};\n\n  padding: 5px;\n  cursor: pointer;\n`;\n\nconst Cell = styled.div`\n  // display: flex;\n`;\n\nconst _Img = styled.div`\n  border: 1px solid red;\n  background: white;\n\n  max-width: 100px;\n  max-height: 100px;\n  width: 100px;\n  height: 100px;\n`;\nconst Img = ({ src }) => {\n  return <_Img><img src={src} alt='' /></_Img>\n}\n\nconst injected = new InjectedConnector() // { supportedChainIds: [1, 3, 4, 5, 42], })\n\nconst W0 = styled.div`\n  // border: 1px solid cyan;\n\n  display: flex;\n  justify-content: flex-start;\n  align-items: center;\n`;\n\nconst W1 = styled.div``;\n\nconst AuthedWidget = (props) => {\n\n  const {\n    currentUser, setCurrentUser,\n    useApi,\n  } = useContext(AuthContext)\n\n  const {\n    editorMode, setEditorMode,\n  } = useContext(TwofoldContext)\n\n  return <F>\n    <Cell>[ { typeof currentUser.n_unlocks === 'undefined' ? '?' : currentUser.n_unlocks} coins\n      <BuyBtn onClick={() => setPurchaseModalOpen(true) }>Add</BuyBtn> ]</Cell>\n\n    <Card>\n      <label>\n      <Toggle\n        defaultChecked={editorMode}\n        icons={false}\n        onChange={() => setEditorMode(!editorMode) } />\n      <span>Editor mode</span>\n    </label>\n    </Card>\n\n  </F>\n}\n\n/**\n * MyAccountWidget\n**/\nconst MyAccountWidget = (props) => {\n  // logg(props, 'MyAccountWidget')\n\n  const {\n    currentUser, setCurrentUser,\n    useApi,\n  } = useContext(AuthContext)\n\n  // const {\n  // } = useContext(TwofoldContext)\n  // // logg(useContext(TwofoldContext), 'MyAccountWidget#usedTwofoldContext')\n\n  /*\n   * @TODO: avatar would be an object s.t. multiple styles/sizes are there,\n   * and it should be in a context - shared across threemap, and accountWidget.\n   */\n  const [ avatar, setAvatar ] = useState(\"\")\n  const api = useApi()\n  const { active, account, library, connector, activate, deactivate } = useWeb3React()\n\n  async function connect() {\n    try {\n      await activate(injected)\n    } catch (ex) {\n      logg(ex, 'could not connect')\n    }\n  }\n\n  async function disconnect() {\n    try {\n      deactivate()\n    } catch (ex) {\n      console.log(ex)\n    }\n  }\n\n  // request access to the user's MetaMask account\n  const requestAccount = async () => {\n    await window.ethereum.request({ method: 'eth_requestAccounts' })\n  }\n\n  const myBodies = async () => {\n    if (window.ethereum) {\n      await requestAccount()\n      if (account) {\n        const provider = new ethers.providers.Web3Provider(window.ethereum)\n        const signer = provider.getSigner()\n        const contract = new ethers.Contract(bodyAddress, bodyNFT.abi, signer)\n        const tokensOfOwner = await contract.tokensOfOwner(account)\n\n        // @TODO: this is only first, I need to support unlimited number of bodies connected to the account.\n        const i = 0\n        const result = await contract.tokenURI(tokensOfOwner[i])\n        request.get(result).then(r => r.data.image).then(r => {\n          setAvatar(r)\n        })\n      }\n    }\n  }\n\n  return <W0 className=\"MyAccountWidget\" >\n\n    { /* currentUser.profile_photo_url && <Img src={currentUser.profile_photo_url} /> */ }\n    <Img src={avatar || currentUser?.profile_photo_url} />\n\n    <FlexRow>\n\n      { currentUser.email && <AuthedWidget /> }\n      <AuthWidget />\n\n\n      { active && <W1> [\n          <span>Connected with <b>{account}</b></span>\n          <button onClick={disconnect} >Disconnect</button>\n          <button onClick={myBodies} >myBodies</button> ]</W1> }\n      { !active && <W1>\n        <span>Not Connected</span>\n        <button onClick={connect} >Connect to MetaMask</button>\n      </W1> }\n\n    </FlexRow>\n\n    <PurchaseModal />\n  </W0>\n}\nMyAccountWidget.propTypes = {\n  // no props\n};\n\n// const WrappedMyAccountWidget = (props) => <Elements stripe={stripePromise}><MyAccountWidget {...props} /></Elements>;\n// export default WrappedMyAccountWidget\nexport default MyAccountWidget\n","/*\n * components / users / index\n */\nimport { Plugins } from '@capacitor/core'\nimport { FacebookLoginResponse } from '@capacitor-community/facebook-login'\nimport React, { Fragment as F, useContext, useState, } from 'react'\nimport { ToastContainer, toast } from 'react-toastify'\nimport styled from 'styled-components'\n\nimport 'react-toastify/dist/ReactToastify.css'\n\nimport config from 'config'\nimport {\n  Btn,\n  C,\n  FlexCol,\n  logg, request, TwofoldContext, useApi,\n} from \"$shared\"\n\n/* A */\nexport { default as Account } from \"./Account\"\n\n\n/* F */\n// @deprecated below, use ishlibjs\nconst { FacebookLogin } = Plugins\nconst FACEBOOK_PERMISSIONS = ['email']\nexport const FbLogin = (props) => {\n  const api = useApi()\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  const doFbLogin = async () => {\n    const result = await FacebookLogin.login({ permissions: FACEBOOK_PERMISSIONS });\n    if (result.accessToken) {\n      request.post(`${config.apiOrigin}${api.longTermTokenPath}`, { accessToken: result.accessToken.token }).then((resp) => {\n        localStorage.setItem(C.jwt_token, resp.data.jwt_token)\n        localStorage.setItem(C.current_user, JSON.stringify(resp.data) )\n        setCurrentUser(resp.data)\n      }).catch((err) => {\n        logg(err, `Could not post request to ${config.apiOrigin}${api.longTermTokenPath}`)\n      })\n    } else {\n      // Canceled by user.\n      logg('canceled')\n    }\n  }\n  return <Btn onClick={doFbLogin}>FB Login</Btn>\n}\nexport const FbLogin2 = (props) => {\n  const api = useApi()\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  const doFbLogin = async () => {\n    const result = await FacebookLogin.login({ permissions: FACEBOOK_PERMISSIONS });\n    if (result.accessToken) {\n      request.post(`${config.apiOrigin}${api.longTermTokenPath}`, { accessToken: result.accessToken.token }).then((resp) => {\n        localStorage.setItem(C.jwt_token, resp.data.jwt_token)\n        localStorage.setItem(C.current_user, JSON.stringify(resp.data) )\n        setCurrentUser(resp.data)\n      }).catch((err) => {\n        logg(err, `Could not post request to ${config.apiOrigin}${api.longTermTokenPath}`)\n      })\n    } else {\n      // Canceled by user.\n      logg('canceled')\n    }\n  }\n  return <Btn onClick={doFbLogin}>Login or Register with Facebook</Btn>\n}\n// ^ @deprecated above\n\n\n\n/* L */\n\nconst BuyBtn = styled.span`\n  border: 1px solid ${p => p.theme.colors.text};\n\n  padding: 5px;\n  cursor: pointer;\n`;\n\nexport const Logout = () => {\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  const doLogout = () => {\n    localStorage.removeItem(C.jwt_token)\n    localStorage.removeItem(C.current_user)\n    setCurrentUser({})\n  }\n  return <BuyBtn onClick={doLogout}>X</BuyBtn>\n}\n\nconst _W = styled.div`\n  display: flex;\n\n  > * {\n    // margin: auto .4em;\n  }\n`;\n\n/* M */\nexport { default as MyAccountWidget } from \"./MyAccountWidget\"\n\n/* P */\n\n\n/* R */\n\n","\n/*\n *  $shared / AppMock\n */\n\nimport { createMemoryHistory } from 'history'\nimport _Box from '@material-ui/core/Box'\nimport React, { useState } from 'react'\nimport {\n  Link, Switch, Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\nimport styled from 'styled-components'\nimport { ThemeProvider } from 'styled-components'\n\nimport {\n  C,\n  logg,\n  S,\n  TwofoldContext, TwofoldContextProvider,\n} from \"$shared\"\nimport { LoginModal } from \"$components/users\"\n\nconst AppMock = (props) => {\n  logg(props, 'AppMock')\n  let {\n    currentUser, setCurrentUser,\n    itemToUnlock, setItemToUnlock,\n    loginModalOpen, setLoginModalOpen,\n    purchaseModalOpen, setPurchaseModalOpen,\n    zoom, setZoom,\n  } = props\n  const history = createMemoryHistory()\n  history.push(\"/en/cities/travel-to/chicago\") // @TODO: move where appropriate\n\n  const [ localItemToUnlock, setLocalItemToUnlock ] = useState({})\n  const [ localCurrentUser, setLocalCurrentUser ] = useState(C.anonUser)\n  const [ localLoginModalOpen, setLocalLoginModalOpen ] = useState(false)\n  const [ localPurchaseModalOpen, setLocalPurchaseModalOpen ] = useState(false)\n  const [ localZoom, setLocalZoom ] = useState(1)\n  if (!currentUser) {\n    currentUser = localCurrentUser\n    setCurrentUser = setLocalCurrentUser\n  }\n  if (!itemToUnlock) {\n    itemToUnlock = localItemToUnlock\n    setItemToUnlock = setLocalItemToUnlock\n  }\n  if ('undefined' === typeof loginModalOpen) {\n    logg('it was undefined')\n    loginModalOpen = localLoginModalOpen\n    setLoginModalOpen = setLocalLoginModalOpen\n  }\n  if ('undefined' === typeof purchaseModalOpen) {\n    purchaseModalOpen = localPurchaseModalOpen\n    setPurchaseModalOpen = setLocalPurchaseModalOpen\n  }\n  if ('undefined' === typeof zoom) {\n    // logg('no props.zoom?!')\n    zoom = localZoom\n    setZoom = setLocalZoom\n  }\n\n  return <ThemeProvider theme={S.lightTheme}>\n    <Router history={history} >\n      <TwofoldContextProvider {...{\n        // bottomDrawerOpen, setBottomDrawerOpen,\n        currentUser, setCurrentUser,\n        itemToUnlock, setItemToUnlock,\n        // layout, setLayout,\n        loginModalOpen, setLoginModalOpen,\n        purchaseModalOpen, setPurchaseModalOpen,\n        // showUrl, setShowUrl,\n        zoom, setZoom,\n      }} >\n        { props.children }\n        {/* <LoginModal /> */}\n      </TwofoldContextProvider>\n    </Router>\n  </ThemeProvider>\n}\n\nexport default AppMock\n","\nconst AppRouter = {\n\n  cityVenuesPath: (slug) => `/en/cities/travel-to/${slug}/venues`,\n  cityPath: (slug) => `/en/cities/travel-to/${slug}`,\n\n};\n\nexport default AppRouter;\n","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from 'react'\nimport styled from 'styled-components'\n\nimport {\n  C, CollapsibleContext,\n  logg,\n  S,\n  WBordered, WBorderedItem,\n} from '$shared'\n\nconst Gt = () => <span>&nbsp;&gt;&nbsp;&nbsp;</span>\n\nconst Inner = styled.div`\n  // border: 2px solid red;\n  // max-height: 100vh;\n\n  clear: left;\n`;\n\nconst Lt = () => <span>&nbsp;&lt;&nbsp;&nbsp;</span>\n\nconst Label = styled.div`\n  display: flex;\n  margin-bottom: ${p => p.theme.borderWidth};\n  color: ${p => p.theme.colors.text};\n`;\n\nconst WTransparent = styled.div`\n  background: ${p => p.theme.colors.background};\n  padding: 0 .5em .5em .5em;\n`;\nconst W = ({ children, variant, ...props }) => {\n  switch (variant) {\n    case C.variants.bordered:\n      return <WBordered {...props} >{children}</WBordered>\n    default:\n      return <WTransparent {...props} >{children}</WTransparent>\n  }\n}\n\n\n/**\n * Collapsible\n *\n * @TODO: test-driven _vp_ 2021-10-29\n */\nconst Collapsible = ({ children, ...props }) => {\n  // logg(props, 'Collapsible')\n  const {\n    className='', config, variant,\n  } = props\n\n  const ctx = useContext(CollapsibleContext)\n  if (!ctx) { return null }\n  const { collapsibles, setCollapsibles } = ctx\n\n  const doToggle = () => setCollapsibles({ ...collapsibles, [props.slug]: !collapsibles[props.slug] })\n\n  const collapsible = typeof config === 'undefined' ? true\n    : typeof config.collapsible === 'undefined' ? true\n      : config.collapsible\n  const folded = false // collapsible ? !!collapsibles[props.slug] : false\n\n  return <W variant={variant} className={`Collapsible ${className}`} >\n    { props.label &&  collapsible && <Label onClick={doToggle} >{folded ? <Lt /> : <Gt />} {props.label}</Label> }\n    { props.label && !collapsible && <Label >{props.label}</Label> }\n    { !folded && <Inner>{ children }</Inner> }\n  </W>\n}\n\nCollapsible.propTypes = {\n  className: PropTypes.string,\n  config: PropTypes.shape({\n    collapsible: PropTypes.bool,\n  }),\n  label: PropTypes.string,\n  slug: PropTypes.string.isRequired,\n  variant: PropTypes.string,\n}\nexport default Collapsible\n","import axios from \"axios\";\nimport config from \"config\";\n\nconst settings = {\n  baseURL: config.apiOrigin\n}\n\nexport default axios.create(settings);","\n/**\n * Style Constants\n */\nconst S = {\n  // Twofold layout\n  borderWidth: '10px',\n  bottomDrawerClosedHeight: '20px',\n  bottomDrawerOpenHeight: '115px',\n  breadcrumbsHeight: '30px',\n\n  thinBorderWidth: '2px',\n  thinBorderRadius: '5px',\n}\n\nconst lightTheme = {\n  ...S,\n  thinBorder: '2px solid black',\n  colors: {\n    text: 'black',\n    background: '#dedede',\n    blue: '#6aa3e9',\n    darkGrey: '#605d5d',\n    lightGrey: '#988b8b',\n    red: 'red',\n    border: 'black',\n    cardBackground: 'white'\n  }\n}\n\nconst darkTheme = {\n  ...S,\n  thinBorder: '2px solid white',\n  colors: {\n    text: 'white',\n    background: '#292929',\n    blue: '#73b0fa',\n    darkGrey: '#b3afaf',\n    lightGrey: '#4a4343',\n    red: '#eb83a8',\n    border: 'white',\n    cardBackground: '#1a1a1a'\n  }\n}\n\nexport default {\n  lightTheme,\n  darkTheme\n}","\nimport { arrowBack } from 'ionicons/icons'\nimport { IonIcon } from '@ionic/react'\nimport { CircularProgress as _CircularProgress } from '@material-ui/core'\nimport _Box from '@material-ui/core/Box'\nimport { ChevronLeft as _ChevronLeft, ChevronRight as _ChevronRight, Menu as _MenuIcon, } from '@material-ui/icons'\nimport React, { useEffect, useRef, useState } from 'react'\nimport {\n  Link, Switch, BrowserRouter as Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport {\n  C,\n  logg,\n  request,\n  useApi,\n} from \"$shared\"\n\n/**\n * ishjs has a newer version of this. _vp_ 2022-03-05\n*/\nconst TwofoldContext = React.createContext({})\nconst TwofoldContextProvider = ({ children, ...props }) => {\n  // logg(props, 'TwofoldContextProvider')\n  let {\n    currentUser, setCurrentUser, // for testing only. _vp_ 2022-03-18\n    itemToUnlock, setItemToUnlock,\n    layout, setLayout,\n    theme, toggleTheme,\n    zoom, setZoom, // it's a prop for testing only. _vp_ 2022-03-18\n  } = props\n\n  const api = useApi()\n\n  /* B */\n\n  // @TODO: does localStorage work like this on mobile?\n  // @TODO: try and catch\n  const [ bottomDrawerOpen, _setBottomDrawerOpen ] = useState(JSON.parse(localStorage.getItem(C.bottomDrawerOpen)))\n  const setBottomDrawerOpen = (m) => {\n    localStorage.setItem(C.bottomDrawerOpen, JSON.stringify(m))\n    _setBottomDrawerOpen(m)\n  }\n\n\n  /* C */\n\n  const [ localCurrentUser, setLocalCurrentUser ] = useState(C.anonUser)\n  if (!currentUser) {\n    currentUser = localCurrentUser\n    setCurrentUser = setLocalCurrentUser\n  }\n\n  /* Get the current_user on load */\n  const mountedRef = useRef('init')\n  useEffect(() => {\n    if (!mountedRef.current) { return } // @TODO: hmmm do I need this?\n\n    const fn = async () => {\n      const r = await api.getMyAccount()\n      setCurrentUser(r)\n    }\n    fn()\n\n    return () => mountedRef.current = null\n  }, [currentUser])\n\n  // Refresh current_user if is_purchasing\n  useEffect(() => {\n    let closure = setTimeout(() => {\n\n      const fn = async () => {\n        const r = await api.getMyAccount()\n        setCurrentUser(r)\n      }\n      fn()\n\n    }, 1 * 1000)\n    return () => clearTimeout(closure)\n  }, [currentUser.is_purchasing])\n\n  /* E */\n  const [ editorMode, _setEditorMode ] = useState(JSON.parse(localStorage.getItem(C.names.editorMode)))\n  const setEditorMode = (t) => {\n    localStorage.setItem(C.names.editorMode, t)\n    _setEditorMode(t)\n  }\n\n  /* F */\n  const [ folded, setFolded ] = useState()\n\n  /* I */\n  const [ _itemToUnlock, _setItemToUnlock ] = useState({})\n  if (!itemToUnlock) {\n    itemToUnlock = _itemToUnlock\n    setItemToUnlock = _setItemToUnlock\n  }\n  /* why is this here? remove. _vp_ 2022-03-18 */\n  // const setItemToUnlock = (item) => {\n  //   if (itemToUnlock.id !== item.id && !loginModalOpen) {\n  //     _setItemToUnlock(item)\n  //   }\n  // }\n\n  /* L */\n  const [ location, setLocation ] = useState(null)\n  const [ loginModalOpen, setLoginModalOpen ] = useState(false)\n\n  /* M */\n  const [ mapPanelWidth, setMapPanelWidth ] = useState(null)\n  const [ mapPanelHeight, setMapPanelHeight ] = useState(null)\n\n  /* P */\n  const [ purchaseModalOpen, setPurchaseModalOpen ] = useState(false)\n\n  /* R */\n\n  const [ ratedConfirmation, _setRatedConfirmation ] = useState(JSON.parse(localStorage.getItem(C.ratedConfirmation)))\n  const setRatedConfirmation = (which) => {\n    localStorage.setItem(C.ratedConfirmation, JSON.stringify(which))\n    _setRatedConfirmation(which)\n  }\n\n  const [ registerModalOpen, setRegisterModalOpen ] = useState(false)\n\n  /* S */\n  const [ showItem, setShowItem ] = useState(false)\n  const [ showUrl, setShowUrl ] = useState(false)\n\n  /* T */\n  let tmp, defaultTwofoldPercent = 0.5\n  if (tmp = localStorage.getItem(C.twofoldPercent)) {\n    try {\n      defaultTwofoldPercent = JSON.parse(tmp)\n    } catch (err) {\n      logg(err, 'cannot get twofoldPercent from localStorage')\n    }\n  }\n  const [ twofoldPercent, setTwofoldPercent ] = useState(0.5)\n\n  /* Z */\n  const [ localZoom, setLocalZoom ] = useState(1)\n  if (!zoom) {\n    zoom = localZoom\n    setZoom = setLocalZoom\n  }\n\n  return <TwofoldContext.Provider value={{\n    bottomDrawerOpen, setBottomDrawerOpen,\n\n    currentUser, setCurrentUser,\n\n    editorMode, setEditorMode,\n\n    folded, setFolded,\n\n    itemToUnlock, setItemToUnlock,\n\n    layout, setLayout,\n    location, setLocation,\n    loginModalOpen, setLoginModalOpen,\n\n    mapPanelHeight, setMapPanelHeight,\n    mapPanelWidth, setMapPanelWidth,\n\n    purchaseModalOpen, setPurchaseModalOpen,\n\n    ratedConfirmation, setRatedConfirmation,\n    registerModalOpen, setRegisterModalOpen,\n\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n\n    twofoldPercent, setTwofoldPercent,\n\n    zoom, setZoom,\n\n    theme, toggleTheme,\n  }} >{ children }</TwofoldContext.Provider>\n}\n\nexport default TwofoldContext\nexport {\n  TwofoldContextProvider,\n}\n","import { useLayoutEffect, useState, } from 'react'\n\n/**\n * useWindowSize\n */\nconst useWindowSize = () => {\n  const [size, setSize] = useState([0, 0]);\n  useLayoutEffect(() => {\n    function updateSize() {\n      setSize([window.innerWidth, window.innerHeight]);\n    }\n    window.addEventListener('resize', updateSize);\n    updateSize();\n    return () => window.removeEventListener('resize', updateSize);\n  }, []);\n  return size;\n}\n\nexport default useWindowSize\n","/*\n *  $shared / index\n */\n// alphabetized\nimport { arrowBack } from 'ionicons/icons'\nimport { IonIcon } from '@ionic/react'\nimport { CircularProgress as _CircularProgress } from '@material-ui/core'\nimport _Box from '@material-ui/core/Box'\nimport { ChevronLeft as _ChevronLeft, ChevronRight as _ChevronRight, Menu as _MenuIcon, } from '@material-ui/icons'\nimport React, { useEffect, useState } from 'react'\nimport {\n  Link, Switch, BrowserRouter as Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport C from \"./C\"\n\n/* A */\nimport useApi from \"./Api\"\nexport { default as useApi } from \"./Api\"\nexport { default as AppMock } from \"./AppMock\"\nexport { default as AppRouter } from \"./AppRouter\"\n\n/* B */\n\n/**\n * Back Button\n */\nconst BackIcon = styled(IonIcon)`\n  margin-right: 5px;\n  cursor: pointer;\n`;\nexport const BackBtn = () => {\n  const history = useHistory()\n  return <BackIcon onClick={history.goBack} icon={arrowBack}></BackIcon>\n}\n\n/**\n * Just your regular shadowed box. Pointer cursor. TDD\n */\nexport const Btn = styled.div`\n  border: 1px solid gray;\n  border-radius: 5px;\n\n  padding: .3em 1em;\n  cursor: pointer;\n`;\n\n\n/* C */\n\nexport { C }\nexport const ChevronLeft = styled(_ChevronLeft)`\n  color: ${(p) => p.theme.colors.text}\n`;\nexport const ChevronRight = styled(_ChevronRight)`\n  color: ${(p) => p.theme.colors.text}\n`;\n\n/**\n * A Card\n */\nexport const Card = styled(_Box)`\n  margin-bottom: 1em;\n  padding: 1em;\n  background: ${p => p.theme.colors.cardBackground};\n  cursor: ${p => p.cursor ? p.cursor : 'auto'};\n\n  display: flex;\n  flex-direction: column;\n`;\n\nexport { default as Collapsible } from \"./Collapsible\"\nexport const CollapsibleContext = React.createContext({})\n/**\n * @TODO: test-driven\n */\nexport const CollapsibleContextProvider = ({ children, ...props }) => {\n  // logg(props, 'CollapsibleContextProvider')\n\n  let defaultCollapsibles = {\n    [C.collapsible.descr]: true,\n  }\n  let tmp\n  if (tmp = localStorage.getItem(C.collapsibles)) {\n    try {\n      defaultCollapsibles = JSON.parse(tmp)\n    } catch (err) {\n      logg(err, 'Could not parse collapsibles from localStorage')\n    }\n  }\n  const [ collapsibles, _setCollapsibles ] = useState(defaultCollapsibles)\n  const setCollapsibles = (m) => {\n    localStorage.setItem(C.collapsibles, JSON.stringify(m))\n    _setCollapsibles(m)\n  }\n\n  return <CollapsibleContext.Provider value={{\n    collapsibles, setCollapsibles,\n  }} >{ children }</CollapsibleContext.Provider>\n}\n\n/* D */\n\n/* F */\n\nexport const FlexRow = styled.div`\n  display: flex;\n\n  > * {\n    margin: auto .4em;\n  }\n`;\n\n/* I */\n\n/**\n * Like the rails inflector, has methods:\n * tableize()\n */\nexport const inflector = {\n  classify: (m) => {\n    if (m.slice(-3)==='ies') {\n      m = m.slice(0, -3) + 'y'\n    }\n    if (m.slice(-1)==='s') {\n      m = m.slice(0, -1)\n    }\n    const ms = m.split('_')\n    for (var i = 0; i < ms.length; i++) {\n      ms[i] = ms[i].charAt(0).toUpperCase() + ms[i].slice(1)\n    }\n    return ms.join(\"\")\n  },\n  tableize: (m) => {\n    switch(m) {\n      case 'Gallery':\n        return 'galleries'\n      default:\n      return `${m.toLowerCase()}s`\n    }\n  },\n}\n\n/* L */\n\n\n// From: https://codepen.io/charlyarg/pen/GByKja\nconst _Circle = styled.div`\n  position: fixed;\n  z-index: 999;\n  overflow: show;\n  margin: auto;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  width: 50px;\n  height: 50px;\n`;\nexport const Loading = (p) => <_Circle><_CircularProgress /></_Circle>\n\n/**\n * Usage: logg(someObject, 'label')\n *\n * This development-grade logger can be used instead of console.log() with some advantages:\n * * It encourages consistent labeling of logs. By labeling each log line, you can have dozens of log lines\n * written per action, and still know which log line comes from where.\n * The recommended label is the component name, or function name.\n * * If the label is present, the logged object is placed in the window, allowing you to inspect it in the console. The\n * label becomes the name of the object (stripped to [0-9a-zA-Z\\-_] chars). If you're logging a function, you can execute it.\n * If you log more than one thing, they can interact, allowing you to validate control flow.\n * * the logger can be turned off by making this function simply return.\n */\nconst logg = (a, b=\"\", c=null) => {\n  c = \"string\" === typeof c ? c : b.replace(/\\W/g, \"\");\n  if (c.length > 0) {\n    window[c] = a;\n  }\n\n  console.log(`+++ ${b}:`, a); // eslint-disable-line no-console\n};\n// optimized for Android (e.g. it inspects and doesn't use window)\nconst logg_android = (a, b=\"\", c=null) => {\n  console.log(`+++ ${b}:`, a.inspect); // eslint-disable-line no-console\n};\nconst logg2 = logg\nconst logg4 = logg\nconst logga = logg_android\nexport {\n  logg,\n  logg2,\n  logg4,\n  logga,\n};\n\n/* M */\nexport const MenuIcon = styled(_MenuIcon)`\n  color: ${(p) => p.theme.colors.text}\n`;\n\n/* P */\nexport const PurchasedIcon = () => {\n  return <div className=\"PurchasedIcon\">[purchased]</div>\n}\n\n/**\n * pretty print date\n */\nexport const pp_date = (d) => (d || \"\" ).substring(0, 10)\n\n/* R */\n\nexport { default as request } from \"./request\"\n\n/* S */\nexport { default as S } from \"./S\"\n\n/* T */\nexport { default as TwofoldContext } from './TwofoldContext'\nexport { TwofoldContextProvider } from './TwofoldContext'\n\n/* U */\nexport { default as useWindowSize } from './useWindowSize'\n\n/* W */\n\n/**\n * Wrapper Bordered. This expects a list? _vp_ 2021-11-02\n * Used in collapsibles and MarkersList\n */\nexport const WBordered = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.cardBackground};\n\n\n  margin-bottom: 1em;\n  padding: .5em;\n\n  cursor: ${p => p.onClick ? 'pointer' : null};\n`;\n\n/**\n * Wrapper Bordered Item. Is padded, margined.\n */\nconst _WBorderedItem = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.cardBackground};\n  color: ${p => p.theme.colors.text};\n\n  margin: 0 .5em .5em 0;\n  padding: .5em;\n\n  text-align: center;\n\n  width: 18%;\n  max-width: 140px;\n  min-width: 120px;\n`;\nexport const WBorderedItem = ({children, ...props}) => {\n  return <_WBorderedItem className=\"WBorderedItem\" {...props}>{children}</_WBorderedItem>\n}\n\n\nexport const WidgetContainer = ({ children, ...props }) => {\n  return <WBordered {...props} >{ children }</WBordered>\n}\n\nexport const Wrapper = styled.div`\n  height: 100vh;\n`;\n\n/* Z */\n\nexport const ZoomContext = React.createContext({})\n\n\n\n","import { IonPage, IonLoading, IonContent, IonIcon as _IonIcon } from '@ionic/react';\nimport { funnel, bookmark, newspaperOutline, image, videocam } from 'ionicons/icons';\nimport React, { Fragment as F, useEffect, useState } from \"react\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport styled from 'styled-components'\n\nimport { useApi, AppRouter,\n  logg, // eslint-disable-line no-unused-vars\n  Wrapper } from \"$shared\"\nimport \"./cities.scss\"\n\nconst Counts = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  margin: 1em 0px;\n`;\n\nconst Count = styled.div`\n  // border: 1px solid red;\n\n  display: flex;\n  justify-content: center;\n\n  width: 50%;\n  text-align: center;\n  position: relative;\n  padding: 0.1em;\n`;\n\nconst IonIcon = styled(_IonIcon)`\n  font-size: 2em;\n  color: ${p=>p.theme.darkGrey};\n`;\n\nconst Number = styled.div`\n  // border: 1px solid green;\n\n  padding: 0.5em;\n\n  color: ${p=>p.theme.lightGrey};\n  font-size: 0.9em;\n  font-weight: 600;\n`;\n\nconst Cities = (props) => {\n  const [cities, setCities] = useState([]);\n  const [filteredCities, setFilteredCities] = useState([]);\n  const [showLoading, setShowLoading] = useState(false);\n  const api = useApi()\n  const history = useHistory()\n\n  useEffect(() => {\n    setShowLoading(true);\n    api.getCities().then(res => {\n      setShowLoading(false);\n      setFilteredCities(res);\n      setCities(res);\n    });\n  }, [])\n\n  const filterHandler = (ev) => {\n    let filteredCities = cities.filter(city => {\n      return city.name.toLowerCase().indexOf(ev.target.value.trim().toLowerCase()) > -1;\n    });\n    setFilteredCities(filteredCities);\n  }\n\n  return <F>\n    <Wrapper className='cities' >\n      <h1 className=\"heading\" >Cities</h1>\n\n      <div className=\"filter-section\">\n        <input className=\"filter-input\" onChange={filterHandler} />\n        <IonIcon className=\"filter-icon\" icon={funnel}></IonIcon>\n      </div>\n\n      { /* @TODO: re-add! */ }\n      { /* <div className=\"bookmark-section\">\n        <label className=\"switch\">\n          <input type=\"checkbox\" onChange={() => { }} checked />\n          <span className=\"slider round\"></span>\n        </label>\n        <span className=\"bookmark-text\">Show only bookmarked</span>\n      </div> */ }\n\n      <div className=\"container\">\n        { filteredCities.map((city, i) => <div key={i} className=\"cities\" onClick={() => history.push(AppRouter.cityPath(city.slug)) } >\n            <div className=\"img-section\">\n              <span className=\"bookmark\" >\n                <IonIcon className=\"bookmark-icon\" icon={bookmark}></IonIcon>\n              </span>\n              <img className=\"city-img\" src={city.photo} />\n              <span className=\"city-title\">{city.name}</span>\n            </div>\n            <Counts>\n              <Count>\n                { /* @TODO: wire in theme provider */ }\n                <Number >{city.n_reports}</Number>\n                <IonIcon icon={newspaperOutline}></IonIcon>\n\n              </Count>\n              <Count>\n\n                <Number >{city.n_galleries}</Number>\n                <IonIcon icon={image}></IonIcon>\n              </Count>\n              <Count>\n\n                <Number >{city.n_videos}</Number>\n                <IonIcon icon={videocam}></IonIcon>\n              </Count>\n            </Counts>\n          </div>\n        ) }\n      </div>\n      &nbsp;\n    </Wrapper>\n\n    <IonLoading\n      isOpen={showLoading}\n      onDidDismiss={() => setShowLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n\n  </F>\n}\n\nexport default Cities;\n","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { Metaline } from \"$components/application\"\nimport { logg } from \"$shared\"\nimport { NewsitemContainer } from './'\nimport \"./newsitems.scss\"\n\nconst Images = styled.div`\n  position: relative;\n`;\n\nconst ImageLarge = styled.img`\n  width: 200px;\n`;\n\nconst ImageThumb1 = styled.img`\n  position: absolute;\n  left: 200px;\n  top: 0;\n`;\n\nconst ImageThumb2 = styled.img`\n  position: absolute;\n  left: 200px;\n  top: 100px;\n`;\n\n/**\n * NewsitemGallery\n */\nconst NewsitemGallery = (props) => {\n  // logg(props, 'NewsitemGallery')\n  const { item, variant } = props\n\n  return <NewsitemContainer item={item} variant={variant} >\n    <Images >\n      { item.photos[0] && <ImageLarge src={item.photos[0].thumb_url} /> }\n      { item.photos[1] && <ImageThumb1 src={item.photos[1].thumb_url} /> }\n      { item.photos[2] && <ImageThumb2 src={item.photos[2].thumb_url} /> }\n    </Images>\n  </NewsitemContainer>\n}\nNewsitemGallery.propTypes = {\n  item: PropTypes.shape({\n    photos: PropTypes.array.isRequired,\n  }),\n  variant: PropTypes.string,\n}\nexport default NewsitemGallery\n","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { NewsitemContainer } from './'\nimport { Metaline } from \"$components/application\"\nimport { logg } from \"$shared\"\n\nimport \"./newsitems.scss\"\n\nconst ImageLarge = styled.img`\n  max-width: 100%;\n`;\n\nconst W = styled.div`\n  display: flex;\n  justify-content: center;\n`;\n\n/**\n * default\n */\nconst NewsitemPhoto = (props) => {\n  logg(props, 'NewsitemPhoto')\n  const { item, variant } = props\n\n  return <NewsitemContainer className='Newsitem NewsitemPhoto' {...{ item, variant }} >\n    <W>\n      { item.photos[0] && <ImageLarge src={item.photos[0].large_url} /> }\n    </W>\n  </NewsitemContainer>\n}\n\nNewsitemPhoto.propTypes = {\n  item: PropTypes.shape({\n    photos: PropTypes.array.isRequired, // @TODO: this is wrong, just show one photo\n  }),\n  variant: PropTypes.string,\n}\nexport default NewsitemPhoto\n","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useEffect, useContext, useState } from \"react\"\n\nimport { useHistory } from \"react-router-dom\"\nimport styled from 'styled-components'\n\nimport { ItemIcon, NewsitemContainer } from \"./\"\nimport { Metaline, } from \"$components/application\"\nimport { Api, C, logg, request, TwofoldContext } from \"$shared\"\n\nimport \"./newsitems.scss\"\n\n\nconst NewsitemReport = (props) => {\n  // logg(props, \"NewsitemReport\");\n  const { item, variant, } = props\n  return (<NewsitemContainer item={item} variant={variant} />)\n}\n\nNewsitemReport.propTypes = {\n  item: PropTypes.object.isRequired,\n  variant: PropTypes.string,\n}\nexport default NewsitemReport\n\n","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { logg } from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport { NewsitemContainer } from \"./\"\nimport \"./newsitems.scss\"\n\n\nconst NewsitemVideo = (props) => {\n  // logg(props, 'NewsitemVideo')\n  const { item, variant } = props\n\n  return <NewsitemContainer item={item} variant={variant} >\n    <div style={{ display: 'flex', justifyContent: 'center' }} >\n      { item.youtube_id ?\n          <iframe className=\"iframe\" width=\"100%\" height=\"315\" src={`https://www.youtube.com/embed/${item.youtube_id}`} frameBorder=\"0\" allow=\"autoplay; encrypted-media\" allowFullScreen></iframe>\n          : <video style={{ maxWidth: '100%', maxHeight: '50vh' }}  preload=\"metadata\" height=\"auto\" controls>\n            <source src={item.url} type=\"video/mp4\" />\n          </video> }\n    </div>\n  </NewsitemContainer>\n}\n\nNewsitemVideo.propTypes = {\n  item: PropTypes.object.isRequired,\n  variant: PropTypes.string,\n}\nexport default NewsitemVideo","\nimport PropTypes from 'prop-types'\nimport React, { useContext, } from \"react\"\nimport { toast } from 'react-toastify'\nimport styled from 'styled-components'\n\nimport { GenericNewsitem } from \"./\"\nimport NewsitemGallery from \"$components/newsitems/NewsitemGallery\"\nimport NewsitemReport from \"$components/newsitems/NewsitemReport\"\nimport NewsitemPhoto from \"$components/newsitems/NewsitemPhoto\"\nimport NewsitemVideo from \"$components/newsitems/NewsitemVideo\"\nimport {\n  Btn,\n  C,\n  logg,\n  TwofoldContext,\n  useApi,\n} from \"$shared\"\n\nimport \"./newsitems.scss\"\n\nconst ICONS = {\n  1: \"/assets/newsfeed/sunglass.png\",\n  2: \"/assets/newsfeed/gem_premium.png\"\n}\n\nconst W0 = styled.div`\n`;\n\nconst W1 = styled.div`\n  position: relative;\n`;\n\nconst _EditModeActions = styled.div`\n  position: absolute;\n  right: 1em;\n  top: 1em;\n  z-index: 2;\n`;\nconst EditModeActions = ({ children, ...props }) => {\n  logg(props, 'EditModeActions')\n  const { item } = props\n\n  const {\n    editorMode,\n  } = useContext(TwofoldContext)\n\n  const api = useApi()\n\n  if (!editorMode) { return null }\n\n  const removeStory = (e) => {\n    if (!confirm('Are you sure?')) { return }\n    api.deleteNewsitem({ id: item.newsitem_id }).then((resp) => {\n      toast('Removed the story')\n    }).catch((err) => {\n      logg('320 - cannot delete newsitem')\n    })\n  }\n\n  return <_EditModeActions>\n\n    <Btn onClick={removeStory} >\n      Remove Story\n    </Btn>\n\n  </_EditModeActions>\n}\n\n/**\n * Newsitems\n**/\nconst Newsitems = (props) => {\n  // logg(props, 'Newsitems')\n  const { newsitems=[], variant } = props\n\n  if (!newsitems.length) { return <div>No Newsitems</div> }\n\n  return (\n    <W0 className=\"Newsitems\" {...{ variant }} >\n      { newsitems.map((newsitem, idx) => {\n        const premium_tier = newsitem.premium_tier || 0\n        const icon = ICONS[premium_tier]\n        let item\n\n        switch (newsitem.item_type) {\n          case C.item_types.gallery:\n            item = <NewsitemGallery item={newsitem} variant={variant} />\n            break\n          case C.item_types.report:\n            item = <NewsitemReport  item={newsitem} variant={variant} />\n            break\n          case C.item_types.video:\n            item = <NewsitemVideo   item={newsitem} variant={variant} />\n            break\n          case C.item_types.photo:\n            item = <NewsitemPhoto   item={newsitem} variant={variant} />\n            break\n          default:\n            item = <GenericNewsitem item={newsitem} />\n        }\n\n        return (\n          <W1 key={idx} className={`premium-${premium_tier}`} >\n            <EditModeActions item={newsitem} />\n            { item }\n          </W1>\n        )\n      }) }\n    </W0>\n  )\n}\n\nNewsitems.propTypes = {\n  newsitems: PropTypes.array.isRequired,\n  variant: PropTypes.string,\n}\nexport default Newsitems\n","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useEffect, useContext, useState } from \"react\"\n\nimport { useHistory, } from \"react-router-dom\"\nimport styled from 'styled-components'\n\nimport {\n  ItemIcon,\n} from \"./\"\nimport {\n  Metaline,\n  Voteable,\n} from \"$components/application\"\nimport {\n  C, Card,\n  inflector,\n  logg,\n  request,\n  TwofoldContext,\n  WidgetContainer,\n} from \"$shared\"\n\n// alphabetized\n\nconst Col = styled.div`\n  display: flex;\n  flex-direction: column;\n`;\n\nconst Row = styled.div`\n  display: flex;\n  align-items: flex-start;\n`;\n\nconst Title = styled.h2`\n  margin-top: 0;\n  margin-bottom: 0;\n  color: ${p=>p.theme.colors.text};\n`;\n\nconst W0 = (props) => {\n  const { children, navigateToItem, variant } = props\n  // @TODO: better management of navigateToItem\n\n  switch (variant) {\n    case C.variants.bordered:\n      return <WidgetContainer {...props} onClick={navigateToItem} cursor=\"pointer\" >{ children }</WidgetContainer>\n    default:\n      return <Card boxShadow={2} {...props} onClick={navigateToItem} cursor=\"pointer\" ></Card>\n  }\n}\n\n/**\n * NewsitemContainer\n**/\nconst NewsitemContainer = ({ children, ...props }) => {\n  // logg(props, 'NewsitemContainer')\n  const {\n    className,\n    item,\n    variant,\n  } = props\n  const { item_type, slug } = item\n\n  const history = useHistory()\n\n  const {\n    itemToUnlock, setItemToUnlock,\n    layout,\n    location,\n    showItem, setShowItem,\n  } = useContext(TwofoldContext)\n  // logg(useContext(TwofoldContext), 'NewsitemContainerUsedContext')\n\n  const navigateToItem = () => {\n    if (item.is_premium && !item.is_purchased) {\n      setItemToUnlock(item)\n    } else {\n      if (layout === C.layout_mapui) {\n        history.push(`/en/locations/show/${location.slug}/${inflector.tableize(item_type)}/show/${slug}`)\n      } else {\n        history.push(`/en/${inflector.tableize(item_type)}/show/${slug}`)\n      }\n    }\n  }\n\n  /*\n   * @TODO: should be config with variants: standard container, container for a single photo, etc.\n   * but for now I'll use item.item_type\n   * _vp_ 2022-03-13\n   */\n\n  if (item.item_type === C.item_types.photo) {\n    // @TODO: navigateToItem can show full-screen pic. _vp_ 2022-04-17\n    return <W0 {...{ className, navigateToItem: () => {}, variant }} >\n      <Col>\n        <Title>{item.name}</Title>\n        <Metaline {...item} />\n      </Col>\n      { children }\n    </W0>\n\n  } else {\n    return <W0 {...{ className, navigateToItem, variant }} >\n      { children }\n      <Row>\n        <Col style={{ alignItems: 'center' }} >\n          <Voteable item={item} />\n\n          { /* @TODO: add premiumTier icon here */ }\n        </Col>\n        <Col style={{ overflowWrap: 'break-word', maxWidth: 'calc(100vw - 100px)' }} >\n          <Row>\n            <ItemIcon {...item} />\n            <Title>{item.name}</Title>\n          </Row>\n          <Metaline {...item} />\n        </Col>\n      </Row>\n      <p className=\"subhead\" dangerouslySetInnerHTML={{ __html: item.subhead }} />\n    </W0>\n  }\n}\nNewsitemContainer.propTypes = {\n  item: PropTypes.object.isRequired,\n  variant: PropTypes.string,\n}\nexport default NewsitemContainer\n","\nimport {\n  Article as ReportIcon,\n  Diamond,\n} from '@mui/icons-material'\nimport * as Ic from '@material-ui/icons'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport styled, { useTheme } from 'styled-components'\n\nimport { C, logg } from \"$shared\"\n\nconst _W0 = styled.div`\n  // border: 1px solid red;\n\n  padding: 10px 10px 0 10px;\n  margin-right: 10px;\n\n  box-sizing: border-box;\n`;\nconst W0 = ({ children, ...props }) => <_W0 className='ItemIcon' {...props}>{children}</_W0>\n\n/**\n * Displays the appropriate icon.\n *\n * @param [Boolean] props.isPurchased\n * @param [Number] props.premiumTier\n * @param [String] props.kind\n */\n export const ItemIcon = (props) => {\n  // logg(props, \"ItemIcon\")\n  const { is_purchased, item_type, premium_tier } = props\n\n  const theme = useTheme()\n\n  if (is_purchased) {\n    return <img className=\"icon\" src=\"/assets/icons/glasses.png\" alt='' />\n  }\n  if (premium_tier > 0) {\n    return <img className=\"icon\" src=\"/assets/icons/gem.png\" alt='' />\n  }\n  switch (item_type) {\n    case C.item_types.gallery:\n      return <W0><img className=\"icon\" src=\"/assets/icons/gallery.png\" alt='' /></W0>\n    case C.item_types.report:\n      return <W0>\n        {/* <img className=\"icon\" src=\"/assets/icons/report.png\" alt='' /> */}\n        <ReportIcon style={{ color: theme.colors.text }} />\n        <Diamond />\n      </W0>\n    case C.item_types.video:\n      return <W0><img className=\"icon\" src=\"/assets/newsfeed/video_icon.svg\" alt='' /></W0>\n    default:\n      return <W0>[unknown kind]</W0>\n  }\n}\nItemIcon.propTypes = {\n  is_purchased: PropTypes.bool, // .isRequired,\n  item_type: PropTypes.string.isRequired,\n  premium_tier: PropTypes.number,\n}\nexport default ItemIcon\n","/*\n * $components / newsitems / index.jsx\n */\nimport React, { Fragment as F, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { Box, inflector, logg } from \"$shared\"\n\n/* G */\n\nexport const GenericNewsitem = (props) => {\n  // logg(props, 'GenericNewsitem')\n  const { item } = props\n\n  return <F>\n    generic newsitem\n    <div dangerouslySetInnerHTML={{ __html: item.description }} />\n  </F>\n}\n\n/* N */\nexport { default as NewsitemGallery } from \"./NewsitemGallery\"\nexport { default as NewsitemPhoto } from \"./NewsitemPhoto\"\nexport { default as NewsitemReport } from \"./NewsitemReport\"\nexport { default as Newsitems } from \"./Newsitems\"\nexport { default as NewsitemContainer } from \"./NewsitemContainer\"\n\n\n\n/* I */\nexport const ICONS = {\n  1: \"/assets/newsfeed/sunglass.png\",\n  2: \"/assets/newsfeed/gem_premium.png\"\n}\n\nexport { default as ItemIcon } from \"./ItemIcon\"\n\n/* V */\n\n","import { funnel, bookmark, newspaperOutline, image, videocam } from 'ionicons/icons'\nimport { IonPage, IonContent, IonButton, IonImg, IonIcon } from \"@ionic/react\"\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { logg } from \"$shared\"\nimport { Rating } from \"$components/application\"\nimport \"./venues.scss\"\n\nconst Address = styled.p`\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  color: ${p => p.theme.darkGrey };\n  font-size: 14px;\n`;\n\nconst Col = styled.div``;\n\n// right arrow container\nconst _Ra = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n`;\nconst RightArrow = () => <_Ra><img className=\"forward-arrow\" src=\"/assets/16x16/arrow-right.png\" /></_Ra>\n\nconst Row = styled.div`\n  display: flex;\n`;\n\nconst Title = styled.div`\n  font-size: 1.5em;\n`;\n\nconst Venue = styled.div`\n  width: 100vw;\n  padding: 1em;\n  margin-bottom: 0.5em;\n  border-bottom: 1px solid #e3d3d3;\n  box-shadow: 0px 1px 5px 1px #b3aeae;\n  background-color: white;\n  position: relative;\n\n  display: flex;\n  justify-content: space-between;\n\n  img.thumb {\n    border-radius: 10px;\n  }\n\n  > div {\n    // border: 1px solid red;\n  }\n`;\n\nconst Venues = (props) => {\n  logg(props, 'Venues')\n\n  const defaultRating = 3.5\n  const [filteredVenues, setFilteredVenues] = useState(props.venues)\n\n  function filterHandler(ev) {\n    let venues = props.venues.filter(venue => {\n      return venue.name.toLowerCase().includes(ev.target.value.toLowerCase())\n    })\n    setFilteredVenues(venues)\n  }\n\n  return (\n    <div className=\"venues-section\">\n      <div>\n        <div className=\"filter-section\">\n          <input className=\"filter-input\" onChange={filterHandler} />\n          <IonIcon className=\"filter-icon\" icon={funnel}></IonIcon>\n        </div>\n      </div>\n      <div className=\"container\">\n\n        { filteredVenues.map((venue, idx) => <Venue key={idx} >\n          <Row>\n            <Col><img style={{ paddingRight: '1em' }} className='thumb' src={venue.photo} /></Col>\n            <Col>\n              <Title>{venue.name}</Title>\n              <div className=\"rating-section\">\n                <Rating rate={defaultRating}></Rating>\n                <span className=\"reviews\">5 reviews</span>\n              </div>\n              <div className=\"tags-section\">\n                { venue.tags.map((tag, idx) => <span key={idx} className=\"tags\">{tag.name}</span> )}\n              </div>\n              <p className=\"description\" dangerouslySetInnerHTML={{ __html: venue.subhead }}></p>\n              { venue.address && <Address>{venue.address}</Address> }\n            </Col>\n\n          </Row>\n          <RightArrow />\n        </Venue> )}\n\n      </div>\n    </div>\n  )\n}\n\nVenues.propTypes = {\n  venues: PropTypes.array.isRequired,\n}\nexport default Venues\n","import React, { useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport { IonPage, IonContent, IonIcon, IonLoading } from '@ionic/react'\nimport { pin, newspaperOutline, image, videocam } from 'ionicons/icons'\n\nimport { AppRouter, useApi, logg, Wrapper } from \"$shared\"\nimport { Newsitems } from \"$components/newsitems\"\nimport { Venues } from \"$components/venues\"\nimport \"./cities.scss\"\n\nconst CitiesShow = (props) => {\n  logg(props, 'CitiesShow')\n  const { match } = props\n\n  const api = useApi()\n  const history = useHistory()\n  const thisPath = AppRouter.cityPath(match.params.name)\n\n  const location = useLocation()\n\n  const [city, setCity] = useState(null)\n  const [showLoading, setShowLoading] = useState(false)\n\n  const mountedRef = useRef('init')\n  useEffect(() => {\n    setShowLoading(true)\n    api.getCity(match.params.name).then(res => {\n      if (mountedRef.current) {\n        setCity(res.data.city)\n        setShowLoading(false)\n      }\n    })\n    return () => mountedRef.current = false\n  }, [match.params.name])\n\n  // @TODO: remove this!\n  function changeMenuHandler(menu) {\n    // history.push(`${match.url}/${menu}`);\n  }\n\n  return <Wrapper>\n\n    { city && <div className='wrapper'>\n      <div className='city-show'>\n\n        <header style={{ backgroundImage: `url(${city.hero_img}}`, backgroundSize: \"contain\" }}></header>\n\n        <section className=\"section-one\">\n          <IonIcon icon={pin} className=\"location\"></IonIcon>\n          <h1 className=\"city-name\">{city.name}</h1>\n          <div className=\"status\">\n            <div className=\"status-grid\">\n              <IonIcon className=\"info-icon\" icon={newspaperOutline}></IonIcon>\n              <span className=\"numbers\">{city.n_reports}</span>\n            </div>\n            <div className=\"status-grid\">\n              <IonIcon className=\"info-icon\" icon={image}></IonIcon>\n              <span className=\"numbers\">{city.n_galleries}</span>\n            </div>\n            <div className=\"status-grid mid\">\n              <IonIcon className=\"info-icon\" icon={videocam}></IonIcon>\n              <span className=\"numbers \">{city.n_videos}</span>\n            </div>\n          </div>\n        </section>\n\n        { /* @TODO: re-add tags here! */ }\n        { /* city.tags && <section className=\"tags-section\">\n          <span className=\"btn delete-btn\" >\n            <IonIcon name=\"close\"> </IonIcon> deselect all\n          </span>\n          { city.tags.map((tag, i) => <span className=\"btn\" key={i} >{tag.name}</span>) }\n        </section> */ }\n\n        <section className=\"section-three\">\n          <div className=\"menu-option\" onClick={() => history.push(AppRouter.cityPath(match.params.name))} >\n            <img src=\"/assets/newsfeed-icon.svg\" alt=\"Newsfeed\" />\n            <p className={`${location.pathname == thisPath ? \"selected\" : \"\"} menu-item`}>Newsfeed</p>\n          </div>\n          <div className=\"menu-option\" onClick={() => history.push(AppRouter.cityVenuesPath(match.params.name))} >\n            <img src=\"/assets/venue-icon.svg\" alt=\"Venues\" />\n            <p className={`${location.pathname.includes(\"venues\") ? \"selected\" : \"\"} menu-item`}>Venues</p>\n          </div>\n        </section>\n\n\n        <Switch>\n          <Route exact path={`${match.url}/venues`} render={() => <Venues    venues={city.venues} />} />\n          <Route exact path={match.url}             render={() => <Newsitems newsitems={city.newsitems} /> } />\n        </Switch>\n\n\n      </div>\n    </div>}\n    <IonLoading\n      isOpen={showLoading}\n      onDidDismiss={() => setShowLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n\n    <br /><br /><br />\n  </Wrapper>\n}\n\nexport default CitiesShow\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { Metaline } from \"$components/application\"\nimport {\n  C, logg, request, TwofoldContext, BackBtn,\n} from \"$shared\"\n\nimport \"./galleries.scss\"\n\nconst W0 = styled.div`\n  // border: 1px solid blue;\n  height: auto;\n`;\n\n/**\n * GalleriesShow\n**/\nconst GalleriesShow = (props) => {\n  // logg(props, 'GalleriesShow')\n  const { match } = props // @TODO: this doesnt look like a prop, remove\n\n  const [showLoading, setShowLoading] = useState(false) // @TODO: hmm could it be moved to TwofoldContext ?\n  const [gallery, setGallery] = useState({})\n\n  const mountedRef = useRef('init')\n\n  const {\n    itemToUnlock, setItemToUnlock,\n  } = useContext(TwofoldContext)\n\n  // @TODO: move this into api\n  let getGallery = async () => {\n    const token = localStorage.getItem(C.jwt_token)\n    await request.get(`/api/galleries/view/${match.params.slug}`, { params: { jwt_token: token } }).then(res => {\n      if (!mountedRef.current) { return }\n      const gallery = res.data.gallery\n      if (gallery.is_premium && !gallery.is_purchased) {\n        setItemToUnlock(gallery)\n      } else {\n        setGallery(res.data.gallery)\n      }\n    }).catch((err) => {\n      logg(err, 'e65')\n    })\n  }\n\n  useEffect(() => {\n    getGallery()\n    return () => {\n      mountedRef.current = null\n    }\n  }, [gallery.id, itemToUnlock.id] )\n\n  return <W0 className=\"GalleriesShow\">\n\n    <div className='narrow'>\n      <h1 className=\"heading\">\n        <BackBtn />\n        <span className=\"title\">{gallery.name}</span>\n      </h1>\n      <Metaline {...gallery} />\n\n      <div className=\"thumbs\">\n        { gallery.photos && gallery.photos.map((ph, i) =>\n          <div className='card' key={i}>\n            <div className='card-inner'>\n              <IonImg src={ph.thumb_url}></IonImg>\n            </div>\n          </div>\n        ) }\n      </div>\n\n      <div dangerouslySetInnerHTML={{ __html: gallery.description }}></div>\n\n    </div>\n    <div className=\"full-img-section\">\n\n      { gallery.photos && gallery.photos.map((ph, i) =>\n        <div className='item' key={i}>\n          <img src={ph.large_url} />\n        </div>\n      ) }\n\n    </div>\n\n  </W0>\n}\n\nexport default GalleriesShow","import React, { useEffect, useState } from \"react\";\nimport { IonLoading } from \"@ionic/react\";\n\nimport request from \"$shared/request\";\nimport { logg } from \"$shared\";\nimport { Galleries } from \"./\";\nimport { NewsitemGallery } from \"$components/newsitems\";\n\nconst MyGalleries = (props) => {\n  const [galleries, setGalleries] = useState(null);\n  const [showLoading, setShowLoading] = useState(false);\n\n  useEffect(() => {\n    setShowLoading(true);\n    const token = localStorage.getItem(\"jwtToken\");\n    request.get(`/api/my/galleries`, { params: { jwt_token: token } }).then(r => {\n      logg(r.data, 'MyGalleries data')\n      setGalleries(r.data);\n      setShowLoading(false);\n    })\n  }, []);\n\n  return (<>\n    <IonLoading\n      isOpen={showLoading}\n      onDidDismiss={() => setShowLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n    { galleries && galleries.length && galleries.map((g) => <NewsitemGallery key={g.id} data={g} /> ) }\n  </>);\n}\n\nexport default MyGalleries;","\nimport {\n  IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonToggle, IonList, IonItem,\n  IonLabel, IonItemDivider,\n} from '@ionic/react'\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useState } from 'react'\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport { C, logg, request, S, TwofoldContext } from \"$shared\"\nimport { MenuLeft } from \"$components/application\"\nimport img from '$components/application/45x45_day-night-2.png'\nimport './day_night_toggle.scss'\n\n/* B */\n\n// One breadcrumb\nconst B0 = styled.div`\n  color: ${p=> p.theme.colors.text};\n  // padding-right: 0.5em;\n`;\n\n// The divider\nconst B1 = styled.div`\n  padding: 0.5em;\n  color: ${p => p.theme.colors.text};\n`;\n\n/* D */\nconst L = styled.div`\n  color: ${p=> p.theme.colors.text};\n  margin-top: .5em;\n`;\nconst WDayNight = styled.div`\n  // border: 1px solid green;\n  display: flex;\n  margin: 0 1em;\n`;\nconst DayNightToggle = (props) => {\n  const { theme, toggleTheme } = props\n  return <WDayNight>\n    <L>Day</L>\n    <IonToggle checked={theme === C.themes.dark} onIonChange={toggleTheme} value=\"DayNight\" />\n    <L>Night</L>\n  </WDayNight>\n}\nconst T0 = styled.div`\n  width: 45px;\n  height: 45px;\n  // background-image: url(${img});\n`;\nconst DayNightToggle2 = (props) => {\n  // logg(props, 'DayNightToggle2')\n  const { theme, toggleTheme } = props\n  const [ rotating, setRotating ] = useState(null)\n\n  const doTransition = () => {\n    setRotating('rotating')\n    setTimeout(() => {\n      setRotating(null)\n      toggleTheme()\n    }, 1 * 1000)\n  }\n\n  return <WDayNight onClick={doTransition} >\n    <T0 className={`theme-${theme} ${rotating}`} />\n    {/* <IonToggle checked={theme === C.themes.dark} onIonChange={toggleTheme} value=\"DayNight\" /> */}\n  </WDayNight>\n}\n\n/* W */\nconst W0 = styled.div`\n  background: ${p => p.theme.colors.cardBackground};\n  border: ${p=>p.debug?'1':'0'}px solid cyan;\n\n  display: flex;\n  align-items: center;\n  justify-content: stretch;\n\n  z-index: 1;\n\n  // height: ${p => p.theme.breadcrumbsHeight};\n`;\n\nconst WBreadcrumbs = styled.div`\n  display: block;\n  flex-grow: 1;\n  // flex-direction: row;\n  // flex-grow: 1;\n  // flex-wrap: wrap;\n\n  > * {\n    // border: 1px solid red;\n    display: inline;\n  }\n`;\n\n\n/**\n * Breadcrumbs\n * @TODO: move to src/application\n */\nconst Breadcrumbs = (props) => {\n  // logg(props, 'Breakcrumbs')\n  const { breadcrumbs=[] } = props\n  const { layout, toggleTheme, theme } = useContext(TwofoldContext)\n  const history = useHistory()\n\n  const out = []\n  breadcrumbs.map((b, idx) => {\n    if (idx+1 === props.breadcrumbs.length) {\n      // last one\n      out.push(<B0 key={idx} >{b.name}</B0>)\n    } else {\n      out.push(<B0\n        key={idx}\n        style={{ textDecoration: 'underline', cursor: 'pointer' }}\n        onClick={() => history.push(`/en/locations/show/${b.slug}`) }\n      >{b.name}</B0>)\n      out.push(<B1 key={`${idx}-divider`} >&gt;</B1>)\n    }\n  })\n\n  return <W0 debug={config.debug} className=\"Breadcrumbs\" >\n    { layout === C.layout_mapui && <MenuLeft variant={C.variants.inline} /> }\n    <WBreadcrumbs className='WBreadcrumbs' >{ out }</WBreadcrumbs>\n    <DayNightToggle2 toggleTheme={toggleTheme} theme={theme} />\n  </W0>\n}\nBreadcrumbs.propTypes = {\n  breadcrumbs: PropTypes.arrayOf(\n    PropTypes.shape({\n      name: PropTypes.string.isRequired,\n      slug: PropTypes.string.isRequired,\n    }),\n  ),\n}\nexport default Breadcrumbs\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\n\nimport {\n  FlexRow,\n  logg,\n} from 'ishlibjs'\n\nconst Actions = styled.div``;\n\nconst W0 = styled.div``;\n\n/**\n * ReportForm\n**/\nconst ReportForm = (props) => {\n  // logg(props, 'ReportForm')\n  const { item } = props\n\n  return <W0>\n\n    <h1>Report Form (@TODO: remove)</h1>\n\n    <form>\n\n      <FlexRow>\n        <input type='text' name='name' /> name\n      </FlexRow>\n\n      <FlexRow>\n        <textarea name='name' /> subhead\n      </FlexRow>\n\n      <FlexRow>\n        item_type: default? longscroll?\n      </FlexRow>\n\n      <FlexRow>\n        @TODO: editable slug, the fucking slug hasn't been solved in 10 years!\n      </FlexRow>\n\n      <FlexRow>\n        @TODO: premium tier\n      </FlexRow>\n\n      <FlexRow>\n        @TODO: tags\n      </FlexRow>\n\n      <FlexRow>\n        public?\n      </FlexRow>\n\n      <textarea /> description\n\n      <Actions>\n        <button type='submit'>Create</button>\n      </Actions>\n    </form>\n  </W0>\n}\nReportForm.propTypes = {\n};\nexport default ReportForm\n","\nimport React, { useEffect, useState } from \"react\";\nimport styled from 'styled-components'\nimport PropTypes from 'prop-types'\n\nimport {\n  useApi, Card as Box, logg, request\n} from \"$shared\"\n\nconst W0 = styled.div``;\n\n/**\n * ReportsShow\n**/\nconst ReportsShow = (props) => {\n  // logg(props, \"ReportsShow\")\n\n  let [ item, setItem ] = useState({})\n  let api = useApi()\n\n  useEffect(() => {\n    api.getReport(props.match.params.slug).then((data) => {\n      setItem(data)\n    }).catch((err) => {\n      logg(err, 'cannot getReport')\n    })\n  }, [])\n\n  // @TODO: logged in and no access\n\n  // @TODO: logged in and access\n\n  return (<W0>\n    {/* <Box boxShadow={2}> */}\n      <h1>{item.name}</h1>\n      <div className=\"description\" dangerouslySetInnerHTML={{ __html: item.description }} />\n    {/* </Box> */}\n  </W0>)\n}\nReportsShow.propTypes = {\n  // none?\n};\n\n// @TODO: wrap in login HOC\nexport default ReportsShow\n","\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { Route, useHistory, useLocation, useParams } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport {\n  Actions,\n  CloseBtn,\n} from 'ishlibjs'\n\nimport { C, logg, TwofoldContext } from \"$shared\"\nimport { GalleriesShow } from \"$components/galleries\"\nimport {\n  ReportsForm,\n  ReportsShow,\n} from \"$resources/reports\"\n\n/**\n * ItemModal\n * @TODO: move to $components/application ?\n * shows items, but also I use it to create report, ...\n *\n**/\nconst ItemModal = (props) => {\n  // logg(props, 'ItemModal')\n  const { item } = props\n\n  const params = useParams()\n  const history = useHistory()\n\n  const {\n    showItem, setShowItem,\n  } = useContext(TwofoldContext)\n\n  const onClose = () => {\n    history.push(config.router.locationPath(params.slug))\n    setShowItem(null)\n  }\n\n  if (!item) { return }\n  if (!item.action) { item.action = C.actions.show } // set default\n\n  return <Modal isOpen={!!showItem} >\n    <Actions >\n      <CloseBtn onClick={onClose} />\n    </Actions>\n    { item.item_type === C.item_types.report && item.action === C.actions.show && <ReportsShow match={{ params: { slug: item.reportname } }} /> }\n    { item.item_type === C.item_types.report && item.action === C.actions.new && <ReportsForm /> }\n    { item.item_type === C.item_types.gallery && <GalleriesShow match={{ params: { slug: item.slug } }} /> }\n  </Modal>\n}\n\nexport default ItemModal\n","\nimport React, {\n  useContext, useState,\n} from 'react'\nimport Modal from 'react-modal'\n\nimport {\n  MarkerContext, MarkerContextProvider,\n  MarkerForm,\n} from './'\nimport {\n  logg,\n} from '$shared'\n\nimport styles from './markers.scss'\n\n/**\n * MarkerModal\n *\n * For editing/adding markers.\n**/\nconst MarkerModal = (props) => {\n\n  const {\n    markerModalOpen, setMarkerModalOpen,\n  } = useContext(MarkerContext)\n  // logg(useContext(MarkerContext), 'MarkerModalUsedContext')\n\n  return <Modal\n    className={`MarkerModal ${styles.MarkerModal}`}\n    isOpen={markerModalOpen}\n  >\n    <h1>\n      marker modal\n      <span onClick={() => setMarkerModalOpen(false)}>[x]</span>\n    </h1>\n    <MarkerForm />\n  </Modal>\n}\n\nexport default MarkerModal\nexport {\n  MarkerContext,\n  MarkerContextProvider,\n  MarkerModal,\n}\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport {\n  C,\n  logg, S, TwofoldContext,\n  PurchasedIcon,\n  WBordered, WBorderedItem,\n} from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\n\n/* M */\nconst _Marker = styled.div`\n  color: ${p => p.theme.colors.text};\n\n  margin-bottom: 10px;\n  max-width: 33%;\n  min-width: 100px;\n\n  text-align: center;\n\n  width: min(33%, 100px);\n`;\nconst Marker = ({ children, variant, ...props }) => {\n  if (variant===C.variants.bordered) {\n    return <WBorderedItem {...props} >{children}</WBorderedItem>\n  } else {\n    return <_Marker className=\"Marker\" {...props} >{children}</_Marker>\n  }\n}\n\n/* W */\nconst _W = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  // justify-content: flex-start;\n\n  ::after {\n    content: \"\";\n    flex: auto;\n  }\n`;\nconst W = ({ children, variant, ...props }) => {\n  if (variant===C.variants.bordered) {\n    return <WBordered {...props}>{children}</WBordered>\n  } else {\n    return <_W {...props}>{children}</_W>\n  }\n}\n\n/**\n * Default\n */\nconst MarkersList = (props) => {\n  // logg(props, 'MarkersList')\n  const { variant } = props\n\n  const {\n    itemToUnlock, setItemToUnlock,\n    showUrl, setShowUrl,\n  } = useContext(TwofoldContext)\n\n  const history = useHistory()\n\n  const goto = (m) => {\n    if (m.premium_tier && !m.is_purchased) {\n      setItemToUnlock({ ...m })\n    } else {\n      if (m.url) {\n        setShowUrl(m.url)\n      }\n      else {\n        history.push(`/en/locations/show/${m.slug}`)\n      }\n    }\n  }\n\n  const out = []\n  props.markers.map((m, idx) => {\n    out.push(<Marker className=\"Marker\" key={idx} variant={variant}\n      onClick={() => goto(m) }\n    >\n      <img src={m.title_img_path} /><br />\n      { m.is_purchased && <PurchasedIcon /> }\n      { m.name }\n    </Marker>)\n  })\n\n  return <W className=\"MarkersList\" >\n    {out}\n  </W>\n}\n\nMarkersList.propTypes = {\n  variant: PropTypes.string,\n}\nexport default MarkersList\n","import React from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\n\nimport {\n  FlexRow,\n  logg,\n} from 'ishlibjs'\n\nconst Actions = styled.div``;\n\nconst W0 = styled.div``;\n\n/**\n * MarkerForm\n**/\nconst MarkerForm = (props) => {\n  // logg(props, 'MarkerForm')\n  const { item } = props\n\n  return <W0>\n    <form>\n\n      <FlexRow>\n        <input type='text' name='name' /> name\n      </FlexRow>\n\n      <FlexRow>\n        <input type='text' name='name' /> destination\n      </FlexRow>\n\n      <FlexRow>\n        <input type='file' name='title_image' />\n        map image\n      </FlexRow>\n\n      <FlexRow>\n        <input type='file' name='title_image' />\n        title image\n      </FlexRow>\n\n      <FlexRow>\n        <checkbox name='is_active' /> active?\n      </FlexRow>\n\n      <FlexRow>\n        <checkbox name='is_public' /> public?\n      </FlexRow>\n\n      <FlexRow>\n        <input type='text' name='url' /> url\n      </FlexRow>\n\n      <textarea /> description\n\n      <Actions>\n        <button type='submit'>Create</button>\n      </Actions>\n    </form>\n  </W0>\n}\nMarkerForm.propTypes = {\n};\nexport default MarkerForm\n","\nimport React, {\n  useContext, useState,\n} from 'react'\nimport Modal from 'react-modal'\n\nconst MarkerContext = React.createContext({})\nconst MarkerContextProvider = ({ children, ...props }) => {\n\n  const [ marker, setMarker ] = useState()\n  const [ markerModalOpen, setMarkerModalOpen ] = useState(false)\n\n  return <MarkerContext.Provider value={{ marker, setMarker, markerModalOpen, setMarkerModalOpen, }}\n  >{children}</MarkerContext.Provider>\n}\n\n\nexport { default as MarkerModal } from './MarkerModal'\nexport {\n  MarkerContext,\n  MarkerContextProvider,\n}\nexport { default as MarkersList } from \"./MarkersList\"\nexport { default as MarkerForm } from './MarkerForm'\n","\nimport { Toast } from \"@capacitor/toast\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport styled from 'styled-components'\n\nimport {\n  Breadcrumbs,\n  ItemModal,\n  MapPanel, MapPanelNoZoom,\n  RatedRestrictionModal,\n  WrappedMapPanel,\n} from \"./\"\nimport {\n  MarkersList,\n  MarkerModal, MarkerContext, MarkerContextProvider,\n} from '$resources/markers'\nimport {\n  ReportForm,\n} from '$resources/reports'\nimport { CitiesList } from \"$components/cities\"\nimport { Newsitems } from \"$components/newsitems\"\nimport { LongLine } from \"$components/TwofoldLayout\"\nimport {\n  C, Card, ChevronLeft, ChevronRight, Collapsible,\n  FlexCol, FlexRow,\n  inflector,\n  Loading, logg,\n  MenuIcon,\n  request,\n  TwofoldContext,\n  useApi, useWindowSize,\n} from \"$shared\"\n\n/* C */\n\n/* D */\n\n// @TODO: move Description into shared ?\nconst _D = styled.div`\n`;\nconst Description = ({ item={} }) => {\n  if (!item.description) { return }\n\n  return <_D className=\"Description\" dangerouslySetInnerHTML={{ __html: item.description }} />\n}\n\n/* H */\nconst WH = styled.div`\n  // border: 1px solid cyan;\n\n  position: fixed;\n  top: 5px;\n  left: ${p => p.foldedLeft\n    ? '10px'\n    : p.foldedRight\n    ? '98%'\n    : `calc(${p.twofoldPercent*100}% - 10px)` };\n\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n\n  width: 30px;\n  height: 95%; /* @TODO: this needs to account for bottom being open */\n`;\nconst Handle = (props) => {\n  const [ w ] = useWindowSize()\n\n  const [ offsetX, setOffsetX ] = useState()\n  const [ dragging, setDragging ] = useState(false)\n\n  const foldLeft = () => {\n    if (folded === C.foldedRight) {\n      setFolded(C.foldedCenter)\n    } else {\n      setFolded(C.foldedLeft)\n    }\n  }\n\n  const foldRight = () => {\n    if (folded === C.foldedLeft) {\n      setFolded(C.foldedCenter)\n    } else {\n      setFolded(C.foldedRight)\n    }\n  }\n\n  const {\n    folded, setFolded,\n    twofoldPercent, setTwofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const onMouseDown = (e) => {\n    setDragging(true)\n    setOffsetX(e.pageX)\n  }\n\n  const onMouseMove = (e) => {\n    if (!dragging) { return }\n    if (e.clientX === 0) { return }\n    const movedBy = e.clientX - offsetX\n    if (movedBy === 0) { return }\n    const movedByPercent = movedBy/w\n    setTwofoldPercent(prev => prev + movedByPercent)\n  }\n\n  const onMouseUp = (e) => {\n    setDragging(false)\n    // document.removeEventListener('mousemove', onMouseMove)\n    // document.removeEventListener('mousedown', onMouseDown)\n  }\n\n  const foldedLeft = folded === C.foldedLeft\n  const foldedRight = folded === C.foldedRight\n\n  // draggable=\"true\"\n  return <WH className=\"Handle\" {...{ foldedLeft, foldedRight, twofoldPercent }}\n    onMouseMove={onMouseMove}\n    onMouseDown={onMouseDown}\n    onMouseLeave={onMouseUp}\n    onMouseUp={onMouseUp}\n    style={{\n      pointer: 'cursor',\n    }}\n  >\n    <MenuIcon />\n    <ChevronLeft onClick={foldLeft} />\n    <ChevronRight onClick={foldRight} />\n    { [C.foldedRight, C.foldedLeft].indexOf(folded) !== -1  && <LongLine orientation={C.vertical} /> }\n  </WH>\n}\n\n/* I */\nconst IframeModal = (props) => {\n  const { showUrl, setShowUrl } = useContext(TwofoldContext)\n\n  return (<Modal ariaHideApp={false} isOpen={!!showUrl} >\n    <span onClick={() => {  setShowUrl(false) }} >[x]</span>\n\n    <iframe height=\"100%\" style={{ width: \"100%\", height: \"100%\" }} scrolling={\"yes\"} src={props.src}\n      frameBorder=\"no\" allowtransparency=\"true\" allowFullScreen={true} >\n    </iframe>\n  </Modal>)\n}\n\n/* L */\nconst Left = styled.div`\n  background: ${p => p.theme.colors.background};\n  flex: ${p => p.foldedRight ? '99%' : `${p.twofoldPercent*100}%` };\n  overflow: hidden;\n\n  display: flex;\n  flex-direction: column;\n\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n`;\n\n\n/* R */\n\nconst Right = styled.div`\n  background: ${p => p.theme.colors.background};\n  position: relative;\n\n  padding: 0 0 0 1em;\n  flex: ${p => p.foldedRight ? '2%' : `${(1-p.twofoldPercent)*100}%` };\n  overflow-x: hidden;\n  overflox-y: auto;\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n`;\n\nconst Row = styled.div`\n  // border: 1px solid magenta;\n\n  display: flex;\n  position: relative;\n`;\n\n\n/**\n * LocationsShowDesktop\n**/\nconst LocationsShowDesktop = (props) => {\n  // logg(props, 'LocationsShowDesktop')\n  const { match } = props\n\n  const [ windowWidth, windowHeight ] = useWindowSize()\n\n  const [ loading, setLoading ] = useState(false)\n  const [ markers, setMarkers ] = useState([])\n\n  const mountedRef = useRef('init')\n  const showItemRef = useRef('init')\n  const mapPanelRef = useRef(null)\n  const api = useApi()\n\n  const {\n    bottomDrawerOpen,\n    editorMode,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    location, setLocation,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  useEffect(() => {\n    if (location) {\n      setMarkers(location.markers)\n\n      if (location.is_premium && !location.is_purchased) {\n        setItemToUnlock({ closable: false, item_type: 'Location', ...location })\n      }\n    }\n  }, [ location ])\n\n  const showToast = async (msg) => await Toast.show({ text: msg })\n\n  // Load the map\n  // @TODO: move into api object\n  useEffect(() => {\n    setLoading(true)\n    const token = localStorage.getItem(\"jwt_token\")\n\n    request.get(`/api/maps/view/${match.params.slug}`, { params: { jwt_token: token } }).then(res => {\n      if (mountedRef.current === match.params.slug) { return null }\n      if (!res.data.map) {\n        setLoading(false)\n        showToast('could not get Location')\n        return null\n      }\n\n      setLocation(res.data.map)\n      if (res.data.map.rated === C.rated.nc17 && !ratedConfirmation) { // @TODO: not test-driven, bad!\n        setRatedConfirmation(false)\n      }\n      setLoading(false)\n      // @TODO: setFlash here?! If I\"m accessing a gallery I haven't bought access to?\n    })\n\n    return () => {\n      mountedRef.current = match.params.slug\n    }\n  }, [ match.params.slug ])\n\n  // set mapPanel sizes\n  useEffect(() => {\n    if (mapPanelRef.current) {\n      setMapPanelWidth(mapPanelRef.current.offsetWidth)\n      setMapPanelHeight(mapPanelRef.current.offsetHeight)\n    }\n  }, [bottomDrawerOpen, folded, mapPanelRef.current, twofoldPercent, windowWidth, windowHeight])\n\n  // load showItem if any\n  // @TODO: this makes too many calls, improve performance\n  // @TODO: move to api\n  // @TODO: this is duplicated between LocationsShowDesktop,Mobile - consolidate!\n  useEffect(() => {\n    if (!match.params.item_type) { return }\n\n    const itemType = inflector.classify(match.params.item_type)\n    switch (itemType) {\n      case C.item_types.gallery:\n        api.getGallery(match.params.item_slug).then(setShowItem)\n        break\n      case C.item_types.report:\n        api.getReport(match.params.item_slug).then(setShowItem)\n        break\n      default:\n        logg(itemType, 'cannot get this item type')\n    }\n  }, [ match.params.item_slug, match.params.item_type ])\n\n  const foldedLeft = folded === C.foldedLeft\n  const foldedRight = folded === C.foldedRight\n\n  return <Row>\n    <MarkerContextProvider >\n\n    { !foldedLeft && <Left\n        className='Left'\n        {...{ bottomDrawerOpen,\n          folded, foldedLeft, foldedRight,\n          twofoldPercent,\n        } }\n    >\n      { <Breadcrumbs {...location} /> }\n      { location && <WrappedMapPanel\n        map={location.map ? location.map : location}\n        ref={mapPanelRef}\n        slug={match.params.slug}\n      /> }\n    </Left> }\n\n    <Right\n        className='Right'\n        {...{\n          bottomDrawerOpen,\n          folded, foldedLeft, foldedRight,\n          twofoldPercent,\n        } }\n    >\n      <Handle />\n      { location && !foldedRight && <F>\n\n        { /* Markers */ }\n        { markers && markers.length && <Collapsible\n            config={{ collapsible: false }}\n            slug={C.collapsible.markers}\n            variant={C.variants.transparent}\n        >\n          <MarkersList markers={markers}\n            variant={C.variants.bordered}\n          />\n        </Collapsible> || null }\n\n        { /* Tags */ }\n        <FlexRow style={{ marginBottom: '1em', flexWrap: 'wrap' }} >\n          { location.tags.map((tag) => <Card >{tag.name}</Card> )}\n        </FlexRow>\n\n        { /* Actions */ }\n        { editorMode && <FlexRow style={{ marginBottom: '1em' }} >\n          <Card onClick={() => setShowItem({ action: C.actions.new, item_type: C.item_types.report }) } >\n            + Report\n          </Card>\n          <Card>\n            + Photo\n          </Card>\n          <Card>\n            + Gallery\n          </Card>\n          <Card>\n            + File\n          </Card>\n          {/* <Card> + Spreadsheet </Card> */}\n          <Card> + Marker </Card>\n        </FlexRow> }\n\n        { /* Description */ }\n        { location.description && <Collapsible\n            label={location.labels.description}\n            slug={C.collapsible.description}\n            variant={C.variants.bordered}\n        >\n          <Description item={location} />\n        </Collapsible> || null }\n\n        { /* Newsitems */ }\n        { location.newsitems && location.newsitems.length && <Newsitems\n            variant={C.variants.bordered} newsitems={location.newsitems}\n        /> || null }\n\n      </F> || null }\n    </Right>\n\n    { showUrl && <IframeModal src={showUrl} /> }\n    { showItem && <ItemModal item={showItem} /> }\n    { loading && <Loading /> }\n    { !ratedConfirmation && <RatedRestrictionModal {...{ ratedConfirmation, setRatedConfirmation, }} /> }\n    { <MarkerModal /> }\n\n  </MarkerContextProvider>\n  </Row>\n}\n\nexport default LocationsShowDesktop\n","import { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { Metaline } from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\nimport {\n  Breadcrumbs,\n  ItemModal,\n  MapPanel, MapPanelNoZoom,\n  WrappedMapPanel,\n} from \"./\"\nimport {\n  MarkersList,\n} from '$resources/markers'\nimport {\n  C, Collapsible, CollapsibleContext,\n  inflector,\n  Loading, logg,\n  request,\n  S,\n  TwofoldContext,\n  useApi, useWindowSize,\n  ZoomContext,\n} from \"$shared\"\n\nconst Div1 = styled.div`\n  // border: 2px solid brown;\n\n  text-align: center;\n  display: block;\n\n  position: relative; /* required for mobile, so that zoomCtrl, etc are inside the collapsible div */\n\n  overflow: scroll;\n  max-height: 80vh; // @TODO: huh?\n`;\n\nconst CollapsibleNoMargins = styled(Collapsible)`\n  margin: 0;\n  padding: 0;\n`;\n\nconst _Description = styled.div`\n  // border: 1px solid red;\n\n  padding: 10px;\n`;\nconst Description = ({ item }) => {\n  return <_Description dangerouslySetInnerHTML={{ __html: item.description }} />\n}\n\nconst MapWrapper = styled.div`\n  // border: 1px solid red;\n\n  position: relative;\n`;\n\n\n/* W */\n\nconst W = styled.div`\n  // border: 1px solid yellow;\n`;\n\n/* Z */\n\nconst ZoomCtrlRoot = styled.div`\n  // border: 1px solid orange;\n\n  position: absolute;\n  top: 0;\n  left: calc(100vw - 80px);\n  background: white;\n  padding: 5px;\n\n  display: flex;\n  flex-direction: column;\n  z-index: 10;\n`;\n\nconst ZoomCtrl = (props) => {\n  const { zoom, setZoom } = useContext(TwofoldContext)\n\n  const zoomIn = () => {\n    setZoom(zoom/2)\n  }\n  const zoomOut = () => {\n    setZoom(zoom*2)\n  }\n  const zoomReset = () => {\n    setZoom(1)\n  }\n\n  return <ZoomCtrlRoot >\n    <span onClick={zoomIn} >[+]</span>\n    <span onClick={zoomOut} >[-]</span>\n    <span onClick={zoomReset} >[1]</span>\n  </ZoomCtrlRoot>\n}\n\n/**\n * LocationsShowMobile\n *\n */\nconst LocationsShowMobile = (props) => {\n  // logg(props, 'LocationsShowMobile')\n  const {\n    match,\n  } = props\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    location, setLocation,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const [ windowWidth, windowHeight ] = useWindowSize()\n\n  const [loading, setLoading] = useState(false)\n  const api = useApi()\n\n  const mountedRef = useRef('init')\n  const mapPanelRef = useRef(null)\n  const history = useHistory()\n\n  // Get the location data\n  useEffect(() => {\n    setLoading(true)\n    const token = localStorage.getItem(\"jwt_token\")\n    request.get(`/api/maps/view/${match.params.slug}`, { params: { jwt_token: token } }).then(res => {\n      if (mountedRef.current === match.params.slug) return null\n\n      if (!res.data.map) {\n        setLoading(false)\n        showToast('could not get Location')\n        return null\n      }\n\n      setLocation(res.data.map)\n      setLoading(false)\n      // @TODO: setFlash here?! If I\"m accessing a gallery I haven't bought access to?\n    }).catch((e) => {\n      logg(e, 'e13')\n      history.push('/')\n    }).finally(() => {\n    })\n\n    return () => {\n      mountedRef.current = match.params.slug\n    }\n  }, [ match.params.slug ])\n\n\n  // @TODO: this can probably be much improved. Take either markers of location.map, or location itself.\n  // @TODO: why is this a redirect to /null ?!\n  let markers = []\n  if (location) {\n    markers = location.markers // location ? location.markers.length ? location.markers : location.map.markers : null\n  }\n\n  // set mapPanel sizes\n  useEffect(() => {\n    if (mapPanelRef.current) {\n      setMapPanelWidth(mapPanelRef.current.offsetWidth)\n      setMapPanelHeight(mapPanelRef.current.offsetHeight)\n    }\n  }, [bottomDrawerOpen, folded, mapPanelRef.current, twofoldPercent, windowWidth, windowHeight])\n\n  // This is to not have MapPanel, only MapPanelNoZoom on mobile _vp_ 2022-03-16\n  let map\n  if (location) {\n    map = location.map || location\n    map = { ...map, config: { ...map.config, map_panel_type: C.map_panel_types.MapPanelNoZoom } }\n  }\n\n  // load showItem if any\n  // @TODO: this makes too many calls, improve performance\n  // @TODO: move to api\n  // @TODO: this is duplicated between LocationsShowDesktop,Mobile - consolidate!\n  useEffect(() => {\n    if (!match.params.item_type) { return }\n\n    const itemType = inflector.classify(match.params.item_type)\n    switch (itemType) {\n      case C.item_types.gallery:\n        api.getGallery(match.params.item_slug).then(setShowItem)\n        break\n      case C.item_types.report:\n        api.getReport(match.params.item_slug).then(setShowItem)\n        break\n      default:\n        logg(itemType, 'cannot get this item type')\n    }\n  }, [ match.params.item_slug, match.params.item_type ])\n\n  return (<W className='LocationsShowMobile' >\n\n    { loading && <i>Loading...</i> }\n\n    { location && <Breadcrumbs {...location} /> }\n    { location && <Collapsible\n        label={location.labels.map}\n        slug={C.collapsible.map}\n    ><WrappedMapPanel\n        map={map}\n        ref={mapPanelRef}\n        slug={match.params.slug}\n        withZoom={false}\n      />\n    </Collapsible> }\n\n    { /* Right-hand side */ }\n\n    { /* @TODO: recursively render map (not location) as appropriate all around in these collapsibles. */ }\n    { markers && markers.length && <Collapsible\n        label={location.labels.markers}\n        slug={C.collapsible.markers}\n    ><MarkersList markers={markers} />\n    </Collapsible> || null }\n\n    { location && location.description && <Collapsible\n        config={location.config.description}\n        label={location.labels.description}\n        slug={C.collapsible.description}\n    ><Description item={location} />\n    </Collapsible> || null }\n\n    { location && location.newsitems.length && <Collapsible\n        label={location.labels.newsitems}\n        slug=\"news-sec\"\n    ><Newsitems newsitems={location.newsitems} />\n    </Collapsible> || null }\n\n    { showUrl  && <IframeModal src={showUrl} /> }\n    { showItem && <ItemModal item={showItem} /> }\n    { loading  && <Loading /> }\n\n  </W>)\n}\n\nexport default LocationsShowMobile\n","import PropTypes from 'prop-types'\nimport React, { useContext, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport { logg, TwofoldContext } from \"$shared\"\n\nconst Div1 = styled.div`\n  // border: 3px solid green;\n\n  text-align: center;\n  display: block;\n\n  position: relative;\n  overflow: auto;\n\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.theme.breadcrumbsHeight}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n\n`;\n\n/* Same size as the map image.\n * What scrolls is this div, not the image inside it.\n */\nconst Img = styled.div`\n  // border: 2px solid cyan;\n  display: inline-block;\n  position: relative;\n`;\n\nconst Root = styled.div`\n  border: ${p=>p.debug?'1':'0'}px solid red;\n\n  position: relative;\n  overflow: auto;\n\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.theme.breadcrumbsHeight}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n\n`;\n\nconst ZoomCtrl = (props) => {\n  const { zoom, setZoom } = useContext(TwofoldContext)\n\n  const zoomIn = () => {\n    setZoom(zoom/2)\n  }\n  const zoomOut = () => {\n    setZoom(zoom*2)\n  }\n  const zoomReset = () => {\n    setZoom(1)\n  }\n\n  return <div style={{\n    position: 'absolute',\n    top: 0,\n    right: 0,\n    zIndex: 1,\n    background: 'white',\n    padding: '5px',\n\n    display: 'flex',\n    flexDirection: 'column',\n  }} >\n    <span onClick={zoomIn} >[+]</span>\n    <span onClick={zoomOut} >[-]</span>\n    <span onClick={zoomReset} >[1]</span>\n  </div>\n}\n\nconst MapPanel = (props) => {\n  // logg(props, 'MapPanel')\n  const { map, withZoom=true } = props\n\n  const {\n    bottomDrawerOpen, setBottomDrawerOpen,\n    showUrl, setShowUrl,\n    zoom, setZoom,\n  } = useContext(TwofoldContext)\n\n  const div1Ref = useRef(null)\n\n  const history = useHistory()\n\n  useEffect(() => {\n    // div1Ref.current.scrollIntoView({ block: 'end', inline: 'center' })\n    div1Ref.current.scroll({\n      top: 200,\n      left: 200,\n      behavior: 'smooth',\n     })\n  }, [])\n\n  const markers = []\n  map.markers.map((m, idx) => {\n    const out = <div\n      key={idx}\n      onClick={() => m.url ? setShowUrl(m.url) : history.push(`/en/locations/show/${m.slug}`) }\n      style={{\n        position: 'absolute',\n        top: ((m.y- m.centerOffsetY )/zoom),\n        left: ((m.x- m.centerOffsetX )/zoom),\n      }} ><img src={m.img_path} style={{\n        display: 'block',\n        maxWidth: `${m.w/zoom}px`,\n        maxHeight: `${m.h/zoom}px`,\n        width: `${m.w/zoom}px`, height: `${m.h/zoom}px`,\n      }} /></div>\n    markers.push(out)\n  })\n\n  return <Root {...{ bottomDrawerOpen }} debug={config.debug} className='MapPanel' >\n    { withZoom && <ZoomCtrl /> }\n\n    <Div1 {...{ bottomDrawerOpen }} >\n      <Img ref={div1Ref} style={{\n        width: `${map.w/zoom}px`,\n        height: `${map.h/zoom}px`,\n      }} >\n        <img\n          src={map.img_path}\n          style={{\n            width: `${map.w/zoom}px`,\n            height: `${map.h/zoom}px`,\n          }}\n        />\n        { markers }\n      </Img>\n    </Div1>\n\n  </Root>\n}\n\nMapPanel.propTypes = {\n  map: PropTypes.object.isRequired,\n  withZoom: PropTypes.bool, // @TODO: I don't like it, I'd like it to be inside a config obj.\n}\nexport default MapPanel\n\n\n","import { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport {\n  MarkerContext,\n} from '$resources/markers'\nimport {\n  C, Card,\n  logg, logg4,\n  TwofoldContext,\n  useWindowSize,\n} from \"$shared\"\n\nconst Actions = styled.div`\n  border: 1px solid red;\n\n  position: absolute;\n  top: 0;\n  right: 0;\n\n  z-index: 2;\n`;\n\n// W\nconst W0 = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.background};\n\n  height: 100%;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  position: relative;\n`;\n\nconst W1 = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  position: relative;\n  height: 100%;\n`;\n\n\n/**\n * MapPanelNoZoom\n *\n * _vp_ 2021-09 @TODO: merge this into MapPanel, have zoom={false} as a prop\n * But I couldn't do it in 10 mins... It's a bit complicated?\n *\n * _vp_ 2021-10-29 But actually this component is getting more work than the zoom one right now...\n**/\nconst MapPanelNoZoom = (props) => {\n  // logg(props, 'MapPanelNoZoom')\n  const { map } = props\n\n  const {\n    bottomDrawerOpen,\n    editorMode,\n    mapPanelWidth, mapPanelHeight,\n    zoom, setZoom,\n  } = useContext(TwofoldContext)\n  // logg(useContext(TwofoldContext), 'MapPanelNoZoomUsedContext')\n\n  const {\n    markerModalOpen, setMarkerModalOpen,\n  } = useContext(MarkerContext)\n\n  const history = useHistory()\n  const [ windowWidth, windowHeight ] = useWindowSize()\n  // logg(useWindowSize(), 'usedWindowSize')\n\n\n  /*\n   * Sets the zoom (in panelNoZoom) to full-panel _vp_ 2021-10-29\n   * w: 1184 h: 819\n   */\n  useEffect(() => {\n    // logg([windowWidth, windowHeight, map.w, map.h], 'MapPanelNoZoom setting zoom')\n    if (windowWidth === 0) { return; }\n\n    let nextZoomByWidth = windowWidth/map.w // .3 mobile // 1.94 desktop\n    let nextZoomByHeight = windowHeight/map.h // .9 mobile // .82 desktop\n    // logg4([nextZoomByWidth, nextZoomByHeight], 'nextZoomOptions')\n\n    let nextZoom = Math.min(nextZoomByWidth, nextZoomByHeight)\n    const slack = 0.01 // image should not overlap with the border... 1% slack added.\n    nextZoom = nextZoom + slack\n\n    setZoom(nextZoom)\n  }, [\n    mapPanelWidth, mapPanelHeight, map.id,\n    windowWidth, windowHeight,\n  ])\n\n\n  const markers = []\n  props.map.markers.map((m, idx) => {\n    const out = <div\n      key={idx}\n      onClick={() => history.push(`/en/locations/show/${m.slug}`) }\n      style={{\n        position: 'absolute',\n        top: m.y*zoom,\n        left: m.x*zoom,\n        zIndex: 2,\n      }} ><img src={m.img_path} style={{\n        display: 'block',\n        maxWidth: `${m.w*zoom}px`,\n        maxHeight: `${m.h*zoom}px`,\n        width: 'auto', height: 'auto',\n      }} /></div>\n    markers.push(out)\n  })\n\n  /*\n   * @TODO: need to get the ACL from api, and use it to determine what to display or not.\n  **/\n\n  return <W0 className=\"MapPanelNoZoom W0\" >\n\n    { editorMode && <Actions>\n      <Card onClick={() => setMarkerModalOpen(true)} >\n        + Marker\n      </Card>\n    </Actions> }\n\n    <W1 className=\"W1\" >\n\n      <img\n        src={map.img_path}\n        style={{\n          // width: `${map.w*zoom}px`,\n          // height: `${map.h*zoom}px`,\n\n          maxWidth: '100%',\n          maxHeight: '100%',\n          width: 'auto',\n          height: 'auto',\n\n          position: 'relative',\n          zIndex: 1,\n        }}\n      />\n      { markers }\n    </W1>\n  </W0>\n}\n\nexport default MapPanelNoZoom\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\n\n/**\n * RatedRestrictionModal\n */\nconst RatedRestrictionModal = (props) => {\n  // logg(props, 'RatedRestrictionModal')\n  const { ratedConfirmation, setRatedConfirmation } = props\n\n  return <Modal isOpen={!ratedConfirmation} >\n    <p>You must be 18 years of age or older to view this content.</p>\n    <button onClick={() => setRatedConfirmation(true) } >I am over 18</button>\n    &nbsp; &nbsp;\n    <button onClick={() => window.location = 'https://disney.com' } >I am NOT over 18</button>\n  </Modal>\n};\nRatedRestrictionModal.propTypes = {\n  // ratedConfirmation, setRatedConfirmation - but maybe from a context instead?\n};\nexport default RatedRestrictionModal\n","\nimport React from 'react'\nimport styled from 'styled-components'\n\nconst Crosshair = styled.div`\n// border: 2px solid yellow;\n\nwidth: 50px;\nheight: 50px;\n\nposition: absolute;\nleft: 50%;\ntop: 50%;\n\n::before {\n  content: '';\n  position: absolute;\n  border-color: white;\n  border-style: solid;\n  border-width: 0 2px 0 0;\n  height: 20px;\n  top: -10px;\n  left: -1px;\n  transform: rotate(90deg);\n\n  // margin-top: -1em;\n\n}\n::after {\n  content: '';\n  position: absolute;\n  border-color: white;\n  border-style: solid;\n  border-width: 0 2px 0 0;\n  height: 20px;\n  top: -10px;\n  left: -1px;\n\n  // margin-top: -1em;\n  // width: 0.5em;\n}\n`;\n\nexport default Crosshair\n","import {\n\tEuler, EventDispatcher, Vector3,\n} from \"three\"\n\nconst _euler = new Euler( 0, 0, 0, 'YXZ' );\nconst _vector = new Vector3();\n\nconst _changeEvent = { type: 'change' };\nconst _lockEvent = { type: 'lock' };\nconst _unlockEvent = { type: 'unlock' };\n\nconst _PI_2 = Math.PI / 2;\n\nclass PointerLockControls extends EventDispatcher {\n\n\tconstructor( camera, domElement ) {\n\n\t\tsuper();\n\n\t\tif ( domElement === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.PointerLockControls: The second parameter \"domElement\" is now mandatory.' );\n\t\t\tdomElement = document.body;\n\n\t\t}\n\n\t\tthis.domElement = domElement;\n\t\tthis.isLocked = false;\n\n\t\t// Set to constrain the pitch of the camera\n\t\t// Range is 0 to Math.PI radians\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\tconst scope = this;\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tif ( scope.isLocked === false ) return;\n\n\t\t\tconst movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\n\t\t\tconst movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\n\n\t\t\t_euler.setFromQuaternion( camera.quaternion );\n\n\t\t\t_euler.y -= movementX * 0.002;\n\t\t\t_euler.x -= movementY * 0.002;\n\n\t\t\t_euler.x = Math.max( _PI_2 - scope.maxPolarAngle, Math.min( _PI_2 - scope.minPolarAngle, _euler.x ) );\n\n\t\t\tcamera.quaternion.setFromEuler( _euler );\n\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t}\n\n\t\tfunction onPointerlockChange() {\n\n\t\t\tif ( scope.domElement.ownerDocument.pointerLockElement === scope.domElement ) {\n\n\t\t\t\tscope.dispatchEvent( _lockEvent );\n\n\t\t\t\tscope.isLocked = true;\n\n\t\t\t} else {\n\n\t\t\t\tscope.dispatchEvent( _unlockEvent );\n\n\t\t\t\tscope.isLocked = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerlockError() {\n\n\t\t\tconsole.error( 'THREE.PointerLockControls: Unable to use Pointer Lock API' );\n\n\t\t}\n\n\t\tthis.connect = function () {\n\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'mousemove', onMouseMove );\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointerlockchange', onPointerlockChange );\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointerlockerror', onPointerlockError );\n\n\t\t};\n\n\t\tthis.disconnect = function () {\n\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'mousemove', onMouseMove );\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerlockchange', onPointerlockChange );\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerlockerror', onPointerlockError );\n\n\t\t};\n\n\t\tthis.dispose = function () {\n\n\t\t\tthis.disconnect();\n\n\t\t};\n\n\t\tthis.getObject = function () { // retaining this method for backward compatibility\n\n\t\t\treturn camera;\n\n\t\t};\n\n\t\tthis.getDirection = function () {\n\n\t\t\tconst direction = new Vector3( 0, 0, - 1 );\n\n\t\t\treturn function ( v ) {\n\n\t\t\t\treturn v.copy( direction ).applyQuaternion( camera.quaternion );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tthis.moveForward = function ( distance ) {\n\n\t\t\t// move forward parallel to the xz-plane\n\t\t\t// assumes camera.up is y-up\n\n\t\t\t_vector.setFromMatrixColumn( camera.matrix, 0 );\n\n\t\t\t_vector.crossVectors( camera.up, _vector );\n\n\t\t\tcamera.position.addScaledVector( _vector, distance );\n\n\t\t};\n\n\t\tthis.moveRight = function ( distance ) {\n\n\t\t\t_vector.setFromMatrixColumn( camera.matrix, 0 );\n\n\t\t\tcamera.position.addScaledVector( _vector, distance );\n\n\t\t};\n\n\t\tthis.lock = function () {\n\n\t\t\tthis.domElement.requestPointerLock();\n\n\t\t};\n\n\t\tthis.unlock = function () {\n\n\t\t\tscope.domElement.ownerDocument.exitPointerLock();\n\n\t\t};\n\n\t\tthis.connect();\n\n\t}\n\n}\n\nexport {\n\tPointerLockControls,\n}\n\nconst unlockEvent = _unlockEvent\nexport { unlockEvent }\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  border: 2px solid red;\n\n  position: relative;\n  // height: calc(100% - ${p => p.breadcrumbsHeight});\n  width: 700px;\n  height: 350px;\n\n  #Crosshair {\n    // border: 1px solid yellow;\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\n/**\n * Equirectangular\n * _vp_ 2021-11-13\n * It works, it shows the panoramic.\n *\n */\nconst Equirectangular = (props) => {\n  logg(props, 'Equirectangular')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov — Camera frustum vertical field of view.\n     * aspect — Camera frustum aspect ratio.\n     * near — Camera frustum near plane.\n     * far — Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n\n    /*\n     * Crosshair\n     * From: https://codepen.io/driezis/pen/jOPzjLG?editors=1000\n     */\n    var pMat = new THREE.ShaderMaterial({\n        uniforms: { main_color: {value: {r: 1, g: 1, b: 1}},\n                    border_color: {value: {r: 0, g: 0, b: 0.1}},\n\n                    thickness: {value:0.006},\n                    height: {value:0.13},\n                    offset: {value:0.05},\n                    border: {value:0.003},\n\n                    opacity: {value: 1},\n                    center: {value: {x: 0.5, y: 0.5}},\n                    rotation: {value: 0}\n                },\n        vertexShader: `\n                uniform float rotation;\n                uniform vec2 center;\n                #include <common>\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec2 scale;\n                    scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n                    scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n                    #ifndef USE_SIZEATTENUATION\n                        bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n                        if ( isPerspective ) scale *= - mvPosition.z;\n                    #endif\n                    vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n                    vec2 rotatedPosition;\n                    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n                    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n                    mvPosition.xy += rotatedPosition;\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n        fragmentShader: `\n            uniform vec3 main_color;\n            uniform vec3 border_color;\n            uniform float opacity;\n\n            uniform float thickness;\n            uniform float height;\n            uniform float offset;\n            uniform float border;\n\n            varying vec2 vUv;\n            void main() {\n\n                float a = (step(abs(vUv.x - 0.5), thickness)) * step(abs(vUv.y - 0.5), height + offset) * step(offset, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness)) * step(abs(vUv.x - 0.5), height + offset) * step(offset, abs(vUv.x - 0.5));\n                float b = (step(abs(vUv.x - 0.5), thickness - border)) * step(abs(vUv.y - 0.5), height + offset - border) * step(offset + border, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness - border)) * step(abs(vUv.x - 0.5), height + offset - border) * step(offset + border, abs(vUv.x - 0.5));\n                gl_FragColor = vec4( mix(border_color, main_color, b), a * opacity);\n            }\n        `,\n        transparent: true,\n    });\n    var sprite = new THREE.Sprite(pMat);\n    // scene.add(sprite);\n    // sprite.position.set(0,0,-5);\n\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    // document.addEventListener( 'keydown', onKeyDown )\n    // document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Floor\n     */\n\n    // // random\n    // // @TODO: it's not aligned to parcels the way I want\n    // let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    // floorGeometry.rotateX( - Math.PI / 2 )\n\n    // // vertex displacement\n    // let position = floorGeometry.attributes.position\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   vertex.fromBufferAttribute( position, i )\n    //   vertex.x += Math.random() * 20 - 10\n    //   vertex.y += Math.random() * 2\n    //   vertex.z += Math.random() * 20 - 10\n    //   position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    // }\n    // floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    // floorGeometry.x = -200\n    // floorGeometry.y = -200\n    // floorGeometry.z = -200\n    // position = floorGeometry.attributes.position\n    // const colorsFloor = []\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n    //   colorsFloor.push( color.r, color.g, color.b )\n    // }\n    // floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    // const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n\n\n\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius — Radius of the circle, default = 1.\n     * segments — Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart — Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength — The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    // let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    // floorGeometry.rotateX( - Math.PI / 2 )\n    // texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`) // moon floor\n    // const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    // const scenesPath = '/assets/scenes/'\n    // const objectsPath = '/assets/objects/'\n    // let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    // const texturePath = `${modelName}/${modelName}.mtl`\n    // const modelPath = `${modelName}/${modelName}.obj`\n    // const manager = new THREE.LoadingManager()\n    // const onProgress = (xhr) => {\n    //   if (xhr.lengthComputable) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }\n    // const onError = () => {}\n    // const onLoad = (materials) => {\n    //   materials.preload()\n    //   const objLoader = new OBJLoader( manager )\n    //   objLoader.setMaterials( materials )\n    //   objLoader.setPath( scenesPath)\n    //   objLoader.load( modelPath, ( object ) => {\n    //     object.traverse((child) => {\n    //       if (child.isMesh) {\n    //         child.geometry.scale(0.10, 0.10, 0.10) // @TODO: change?\n    //       }\n    //     })\n    //     object.position.x = Math.random() * 500\n    //     object.position.y = 10\n    //     object.position.z = Math.random() * 500\n\n    //     logg(object, '1st object')\n    //     scene.add( object )\n    //     markerObjects.push( object )\n    //     markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' }) // @TODO: change!\n\n    //   }, onProgress, onError )\n    // }\n    // const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setPath(scenesPath)\n    // mtlLoader.load(texturePath, onLoad)\n\n\n    /*\n     * Skybox\n     */\n    const textureLoader = new THREE.TextureLoader()\n    const assetPath = map.img_path\n    texture = textureLoader.load(assetPath, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( 700, 350 ) // aspect ratio 0.5\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} >\n      <div id=\"Crosshair\" />\n    </Blocker>\n  </F>\n}\n\nexport default Equirectangular\n","\"use strict\";\n\nfunction TouchControls({ container, camera, options, THREE, RotationPad }) {\n\n\tvar self = this;\n\tself.config = $.extend({\n\t\tspeedFactor: 0.5,\n\t\tdelta: 1,\n\t\trotationFactor: 0.002,\n\t\tmaxPitch: 55,\n\t\thitTest: true,\n\t\thitTestDistance: 40\n\t}, options);\n\n\tvar container = container;\n\tvar isRightMouseDown = false;\n\tvar rotationMatrices = [];\n\tvar hitObjects = [];\n\n\tvar moveForward = false;\n\tvar moveBackward = false;\n\tvar moveLeft = false;\n\tvar moveRight = false;\n\tvar lockMoveForward = false;\n\tvar lockMoveBackward = false;\n\tvar lockMoveLeft = false;\n\tvar lockMoveRight = false;\n\n\tvar ztouch = 1, xtouch = 1;\n\tvar PI_2 = Math.PI / 2;\n\tvar maxPitch = self.config.maxPitch * Math.PI / 180;\n\tvar velocity = new THREE.Vector3(0, 0, 0);\n\n\tvar cameraHolder = new THREE.Object3D();\n\tcameraHolder.name = \"cameraHolder\";\n\tcameraHolder.add(camera);\n\n\tself.scene = null;\n\tself.fpsBody = new THREE.Object3D();\n\tself.fpsBody.add(cameraHolder);\n\tself.enabled = true;\n\n\tself.mouse = new THREE.Vector2();\n\n\t// Creating rotation pad:\n\tself.rotationPad = new RotationPad(container);\n\t$(self.rotationPad).on(\"YawPitch\", function(event) {\n\t\tvar rotation = calculateCameraRotation(event.detail.deltaX, event.detail.deltaY);\n\t\tself.setRotation(rotation.rx, rotation.ry);\n\t});\n\n\t// Creating movement pad:\n\tself.movementPad = new MovementPad(container);\n\t$(self.movementPad).on(\"move\", function(event) {\n\t\tztouch = Math.abs(event.detail.deltaY);\n\t\txtouch = Math.abs(event.detail.deltaX);\n\n\t\tif (event.detail.deltaY == event.detail.middle) {\n\t\t\tztouch = 1;\n\t\t\tmoveForward = moveBackward = false;\n\t\t} else {\n\t\t\tif (event.detail.deltaY > event.detail.middle) {\n\t\t\t\tmoveForward = true;\n\t\t\t\tmoveBackward = false;\n\t\t\t}\n\t\t\telse if (event.detail.deltaY < event.detail.middle) {\n\t\t\t\tmoveForward = false;\n\t\t\t\tmoveBackward = true;\n\t\t\t}\n\t\t}\n\n\t\tif (event.detail.deltaX == event.detail.middle) {\n\t\t\txtouch = 1;\n\t\t\tmoveRight = moveLeft = false;\n\t\t} else {\n\t\t\tif (event.detail.deltaX < event.detail.middle) {\n\t\t\t\tmoveRight = true;\n\t\t\t\tmoveLeft = false;\n\t\t\t}\n\t\t\telse if (event.detail.deltaX > event.detail.middle) {\n\t\t\t\tmoveRight = false;\n\t\t\t\tmoveLeft = true;\n\t\t\t}\n\t\t}\n\t});\n\t$(self.movementPad).on(\"stopMove\", function(event) {\n\t\tztouch = xtouch = 1;\n\t\tmoveForward = moveBackward = moveLeft = moveRight = false;\n\t});\n\n\tcontainer.on(\"contextmenu\", onContextMenu);\n\tcontainer.on(\"mousedown\", onMouseDown);\n\tcontainer.on(\"mouseup\", onMouseUp);\n\n\t$(document).on(\"keydown\", onKeyDown);\n\t$(document).on(\"keyup\", onKeyUp);\n\t$(document).on(\"mousemove\", onMouseMove);\n\t$(document).on(\"mouseout\", onMouseOut);\n\n\tprepareRotationMatrices();\n\n\t//\n\t// Events:\n\t//\n\tfunction onContextMenu(event) {\n\t\tevent.preventDefault();\n\t};\n\n\tfunction onMouseDown(event) {\n\n\t\tif (self.enabled && event.button === 2) {\n\t\t\tisRightMouseDown = true;\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t}\n\t};\n\n\tfunction onMouseUp(event) {\n\n\t\tif (self.enabled && event.button === 2) {\n\t\t\tisRightMouseDown = false;\n\t\t}\n\t};\n\n\tfunction onMouseMove(event) {\n\n\t\tself.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\n\t\tself.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n\n\t\tif (!self.enabled || !isRightMouseDown) return;\n\n\t\tvar movementX = event.originalEvent.movementX || event.originalEvent.mozMovementX || event.originalEvent.webkitMovementX || 0;\n\t\tvar movementY = event.originalEvent.movementY || event.originalEvent.mozMovementY || event.originalEvent.webkitMovementY || 0;\n\t\tvar rotation = calculateCameraRotation(-1 * movementX, -1 * movementY);\n\n\t\t// console.log(self.mouse, \"\\n\", movementX, rotation);\n\n\t\tself.setRotation(rotation.rx, rotation.ry);\n\n\t\t// updateNavPad();\n\t};\n\n\tfunction onMouseOut(e) {\n\t\tisRightMouseDown = false;\n\t\t// self.stopMouseMoving();\n\t};\n\n\tfunction onKeyDown(e) {\n\n\t\tif (!self.enabled) return;\n\n\t\tswitch (e.keyCode) {\n\n\t\t\tcase 38: // up\n\t\t\tcase 87: // w\n\t\t\t\tmoveForward = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 37: // left\n\t\t\tcase 65: // a\n\t\t\t\tmoveLeft = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 40: // down\n\t\t\tcase 83: // s\n\t\t\t\tmoveBackward = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 39: // right\n\t\t\tcase 68: // d\n\t\t\t\tmoveRight = true;\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tfunction onKeyUp(e) {\n\n\t\tswitch (e.keyCode) {\n\n\t\t\tcase 38: // up\n\t\t\tcase 87: // w\n\t\t\t\tmoveForward = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 37: // left\n\t\t\tcase 65: // a\n\t\t\t\tmoveLeft = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 40: // down\n\t\t\tcase 83: // a\n\t\t\t\tmoveBackward = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 39: // right\n\t\t\tcase 68: // d\n\t\t\t\tmoveRight = false;\n\t\t\t\tbreak;\n\n\t\t}\n\t};\n\n\t//\n\t// Private functions:\n\t//\n\tfunction prepareRotationMatrices() {\n\n\t\tvar rotationMatrixF = new THREE.Matrix4();\n\t\trotationMatrixF.makeRotationY(0);\n\t\trotationMatrices.push(rotationMatrixF); // forward direction.\n\n\t\tvar rotationMatrixB = new THREE.Matrix4();\n\t\trotationMatrixB.makeRotationY(180 * Math.PI / 180);\n\t\trotationMatrices.push(rotationMatrixB);\n\n\t\tvar rotationMatrixL = new THREE.Matrix4();\n\t\trotationMatrixL.makeRotationY(90 * Math.PI / 180);\n\t\trotationMatrices.push(rotationMatrixL);\n\n\t\tvar rotationMatrixR = new THREE.Matrix4();\n\t\trotationMatrixR.makeRotationY((360 - 90) * Math.PI / 180);\n\t\trotationMatrices.push(rotationMatrixR);\n\t};\n\n\tfunction calculateCameraRotation(dx, dy, factor) {\n\t\tvar factor = factor ? factor : self.config.rotationFactor;\n\t\tvar ry = self.fpsBody.rotation.y - (dx * factor);\n\t\tvar rx = cameraHolder.rotation.x - (dy * factor);\n\t\trx = Math.max(-maxPitch, Math.min(maxPitch, rx));\n\n\t\treturn {\n\t\t\trx: rx,\n\t\t\try: ry\n\t\t};\n\t};\n\n\tfunction lockDirectionByIndex(index) {\n\t\tif (index == 0)\n\t\t\tself.lockMoveForward(true);\n\t\telse if (index == 1)\n\t\t\tself.lockMoveBackward(true);\n\t\telse if (index == 2)\n\t\t\tself.lockMoveLeft(true);\n\t\telse if (index == 3)\n\t\t\tself.lockMoveRight(true);\n\t}\n\n\t//\n\t// Public functions:\n\t//\n\tself.update = function() {\n\t\tif (self.config.hitTest)\n\t\t\tself.hitTest();\n\n\t\tvelocity.x += (-1 * velocity.x) * 0.75 * self.config.delta;\n\t\tvelocity.z += (-1 * velocity.z) * 0.75 * self.config.delta;\n\n\t\tif (moveForward && !lockMoveForward) velocity.z -= ztouch * self.config.speedFactor * self.config.delta;\n\t\tif (moveBackward && !lockMoveBackward) velocity.z += ztouch * self.config.speedFactor * self.config.delta;\n\n\t\tif (moveLeft && !lockMoveLeft) velocity.x -= xtouch * self.config.speedFactor * self.config.delta;\n\t\tif (moveRight && !lockMoveRight) velocity.x += xtouch * self.config.speedFactor * self.config.delta;\n\n\t\tself.fpsBody.translateX(velocity.x);\n\t\tself.fpsBody.translateY(velocity.y);\n\t\tself.fpsBody.translateZ(velocity.z);\n\t};\n\n\tself.hitTest = function() {\n\t\tself.unlockAllDirections();\n\t\thitObjects = [];\n\t\tvar cameraDirection = self.getDirection2(new THREE.Vector3(0, 0, 0)).clone();\n\n\t\tfor (var i = 0; i < 4; i++) {\n\t\t\t// Applying rotation for each direction:\n\t\t\tvar direction = cameraDirection.clone();\n\t\t\tdirection.applyMatrix4(rotationMatrices[i]);\n\n\t\t\tvar rayCaster = new THREE.Raycaster(self.fpsBody.position, direction);\n\t\t\tvar intersects = rayCaster.intersectObject(self.scene, true);\n\t\t\tif ((intersects.length > 0 && intersects[0].distance < self.config.hitTestDistance)) {\n\t\t\t\tlockDirectionByIndex(i);\n\t\t\t\thitObjects.push(intersects[0]);\n\t\t\t\t// console.log(intersects[0].object.name, i);\n\t\t\t}\n\t\t}\n\n\t\treturn hitObjects;\n\t};\n\n\tself.getDirection2 = function(v) {\n\t\tvar self = this;\n\t\tvar direction = new THREE.Vector3(0, 0, -1);\n\t\tvar rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\n\t\tvar rx = self.fpsBody.getObjectByName(\"cameraHolder\").rotation.x;;\n\t\tvar ry = self.fpsBody.rotation.y;\n\n\t\t// console.log(\"DIRECTION:\", this);\n\t\trotation.set(rx, ry, 0);\n\t\tv.copy(direction).applyEuler(rotation);\n\t\t// console.log(v);\n\t\treturn v;\n\t};\n\n\tself.getDirection = function() {\n\t\tvar self = this;\n\t\tvar rx = 0;\n\t\tvar ry = 0;\n\t\tvar direction = new THREE.Vector3(0, 0, -1);\n\t\tvar rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\n\n\t\t// console.log(\"DIRECTION:\", this);\n\t\tif (self != undefined) {\n\t\t\trx = self.fpsBody.getObjectByName(\"cameraHolder\").rotation.x;\n\t\t\try = self.fpsBody.rotation.y;\n\t\t\tconsole.log(rx, ry);\n\t\t}\n\t\t// var camHolder = self.fpsBody.getObjectByName(\"cameraHolder\");\n\n\t\treturn function(v) {\n\t\t\trotation.set(rx, ry, 0);\n\t\t\tv.copy(direction).applyEuler(rotation);\n\t\t\t// console.log(v);\n\t\t\treturn v;\n\t\t}\n\t}();\n\n\tself.moveLeft = function() {\n\t\treturn moveLeft;\n\t};\n\n\tself.moveRight = function() {\n\t\treturn moveRight;\n\t};\n\n\tself.moveForward = function() {\n\t\treturn moveForward;\n\t};\n\n\tself.moveBackward = function() {\n\t\treturn moveBackward;\n\t};\n\n\tself.lockMoveForward = function(boolean) {\n\t\tlockMoveForward = boolean;\n\t};\n\n\tself.lockMoveBackward = function(boolean) {\n\t\tlockMoveBackward = boolean;\n\t};\n\n\tself.lockMoveLeft = function(boolean) {\n\t\tlockMoveLeft = boolean;\n\t};\n\n\tself.lockMoveRight = function(boolean) {\n\t\tlockMoveRight = boolean;\n\t};\n\n\tself.unlockAllDirections = function() {\n\t\tself.lockMoveForward(false);\n\t\tself.lockMoveBackward(false);\n\t\tself.lockMoveLeft(false);\n\t\tself.lockMoveRight(false);\n\t};\n};\n\nTouchControls.prototype = {\n\taddToScene: function(scene) {\n\t\tthis.scene = scene;\n\t\tscene.add(this.fpsBody);\n\t},\n\n\tsetPosition: function(x, y, z) {\n\t\tthis.fpsBody.position.set(x, y, z);\n\t},\n\n\tstopMouseMoving: function() {\n\t\tisRightMouseDown = false;\n\t},\n\n\tsetRotation: function(x, y) {\n\t\tvar camHolder = this.fpsBody.getObjectByName(\"cameraHolder\");\n\n\t\tif (x !== null)\n\t\t\tcamHolder.rotation.x = x;\n\n\t\tif (y !== null)\n\t\t\tthis.fpsBody.rotation.y = y;\n\t},\n\n\tgetHitObjects: function() {\n\t\treturn hitObjects;\n\t}\n\n};\n\nexport default TouchControls\n","import React, { useRef, } from 'react'\nimport styled from 'styled-components'\n\nconst RotationPad = (props) => {\n\t// logg(props, 'RotationPad')\n\n\tvar mouseDown = false;\n\tvar mouseStopped = false;\n\tvar mouseStopTimeout, eventRepeatTimeout;\n\tvar newLeft, newTop, distance, angle;\n\n\tconst handleRef = useRef(null)\n\tconst handleEl = handleRef.current\n\tconst regionRef = useRef(null)\n\tconst regionEl = regionRef.current\n\n\t/* Aligning pad: */\n\t// rotationPadEl.css({\n\t// \ttop: container.find(\"canvas\").height() + container.position().top - regionEl.outerHeight() - 10,\n\t// \tleft: container.find(\"canvas\").width() - regionEl.outerWidth() - 20\n\t// });\n\n\n\n\tconst regionData = {};\n\tconst handleData = {};\n\n\t// regionData.width = regionEl.outerWidth();\n\t// regionData.height = regionEl.outerHeight();\n\t// regionData.position = regionEl.position();\n\t// regionData.offset = regionEl.offset();\n\t// regionData.radius = regionData.width / 2;\n\t// regionData.centerX = regionData.position.left + regionData.radius;\n\t// regionData.centerY = regionData.position.top + regionData.radius;\n\n\t// handleData.width = handleEl.outerWidth();\n\t// handleData.height = handleEl.outerHeight();\n\t// handleData.radius = handleData.width / 2;\n\n\t// regionData.radius = regionData.width / 2 - handleData.radius;\n\n\tconst resetHandlePosition = () => {\n\t\thandleEl.animate({\n\t\t\ttop: this.regionData.centerY - handleData.radius,\n\t\t\tleft: this.regionData.centerX - handleData.radius,\n\t\t\topacity: 0.1\n\t\t}, \"fast\");\n\t}\n\n\t// Mouse events:\n\tregionEl && regionEl.on(\"mousedown\", function (event) {\n\t\tmouseDown = true;\n\t\thandleEl.css(\"opacity\", \"1.0\");\n\t\tupdate(event.pageX, event.pageY);\n\t});\n\n\t$(document).on(\"mouseup\", function () {\n\t\tmouseDown = false;\n\t\thandleEl && resetHandlePosition();\n\t});\n\n\t$(document).on(\"mousemove\", function(event) {\n\t\tif (!mouseDown) return;\n\t\tupdate(event.pageX, event.pageY);\n\t});\n\n\t//Touch events:\n\tregionEl && regionEl.on(\"touchstart\", function (event) {\n\t\tmouseDown = true;\n\t\thandleEl.css(\"opacity\", \"1.0\");\n\t\tupdate(event.originalEvent.targetTouches[0].pageX, event.originalEvent.targetTouches[0].pageY);\n\t});\n\n\t$(document).on(\"touchend touchcancel\", function () {\n\t\tmouseDown = false;\n\t\thandleEl && resetHandlePosition();\n\t});\n\n\t$(document).on(\"touchmove\", function(event) {\n\t\tif (!mouseDown) return;\n\t\tupdate(event.originalEvent.touches[0].pageX, event.originalEvent.touches[0].pageY);\n\t});\n\n\n\tfunction update(pageX, pageY) {\n\t\tnewLeft = (pageX - regionData.offset.left);\n\t\tnewTop = (pageY - regionData.offset.top);\n\n\t\t// If handle reaches the pad boundaries.\n\t\tdistance = Math.pow(regionData.centerX - newLeft, 2) + Math.pow(regionData.centerY - newTop, 2);\n\t\tif (distance > Math.pow(regionData.radius, 2)) {\n\t\t\tangle = Math.atan2((newTop - regionData.centerY), (newLeft - regionData.centerX));\n\t\t\tnewLeft = (Math.cos(angle) * regionData.radius) + regionData.centerX;\n\t\t\tnewTop = (Math.sin(angle) * regionData.radius) + regionData.centerY;\n\t\t}\n\t\tnewTop = Math.round(newTop * 10) / 10;\n\t\tnewLeft = Math.round(newLeft * 10) / 10;\n\n\t\thandleEl.css({\n\t\t\ttop: newTop - handleData.radius,\n\t\t\tleft: newLeft - handleData.radius\n\t\t});\n\t\t// console.log(newTop , newLeft);\n\n\t\t// Providing event and data for handling camera movement.\n\t\tvar deltaX = regionData.centerX - parseInt(newLeft);\n\t\tvar deltaY = regionData.centerY - parseInt(newTop);\n\t\t// Normalize x,y between -2 to 2 range.\n\t\tdeltaX = -2 + (2+2) * (deltaX - (-regionData.radius)) / (regionData.radius - (-regionData.radius));\n\t\tdeltaY = -2 + (2+2) * (deltaY - (-regionData.radius)) / (regionData.radius - (-regionData.radius));\n\t\tdeltaX = -1 * Math.round(deltaX * 10) / 10;\n\t\tdeltaY = -1 * Math.round(deltaY * 10) / 10;\n\t\t// console.log(deltaX, deltaY);\n\n\t\tsendEvent(deltaX, deltaY);\n\t}\n\n\tfunction sendEvent(dx, dy) {\n\t\tif (!mouseDown) {\n\t\t\tclearTimeout(eventRepeatTimeout);\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(eventRepeatTimeout);\n\t\teventRepeatTimeout = setTimeout(function() {\n\t\t\tsendEvent(dx, dy);\n\t\t}, 5);\n\n\t\tvar moveEvent = $.Event(\"YawPitch\", {\n\t\t\tdetail: {\n\t\t\t\t\"deltaX\": dx,\n\t\t\t\t\"deltaY\": dy\n\t\t\t},\n\t\t\tbubbles: false\n\t\t});\n\t\t$(self).trigger(moveEvent);\n\t}\n\n\thandleEl && resetHandlePosition();\n\n\treturn \t<div className=\"rotation-pad\">\n\t  <div className=\"region\" ref={regionRef} ></div>\n\t  <div className=\"handle\" ref={handleRef} ></div>\n\t</div>\n}\n\nexport default RotationPad\n","\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { PointerLockControls } from './PointerLockControls'\nimport TouchControls from \"./TouchControls\"\nimport RotationPad from \"./RotationPad\"\nimport {\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst Blocker = styled.div`\n  border: 1px dashed red;\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n\n  #Crosshair {\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\nconst W = styled.div`\n  border: 1px solid blue;\n  height: 90vh;\n`;\n\n/**\n * Equirectangular2\n * _vp_ 2021-11-15\n * Let's wire in a simple floor and full-window sizing.\n *\n * Threejs units of measure are centimeters (cm).\n *\n */\nconst Equirectangular2 = (props) => {\n  logg(props, 'Equirectangular2')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene;\n\n  var width, height;\n  var viewAngle = 45,\n    near = 1,\n    far = 10000;\n  var aspect;\n  var stats;\n  var sceneObject, intersected;\n\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const blockerRef = useRef(null)\n  const wContainerRef = useRef(null)\n  const instructionsRef = useRef(null)\n\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  useEffect(() => {\n    window.dispatchEvent(new Event('resize'));\n  }, [ bottomDrawerOpen, folded, twofoldPercent ])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov — Camera frustum vertical field of view.\n     * aspect — Camera frustum aspect ratio.\n     * near — Camera frustum near plane.\n     * far — Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 ) // @TODO: what this?\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 ) // @TODO: what this?\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Origin: axis helper\n     */\n    var axes = new THREE.AxisHelper(700)\n\t\tscene.add(axes)\n\n    const wContainer = wContainerRef.current\n\n    function addControls() {\n      var options = {\n        speedFactor: 0.5,\n        delta: 1,\n        rotationFactor: 0.002,\n        maxPitch: 55,\n        hitTest: true,\n        hitTestDistance: 40\n      };\n      controls = new TouchControls({\n        container: wContainer, camera,\n        options,\n        RotationPad: rotationPad,\n        THREE,\n      });\n      controls.setPosition(0, 35, 400);\n      controls.addToScene(scene);\n      // controls.setRotation(0.15, -0.15);\n    }\n    addControls()\n\n    /*\n     * Floor\n     */\n\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius — Radius of the circle, default = 1.\n     * segments — Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart — Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength — The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.PlaneGeometry( 100, 100, 10, 10 ) // width, height, w segments, h segments\n    // let floorGeometry = new THREE.CircleGeometry(100, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/100x100_lazer-floor.png`)\n    texture.wrapS = THREE.RepeatWrapping\n    texture.wrapT = THREE.RepeatWrapping\n    texture.repeat.set( 10, 10 )\n    const floorMaterial = new THREE.MeshPhongMaterial({\n      map: texture,\n      // transparent: true,\n    })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    // const scenesPath = '/assets/scenes/'\n    // const objectsPath = '/assets/objects/'\n    // let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    // const texturePath = `${modelName}/${modelName}.mtl`\n    // const modelPath = `${modelName}/${modelName}.obj`\n    // const manager = new THREE.LoadingManager()\n    // const onProgress = (xhr) => {\n    //   if (xhr.lengthComputable) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }\n    // const onError = () => {}\n    // const onLoad = (materials) => {\n    //   materials.preload()\n    //   const objLoader = new OBJLoader( manager )\n    //   objLoader.setMaterials( materials )\n    //   objLoader.setPath( scenesPath)\n    //   objLoader.load( modelPath, ( object ) => {\n    //     object.traverse((child) => {\n    //       if (child.isMesh) {\n    //         child.geometry.scale(0.10, 0.10, 0.10) // @TODO: change?\n    //       }\n    //     })\n    //     object.position.x = Math.random() * 500\n    //     object.position.y = 10\n    //     object.position.z = Math.random() * 500\n\n    //     logg(object, '1st object')\n    //     scene.add( object )\n    //     markerObjects.push( object )\n    //     markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' }) // @TODO: change!\n\n    //   }, onProgress, onError )\n    // }\n    // const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setPath(scenesPath)\n    // mtlLoader.load(texturePath, onLoad)\n\n\n    /*\n     * Skybox\n     */\n    const textureLoader = new THREE.TextureLoader()\n    const assetPath = map.img_path\n    texture = textureLoader.load(assetPath, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  /* From: https://threejsfundamentals.org/threejs/lessons/threejs-responsive.html */\n  function resizeRendererToDisplaySize() {\n    const canvas = renderer.domElement\n    const width = blockerRef.current.clientWidth\n    const height = blockerRef.current.clientHeight\n    const needResize = canvas.width !== width || canvas.height !== height\n    if (needResize) {\n      renderer.setSize(width, height)\n    }\n    return needResize\n  }\n  function onWindowResize() {\n    if (resizeRendererToDisplaySize()) {\n      const width = blockerRef.current.clientWidth\n      const height = blockerRef.current.clientHeight\n      camera.aspect = width / height\n      camera.updateProjectionMatrix()\n    }\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <W ref={wContainerRef} >\n    <div ref={instructionsRef} />\n    <Blocker ref={blockerRef} >\n      <div id=\"Crosshair\" />\n\n      <RotationPad />\n    </Blocker>\n  </W>\n}\n\nexport default Equirectangular2\n","\n/*\n * @TODO: this is just a copy of equirectangular2, discard\n */\n\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { PointerLockControls } from './PointerLockControls'\nimport TouchControls from \"./TouchControls\"\nimport RotationPad from \"./RotationPad\"\nimport {\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst Blocker = styled.div`\n  border: 1px dashed red;\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n\n  #Crosshair {\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\nconst W = styled.div`\n  border: 1px solid blue;\n  height: 90vh;\n`;\n\n/**\n * Equirectangular2\n * _vp_ 2021-11-15\n * Let's wire in a simple floor and full-window sizing.\n *\n * Threejs units of measure are centimeters (cm).\n *\n */\nconst Equirectangular2 = (props) => {\n  logg(props, 'Equirectangular2')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene;\n\n  var width, height;\n  var viewAngle = 45,\n    near = 1,\n    far = 10000;\n  var aspect;\n  var stats;\n  var sceneObject, intersected;\n\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const blockerRef = useRef(null)\n  const wContainerRef = useRef(null)\n  const instructionsRef = useRef(null)\n\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  useEffect(() => {\n    window.dispatchEvent(new Event('resize'));\n  }, [ bottomDrawerOpen, folded, twofoldPercent ])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov — Camera frustum vertical field of view.\n     * aspect — Camera frustum aspect ratio.\n     * near — Camera frustum near plane.\n     * far — Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 ) // @TODO: what this?\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 ) // @TODO: what this?\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Origin: axis helper\n     */\n    var axes = new THREE.AxisHelper(700)\n\t\tscene.add(axes)\n\n    const wContainer = wContainerRef.current\n\n    function addControls() {\n      var options = {\n        speedFactor: 0.5,\n        delta: 1,\n        rotationFactor: 0.002,\n        maxPitch: 55,\n        hitTest: true,\n        hitTestDistance: 40\n      };\n      controls = new TouchControls({\n        container: wContainer, camera,\n        options,\n        RotationPad: rotationPad,\n        THREE,\n      });\n      controls.setPosition(0, 35, 400);\n      controls.addToScene(scene);\n      // controls.setRotation(0.15, -0.15);\n    }\n    addControls()\n\n    /*\n     * Floor\n     */\n\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius — Radius of the circle, default = 1.\n     * segments — Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart — Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength — The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.PlaneGeometry( 100, 100, 10, 10 ) // width, height, w segments, h segments\n    // let floorGeometry = new THREE.CircleGeometry(100, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/100x100_lazer-floor.png`)\n    texture.wrapS = THREE.RepeatWrapping\n    texture.wrapT = THREE.RepeatWrapping\n    texture.repeat.set( 10, 10 )\n    const floorMaterial = new THREE.MeshPhongMaterial({\n      map: texture,\n      // transparent: true,\n    })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    // const scenesPath = '/assets/scenes/'\n    // const objectsPath = '/assets/objects/'\n    // let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    // const texturePath = `${modelName}/${modelName}.mtl`\n    // const modelPath = `${modelName}/${modelName}.obj`\n    // const manager = new THREE.LoadingManager()\n    // const onProgress = (xhr) => {\n    //   if (xhr.lengthComputable) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }\n    // const onError = () => {}\n    // const onLoad = (materials) => {\n    //   materials.preload()\n    //   const objLoader = new OBJLoader( manager )\n    //   objLoader.setMaterials( materials )\n    //   objLoader.setPath( scenesPath)\n    //   objLoader.load( modelPath, ( object ) => {\n    //     object.traverse((child) => {\n    //       if (child.isMesh) {\n    //         child.geometry.scale(0.10, 0.10, 0.10) // @TODO: change?\n    //       }\n    //     })\n    //     object.position.x = Math.random() * 500\n    //     object.position.y = 10\n    //     object.position.z = Math.random() * 500\n\n    //     logg(object, '1st object')\n    //     scene.add( object )\n    //     markerObjects.push( object )\n    //     markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' }) // @TODO: change!\n\n    //   }, onProgress, onError )\n    // }\n    // const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setPath(scenesPath)\n    // mtlLoader.load(texturePath, onLoad)\n\n\n    /*\n     * Skybox\n     */\n    const textureLoader = new THREE.TextureLoader()\n    const assetPath = map.img_path\n    texture = textureLoader.load(assetPath, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  /* From: https://threejsfundamentals.org/threejs/lessons/threejs-responsive.html */\n  function resizeRendererToDisplaySize() {\n    const canvas = renderer.domElement\n    const width = blockerRef.current.clientWidth\n    const height = blockerRef.current.clientHeight\n    const needResize = canvas.width !== width || canvas.height !== height\n    if (needResize) {\n      renderer.setSize(width, height)\n    }\n    return needResize\n  }\n  function onWindowResize() {\n    if (resizeRendererToDisplaySize()) {\n      const width = blockerRef.current.clientWidth\n      const height = blockerRef.current.clientHeight\n      camera.aspect = width / height\n      camera.updateProjectionMatrix()\n    }\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <W ref={wContainerRef} >\n    <div ref={instructionsRef} />\n    <Blocker ref={blockerRef} >\n      <div id=\"Crosshair\" />\n\n      <RotationPad />\n    </Blocker>\n  </W>\n}\n\nexport default Equirectangular2\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport * as THREE from \"three\"\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  height: calc(100% - ${p => p.breadcrumbsHeight});\n`;\n\n/**\n * Excellent documentation. From: https://threejs.org/examples/#misc_controls_pointerlock\n * Right now the unit is 1cm, 1/10 of a meter.\n */\n\n\nconst Loc = (props) => {\n  let camera, controls,\n    object, objects = [],\n    raycaster, renderer,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n    /*\n    // PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n    // fov — Camera frustum vertical field of view.\n    // aspect — Camera frustum aspect ratio.\n    // near — Camera frustum near plane.\n    // far — Camera frustum far plane.\n    */\n    // camera = new THREE.PerspectiveCamera( 75, 2, 1, 100 )\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 300 )\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    // floor\n    // @TODO: it's not aligned to parcels the way I want\n    let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    floorGeometry.rotateX( - Math.PI / 2 )\n\n    // vertex displacement\n    let position = floorGeometry.attributes.position\n    for ( let i = 0, l = position.count; i < l; i ++ ) {\n      vertex.fromBufferAttribute( position, i )\n      vertex.x += Math.random() * 20 - 10\n      vertex.y += Math.random() * 2\n      vertex.z += Math.random() * 20 - 10\n      position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    }\n    floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    floorGeometry.x = -200\n    floorGeometry.y = -200\n    floorGeometry.z = -200\n    position = floorGeometry.attributes.position\n    const colorsFloor = []\n    for ( let i = 0, l = position.count; i < l; i ++ ) {\n      color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n      colorsFloor.push( color.r, color.g, color.b )\n    }\n    floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    // objects\n    /*\n    const boxGeometry = new THREE.BoxGeometry( 20, 20, 20 ).toNonIndexed()\n    position = boxGeometry.attributes.position\n    const colorsBox = []\n    for ( let i = 0, l = position.count; i < l; i ++ ) {\n      color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n      colorsBox.push( color.r, color.g, color.b )\n    }\n    boxGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsBox, 3 ) )\n    for ( let i = 0; i < 500; i ++ ) {\n      const boxMaterial = new THREE.MeshPhongMaterial( { specular: 0xffffff, flatShading: true, vertexColors: true } )\n      boxMaterial.color.setHSL( Math.random() * 0.2 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n\n      const box = new THREE.Mesh( boxGeometry, boxMaterial )\n      box.position.x = Math.floor( Math.random() * 20 - 10 ) * 20\n      box.position.y = Math.floor( Math.random() * 20 ) * 20 + 10\n      box.position.z = Math.floor( Math.random() * 20 - 10 ) * 20\n      scene.add( box )\n      objects.push( box )\n    }\n    */\n\n    // load OBJ\n\n    // manager\n\n    // this is specifically for tiny-house-1\n    const loadModel = () => {\n      object.traverse((child) => {\n        if ( child.isMesh ) {\n          child.material.map = texture\n          child.geometry.scale(10, 10, 10)\n        }\n      })\n      object.position.x = 100\n      object.position.y = 10\n      object.position.z = 100\n\n      scene.add( object )\n    }\n    const manager = new THREE.LoadingManager( loadModel )\n    manager.onProgress = function ( item, loaded, total ) {\n      console.log( item, loaded, total )\n    }\n\n    // texture\n\n    const textureLoader = new THREE.TextureLoader( manager )\n    const texture = textureLoader.load( 'textures/uv_grid_opengl.jpg' )\n\n    // model\n\n    // tiny-house-1\n    const loader = new OBJLoader( manager )\n    loader.load( '/assets/scenes/tiny-house-1/tiny-house-1.obj', ( obj ) => {\n      object = obj\n    }, ( xhr ) => {\n      if ( xhr.lengthComputable ) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }, (e) => {\n      logg(e, 'onError')\n    } )\n\n\n    // some delimiters for the first 6 parcels!\n    let geometry = new THREE.BoxGeometry( 10, 10, 10 )\n    let material = new THREE.MeshBasicMaterial( {color: 0x00ff00} )\n    let cube = new THREE.Mesh( geometry, material )\n    cube.position.x = 0\n    cube.position.y = 5\n    cube.position.z = 0\n    scene.add( cube )\n    const items = [\n      { color: 0xff0000, x: 1, y: 0, z: 0 },\n      { color: 0x00ff00, x: 0, y: 1, z: 0 },\n      { color: 0x0000ff, x: 0, y: 0, z: 1 }\n    ]\n    items.map((item, idx) => {\n      logg(item, 'item')\n      const { color, x, y, z } = item\n      geometry = new THREE.BoxGeometry( 1 + x*10, 1 + y*10, 1 + z*10 )\n      material = new THREE.MeshBasicMaterial({ color: color })\n      cube = new THREE.Mesh( geometry, material )\n      cube.position.x = x*5\n      cube.position.y = 10+y*5\n      cube.position.z = z*5\n      scene.add( cube )\n    })\n\n    const parcels = [\n      { color: 0xff0000, x: 100, y: 1, z: 100 },\n      { color: 0x00ff00, x: 100, y: 1, z: 320 },\n      { color: 0x0000ff, x: -120, y: 1, z: 320 },\n\n      { color: 0x660000, x: -120, y: 1, z: 100 },\n      { color: 0x006600, x: -120, y: 1, z: -120 },\n      { color: 0x000066, x: 100, y: 1, z: -120 },\n    ]\n    parcels.map((item, idx) => {\n      const { color, x, y, z } = item\n      const g = new THREE.BoxGeometry( 200, 2, 200 )\n      const m = new THREE.MeshBasicMaterial({color: color})\n      const p = new THREE.Mesh( g, m )\n      p.position.x = x\n      p.position.y = y\n      p.position.z = z\n      scene.add( p )\n    })\n\n    //\n\n\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    // renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setPixelRatio(1)\n    renderer.setSize( 800, 400 )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n      raycaster.ray.origin.copy( controls.getObject().position )\n      raycaster.ray.origin.y -= 10\n      const intersections = raycaster.intersectObjects( objects, false )\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} />\n  </F>\n}\n\nexport default Loc\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  border: 2px solid red;\n\n  position: relative;\n  // height: calc(100% - ${p => p.breadcrumbsHeight});\n  width: 700px;\n  height: 350px;\n\n  #Crosshair {\n    // border: 1px solid yellow;\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\n/**\n * Loc = Location\n *\n * Excellent documentation. From: https://threejs.org/examples/#misc_controls_pointerlock\n * Right now the unit is 1cm, 1/10 of a meter.\n */\nconst Loc = (props) => {\n  // logg(props, 'Loc')\n\n  const history = useHistory()\n\n  let camera, controls,\n    object, objects = [], markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov — Camera frustum vertical field of view.\n     * aspect — Camera frustum aspect ratio.\n     * near — Camera frustum near plane.\n     * far — Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n\n    /*\n     * Crosshair\n     * From: https://codepen.io/driezis/pen/jOPzjLG?editors=1000\n     */\n    var pMat = new THREE.ShaderMaterial({\n        uniforms: { main_color: {value: {r: 1, g: 1, b: 1}},\n                    border_color: {value: {r: 0, g: 0, b: 0.1}},\n\n                    thickness: {value:0.006},\n                    height: {value:0.13},\n                    offset: {value:0.05},\n                    border: {value:0.003},\n\n                    opacity: {value: 1},\n                    center: {value: {x: 0.5, y: 0.5}},\n                    rotation: {value: 0}\n                },\n        vertexShader: `\n                uniform float rotation;\n                uniform vec2 center;\n                #include <common>\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec2 scale;\n                    scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n                    scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n                    #ifndef USE_SIZEATTENUATION\n                        bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n                        if ( isPerspective ) scale *= - mvPosition.z;\n                    #endif\n                    vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n                    vec2 rotatedPosition;\n                    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n                    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n                    mvPosition.xy += rotatedPosition;\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n        fragmentShader: `\n            uniform vec3 main_color;\n            uniform vec3 border_color;\n            uniform float opacity;\n\n            uniform float thickness;\n            uniform float height;\n            uniform float offset;\n            uniform float border;\n\n            varying vec2 vUv;\n            void main() {\n\n                float a = (step(abs(vUv.x - 0.5), thickness)) * step(abs(vUv.y - 0.5), height + offset) * step(offset, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness)) * step(abs(vUv.x - 0.5), height + offset) * step(offset, abs(vUv.x - 0.5));\n                float b = (step(abs(vUv.x - 0.5), thickness - border)) * step(abs(vUv.y - 0.5), height + offset - border) * step(offset + border, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness - border)) * step(abs(vUv.x - 0.5), height + offset - border) * step(offset + border, abs(vUv.x - 0.5));\n                gl_FragColor = vec4( mix(border_color, main_color, b), a * opacity);\n            }\n        `,\n        transparent: true,\n    });\n    var sprite = new THREE.Sprite(pMat);\n    // scene.add(sprite);\n    // sprite.position.set(0,0,-5);\n\n    /*\n     * Reticle\n     */\n    // var scale = 3\n    // var cursorSize = 500\n    // var reticle = new THREE.Mesh(\n    //   new THREE.RingBufferGeometry( 0.85 * cursorSize, cursorSize, 32),\n    //   new THREE.MeshBasicMaterial({color: 0xffffff, blending: THREE.AdditiveBlending, side: THREE.DoubleSide })\n    // );\n    // reticle.position.z = -100\n    // reticle.lookAt(camera.position)\n    // camera.add(reticle)\n\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Floor\n     */\n\n    // // random\n    // // @TODO: it's not aligned to parcels the way I want\n    // let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    // floorGeometry.rotateX( - Math.PI / 2 )\n\n    // // vertex displacement\n    // let position = floorGeometry.attributes.position\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   vertex.fromBufferAttribute( position, i )\n    //   vertex.x += Math.random() * 20 - 10\n    //   vertex.y += Math.random() * 2\n    //   vertex.z += Math.random() * 20 - 10\n    //   position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    // }\n    // floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    // floorGeometry.x = -200\n    // floorGeometry.y = -200\n    // floorGeometry.z = -200\n    // position = floorGeometry.attributes.position\n    // const colorsFloor = []\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n    //   colorsFloor.push( color.r, color.g, color.b )\n    // }\n    // floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    // const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n    // moon floor\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`)\n\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius — Radius of the circle, default = 1.\n     * segments — Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart — Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength — The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    const scenesPath = '/assets/scenes/'\n    const objectsPath = '/assets/objects/'\n    let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    let modelName2 = 'girl'\n    const texturePath = `${modelName}/${modelName}.mtl`\n    const modelPath = `${modelName}/${modelName}.obj`\n    const modelPath2 = `${modelName2}/${modelName2}.obj`\n    const manager = new THREE.LoadingManager()\n\n    const onProgress = (xhr) => {\n      if (xhr.lengthComputable) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }\n    // onProgress = function ( item, loaded, total ) {\n    //   console.log( item, loaded, total )\n    // }\n    const onError = () => {}\n    const onLoad = (materials) => {\n      materials.preload()\n      const objLoader = new OBJLoader( manager )\n      objLoader.setMaterials( materials )\n      objLoader.setPath( scenesPath)\n      objLoader.load( modelPath, ( object ) => {\n        object.traverse((child) => {\n          if (child.isMesh) {\n            child.geometry.scale(0.10, 0.10, 0.10)\n          }\n        })\n        object.position.x = Math.random() * 500\n        object.position.y = 10\n        object.position.z = Math.random() * 500\n\n        logg(object, '1st object')\n        scene.add( object )\n        markerObjects.push( object )\n        markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' })\n\n      }, onProgress, onError )\n    }\n    const onLoad2 = (materials) => {\n      // materials.preload()\n      const objLoader = new OBJLoader( manager )\n      // objLoader.setMaterials( materials )\n      objLoader.setPath( objectsPath )\n      objLoader.load( modelPath2, ( object ) => {\n        object.traverse((child) => {\n          if (child.isMesh) {\n            child.geometry.scale(10, 10, 10)\n          }\n        })\n        object.position.x = Math.random() * 500\n        object.position.y = 10\n        object.position.z = Math.random() * 500\n\n        logg(object, '2st object')\n        scene.add( object )\n        markerObjects.push( object )\n        markerObjectsIdxs.push({ uuid: object.uuid, name: 'girl', slug: 'demmitv' })\n\n      }, onProgress, onError )\n    }\n    const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setBaseUrl(scenesPath)\n    mtlLoader.setPath(scenesPath)\n    mtlLoader.load(texturePath, onLoad)\n    mtlLoader.load(texturePath, onLoad2)\n\n\n    // /* texture */\n    // const textureLoader = new THREE.TextureLoader( manager )\n    // const texture = textureLoader.load( 'textures/uv_grid_opengl.jpg' )\n\n\n    // const loader = new OBJLoader( manager )\n    // loader.load( `/assets/scenes/${modelName}/${modelName}.obj`, ( obj ) => {\n    //   object = obj\n    // }, ( xhr ) => {\n    //   if ( xhr.lengthComputable ) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }, (e) => {\n    //   logg(e, 'onError')\n    // } )\n\n\n    /*\n     * parcels\n     */\n\n    // // some delimiters for the first 6 parcels!\n    // let geometry = new THREE.BoxGeometry( 10, 10, 10 )\n    // let material = new THREE.MeshBasicMaterial( {color: 0x00ff00} )\n    // let cube = new THREE.Mesh( geometry, material )\n    // cube.position.x = 0\n    // cube.position.y = 5\n    // cube.position.z = 0\n    // // scene.add( cube )\n    // const items = [\n    //   { color: 0xff0000, x: 1, y: 0, z: 0 },\n    //   { color: 0x00ff00, x: 0, y: 1, z: 0 },\n    //   { color: 0x0000ff, x: 0, y: 0, z: 1 }\n    // ]\n    // items.map((item, idx) => {\n    //   logg(item, 'item')\n    //   const { color, x, y, z } = item\n    //   geometry = new THREE.BoxGeometry( 1 + x*10, 1 + y*10, 1 + z*10 )\n    //   material = new THREE.MeshBasicMaterial({ color: color })\n    //   cube = new THREE.Mesh( geometry, material )\n    //   cube.position.x = x*5\n    //   cube.position.y = 10+y*5\n    //   cube.position.z = z*5\n    //   // scene.add( cube )\n    // })\n\n    // const parcels = [\n    //   { color: 0xff0000, x: 100, y: 1, z: 100 },\n    //   { color: 0x00ff00, x: 100, y: 1, z: 320 },\n    //   { color: 0x0000ff, x: -120, y: 1, z: 320 },\n\n    //   { color: 0x660000, x: -120, y: 1, z: 100 },\n    //   { color: 0x006600, x: -120, y: 1, z: -120 },\n    //   { color: 0x000066, x: 100, y: 1, z: -120 },\n    // ]\n    // parcels.map((item, idx) => {\n    //   const { color, x, y, z } = item\n    //   const g = new THREE.BoxGeometry( 200, 2, 200 )\n    //   const m = new THREE.MeshBasicMaterial({color: color})\n    //   const p = new THREE.Mesh( g, m )\n    //   p.position.x = x\n    //   p.position.y = y\n    //   p.position.z = z\n    //   // scene.add( p )\n    // })\n\n\n    /*\n     * Skybox\n     */\n    const loader = new THREE.TextureLoader()\n    texture = loader.load(`/assets/textures/space-5.jpg`, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( 700, 350 ) // aspect ratio 0.5\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} >\n      <div id=\"Crosshair\" />\n    </Blocker>\n  </F>\n}\n\nexport default Loc\n","\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\nimport * as THREE from \"three\"\nimport Stats from 'three/examples/jsm/libs/stats.module'\nimport { Octree } from 'three/examples/jsm/math/Octree'\nimport { Capsule } from 'three/examples/jsm/math/Capsule'\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\"\n\nimport { Crosshair } from \"./\"\nimport { PointerLockControls, } from './PointerLockControls'\nimport {\n  C,\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst Blocker = styled.div`\n  // border: 2px solid red;\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n`;\n\n/**\n * Location\n *\n * Excellent documentation. From: https://threejs.org/examples/#misc_controls_pointerlock\n * Right now the unit is 1cm, 1/10 of a meter.\n *\n * Octree! From: https://threejs.org/examples/games_fps.html\n * @TODO: let's load the map, and collision player on map. _vp_ 202-04-20\n *\n**/\nconst Location = (props) => {\n  // logg(props, 'Loc')\n\n  const history = useHistory()\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  let camera, clock,\n    directionalLight,\n    fillLight1,\n    glow,\n    markerObjects = [],\n    pickedObject, plc,\n    raycaster, removedObject, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  useEffect(() => {\n    window.dispatchEvent(new Event('resize'));\n  }, [ bottomDrawerOpen, folded, twofoldPercent ])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n\n\n\n  function init_old() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov — Camera frustum vertical field of view.\n     * aspect — Camera frustum aspect ratio.\n     * near — Camera frustum near plane.\n     * far — Camera frustum far plane.\n    */\n    const aspect = blockerRef.current.clientWidth / blockerRef.current.clientHeight\n    camera = new THREE.PerspectiveCamera( 75, aspect, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    // scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    plc = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      plc.lock()\n    } )\n\n    plc.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    plc.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( plc.getObject() )\n\n    const onClick = (event) => {\n      // logg(event, 'onCLick')\n      // logg(pickedObject, 'pickedObject')\n\n      // @TODO: prevent lock-outs!\n      if (pickedObject) {\n        // plc.unlock()\n        // history.push(`/en/locations/show/${pickedObject.slug}`)\n      }\n    }\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n    document.addEventListener( 'click', onClick )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n\n    /*\n     * Floor\n     */\n\n    // moon floor\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`)\n\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius — Radius of the circle, default = 1.\n     * segments — Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart — Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength — The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    const scenesPath = '/assets/scenes/'\n    const objectsPath = '/assets/objects/'\n    const manager = new THREE.LoadingManager()\n\n    let importModels = [\n      // { modelName: 'wasyaco-reception-2', slug: 'construct1' },\n\n      { modelName: 'camaro75', slug: 'construct1' },\n      { modelName: 'girl',     slug: 'demmitv' },\n\n      // { modelName: 'girl-5',     slug: 'demmitv' },\n    ]\n\n    const onProgress = (xhr) => {\n      if (xhr.lengthComputable) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }\n    const onError = () => {}\n    const mtlLoader = new MTLLoader(manager)\n    mtlLoader.setPath(objectsPath)\n\n    importModels.map(({ modelName, slug }) => {\n      const texturePath = `${modelName}/${modelName}.mtl`\n      const modelPath = `${modelName}/${modelName}.obj`\n      const wrappedOnLoad = (modelPath) => {\n        return (materials) => {\n          materials.preload()\n          const objLoader = new OBJLoader( manager )\n          objLoader.setMaterials( materials )\n\n          objLoader.setPath(objectsPath)\n          objLoader.load( modelPath, ( object ) => {\n            object.traverse((child) => {\n              if (child.isMesh) {\n                child.geometry.scale(10, 10, 10)\n              }\n            })\n            object.position.x = Math.random() * 200\n            object.position.y = 10\n            object.position.z = Math.random() * 200\n\n            scene.add( object )\n            markerObjects.push({ uuid: object.uuid, name: 'camaro75', object, slug: 'construct1', })\n\n          }, onProgress, onError )\n        }\n      }\n      mtlLoader.load(texturePath, wrappedOnLoad(modelPath))\n    })\n\n\n\n\n    /*\n     * Skybox\n     */\n    const loader = new THREE.TextureLoader()\n    texture = loader.load(`/assets/textures/space-5.jpg`, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n  }\n\n\n  const GRAVITY = 30;\n\n  const NUM_SPHERES = 100;\n  const SPHERE_RADIUS = 0.2;\n\n  const STEPS_PER_FRAME = 5;\n\n  const sphereGeometry = new THREE.IcosahedronGeometry( SPHERE_RADIUS, 5 );\n  const sphereMaterial = new THREE.MeshLambertMaterial( { color: 0xbbbb44 } );\n\n  const spheres = [];\n  let sphereIdx = 0;\n\n  const worldOctree = new Octree();\n\n  const playerCollider = new Capsule( new THREE.Vector3( 0, 0.35, 0 ), new THREE.Vector3( 0, 1, 0 ), 0.35 );\n\n  const playerVelocity = new THREE.Vector3();\n  const playerDirection = new THREE.Vector3();\n\n  let playerOnFloor = false;\n  let mouseTime = 0;\n\n  const keyStates = {};\n\n  const vector1 = new THREE.Vector3();\n  const vector2 = new THREE.Vector3();\n  const vector3 = new THREE.Vector3();\n\n  const init = () => {\n    clock = new THREE.Clock();\n\n    scene = new THREE.Scene();\n    scene.background = new THREE.Color( 0x88ccee );\n    scene.fog = new THREE.Fog( 0x88ccee, 0, 50 );\n\n    camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 1000 );\n    camera.rotation.order = 'YXZ';\n\n    fillLight1 = new THREE.HemisphereLight( 0x4488bb, 0x002244, 0.5 );\n    fillLight1.position.set( 2, 1, 1 );\n    scene.add( fillLight1 );\n\n    directionalLight = new THREE.DirectionalLight( 0xffffff, 0.8 );\n    directionalLight.position.set( - 5, 25, - 1 );\n    directionalLight.castShadow = true;\n    directionalLight.shadow.camera.near = 0.01;\n    directionalLight.shadow.camera.far = 500;\n    directionalLight.shadow.camera.right = 30;\n    directionalLight.shadow.camera.left = - 30;\n    directionalLight.shadow.camera.top\t= 30;\n    directionalLight.shadow.camera.bottom = - 30;\n    directionalLight.shadow.mapSize.width = 1024;\n    directionalLight.shadow.mapSize.height = 1024;\n    directionalLight.shadow.radius = 4;\n    directionalLight.shadow.bias = - 0.00006;\n    scene.add( directionalLight );\n\n    for ( let i = 0; i < NUM_SPHERES; i ++ ) {\n      const sphere = new THREE.Mesh( sphereGeometry, sphereMaterial );\n      sphere.castShadow = true;\n      sphere.receiveShadow = true;\n\n      scene.add( sphere );\n\n      spheres.push( {\n        mesh: sphere,\n        collider: new THREE.Sphere( new THREE.Vector3( 0, - 100, 0 ), SPHERE_RADIUS ),\n        velocity: new THREE.Vector3()\n      } );\n    }\n\n    /*\n     * controls\n    **/\n    plc = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      plc.lock()\n    } )\n\n    plc.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    plc.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( plc.getObject() )\n\n    /*\n     * Render\n    **/\n    renderer = new THREE.WebGLRenderer( { antialias: true } )\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n    renderer.shadowMap.enabled = true\n    renderer.shadowMap.type = THREE.VSMShadowMap\n    renderer.outputEncoding = THREE.sRGBEncoding\n    renderer.toneMapping = THREE.ACESFilmicToneMapping\n\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n    /*\n     * GLFT Loader\n    **/\n    const loader = new GLTFLoader().setPath( './assets/objects/gltf/' );\n\n    loader.load( 'collision-world.glb', ( gltf ) => {\n      scene.add( gltf.scene );\n      worldOctree.fromGraphNode( gltf.scene );\n      gltf.scene.traverse( child => {\n        if ( child.isMesh ) {\n          child.castShadow = true;\n          child.receiveShadow = true;\n          if ( child.material.map ) {\n            child.material.map.anisotropy = 4;\n          }\n        }\n      } );\n\n      // const helper = new OctreeHelper( worldOctree );\n      // helper.visible = false;\n      // scene.add( helper );\n\n      animate();\n    } );\n\n    /*\n     * keyboard control, event listeners\n    **/\n    document.addEventListener( 'keydown', ( event ) => {\n      keyStates[ event.code ] = true;\n    } );\n\n    document.addEventListener( 'keyup', ( event ) => {\n      keyStates[ event.code ] = false;\n    } );\n\n    document.addEventListener( 'mouseup', () => {\n      if ( document.pointerLockElement !== null ) throwBall();\n    } );\n\n    // document.body.addEventListener( 'mousemove', ( event ) => {\n    //   if ( document.pointerLockElement === document.body ) {\n    //     camera.rotation.y -= event.movementX / 500;\n    //     camera.rotation.x -= event.movementY / 500;\n    //   }\n    // } );\n\n    document.addEventListener( 'mousedown', () => {\n      document.body.requestPointerLock();\n      mouseTime = performance.now();\n    } );\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = blockerRef.current.clientWidth / blockerRef.current.clientHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n  }\n\n  function playerCollisions() {\n    const result = worldOctree.capsuleIntersect( playerCollider );\n    playerOnFloor = false;\n    if ( result ) {\n      playerOnFloor = result.normal.y > 0;\n      if ( ! playerOnFloor ) {\n        playerVelocity.addScaledVector( result.normal, - result.normal.dot( playerVelocity ) );\n      }\n      playerCollider.translate( result.normal.multiplyScalar( result.depth ) );\n    }\n  }\n\n  function updateSpheres( deltaTime ) {\n    spheres.forEach( sphere => {\n      sphere.collider.center.addScaledVector( sphere.velocity, deltaTime );\n      const result = worldOctree.sphereIntersect( sphere.collider );\n      if ( result ) {\n        sphere.velocity.addScaledVector( result.normal, - result.normal.dot( sphere.velocity ) * 1.5 );\n        sphere.collider.center.add( result.normal.multiplyScalar( result.depth ) );\n      } else {\n        sphere.velocity.y -= GRAVITY * deltaTime;\n      }\n      const damping = Math.exp( - 1.5 * deltaTime ) - 1;\n      sphere.velocity.addScaledVector( sphere.velocity, damping );\n      playerSphereCollision( sphere );\n    } );\n    spheresCollisions();\n    for ( const sphere of spheres ) {\n      sphere.mesh.position.copy( sphere.collider.center );\n    }\n  }\n\n  function throwBall() {\n    const sphere = spheres[ sphereIdx ];\n    camera.getWorldDirection( playerDirection );\n    sphere.collider.center.copy( playerCollider.end ).addScaledVector( playerDirection, playerCollider.radius * 1.5 );\n    // throw the ball with more force if we hold the button longer, and if we move forward\n    const impulse = 15 + 30 * ( 1 - Math.exp( ( mouseTime - performance.now() ) * 0.001 ) );\n    sphere.velocity.copy( playerDirection ).multiplyScalar( impulse );\n    sphere.velocity.addScaledVector( playerVelocity, 2 );\n    sphereIdx = ( sphereIdx + 1 ) % spheres.length;\n  }\n\n  function getForwardVector() {\n    camera.getWorldDirection( playerDirection );\n    playerDirection.y = 0;\n    playerDirection.normalize();\n    return playerDirection;\n  }\n\n  function getSideVector() {\n    camera.getWorldDirection( playerDirection );\n    playerDirection.y = 0;\n    playerDirection.normalize();\n    playerDirection.cross( camera.up );\n    return playerDirection;\n  }\n\n  function updatePlayer( deltaTime ) {\n    let damping = Math.exp( - 4 * deltaTime ) - 1;\n    if ( ! playerOnFloor ) {\n      playerVelocity.y -= GRAVITY * deltaTime;\n      // small air resistance\n      damping *= 0.1;\n    }\n    playerVelocity.addScaledVector( playerVelocity, damping );\n    const deltaPosition = playerVelocity.clone().multiplyScalar( deltaTime );\n    playerCollider.translate( deltaPosition );\n    playerCollisions();\n    camera.position.copy( playerCollider.end );\n  }\n\n  function spheresCollisions() {\n    for ( let i = 0, length = spheres.length; i < length; i ++ ) {\n      const s1 = spheres[ i ];\n      for ( let j = i + 1; j < length; j ++ ) {\n        const s2 = spheres[ j ];\n\n        const d2 = s1.collider.center.distanceToSquared( s2.collider.center );\n        const r = s1.collider.radius + s2.collider.radius;\n        const r2 = r * r;\n\n        if ( d2 < r2 ) {\n          const normal = vector1.subVectors( s1.collider.center, s2.collider.center ).normalize();\n          const v1 = vector2.copy( normal ).multiplyScalar( normal.dot( s1.velocity ) );\n          const v2 = vector3.copy( normal ).multiplyScalar( normal.dot( s2.velocity ) );\n\n          s1.velocity.add( v2 ).sub( v1 );\n          s2.velocity.add( v1 ).sub( v2 );\n\n          const d = ( r - Math.sqrt( d2 ) ) / 2;\n\n          s1.collider.center.addScaledVector( normal, d );\n          s2.collider.center.addScaledVector( normal, - d );\n        }\n      }\n    }\n  }\n\n  function playerSphereCollision( sphere ) {\n    const center = vector1.addVectors( playerCollider.start, playerCollider.end ).multiplyScalar( 0.5 );\n    const sphere_center = sphere.collider.center;\n    const r = playerCollider.radius + sphere.collider.radius;\n    const r2 = r * r;\n\n    // approximation: player = 3 spheres\n    for ( const point of [ playerCollider.start, playerCollider.end, center ] ) {\n      const d2 = point.distanceToSquared( sphere_center );\n\n      if ( d2 < r2 ) {\n        const normal = vector1.subVectors( point, sphere_center ).normalize();\n        const v1 = vector2.copy( normal ).multiplyScalar( normal.dot( playerVelocity ) );\n        const v2 = vector3.copy( normal ).multiplyScalar( normal.dot( sphere.velocity ) );\n\n        playerVelocity.add( v2 ).sub( v1 );\n        sphere.velocity.add( v1 ).sub( v2 );\n\n        const d = ( r - Math.sqrt( d2 ) ) / 2;\n        sphere_center.addScaledVector( normal, - d );\n      }\n    }\n  }\n\n  function teleportPlayerIfOob() {\n    if ( camera.position.y <= - 25 ) {\n      playerCollider.start.set( 0, 0.35, 0 );\n      playerCollider.end.set( 0, 1, 0 );\n      playerCollider.radius = 0.35;\n      camera.position.copy( playerCollider.end );\n      camera.rotation.set( 0, 0, 0 );\n    }\n  }\n\n  function controls( deltaTime ) {\n    // gives a bit of air control\n    const speedDelta = deltaTime * ( playerOnFloor ? 25 : 8 );\n\n    if ( keyStates[ 'KeyW' ] ) {\n      playerVelocity.add( getForwardVector().multiplyScalar( speedDelta ) );\n    }\n\n    if ( keyStates[ 'KeyS' ] ) {\n      playerVelocity.add( getForwardVector().multiplyScalar( - speedDelta ) );\n    }\n\n    if ( keyStates[ 'KeyA' ] ) {\n      playerVelocity.add( getSideVector().multiplyScalar( - speedDelta ) );\n    }\n\n    if ( keyStates[ 'KeyD' ] ) {\n      playerVelocity.add( getSideVector().multiplyScalar( speedDelta ) );\n    }\n\n    if ( playerOnFloor ) {\n      if ( keyStates[ 'Space' ] ) {\n        playerVelocity.y = 15;\n      }\n    }\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( plc.isLocked === true ) {\n\n      const deltaTime = Math.min( 0.05, clock.getDelta() ) / STEPS_PER_FRAME;\n\n      // we look for collisions in substeps to mitigate the risk of\n      // an object traversing another too quickly for detection.\n\n      for ( let i = 0; i < STEPS_PER_FRAME; i ++ ) {\n        controls( deltaTime );\n        updatePlayer( deltaTime );\n        updateSpheres( deltaTime );\n        teleportPlayerIfOob();\n      }\n\n    }\n    prevTime = time\n\n    // @TODO: add stats\n    // @TODO: add OctreeHelper\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker ref={blockerRef} >\n      <Crosshair />\n    </Blocker>\n  </F>\n}\n\nexport default Location\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  border: 2px solid red;\n\n  position: relative;\n  // height: calc(100% - ${p => p.breadcrumbsHeight});\n  width: 700px;\n  height: 350px;\n\n  #Crosshair {\n    // border: 1px solid yellow;\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\n/**\n * ThreePanelV4\n * Markers are obejcts _vp_ 2021-11-14\n *\n */\nconst ThreePanelV4 = (props) => {\n  logg(props, 'ThreePanelV4')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    object, objects = [], markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov — Camera frustum vertical field of view.\n     * aspect — Camera frustum aspect ratio.\n     * near — Camera frustum near plane.\n     * far — Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n\n    /*\n     * Crosshair\n     * From: https://codepen.io/driezis/pen/jOPzjLG?editors=1000\n     */\n    var pMat = new THREE.ShaderMaterial({\n        uniforms: { main_color: {value: {r: 1, g: 1, b: 1}},\n                    border_color: {value: {r: 0, g: 0, b: 0.1}},\n\n                    thickness: {value:0.006},\n                    height: {value:0.13},\n                    offset: {value:0.05},\n                    border: {value:0.003},\n\n                    opacity: {value: 1},\n                    center: {value: {x: 0.5, y: 0.5}},\n                    rotation: {value: 0}\n                },\n        vertexShader: `\n                uniform float rotation;\n                uniform vec2 center;\n                #include <common>\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec2 scale;\n                    scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n                    scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n                    #ifndef USE_SIZEATTENUATION\n                        bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n                        if ( isPerspective ) scale *= - mvPosition.z;\n                    #endif\n                    vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n                    vec2 rotatedPosition;\n                    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n                    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n                    mvPosition.xy += rotatedPosition;\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n        fragmentShader: `\n            uniform vec3 main_color;\n            uniform vec3 border_color;\n            uniform float opacity;\n\n            uniform float thickness;\n            uniform float height;\n            uniform float offset;\n            uniform float border;\n\n            varying vec2 vUv;\n            void main() {\n\n                float a = (step(abs(vUv.x - 0.5), thickness)) * step(abs(vUv.y - 0.5), height + offset) * step(offset, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness)) * step(abs(vUv.x - 0.5), height + offset) * step(offset, abs(vUv.x - 0.5));\n                float b = (step(abs(vUv.x - 0.5), thickness - border)) * step(abs(vUv.y - 0.5), height + offset - border) * step(offset + border, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness - border)) * step(abs(vUv.x - 0.5), height + offset - border) * step(offset + border, abs(vUv.x - 0.5));\n                gl_FragColor = vec4( mix(border_color, main_color, b), a * opacity);\n            }\n        `,\n        transparent: true,\n    });\n    var sprite = new THREE.Sprite(pMat);\n    // scene.add(sprite);\n    // sprite.position.set(0,0,-5);\n\n    /*\n     * Reticle\n     */\n    // var scale = 3\n    // var cursorSize = 500\n    // var reticle = new THREE.Mesh(\n    //   new THREE.RingBufferGeometry( 0.85 * cursorSize, cursorSize, 32),\n    //   new THREE.MeshBasicMaterial({color: 0xffffff, blending: THREE.AdditiveBlending, side: THREE.DoubleSide })\n    // );\n    // reticle.position.z = -100\n    // reticle.lookAt(camera.position)\n    // camera.add(reticle)\n\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Floor\n     */\n\n    // // random\n    // // @TODO: it's not aligned to parcels the way I want\n    // let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    // floorGeometry.rotateX( - Math.PI / 2 )\n\n    // // vertex displacement\n    // let position = floorGeometry.attributes.position\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   vertex.fromBufferAttribute( position, i )\n    //   vertex.x += Math.random() * 20 - 10\n    //   vertex.y += Math.random() * 2\n    //   vertex.z += Math.random() * 20 - 10\n    //   position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    // }\n    // floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    // floorGeometry.x = -200\n    // floorGeometry.y = -200\n    // floorGeometry.z = -200\n    // position = floorGeometry.attributes.position\n    // const colorsFloor = []\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n    //   colorsFloor.push( color.r, color.g, color.b )\n    // }\n    // floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    // const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n    // moon floor\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`)\n\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius — Radius of the circle, default = 1.\n     * segments — Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart — Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength — The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    const scenesPath = '/assets/scenes/'\n    const objectsPath = '/assets/objects/'\n    const texturesPath = '/assets/textures/'\n    const manager = new THREE.LoadingManager()\n    const mtlLoader = new MTLLoader(manager)\n    mtlLoader.setPath(texturesPath)\n    const onProgress = (xhr) => {\n      if (xhr.lengthComputable) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }\n    const onError = () => {}\n\n\n    map.markers.map((marker, idx) => {\n      let modelName = marker.slug\n      const texturePath = `${modelName}/${modelName}.mtl`\n      const modelPath = `${modelName}/${modelName}.obj`\n      const wrappedOnLoad = (modelPath, modelName) => {\n        return (materials) => {\n          materials.preload()\n          const objLoader = new OBJLoader( manager )\n          objLoader.setMaterials( materials )\n          objLoader.setPath( objectsPath )\n          objLoader.load( modelPath, ( object ) => {\n            object.traverse((child) => {\n              if (child.isMesh) {\n                child.geometry.scale(10, 10, 10) // @TODO change, girl-6 accepts 1,1,1\n              }\n            })\n            object.position.x = Math.random() * 100\n            object.position.y = 10\n            object.position.z = Math.random() * 100\n\n            // object.rotateX( - Math.PI / 2 ) // girl-6 only.\n\n            logg(object, 'loaded obj')\n\n            scene.add( object )\n            markerObjects.push( object )\n            markerObjectsIdxs.push({ uuid: object.uuid, name: modelName })\n\n          }, onProgress, onError )\n        }\n      }\n      mtlLoader.load(texturePath, wrappedOnLoad(modelPath, modelName))\n    })\n\n    // /* texture */\n    // const textureLoader = new THREE.TextureLoader( manager )\n    // const texture = textureLoader.load( 'textures/uv_grid_opengl.jpg' )\n\n\n    // const loader = new OBJLoader( manager )\n    // loader.load( `/assets/scenes/${modelName}/${modelName}.obj`, ( obj ) => {\n    //   object = obj\n    // }, ( xhr ) => {\n    //   if ( xhr.lengthComputable ) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }, (e) => {\n    //   logg(e, 'onError')\n    // } )\n\n\n    /*\n     * parcels\n     */\n\n    // // some delimiters for the first 6 parcels!\n    // let geometry = new THREE.BoxGeometry( 10, 10, 10 )\n    // let material = new THREE.MeshBasicMaterial( {color: 0x00ff00} )\n    // let cube = new THREE.Mesh( geometry, material )\n    // cube.position.x = 0\n    // cube.position.y = 5\n    // cube.position.z = 0\n    // // scene.add( cube )\n    // const items = [\n    //   { color: 0xff0000, x: 1, y: 0, z: 0 },\n    //   { color: 0x00ff00, x: 0, y: 1, z: 0 },\n    //   { color: 0x0000ff, x: 0, y: 0, z: 1 }\n    // ]\n    // items.map((item, idx) => {\n    //   logg(item, 'item')\n    //   const { color, x, y, z } = item\n    //   geometry = new THREE.BoxGeometry( 1 + x*10, 1 + y*10, 1 + z*10 )\n    //   material = new THREE.MeshBasicMaterial({ color: color })\n    //   cube = new THREE.Mesh( geometry, material )\n    //   cube.position.x = x*5\n    //   cube.position.y = 10+y*5\n    //   cube.position.z = z*5\n    //   // scene.add( cube )\n    // })\n\n    // const parcels = [\n    //   { color: 0xff0000, x: 100, y: 1, z: 100 },\n    //   { color: 0x00ff00, x: 100, y: 1, z: 320 },\n    //   { color: 0x0000ff, x: -120, y: 1, z: 320 },\n\n    //   { color: 0x660000, x: -120, y: 1, z: 100 },\n    //   { color: 0x006600, x: -120, y: 1, z: -120 },\n    //   { color: 0x000066, x: 100, y: 1, z: -120 },\n    // ]\n    // parcels.map((item, idx) => {\n    //   const { color, x, y, z } = item\n    //   const g = new THREE.BoxGeometry( 200, 2, 200 )\n    //   const m = new THREE.MeshBasicMaterial({color: color})\n    //   const p = new THREE.Mesh( g, m )\n    //   p.position.x = x\n    //   p.position.y = y\n    //   p.position.z = z\n    //   // scene.add( p )\n    // })\n\n\n    /*\n     * Skybox\n     */\n    const loader = new THREE.TextureLoader()\n    texture = loader.load(`/assets/textures/space-5.jpg`, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( 700, 350 ) // aspect ratio 0.5\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        /* collision */\n        // if (intersections[0].distance < 5) {\n        //   moveForward = false\n        // }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} >\n      <div id=\"Crosshair\" />\n    </Blocker>\n  </F>\n}\n\nexport default ThreePanelV4\n","\n\nimport { CircularProgress as _CircularProgress } from '@material-ui/core'\nimport { ChevronLeft, ChevronRight, Menu as MenuIcon, } from '@material-ui/icons'\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport styled from 'styled-components'\n\nimport {\n  MapPanel, MapPanelNoZoom,\n} from \"./\"\nimport {\n  Equirectangular, Equirectangular2, Equirectangular4,\n  ThreePanelV1, ThreePanelV2, ThreePanelV3, ThreePanelV4,\n} from \"$components/3d_locations\"\nimport {\n  C, Collapsible,\n  logg,\n  request,\n  TwofoldContext,\n  useWindowSize,\n} from \"$shared\"\n\n/* W */\nconst W0 = styled.div`\n  overflow: hidden;\n\n  flex-grow: 1;\n\n  // max-height: 100vh;\n  // min-height: 50vh;\n\n`;\n\n/**\n * Renders either MapPanel (W really, a simple wrapper), MapPanelNoZoom, or ThreePanelV1\n * or some other MapPanel.\n */\nconst WrappedMapPanel = React.forwardRef((props, ref) => {\n  // logg(props.map, 'WrappedMapPanel')\n\n  switch (props.map.config.map_panel_type) {\n\n    case C.map_panel_types.Equirectangular:\n      // return <W0 ref={ref} className=\"Equirectangular\" ><Equirectangular {...props} /></W0>\n      // return <W0 ref={ref} className=\"Equirectangular2\" ><Equirectangular2 {...props} /></W0>\n      return <W0 ref={ref} className=\"Equirectangular4\" ><Equirectangular4 {...props} /></W0>\n\n    case C.map_panel_types.MapPanelNoZoom:\n      return <W0 ref={ref} className=\"WrappedMapPanel\" ><MapPanelNoZoom withZoom={false} {...props} /></W0>\n\n    case C.map_panel_types.ThreePanelV1:\n      switch (props.slug) {\n        case 'threev1':\n          return <W0><ThreePanelV1 {...props} /></W0>\n        case 'threev2':\n          return <W0><ThreePanelV2 {...props} /></W0>\n          case 'threev3':\n            return <W0><ThreePanelV3 {...props} /></W0>\n\n        default:\n          logg(props.slug, `ttr - this 3d panel is not implemented`)\n          return <W0 ref={ref} className=\"WrappedMapPanel\" ><MapPanel {...props} /></W0>\n      }\n\n    case C.map_panel_types.ThreePanelV4: // markers are objects\n      return <W0><ThreePanelV4 {...props} /></W0>\n\n    default:\n      return <W0 ref={ref} className=\"WrappedMapPanel\" ><MapPanel {...props} /></W0>\n  }\n})\nexport default WrappedMapPanel\n\n","\nimport PropTypes from 'prop-types'\nimport React, { useContext, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport {\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst W = styled.div`\n  position: absolute;\n  top: 0;\n  right: 0;\n  z-index: 1;\n  background: white;\n  padding: 5px;\n\n  display: flex;\n  flex-direction: column;\n`;\n\n/**\n * ZoomCtrl\n */\nconst ZoomCtrl = (props) => {\n  logg(props, 'ZoomCtrl')\n\n  const { zoom, setZoom } = useContext(TwofoldContext)\n\n  const zoomIn = () => {\n    setZoom(zoom/2)\n  }\n  const zoomOut = () => {\n    setZoom(zoom*2)\n  }\n  const zoomReset = () => {\n    setZoom(1)\n  }\n\n  return <W className='ZoomCtrl' >\n    <span onClick={zoomIn} >[+]</span>\n    <span onClick={zoomOut} >[-]</span>\n    <span onClick={zoomReset} >[1]</span>\n  </W>\n}\n\nexport default ZoomCtrl\n","\nimport PropTypes from 'prop-types'\nimport { Grid } from '@material-ui/core'\nimport React, { Fragment as F, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, useApi, } from \"$shared\"\n\nconst Label = styled.div``;\n\nconst Features = ({ features, label, ...props }) => {\n  // logg(props, 'Features')\n\n  const out = []\n  features.map((f) => {\n    if (f.inner_html) {\n      out.push(<Grid item sm={3} dangerouslySetInnerHTML={{ __html: f.inner_html }} />)\n    }\n  })\n\n  return <F>\n    {label && <Label>{label}</Label>}\n    <Grid style={{ marginBottom: '1em' }} container spacing={2}>\n      { out }\n    </Grid>\n  </F>\n}\n\nFeatures.propTypes = {\n  features: PropTypes.arrayOf(PropTypes.shape({\n    inner_html: PropTypes.string,\n  }) ),\n  label: PropTypes.string,\n}\nexport default Features","import { IonPage, IonLoading, IonContent } from '@ionic/react'\nimport React, { Fragment as F, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, useApi, } from \"$shared\"\nimport { Features } from \"./\"\nimport {\n  MainHeader,\n} from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\n\nconst _Hero = styled.div`\n  height: 370px;\n  text-align: center;\n\n  img {\n    max-width: 100%;\n  }\n`\nconst Hero = () => <_Hero><img className=\"image\" src=\"/assets/hero.png\" /></_Hero>\n\nconst Root = styled.div`\n  margin: 0;\n  padding-bottom: 1em;\n`\n\nconst SitesShow = (props) => {\n  // logg(props, 'SitesShow')\n\n  let [ site, setSite ] = useState({ features: [], newsitems: [] })\n  let [ loading, setLoading ] = useState(false)\n\n  const api = useApi()\n  const mountedRef = useRef('init')\n\n  useEffect(() => {\n    api.applicationHome().then(data => {\n      if (!mountedRef.current) { return null }\n      setSite(data)\n      setLoading(false)\n    })\n    return () => { mountedRef.current = false }\n  }, [])\n\n  return <F>\n    <Root>\n      { /* <Hero /> */ }\n      <MainHeader />\n\n      <Features features={site.features} />\n      <Newsitems newsitems={site.newsitems} />\n    </Root>\n    <IonLoading\n      isOpen={loading}\n      onDidDismiss={() => setLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n  </F>\n}\n\nexport default SitesShow\n","import { IonPage, IonLoading, IonContent } from '@ionic/react'\nimport React, { Fragment as F, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, useApi, } from \"$shared\"\nimport { Features } from \"./\"\nimport {\n  BottomDrawer,\n  MainHeader, Menu, MenuBottom, MenuLeft,\n  UnlockModal\n} from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\n\nconst _Hero = styled.div`\n  height: 370px;\n  text-align: center;\n\n  img {\n    max-width: 100%;\n  }\n`\nconst Hero = () => <_Hero><img className=\"image\" src=\"/assets/hero.png\" /></_Hero>\n\nconst Root = styled.div`\n  margin: 0;\n  padding-bottom: 1em;\n`\n\n// Currently a homepage, like a wp page.\nconst SitesShow1 = (props) => {\n  // logg(props, 'SitesShow1')\n\n  let [ site, setSite ] = useState({ features: [], newsitems: [] })\n  let [ artTag, setArtTag ] = useState({ features: [] })\n  let [ homeRow1Tag, setHomeRow1Tag ] = useState({ features: [] })\n  let [ interestingLocationsTag, setInterestingLocationsTag ] = useState({ features: [] })\n  let [ loading, setLoading ] = useState(false)\n\n\n  const api = useApi()\n  const mountedRef = useRef('init')\n\n  // loads all data\n  useEffect(() => {\n    // setLoading(true)\n\n    const fn = async () => {\n\n      if (!mountedRef.current) { return }\n      const data = await api.applicationHome()\n      logg(data, 'zeDataZ')\n      setSite(data)\n\n      // @TODO: this was here before, but not anymore. Check it out. _vp_ 2022-03-19\n\n      // api.getTag({ slug: 'interesting-locations' }).then(data => {\n      //   if (!mountedRef.current) { return null }\n      //   logg(data, 'setInterestingLocations')\n      //   setInterestingLocationsTag(data)\n      //   // setLoading(false)\n      // })\n\n      // api.getTag({ slug: 'home-row-1' }).then(data => {\n      //   if (!mountedRef.current) { return null }\n      //   setHomeRow1Tag(data)\n      // })\n\n      // api.getTag({ slug: 'art' }).then(data => {\n      //   if (!mountedRef.current) { return null }\n      //   setArtTag(data)\n      // })\n\n    }\n    fn()\n\n    return () => { mountedRef.current = false }\n  }, [])\n\n  return <F>\n    <Root>\n\n      <MainHeader />\n      { /* <Hero /> */ }\n\n      <Features features={interestingLocationsTag.features} label=\"Interesting Locations\" />\n      <Features features={homeRow1Tag.features} label=\"Interesting Tags\" />\n      <Features features={artTag.features} label=\"art\" />\n      <Newsitems newsitems={site.newsitems} />\n    </Root>\n    <IonLoading\n      isOpen={loading}\n      onDidDismiss={() => setLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n  </F>\n}\n\nexport default SitesShow1\n","import { IonPage, IonContent, IonIcon, IonLoading } from '@ionic/react';\nimport { Container, Grid, GridList } from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { useEffect, useState } from \"react\";\nimport styled from 'styled-components'\nimport config from \"config\";\n\nimport { useApi, logg, request } from \"$shared\";\n\nconst useStyles = makeStyles((theme) => ({\n\n  paper: {\n    padding: theme.spacing(2),\n    textAlign: 'center',\n    color: theme.palette.text.secondary,\n  },\n  redBorder: {\n    border: '1px solid red',\n  },\n  root: {\n    flexGrow: 1,\n    overflow: 'scroll',\n    height: '100vh',\n  },\n\n}));\n\nconst VideoItem = styled.div`\n  border-bottom: 1px solid red;\n`;\n\nconst Video = (props) => {\n  logg(props, 'Video');\n  const api = useApi()\n\n  const { item: video } = props;\n\n  return <VideoItem key={props.idx} >\n    <h5>Video {video.name}</h5>\n    <p>created {video.created_at}</p>\n    <video controls preload=\"metadata\" type=\"video/mp4\" src={video.video_url}\n      style={{ maxWidth: '500px', maxHeight: '90vh' }} ></video>\n  </VideoItem>;\n};\n\nconst Videos = () => {\n  logg(config, 'Videos component');\n  console.log(JSON.stringify(config));\n\n  const [videos, setVideos] = useState([]);\n\n  const jwtToken = localStorage.getItem(\"jwtToken\");\n\n  const classes = useStyles();\n  const api = useApi()\n\n  useEffect(() => {\n    logg('posting...');\n    request.post(api.myVideosPath, { jwtToken: jwtToken }).then(r => r.data\n      ).then(({ videos }) => {\n        logg(videos, 'data')\n        setVideos(videos);\n      })\n  }, []);\n\n  return <Container maxWidth=\"md\">\n    <Grid container className={classes.root} >\n      <Grid item xs={12} >\n        <h2>My Videos</h2>\n      </Grid>\n      <Grid item xs={12}>\n        { videos && videos.map((v, idx) => <Video key={idx} item={v} ></Video> ) }\n      </Grid>\n    </Grid>\n  </Container>;\n\n};\n\nexport default Videos;\n","\nimport { Container as _Container, } from '@material-ui/core'\nimport React, { Fragment as F, useEffect, useState } from 'react'\nimport {\n  Switch, BrowserRouter as Router, Redirect, Route as _Route,\n} from 'react-router-dom'\nimport { ToastContainer, toast } from 'react-toastify'\nimport 'react-toastify/dist/ReactToastify.css'\nimport styled from 'styled-components'\n\nimport config from \"config\"\nimport {\n  AuthContextProvider,\n} from 'ishlibjs'\n\nimport {\n  BottomDrawer,\n  UnlockModal,\n} from \"$components/application\"\nimport MapuiLayout from \"$components/application/MapuiLayout\"\nimport { CitiesList, CitiesShow } from \"$components/cities\"\n// @TODO: MyGalleries doesn't look right...\nimport { GalleriesShow, MyGalleries } from \"$components/galleries\"\nimport { LocationsShowDesktop } from \"$components/locations\"\nimport { ReportsShow } from \"$resources/reports\"\nimport SitesShow from '$components/sites/SitesShow1'\nimport {\n  Account,\n} from \"$components/users\"\nimport { Videos } from \"$components/videos\"\nimport {\n  C, CollapsibleContextProvider,\n  logg,\n  TwofoldContextProvider,\n  useApi,\n} from \"$shared\"\n\nimport '@ionic/react/css/core.css'\nimport '@ionic/react/css/normalize.css'\nimport '@ionic/react/css/structure.css'\nimport '@ionic/react/css/typography.css'\nimport '@ionic/react/css/padding.css'\nimport '@ionic/react/css/float-elements.css'\nimport '@ionic/react/css/text-alignment.css'\nimport '@ionic/react/css/text-transformation.css'\nimport '@ionic/react/css/flex-utils.css'\nimport '@ionic/react/css/display.css'\n\nimport './theme/variables.css'\n\n\nconst Root = styled.div`\n  // border: 1px solid #741741;\n\n  background: ${p => p.theme.colors.background};\n  height: 100vh;\n  overflow: auto;\n`;\n\n/**\n * AppDesktop\n**/\nconst AppDesktop = (props) => {\n  // logg(props, 'AppDesktop')\n  // const {} = props\n\n  const [ layout, setLayout ] = useState(C.layout_onecol)\n\n  const Container = (props) => {\n    switch(layout) {\n      case C.layout_onecol:\n        // main case\n        return <_Container maxWidth=\"md\" {...props} />\n      case C.layout_mapui:\n        return <MapuiLayout {...props} />\n    }\n  }\n\n  const Route = (props) => {\n    useEffect(() => {\n      if (props.layout) {\n        setLayout(props.layout)\n      } else {\n        setLayout(C.layout_onecol)\n      }\n    }, [props.layout])\n\n    return <_Route {...props} />\n  }\n\n  return (<Router>\n    <AuthContextProvider {...{ useApi, }} >\n      <TwofoldContextProvider {...props} {...{ layout, setLayout }} >\n        <CollapsibleContextProvider >\n          <Root>\n\n            <Container >\n              <Switch id=\"main\" main >\n\n                <Redirect exact from=\"/\" to={config.homeLocation} />\n                <Route exact path=\"/en\" ><SitesShow /></Route>\n\n                <Route exact path=\"/en/account\" component={Account} />\n                <Route exact path=\"/en/account/my/videos\" component={Videos} />\n                <Route exact path=\"/en/account/my/galleries\" component={MyGalleries} />\n\n                <Route exact path=\"/en/cities\"                 component={CitiesList} />\n                <Route       path=\"/en/cities/travel-to/:name\" component={CitiesShow} />\n\n                <Route exact path=\"/en/galleries/show/:slug\" component={GalleriesShow} />\n\n                <Route exact path=\"/en/reports/show/:slug\" component={ReportsShow} />\n\n                <Route exact path=\"/en/locations/show/:slug\" component={LocationsShowDesktop} layout={C.layout_mapui} />\n                <Route exact path=\"/en/locations/show/:slug/:item_type/show/:item_slug\" component={LocationsShowDesktop} layout={C.layout_mapui} />\n\n              </Switch>\n            </Container>\n          </Root>\n\n          <BottomDrawer />\n          <UnlockModal />\n          <ToastContainer />\n\n        </CollapsibleContextProvider>\n      </TwofoldContextProvider>\n    </AuthContextProvider>\n  </Router>)\n}\n\nexport default AppDesktop\n","import { Container as _Container, Grid, GridList } from '@material-ui/core'\n\nimport React, { Fragment as F, useContext, useEffect, useState } from 'react'\nimport Modal from \"react-modal\"\nimport {\n  Switch, BrowserRouter as Router, Redirect, Route as _Route,\n} from 'react-router-dom'\nimport styled, { useTheme } from 'styled-components'\nimport { ToastContainer, toast } from 'react-toastify'\n\nimport '@ionic/react/css/core.css'\nimport '@ionic/react/css/normalize.css'\nimport '@ionic/react/css/structure.css'\nimport '@ionic/react/css/typography.css'\nimport '@ionic/react/css/padding.css'\nimport '@ionic/react/css/float-elements.css'\nimport '@ionic/react/css/text-alignment.css'\nimport '@ionic/react/css/text-transformation.css'\nimport '@ionic/react/css/flex-utils.css'\nimport '@ionic/react/css/display.css'\nimport './theme/variables.css'\n\nimport config from \"config\"\nimport {\n  LoginModal,\n  RegisterModal,\n} from 'ishlibjs'\n\n\nimport { BottomDrawer, Menu, MenuBottom, MenuLeft, UnlockModal } from \"$components/application\"\nimport { MapuiMobileLayout } from \"$components/application\"\nimport { CitiesList, CitiesShow } from \"$components/cities\"\nimport { GalleriesShow } from \"$components/galleries\"\nimport { LocationsShowMobile } from \"$components/locations\"\nimport { ReportsShow } from \"$resources/reports\"\nimport { SitesShow } from '$components/sites'\nimport {\n  Account,\n} from \"$components/users\"\nimport { Videos } from \"$components/videos\"\nimport { Galleries, MyGalleries } from \"$components/galleries\"\nimport {\n  C, CollapsibleContextProvider,\n  logg,\n  TwofoldContext, TwofoldContextProvider,\n  useApi,\n} from \"$shared\"\n\nconst Root = styled.div`\n  background: ${p => p.theme.colors.background};\n  height: 100vh;\n  overflow: auto;\n`;\n\nconst __Container = styled(_Container)`\n  padding: 0;\n  height: 100vh;\n  overflow: scroll;\n`;\n\n/**\n * AppMobile\n */\nconst AppMobile = (props) => {\n  // logg(props, 'AppMobile')\n\n  const [ layout, setLayout ] = useState(C.layout_onecol)\n  // const [ bottomDrawerOpen, setBottomDrawerOpen ] = React.useState(false)\n  // const [ itemToUnlock, setItemToUnlock ] = React.useState(false)\n  // const [ zoom, setZoom ] = useState(1)\n  // const api = useApi()\n  const theme = useTheme()\n\n  // @TODO: move into its own component!\n  const Container = ({ children, ...props }) => {\n    // logg(props, 'Container')\n\n    const {\n      bottomDrawerOpen,\n    } = useContext(TwofoldContext)\n\n    const style = {\n      paddingBottom: bottomDrawerOpen ? theme.bottomDrawerOpenHeight : null\n    }\n\n    switch(layout) {\n      case C.layout_onecol:\n        return <__Container style={style} maxWidth=\"md\" {...props} >{ children }</__Container>\n      case C.layout_mapui:\n        // This is true right now (2021-10-20) for mobile even when it's one column\n        return <MapuiMobileLayout style={style} {...props} >{ children }</MapuiMobileLayout>\n    }\n  }\n\n  const Route = (props) => {\n    useEffect(() => {\n      if (props.layout) {\n        setLayout(props.layout)\n      } else {\n        setLayout(C.layout_onecol)\n      }\n    }, [props.layout])\n\n    return <_Route {...props} />\n  }\n\n  // const doUnlock = async () => {\n  //   // @TODO: check how many unlocks I have, and offer to purchase more if not enough.\n  //   const path = api.doUnlock({ kind: 'Report', id: itemToUnlock.report_id })\n  //   const result = await request.post(`${config.apiOrigin}${path}`)\n  //   logg(result, 'result of unlocking')\n  // }\n\n  return (<Router>\n    <TwofoldContextProvider {...props} {...{ layout, setLayout }} >\n      <CollapsibleContextProvider >\n        { layout === C.layout_onecol && <MenuLeft variant={C.variants.floating} /> }\n        <Root className=\"Root\" >\n\n          <Container className=\"Container\" >\n            <Switch id=\"main\" main >\n\n              <Redirect exact from=\"/\" to={config.homeLocation} />\n              <Route exact path=\"/en\" ><SitesShow /></Route>\n\n              <Route exact path=\"/en/account\" component={Account} />\n              <Route exact path=\"/en/account/my/videos\" component={Videos} />\n              <Route exact path=\"/en/account/my/galleries\" component={MyGalleries} />\n\n              <Route exact path=\"/en/cities\"                 component={CitiesList} />\n              <Route       path=\"/en/cities/travel-to/:name\" component={CitiesShow} />\n\n              <Route exact path=\"/en/galleries/show/:slug\" component={GalleriesShow} />\n\n              <Route exact path=\"/en/reports/show/:slug\" component={ReportsShow} />\n\n              <Route exact path=\"/en/locations/show/:slug\" component={LocationsShowMobile} layout={C.layout_mapui} />\n              <Route exact path=\"/en/locations/show/:slug/:item_type/show/:item_slug\" component={LocationsShowMobile} layout={C.layout_mapui} />\n\n            </Switch>\n          </Container>\n\n        </Root>\n\n        <BottomDrawer />\n        <UnlockModal />\n        <LoginModal />\n        <RegisterModal />\n        <ToastContainer />\n\n      </CollapsibleContextProvider>\n    </TwofoldContextProvider>\n  </Router>)\n}\n\nexport default AppMobile\n","\nimport { Device } from '@capacitor/device'\nimport React, { useContext, useEffect, useRef, useState, } from 'react'\nimport { ThemeProvider } from 'styled-components'\n\nimport config from 'config'\nimport 'ishlibjs/dist/index.css'\n\nimport { C, logg, request, S, useApi } from \"$shared\"\nimport AppDesktop from './AppDesktop'\nimport AppMobile from './AppMobile'\n\n\n/**\n * Choses mobile vs desktop\n */\nconst AppWrapper = (props) => {\n  // logg(props, 'AppWrapper')\n\n  const [ os, setOs ] = useState(null)\n  // info.operatingSystem === 'ios' || 'android'\n  const fn = async () => {\n    let info = await Device.getInfo()\n    setOs(info.operatingSystem)\n  }\n  fn()\n\n  const [theme, setTheme] = useState(window.localStorage.getItem(C.theme) || C.themes.light)\n  const toggleTheme = (e) => {\n    if (theme === C.themes.light) {\n      window.localStorage.setItem(C.theme, C.themes.dark)\n      setTheme(C.themes.dark)\n    } else {\n      window.localStorage.setItem(C.theme, C.themes.light)\n      setTheme(C.themes.light)\n    }\n  }\n\n  const childProps = {\n    theme, toggleTheme,\n  }\n\n  if (!os) { return null }\n  return <ThemeProvider theme={theme == C.themes.light ? S.lightTheme: S.darkTheme} >\n    { \"ios android\".includes(os) ?\n      <AppMobile {...childProps} />\n      : <AppDesktop {...childProps} /> }\n  </ThemeProvider>\n}\n\nexport default AppWrapper\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport AppWrapper from './AppWrapper'\nimport * as serviceWorker from './serviceWorker'\nimport {\n  Link, Switch, BrowserRouter as Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\n\nReactDOM.render(<AppWrapper />, document.getElementById('root'))\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n\n\n\n"],"sourceRoot":""}