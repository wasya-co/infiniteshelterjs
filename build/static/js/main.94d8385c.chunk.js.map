{"version":3,"sources":["../config/environments/production_ish/config.js","components/application/45x45_day-night-2.png","../node_modules/@ionic/core/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","../node_modules/ionicons/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","shared/C.jsx","shared/Api.jsx","components/TwofoldLayout/index.jsx","components/application/BottomDrawer.jsx","components/application/MainHeader.jsx","components/application/MapuiLayout.jsx","components/application/MapuiMobileLayout.jsx","components/application/Menu.jsx","components/application/MenuLeft.jsx","components/application/Metaline.jsx","components/application/Rating.jsx","components/application/UnlockModal.jsx","components/users/Account.jsx","components/users/LoginModal.jsx","components/users/MyAccountWidget.jsx","components/users/RegisterModal.jsx","components/users/index.jsx","shared/AppMock.jsx","shared/AppRouter.jsx","shared/Collapsible.jsx","shared/request.jsx","shared/S.jsx","shared/TwofoldContext.jsx","shared/useWindowSize.jsx","shared/index.jsx","components/cities/CitiesList.jsx","components/newsitems/NewsitemGallery.jsx","components/newsitems/NewsitemPhoto.jsx","components/newsitems/NewsitemReport.jsx","components/newsitems/NewsitemVideo.jsx","components/newsitems/Newsitems.jsx","components/newsitems/NewsitemContainer.jsx","components/newsitems/ItemIcon.jsx","components/newsitems/index.js","components/venues/Venues.jsx","components/cities/CitiesShow.jsx","components/galleries/GalleriesShow.jsx","components/galleries/MyGalleries.jsx","components/locations/Breadcrumbs.jsx","components/reports/ReportsShow.jsx","components/locations/ItemModal.jsx","components/locations/LocationsShowDesktop.jsx","components/locations/LocationsShowMobile.jsx","components/locations/MapPanel.jsx","components/locations/MapPanelNoZoom.jsx","components/locations/MarkersList.jsx","components/locations/RatedRestrictionModal.jsx","components/locations3/Crosshair.jsx","components/locations3/PointerLockControls.js","components/locations3/Equirectangular.jsx","components/locations3/TouchControls.jsx","components/locations3/RotationPad.jsx","components/locations3/Equirectangular2.jsx","components/locations3/Equirectangular4.jsx","components/locations3/ThreePanelV1.jsx","components/locations3/ThreePanelV2.jsx","components/locations3/ThreePanelV3.jsx","components/locations3/ThreePanelV4.jsx","components/locations/WrappedMapPanel.jsx","components/locations/ZoomCtrl.jsx","components/sites/Features.jsx","components/sites/SitesShow.jsx","components/sites/SitesShow1.jsx","components/videos/Videos.jsx","AppDesktop.jsx","AppMobile.jsx","AppWrapper.jsx","serviceWorker.js","index.jsx"],"names":["module","exports","map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","keys","Object","C","anonUser","bottomDrawerOpen","collapsible","description","extra1","extra2","extra3","markers","collapsibles","current_user","foldedCenter","foldedLeft","foldedRight","horizontal","item_types","gallery","report","photo","video","jwt_token","layout_onecol","layout_mapui","locations","earth","map_panel_types","Equirectangular","MapPanel","MapPanelNoZoom","ThreePanelV1","ThreePanelV4","rated","nc17","ratedConfirmation","theme","themes","dark","light","twofoldPercent","variants","bordered","floating","inline","transparent","vertical","useApi","useContext","TwofoldContext","token","currentUser","setCurrentUser","localStorage","getItem","doRegister","email","password","request","post","config","apiOrigin","r","data","logg","doUnlock","kind","path","getCities","get","getCity","slug","getGallery","getMyAccount","getPayments","getReport","getTag","tag","loginPath","longTermTokenPath","myVideosPath","applicationHome","domain","params","LongLine","styled","div","p","thinBorder","thinBorderRadius","orientation","colors","background","propTypes","PropTypes","string","Drawer","_Drawer","getLibrary","provider","Web3","Inner0","text","Inner1","bottomDrawerOpenHeight","borderHeight","borderWidth","Inner2","cardBackground","WClosed","BottomDrawer","props","layout","setBottomDrawerOpen","IconButton","aria-label","onClick","MenuIcon","fontSize","anchor","elevation","open","onClose","BackdropProps","invisible","variant","style","paddingRight","Header","Root","MainHeader","MapuiContainer","bottomDrawerHeight","MapuiLayout","bottomDrawerClosedHeight","MapuiMobileLayout","S","newspaperOutline","bus","person","powerOutline","W1","MenuLeft","React","useState","drawerOpen","setDrawerOpen","history","useHistory","Fab","position","top","left","margin","List","ListItem","button","key","push","homeLocation","bookmarks","b","idx","name","W","withRouter","created_at","username","city","tags","className","pp_date","i","Rating","rate","rating","setRating","iconMapping","0","starOutline","1","starHalf","2","star","useEffect","Array","fill","icon","Btn0","BtnRow","modalStyle","overlay","content","maxWidth","UnlockModal","itemToUnlock","setItemToUnlock","setLoginModalOpen","loginModalOpen","setPurchaseModalIsOpen","purchaseModalIsOpen","setRatedConfirmation","api","a","item_type","closable","cost","premium_tier","ariaHideApp","isOpen","n_unlocks","Btn","isPushNotificationsAvailable","Capacitor","isPluginAvailable","greeterAddress","tokenAddress","LoginRow","Account","greeting","setGreetingValue","notifications","setNotifications","scratchpad","setScratchpad","register","PushNotifications","addListener","showToast","error","alert","JSON","stringify","_n","n","logg2","ns","type","nofitication","msg","Toast","show","requestAccount","window","ethereum","method","fetchGreeting","ethers","providers","Web3Provider","contract","Contract","Greeter","abi","greet","console","log","account","Token","balanceOf","balance","toString","signer","getSigner","setGreeting","transaction","wait","transfer","userAccount","amount","transation","checkPermissions","res","receive","requestPermissions","Grid","container","spacing","item","xs","src","alt","value","onChange","target","placeholder","setUserAccount","setAmount","to","length","notif","title","body","color","expand","LoginModal","zIndex","BuyBtn","span","Cell","_Img","Img","stripePromise","InjectedConnector","loadStripe","Login","setRegisterModalIsOpen","s","default","state","setState","login","RegisterWithEmail","LoginWithEmail","W0","MyAccountWidget","stripe","useStripe","elements","useElements","avatar","setAvatar","handleSubmit","event","preventDefault","getElement","CardElement","client_secret","confirmCardPayment","payment_method","card","result","message","paymentIntent","status","response","useWeb3React","active","deactivate","library","connector","activate","ex","myBodies","bodyNFT","tokensOfOwner","tokenURI","image","profile_photo_url","onSubmit","disabled","WrappedMyAccountWidget","RegisterModal","registerModalIsOpen","setEmail","setPassword","password2","setPassword2","toast","setItem","for","FlexRow","FacebookLogin","Plugins","FACEBOOK_PERMISSIONS","FbLogin","doFbLogin","permissions","accessToken","resp","err","FbLogin2","Logout","removeItem","_W","PasswordLogin","doPasswordLogin","onKeyDown","PasswordRegisterMobile","passwordConfirm","setPasswordConfirm","doPasswordRegister","PasswordLoginMobile","AppRouter","cityVenuesPath","cityPath","Gt","Inner","Label","WTransparent","children","WBordered","Collapsible","ctx","CollapsibleContext","setCollapsibles","label","shape","bool","isRequired","settings","baseURL","axios","create","breadcrumbsHeight","thinBorderWidth","lightTheme","blue","darkGrey","lightGrey","red","border","darkTheme","createContext","TwofoldContextProvider","setLayout","toggleTheme","zoom","setZoom","parse","_setBottomDrawerOpen","localCurrentUser","setLocalCurrentUser","mountedRef","useRef","current","fn","closure","setTimeout","clearTimeout","is_purchasing","folded","setFolded","_itemToUnlock","_setItemToUnlock","tmp","location","setLocation","mapPanelWidth","setMapPanelWidth","mapPanelHeight","setMapPanelHeight","_setRatedConfirmation","showItem","setShowItem","showUrl","setShowUrl","setTwofoldPercent","localZoom","setLocalZoom","Provider","m","which","useWindowSize","size","setSize","useLayoutEffect","updateSize","innerWidth","innerHeight","addEventListener","removeEventListener","BackIcon","IonIcon","BackBtn","goBack","arrowBack","ChevronLeft","_ChevronLeft","ChevronRight","_ChevronRight","Card","_Box","cursor","CollapsibleContextProvider","defaultCollapsibles","descr","_setCollapsibles","_FlexCol","FlexCol","inflector","slice","ms","split","charAt","toUpperCase","join","toLowerCase","_Circle","Loading","c","replace","_MenuIcon","PurchasedIcon","d","substring","_WBorderedItem","WBorderedItem","WidgetContainer","Wrapper","Counts","Count","_IonIcon","Number","Cities","cities","setCities","filteredCities","setFilteredCities","showLoading","setShowLoading","ev","filter","indexOf","trim","funnel","bookmark","n_reports","n_galleries","n_videos","videocam","onDidDismiss","duration","Images","ImageLarge","img","ImageThumb1","ImageThumb2","NewsitemGallery","photos","thumb_url","array","NewsitemPhoto","large_url","NewsitemReport","object","NewsitemVideo","display","justifyContent","youtube_id","width","height","frameBorder","allow","allowFullScreen","maxHeight","preload","controls","url","Newsitems","newsitems","newsitem","Col","Row","Title","h2","navigateToItem","boxShadow","NewsitemContainer","is_premium","is_purchased","dangerouslySetInnerHTML","__html","subhead","ItemIcon","useTheme","number","GenericNewsitem","Address","_Ra","RightArrow","Venue","Venues","venues","filteredVenues","setFilteredVenues","venue","includes","address","CitiesShow","match","thisPath","useLocation","setCity","backgroundImage","hero_img","backgroundSize","pin","pathname","exact","render","GalleriesShow","setGallery","ph","MyGalleries","galleries","setGalleries","g","B0","B1","WDayNight","T0","DayNightToggle2","rotating","setRotating","debug","WBreadcrumbs","Breadcrumbs","breadcrumbs","out","textDecoration","arrayOf","ReportsShow","Fabs","ItemModal","reportname","_D","Description","WH","Handle","w","offsetX","setOffsetX","dragging","setDragging","onMouseUp","onMouseMove","clientX","movedBy","movedByPercent","prev","onMouseDown","pageX","onMouseLeave","pointer","IframeModal","scrolling","allowtransparency","Left","Right","LocationsShowDesktop","windowWidth","windowHeight","loading","setLoading","setMarkers","mapPanelRef","offsetWidth","offsetHeight","itemType","item_slug","ref","labels","_Description","LocationsShowMobile","map_panel_type","withZoom","Div1","ZoomCtrl","right","padding","flexDirection","div1Ref","scroll","behavior","y","centerOffsetY","x","centerOffsetX","img_path","h","nextZoomByWidth","nextZoomByHeight","nextZoom","Math","min","_Marker","Marker","MarkersList","goto","title_img_path","RatedRestrictionModal","Crosshair","_euler","Euler","_vector","Vector3","_changeEvent","_lockEvent","_unlockEvent","_PI_2","PI","PointerLockControls","camera","domElement","undefined","warn","document","isLocked","minPolarAngle","maxPolarAngle","scope","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","setFromQuaternion","quaternion","max","setFromEuler","dispatchEvent","onPointerlockChange","ownerDocument","pointerLockElement","onPointerlockError","connect","disconnect","dispose","this","getObject","getDirection","direction","v","copy","applyQuaternion","moveForward","distance","setFromMatrixColumn","matrix","crossVectors","up","addScaledVector","moveRight","lock","requestPointerLock","unlock","exitPointerLock","EventDispatcher","TouchControls","options","THREE","RotationPad","self","$","extend","speedFactor","delta","rotationFactor","maxPitch","hitTest","hitTestDistance","isRightMouseDown","rotationMatrices","hitObjects","moveBackward","moveLeft","lockMoveForward","lockMoveBackward","lockMoveLeft","lockMoveRight","ztouch","xtouch","velocity","cameraHolder","Object3D","calculateCameraRotation","dx","dy","factor","ry","fpsBody","rotation","rx","add","scene","enabled","mouse","Vector2","rotationPad","on","detail","deltaX","deltaY","setRotation","movementPad","MovementPad","abs","middle","stopPropagation","keyCode","clientY","originalEvent","rotationMatrixF","Matrix4","makeRotationY","rotationMatrixB","rotationMatrixL","rotationMatrixR","prepareRotationMatrices","update","z","translateX","translateY","translateZ","unlockAllDirections","index","cameraDirection","getDirection2","clone","applyMatrix4","intersects","Raycaster","intersectObject","getObjectByName","set","applyEuler","boolean","prototype","addToScene","setPosition","stopMouseMoving","camHolder","getHitObjects","eventRepeatTimeout","newLeft","newTop","angle","mouseDown","handleRef","handleEl","regionRef","regionEl","regionData","handleData","resetHandlePosition","animate","centerY","radius","centerX","opacity","pageY","offset","pow","atan2","cos","sin","round","css","parseInt","sendEvent","moveEvent","Event","bubbles","trigger","targetTouches","touches","Blocker","Equirectangular2","renderer","texture","markerObjects","blockerRef","wContainerRef","instructionsRef","fog","canJump","axes","wContainer","floorGeometry","rotateX","loadTexture","wrapS","wrapT","repeat","floorMaterial","floor","textureLoader","assetPath","load","rt","fromEquirectangularTexture","antialias","setPixelRatio","devicePixelRatio","clientWidth","clientHeight","appendChild","onWindowResize","init","prevTime","performance","now","canvas","needResize","resizeRendererToDisplaySize","aspect","updateProjectionMatrix","requestAnimationFrame","time","intersections","intersectObjects","onObject","normalize","Loc","raycaster","objects","attributes","l","count","vertex","fromBufferAttribute","random","setXYZ","toNonIndexed","colorsFloor","setHSL","setAttribute","vertexColors","manager","traverse","child","isMesh","material","geometry","scale","onProgress","loaded","total","OBJLoader","obj","xhr","lengthComputable","percentComplete","cube","ray","origin","markerObjectsIdxs","pMat","uniforms","main_color","border_color","thickness","center","vertexShader","fragmentShader","texturePath","modelPath","modelPath2","onError","mtlLoader","MTLLoader","setPath","materials","objLoader","setMaterials","uuid","loader","glow","removedObject","modelName","wrappedOnLoad","remove","_pickedObject","parent","marker","WrappedMapPanel","forwardRef","Equirectangular4","ThreePanelV2","ThreePanelV3","Features","features","f","inner_html","sm","marginBottom","SitesShow","site","setSite","SitesShow1","artTag","homeRow1Tag","interestingLocationsTag","useStyles","makeStyles","paper","textAlign","palette","secondary","redBorder","root","flexGrow","overflow","VideoItem","Video","video_url","Videos","videos","setVideos","jwtToken","classes","AppDesktop","Container","Route","main","from","component","CitiesList","__Container","_Container","AppMobile","paddingBottom","AppWrapper","os","setOs","Device","getInfo","info","operatingSystem","setTheme","childProps","Boolean","hostname","ReactDOM","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"k1nBACAA,EAAOC,QAAU,CACf,UAAa,+BACb,aAAgB,YAEhB,OAAU,mBAEV,aAAgB,0BAEhB,cAAgB,I,uh0DCTlBD,EAAOC,QAAU,k/H,0DCAjB,IAAIC,EAAM,CACT,8BAA+B,CAC9B,IACA,GAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,GAED,0BAA2B,CAC1B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,sBAAuB,CACtB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,qBAAsB,CACrB,IACA,IAED,mCAAoC,CACnC,IACA,IAED,uBAAwB,CACvB,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,IAED,yBAA0B,CACzB,IACA,GAED,8BAA+B,CAC9B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,sBAAuB,CACtB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,gCAAiC,CAChC,IACA,KAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WAC7B,IAAI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","file":"static/js/main.94d8385c.chunk.js","sourcesContent":["\nmodule.exports = {\n  \"apiOrigin\": \"https://manager.piousbox.com\",\n  \"appIndexPath\": \"src/index\", // @TODO: remove\n\n  \"domain\": \"tgm.piousbox.com\", // required! 20210831\n\n  \"homeLocation\": \"/en/locations/show/root\",\n\n  \"requireLogin\": false,\n};\n","module.exports = \"data:image/png;base64,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\"","var map = {\n\t\"./ion-action-sheet.entry.js\": [\n\t\t801,\n\t\t5\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t802,\n\t\t6\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t803,\n\t\t7\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t804,\n\t\t17\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t805,\n\t\t18\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t806,\n\t\t46\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t807,\n\t\t19\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t808,\n\t\t20\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t809,\n\t\t21\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t810,\n\t\t22\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t811,\n\t\t47\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t812,\n\t\t10\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t813,\n\t\t23\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t814,\n\t\t48\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t815,\n\t\t49\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t816,\n\t\t24\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t817,\n\t\t25\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t818,\n\t\t26\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t819,\n\t\t27\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t820,\n\t\t28\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t821,\n\t\t8\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t822,\n\t\t14\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t823,\n\t\t9\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t824,\n\t\t29\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t825,\n\t\t30\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t826,\n\t\t31\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t827,\n\t\t11\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t828,\n\t\t16\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t829,\n\t\t50\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t830,\n\t\t32\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t831,\n\t\t33\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t832,\n\t\t34\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t833,\n\t\t35\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t834,\n\t\t51\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t835,\n\t\t13\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t836,\n\t\t52\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t837,\n\t\t36\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t838,\n\t\t15\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t839,\n\t\t37\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t840,\n\t\t38\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t841,\n\t\t39\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t842,\n\t\t12\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t843,\n\t\t53\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 409;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t844,\n\t\t60\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 411;\nmodule.exports = webpackAsyncContext;","\n/**\n * Constants\n */\nconst C = {\n\n  // A\n  anonUser: {}, // as opposed to null\n\n  // B\n  bottomDrawerOpen: 'bottom-drawer-open', // localStorage\n\n  // C\n  collapsible: {\n    description: \"descr-sec\",\n    extra1: \"extra1-sec\",\n    extra2: \"extra2-sec\",\n    extra3: \"extra3-sec\",\n    map: \"map-sec\",\n    markers: \"markers-sec\",\n  },\n  collapsibles: 'collapsibles', // localStorage\n  current_user: 'current_user',\n\n  // F\n  foldedCenter: 'folded-center',\n  foldedLeft: 'folded-left', // twofoldContext\n  foldedRight: 'folded-right',\n\n  // H\n  horizontal: 'horizontal',\n\n  // I\n  item_types: {\n    gallery: 'Gallery',\n    report: 'Report',\n    photo: 'Photo',\n    video: 'Video',\n  },\n\n  // J\n  jwt_token: 'jwt_token',\n\n  // L\n  layout_onecol: 'onecol',\n  layout_mapui: 'mapui',\n  locations: {\n    earth: 'earth',\n  },\n\n  // M\n  map_panel_types: {\n    Equirectangular: \"Equirectangular\",\n    MapPanel: \"MapPanel\",\n    MapPanelNoZoom: \"MapPanelNoZoom\",\n    ThreePanelV1: \"ThreePanelV1\",\n    ThreePanelV4: \"ThreePanelV4\",\n  },\n\n  // R\n  rated: {\n    nc17: 'nc-17',\n  },\n  ratedConfirmation: 'rated-confirmation', // localStorage\n\n  // T\n  theme: 'theme',\n  themes: {\n    dark: 'dark',\n    light: 'light',\n  },\n  twofoldPercent: 'twofold-percent', // localStorage\n\n  // V\n  variants: {\n    bordered: 'bordered', // for Newsitems\n    floating: 'floating', // for main-menu btn\n    inline: 'inline',     // for main-menu btn\n    transparent: 'transparent', // for markers on Right\n  },\n  vertical: 'vertical',\n}\nexport default C\n","import React, { useContext } from 'react'\n\nimport config from \"config\"\nimport { C,\n  logg, // eslint-disable-line no-unused-vars\nrequest, TwofoldContext } from \"$shared\"\n\nconst useApi = () => {\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  const token = localStorage.getItem(C.jwt_token)\n\n  return {\n\n    doRegister: ({email, password }) => {\n      return request.post(`${config.apiOrigin}/api/users`, { email, password }).then((r) => r.data).then((r) => {\n        logg(r, 'done registered')\n        return r\n      })\n    },\n\n    /* Returns current user */\n    doUnlock: ({ kind, id }) => {\n      const jwt_token = localStorage.getItem('jwt_token')\n      const path = `/api/payments/unlock?kind=${kind}&id=${id}&jwt_token=${jwt_token}`\n      return request.post(`${config.apiOrigin}${path}`).then((r) => r.data)\n    },\n\n    getCities: ()   => request.get(`${config.apiOrigin}/api/cities`).then((r) => r.data),\n    getCity: (slug) => request.get(`${config.apiOrigin}/api/cities/view/${slug}`),\n    getGallery: (slug) => request.get(`${config.apiOrigin}/api/galleries/view/${slug}?jwt_token=${token}`).then((r) => r.data.gallery),\n\n    getMyAccount: () => request.post(`/api/my/account`, { jwt_token: token, }).then((r) => r.data),\n\n    getPayments: () => request.get(`${config.apiOrigin}/api/payments2?jwt_token=${token}`).then((r) => r.data),\n\n    getReport: (slug) => request.get(`${config.apiOrigin}/api/reports/view/${slug}?jwt_token=${token}`).then((r) => r.data.report),\n\n    getTag: (tag) => request.get(`${config.apiOrigin}/api/tags/view/${tag.slug}`).then((r) => r.data),\n\n    loginPath: '/api/users/login.json',\n    longTermTokenPath: '/api/users/long_term_token',\n\n    myVideosPath: \"/api/my/videos\", // @TODO: remove\n\n    applicationHome: () => {\n      request.get(`${config.apiOrigin}/api/sites/view/${config.domain}`, { params: { jwt_token: token } }).then((r) => {\n        return r.data\n      })\n    }\n  }\n\n}\n\nexport default useApi\n","/*\n * components / TwofoldLayout / index.jsx\n */\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\n\nimport { C, logg } from \"$shared\"\n\n/**\n * LongLine\n * @TODO: remove this, probably. Or at least move it.\n */\nconst LongLine = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n\n  flex-grow: 1;\n\n  width: ${p => p.orientation === C.horizontal ? 'auto' : '10px'};\n  height: ${p => p.orientation === C.horizontal ? '10px' : 'auto'};\n\n  padding: 2px;\n  background: ${p => p.theme.colors.background};\n`;\nLongLine.propTypes = {\n  orientation: PropTypes.string,\n}\n\nexport { LongLine }\n","\nimport _Drawer from '@material-ui/core/Drawer'\nimport IconButton from '@material-ui/core/IconButton'\nimport React, { Fragment as F, useContext, useState } from 'react'\nimport styled from 'styled-components'\nimport Web3 from 'web3'\nimport { useWeb3React, Web3ReactProvider } from \"@web3-react/core\"\nimport { InjectedConnector } from '@web3-react/injected-connector'\n\nimport { C, logg, MenuIcon, S, TwofoldContext, } from \"$shared\"\nimport { LongLine } from \"$components/TwofoldLayout\"\nimport { MyAccountWidget } from \"$components/users\"\n\n\nconst Drawer = styled(_Drawer)`\n  .MuiDrawer-paper {\n    // border: 1px solid cyan;\n\n    background: ${p=>p.theme.colors.background};\n  }\n\n  .MuiDrawer-paperAnchorDockedBottom {\n    border-top: 0;\n  }\n\n`;\n\nfunction getLibrary(provider) {\n  return new Web3(provider)\n}\n\nconst Inner0 = styled.div`\n  display: flex;\n  align-items: flex-start;\n  color: ${p => p.theme.colors.text};\n`;\n\nconst Inner1 = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n\n  background: ${p=>p.theme.colors.background};\n  height: calc(${p=>p.theme.bottomDrawerOpenHeight} + 1*${p=>p.theme.borderHeight});\n  margin: ${p=>p.theme.borderWidth};\n\n  flex-grow: 1;\n`;\n\n// TODO: I may not need this\nconst Inner2 = styled.div`\n  // border: 1px solid green;\n\n  background: ${p=>p.theme.colors.cardBackground};\n  height: 100px;\n  display: flex;\n`;\n\nconst WClosed = styled.div`\n  // border: 1px solid yellow;\n\n  position: absolute;\n  bottom: -10px;\n  // left: 10px;\n\n  width: calc(100% - 2*${p=>p.theme.borderWidth});\n\n  display: flex;\n  align-items: center;\n`;\n\n/**\n * BottomDrawer\n */\nconst BottomDrawer = (props) => {\n  // logg(props, 'BottomDrawer')\n\n  const { bottomDrawerOpen, layout, setBottomDrawerOpen } = useContext(TwofoldContext)\n\n  // @TODO: move the component to layout_onecol then\n  if (layout === C.layout_onecol) { return null; }\n\n  return <F>\n\n    <WClosed>\n      <IconButton\n        aria-label=\"open drawer\"\n        onClick={() => setBottomDrawerOpen(true)}\n      ><MenuIcon\n        fontSize=\"small\"\n      /></IconButton>\n      <LongLine orientation={C.horizontal} />\n    </WClosed>\n\n\n    <Drawer anchor={\"bottom\"}\n      elevation={1}\n      open={bottomDrawerOpen}\n      onClose={() => setBottomDrawerOpen(false)}\n      BackdropProps={{ invisible: true }}\n      variant={\"persistent\"}\n    >\n      <Inner0 >\n        <IconButton\n          aria-label=\"open drawer\"\n          onClick={() => setBottomDrawerOpen(false)}\n          style={{ paddingRight: 0 }}\n        ><MenuIcon\n          fontSize=\"small\"\n        /></IconButton>\n\n        <Inner1 >\n          <Inner2 >\n\n            {/* @TODO: move this upstream */}\n            <Web3ReactProvider getLibrary={getLibrary}>\n              <MyAccountWidget />\n            </Web3ReactProvider>\n\n          </Inner2>\n        </Inner1>\n      </Inner0>\n    </Drawer>\n  </F>\n}\n\nexport default BottomDrawer\n","import React from 'react'\nimport styled from 'styled-components'\n\nimport { logg, C, } from \"$shared\"\nimport { MenuLeft, } from \"$components/application\"\n\nconst Header = styled.div`\n  // border: 1px solid red;\n\n  flex-grow: 1;\n\n  text-align: center;\n  font-size: 2em;\n\n\n`;\n\nconst Root = styled.div`\n  // border: 1px solid blue;\n\n  display: flex;\n  justify-content: center;\n  line-height: 2em;\n  padding: 2em 0;\n`;\n\nconst MainHeader = (props) => {\n  // logg(props, 'MainMenu')\n\n  return <Root>\n    <MenuLeft variant={C.variants.inline} />\n    <Header>My Local Guide</Header>\n  </Root>\n}\n\nexport default MainHeader\n","\nimport React from 'react'\nimport styled from 'styled-components'\n\nconst MapuiContainer = styled.div`\n  // border: 1px solid purple;\n\n  background: white;\n\n  overflow: hidden;\n  margin: 10px;\n  height: calc(100vh - ${p => p.borderWidth*2}px - ${p => p.bottomDrawerOpen ? `${p.bottomDrawerHeight - p.borderWidth/2}px` : '0px' });\n`\n\nexport {\n  MapuiContainer,\n}\n\nconst MapuiLayout = (props) => {\n  return <MapuiContainer {...props} />\n}\n\nexport default MapuiLayout\n","\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, request, S, TwofoldContext, ZoomContext } from \"$shared\"\n\nconst MapuiContainer = styled.div`\n  // border: 1px solid cyan;\n  // background: white;\n\n  overflow-y: auto;\n\n  height: calc(100vh\n    - ${p => p.bottomDrawerOpen ? p.bottomDrawerOpenHeight : p.bottomDrawerClosedHeight });\n`;\n\nexport {\n  MapuiContainer,\n}\n\nconst MapuiMobileLayout = (props) => {\n  const { bottomDrawerOpen } = useContext(TwofoldContext)\n  return <MapuiContainer {...props} {...{ bottomDrawerOpen }} {...S} />\n}\n\nexport default MapuiMobileLayout\n","import {\n  IonContent,\n  IonIcon,\n  IonItem,\n  IonLabel,\n  IonList,\n  IonMenu,\n  IonMenuToggle,\n  IonHeader,\n  IonToolbar,\n  IonTitle,\n} from '@ionic/react';\n\nimport React from 'react';\nimport { newspaperOutline, bus, person, powerOutline } from 'ionicons/icons';\nimport './application.scss';\n\nconst appPages = [\n  {\n    title: 'Homefeed',\n    icon: newspaperOutline,\n    url: \"/en\"\n  },\n  {\n    title: 'Cities',\n    icon: bus,\n    url: \"/en/cities\"\n  },\n  {\n    title: 'My Account',\n    icon: person,\n    url: \"/en/account\"\n  },\n  {\n    title: 'Account2',\n    icon: person,\n    url: \"/en/account2\"\n  },\n  {\n    title: 'Login',\n    icon: powerOutline\n  }\n];\n\n/**\n * 20210529 - I think this is obsolete somehow, I'm using MyDrawer in App.jsx\n *\n */\nconst Menu = () => {\n  return (\n    <IonMenu contentId=\"main\" type=\"overlay\">\n      <IonHeader>\n        <IonToolbar color=\"primary\">\n          <IonTitle>Menu</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent>\n        <img src=\"/assets/hero.png\" />\n        <IonList id=\"inbox-list\">\n          { appPages.map((appPage, index) => <IonMenuToggle key={index} autoHide={false}>\n            <IonItem\n              routerLink={appPage.url}\n              routerDirection=\"none\"\n              lines=\"none\"\n              detail={false}>\n              <IonIcon\n                slot=\"start\"\n                ios={appPage.icon}\n                md={appPage.icon} />\n              <IonLabel>{appPage.title}</IonLabel>\n            </IonItem>\n          </IonMenuToggle>) }\n        </IonList>\n      </IonContent>\n    </IonMenu>\n  )\n}\n\nexport default Menu\n","import { IonApp, IonButtons, IonMenuButton } from '@ionic/react'\nimport Drawer from '@material-ui/core/Drawer'\nimport Fab from '@material-ui/core/Fab'\nimport IconButton from '@material-ui/core/IconButton'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport { Menu } from \"$components/application\"\nimport { Api, C, Debug, logg, MenuIcon, TwofoldContext, } from \"$shared\"\n\nconst _LeftWrapper = styled.div`\n  // border: 1px solid green;\n`;\n\nconst W1 = styled.div`\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  align-content: space-between;\n`;\n\nconst W2 = styled.div`\n`;\n\nconst MenuLeft= (props) => {\n  // logg(props, 'MenuLeft')\n\n  const [ drawerOpen, setDrawerOpen ] = React.useState(false)\n  const [ loading, setLoading ] = useState(false)\n  const history = useHistory()\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  return <F>\n\n    { /* <Menu /> */ }\n\n    { /* @TODO: probably remove from here, too many variations of the button, it gotta be separate */ }\n    { props.variant === C.variants.floating ?\n      <Fab onClick={() => setDrawerOpen(true)} style={{ position: 'absolute', top: 0, left: 0, margin: '.5em' }} aria-label='main menu'><MenuIcon /></Fab>\n      : <MenuIcon onClick={() => setDrawerOpen(true)} /> }\n\n    <Drawer anchor={\"left\"} open={drawerOpen} onClose={() => setDrawerOpen(false)} >\n      <W1>\n        <List>\n\n          <ListItem button key={'newsfeed'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(config.homeLocation)\n            } } >Home\n          </ListItem>\n\n          { /* <ListItem button key={'three'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/locations/show/threev1\")\n            } } >Three\n          </ListItem>\n\n          <ListItem button key={'three'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/locations/show/construct03d\")\n            } } >Construct0 3D\n          </ListItem>\n\n          <ListItem button key={'cities'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/cities\")\n            } }>\n            <span >Cities</span>\n          </ListItem>\n\n          <ListItem button key={'map 1'} >\n            <span onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/locations\")\n            } }>The Directory</span>\n          </ListItem> */ }\n\n          { currentUser && currentUser.bookmarks?.map((b, idx) =>\n            <ListItem button key={idx}\n              onClick={() => {\n                setDrawerOpen(false)\n                history.push(`/en/locations/show/${b.slug}`)\n              } } >\n              <span >{b.name}</span>\n            </ListItem>\n          ) }\n\n          <ListItem button key={'account'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/account\")\n            } } >\n            <span >Account</span>\n          </ListItem>\n\n        </List>\n        { /* <W2>\n          { loading && 'Loading...' }\n          { currentUser && <F>\n            {currentUser.email}<br />\n            {currentUser.n_stars}<br />\n            some action\n          </F> }\n        </W2> */ }\n      </W1>\n    </Drawer>\n  </F>\n}\n\nMenuLeft.propTypes = {\n  variant: PropTypes.string,\n}\nexport default MenuLeft\n","import React from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport \"./application.scss\";\nimport styled from 'styled-components'\n\nimport { Api, logg, request, pp_date } from \"$shared\"\n\nconst W = styled.div`\n  margin: .5em 0;\n  color: ${p=>p.theme.colors.text};\n`\n\nconst Metaline = (props) => {\n  // logg(props, 'Metaline')\n\n  const { created_at, username, city, tags = [] } = props;\n\n  function navigateToCity(){\n    props.history.push(`/en/cities/travel-to/${city.slug}/show/newsfeed`);\n  }\n\n  return (\n    <W>\n      { created_at && <span className=\"date\"> On {pp_date(created_at)} </span>}\n      { username && <>by <span className=\"user\"> {username} </span></> }\n      { city     && <>in <span className=\"city\" onClick={navigateToCity}> {city.name} </span></> }\n      { tags     && tags.map((tag, i) => <span key={i} className=\"tags\">{tag.name}</span>) }\n    </W>\n  );\n\n}\n\nexport default withRouter(Metaline);","import React, { useEffect, useState } from \"react\";\nimport { IonIcon } from \"@ionic/react\";\nimport { starOutline, starHalf, star } from 'ionicons/icons';\nimport \"./application.scss\";\n\nconst Rating = (props) => {\n\n  let rate = props.rate;\n  let [rating, setRating] = useState([]);\n\n  let iconMapping = {\n    0: starOutline,\n    1: starHalf,\n    2: star\n  };\n\n  useEffect(() => {\n\n    let rating = (new Array(5)).fill(0);\n    let i = 0;\n    while (rate > 0) {\n      if (rate < 1) {\n        rating[i] = 1;\n      } else {\n        rating[i] = 2;\n      }\n      rate--;\n      i++;\n    }\n\n    setRating(rating);\n\n  }, []);\n\n  return (\n    <div className=\"rating\">\n      { rating.map((r, i) => <IonIcon key={i} className=\"stars\" icon={iconMapping[r]} ></IonIcon>) }\n    </div>\n  )\n\n}\n\nexport default Rating;","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useRef, } from 'react'\nimport Modal from \"react-modal\"\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport './UnlockModal.scss'\nimport { Btn, C, logg, request, TwofoldContext, useApi, } from \"$shared\"\n\nconst Btn0 = styled.div`\n  display: inline;\n  cursor: pointer;\n`;\nconst BtnRow = styled.div`\n  display: flex;\n  justify-content: space-around;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst modalStyle = {\n  overlay: {},\n  content: {\n    margin: 'auto',\n    maxWidth: '400px',\n\n  }\n}\n\n/**\n * UnlockModal\n */\nconst UnlockModal = (props) => {\n  // logg(props, 'UnlockModal')\n\n  const {\n    currentUser, setCurrentUser,\n    itemToUnlock, setItemToUnlock,\n    loginModalOpen, setLoginModalOpen,\n    purchaseModalIsOpen, setPurchaseModalIsOpen,\n    ratedConfirmation, setRatedConfirmation,\n  } = useContext(TwofoldContext)\n  // logg(useContext(TwofoldContext), 'unlockModalUsedTwofoldContext')\n\n  const history = useHistory()\n  const api = useApi()\n\n  const doUnlock = async () => {\n    // @TODO: check how many unlocks I have, and offer to purchase more if not enough.\n    await api.doUnlock({ kind: itemToUnlock.item_type, id: itemToUnlock.id }).then((r) => {\n      setItemToUnlock({})\n\n      // @TODO: fix this mess\n\n      setCurrentUser(r)\n      // refresh the newsfeed?\n    }).catch((e) => {\n      logg(e, 'e19')\n    })\n  }\n\n  /* @TODO: this was here before, but should not be, right? _vp_ 2022-03-19 */\n  // const mountedRef = useRef('init')\n  // useEffect(() => {\n  //   const fn = async () => {\n  //     const r = await api.getMyAccount()\n  //     if (r) {\n  //       setCurrentUser(r)\n  //     }\n  //   }\n  //   fn()\n  //   return () => mountedRef.current = null\n  // }, [itemToUnlock.id])\n\n  if (!itemToUnlock.id) { return null }\n\n  let closable = typeof itemToUnlock.closable === 'undefined' ? true : itemToUnlock.closable\n\n  // @TODO: this is messy\n  let gohome = () => {\n    setItemToUnlock({})\n    setRatedConfirmation(true)\n    history.push(config.homeLocation)\n  }\n\n  const cost = itemToUnlock.premium_tier\n\n  return (<Modal style={modalStyle} ariaHideApp={false} isOpen={!!itemToUnlock.id} >\n    <Header>\n      <h1>Unlock this item?</h1>\n      { closable && <Btn0 onClick={() => closable && setItemToUnlock(false) } >&times;</Btn0> }\n    </Header>\n    <p>To access this content, please unlock it first. It costs {cost} coin(s) to unlock.</p>\n    { currentUser && <F>\n      <p>You have <b>{currentUser.n_unlocks}</b> unlocks.</p>\n      { currentUser.n_unlocks >= cost && <Btn onClick={doUnlock} >Unlock</Btn> }\n      { currentUser.n_unlocks < cost && <F>\n        <p>You don't have enough unlocks.</p>\n        <Btn onClick={() => { setPurchaseModalIsOpen(true) ; setItemToUnlock(false)} } >Purchase more.</Btn>\n      </F> }\n    </F> }\n    { !currentUser && <F>\n      <p>You have to be logged in to unlock content. <a onClick={() => { setLoginModalOpen(true) ; setItemToUnlock(false) }}>Please login.</a></p>\n    </F> }\n    <BtnRow>\n      { !closable && <Btn onClick={gohome} >Go Home</Btn> }\n    </BtnRow>\n  </Modal>)\n\n}\n\nexport default UnlockModal\n","\nimport { Capacitor } from '@capacitor/core'\nimport { PushNotifications } from '@capacitor/push-notifications'\nimport { Toast } from \"@capacitor/toast\"\nimport { ethers } from 'ethers'\nimport {\n  IonButton, IonButtons,\n  IonCard, IonCardContent, IonContent,\n  IonFooter,\n  IonHeader,\n  IonItem,\n  IonLabel, IonListHeader, IonList,\n  IonMenuButton,\n  IonPage,\n  IonText, IonTitle, IonToolbar,\n} from '@ionic/react'\nimport { Container, Grid } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport React, {\n  Fragment as F,\n  useContext, useEffect, useState,\n} from \"react\"\nimport { Link } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { FbLogin, Logout, PasswordLogin } from \"./\"\nimport { C, logg, logg2, TwofoldContext } from \"$shared\"\nimport { MenuLeft } from \"$components/application\"\nimport Greeter from '$src/artifacts/contracts/Greeter.sol/Greeter.json'\nimport Token from '$src/artifacts/contracts/Token.sol/Token.json'\n\nconst isPushNotificationsAvailable = Capacitor.isPluginAvailable('PushNotifications')\n\n// Update with the contract address logged out to the CLI when it was deployed\nconst greeterAddress = \"0x4bE9765Ca063E73E0aaEd227fd6731473508DbE0\"\nconst tokenAddress = \"0xffa52d00685aC60e65457922aEae2c2783c0cB0E\"\n\nconst LoginRow = styled.div`\n  display: flex;\n  // border: 1px solid yellow;\n\n  > * {\n    margin: auto .4em;\n  }\n`;\n\nconst Account = (props) => {\n  // logg(props, 'Account')\n\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  const [ greeting, setGreetingValue ] = useState(\"\")\n  const [notifications, setNotifications] = useState([])\n  const [ scratchpad, setScratchpad ] = useState(\"\")\n  const saveScratchpad = () => {}\n\n  // push notifications\n  const register = () => {\n    // Register with Apple / Google to receive push via APNS/FCM\n    PushNotifications.register()\n\n    // On success, we should be able to receive notifications\n    PushNotifications.addListener('registration', (token) => {\n      showToast('Push registration success')\n    })\n\n    // Some issue with our setup and push will not work\n    PushNotifications.addListener('registrationError', (error) => {\n      alert('Error on registration: ' + JSON.stringify(error))\n    })\n\n    // Show us the notification payload if the app is open on our device\n    PushNotifications.addListener('pushNotificationReceived', (_n) => {\n      const n = _n\n      logg2(n, 'pushNotificationReceived')\n      setNotifications((ns) => {\n        logg2(ns, 'setNofitications')\n        return [...ns, { ...n, type: 'foreground' }]\n      })\n    })\n\n    // Method called when tapping on a notification\n    PushNotifications.addListener('pushNotificationActionPerformed', ({ nofitication: n }) => {\n      logg2(n, 'pushNotificationActionPerformed')\n      setNotifications((ns) => {\n        logg2(ns, 'setNofitications')\n        return [...ns, { ...n, type: 'action' }]\n      })\n    })\n  }\n\n  const showToast = async (msg) => await Toast.show({ text: msg })\n\n  // push notifications\n  useEffect(() => {\n    if (!isPushNotificationsAvailable) { return }\n\n    PushNotifications.checkPermissions().then((res) => {\n        if (res.receive === 'granted') {\n          register()\n        } else {\n          PushNotifications.requestPermissions().then((res) => {\n            if (res.receive === 'denied') {\n              showToast('Push Notification permission denied')\n            } else {\n              showToast('Push Notification permission granted')\n              register()\n            }\n          })\n        }\n      })\n  }, [])\n\n  // request access to the user's MetaMask account\n  async function requestAccount() {\n    await window.ethereum.request({ method: 'eth_requestAccounts' });\n  }\n\n  // call the smart contract, read the current greeting value\n  async function fetchGreeting() {\n    if (typeof window.ethereum !== 'undefined') {\n      const provider = new ethers.providers.Web3Provider(window.ethereum)\n      const contract = new ethers.Contract(greeterAddress, Greeter.abi, provider)\n      try {\n        const data = await contract.greet()\n        setGreetingValue(data)\n        // console.log('data: ', data)\n      } catch (err) {\n        console.log(\"Error: \", err)\n      }\n    }\n  }\n\n  async function getBalance() {\n    if (typeof window.ethereum !== 'undefined') {\n      const [account] = await window.ethereum.request({ method: 'eth_requestAccounts' })\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const contract = new ethers.Contract(tokenAddress, Token.abi, provider)\n      const balance = await contract.balanceOf(account);\n      console.log(\"Balance: \", balance.toString());\n    }\n  }\n\n  // call the smart contract, send an update\n  async function setGreeting() {\n    if (!greeting) return\n    if (typeof window.ethereum !== 'undefined') {\n      await requestAccount()\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const signer = provider.getSigner()\n      const contract = new ethers.Contract(greeterAddress, Greeter.abi, signer)\n      const transaction = await contract.setGreeting(greeting)\n      await transaction.wait()\n      fetchGreeting()\n    }\n  }\n\n  async function sendCoins() {\n    if (typeof window.ethereum !== 'undefined') {\n      await requestAccount()\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const signer = provider.getSigner();\n      const contract = new ethers.Contract(tokenAddress, Token.abi, signer);\n      const transation = await contract.transfer(userAccount, amount);\n      await transation.wait();\n      console.log(`${amount} Coins successfully sent to ${userAccount}`);\n    }\n  }\n\n  return <IonPage>\n    <Grid container>\n      <MenuLeft variant={C.variants.inline} />\n      <h1>Account</h1>\n    </Grid>\n    <IonContent className=\"ion-padding\">\n\n      <Grid container spacing={2} >\n        <Grid item xs={12}>\n          <Grid container>\n            <Grid item xs={6}>\n              <img src=\"/assets/accounts/default-avatar.png\" alt=\"profile pic\" />\n\n              { /* NFT */ }\n              <div>\n                <button onClick={fetchGreeting}>Fetch Greeting</button>\n                <br />\n                <button onClick={setGreeting}>Set Greeting</button>\n                <br />\n                <input value={greeting} onChange={e => setGreetingValue(e.target.value)} placeholder=\"Set greeting\" />\n              </div>\n              <hr />\n              <div>\n                <button onClick={getBalance}>Get Balance</button>\n                <br />\n                <button onClick={sendCoins}>Send Coins</button>\n                <br />\n                <input onChange={e => setUserAccount(e.target.value)} placeholder=\"Account ID\" />\n                <br />\n                <input onChange={e => setAmount(e.target.value)} placeholder=\"Amount\" />\n              </div>\n\n            </Grid>\n            <Grid item xs={6}>\n              { !!currentUser\n                && <F>\n                  <h4>{currentUser.email}</h4>\n                  <ul>\n                    <li><Link to={\"/en/account/my/galleries\"} >My Galleries</Link></li>\n                    <li><a onClick={() => props.history.push(\"/en/account/my/videos\")}>My Videos</a></li>\n                    <li><Logout /></li>\n                  </ul>\n                </F>\n                || <F>\n                  <h4>Not logged in</h4>\n\n                  <LoginRow>\n                    <FbLogin />\n                    <PasswordLogin />\n                  </LoginRow>\n\n                </F> }\n            </Grid>\n          </Grid>\n          <Grid container spacing={2}>\n            <Grid item xs={6} >\n              <textarea value={scratchpad} onChange={setScratchpad} />\n              <button type='submit' onClick={saveScratchpad}>Save Scratchpad</button>\n            </Grid>\n          </Grid>\n        </Grid>\n      </Grid>\n\n      <hr />\n      { /* push notifications */ }\n      { notifications.length && <IonList>\n        { notifications.map((notif) => <IonItem key={notif.id}>\n          <IonLabel>\n            <IonText><h3 className=\"notif-title\">{ notif.title }</h3></IonText>\n            <p>{ notif.body }</p>\n            { notif.type==='foreground' && <p>This data was received in foreground</p> }\n            { notif.type==='action' && <p>This data was received on tap</p> }\n          </IonLabel>\n        </IonItem>) }\n      </IonList> || 'no notifications so far' }\n\n    </IonContent>\n    <IonFooter>\n      <IonToolbar>\n        { isPushNotificationsAvailable && <IonButton\n          color=\"success\" expand=\"full\" onClick={register}>Register for Push</IonButton>\n          || <div><h1>Push notifications not available</h1></div> }\n      </IonToolbar>\n    </IonFooter>\n  </IonPage>\n}\n\nexport default Account\n","\nimport { IonPage, IonContent } from \"@ionic/react\"\nimport { Container, Grid } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport React, { Fragment as F, useContext, useEffect, useState } from \"react\"\nimport Modal from 'react-modal'\nimport { Link } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { FbLogin, Logout, PasswordLogin } from \"./\"\nimport {\n  C,\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\n\nconst LoginModal = (props) => {\n  // logg(props, 'LoginModal')\n  const { loginModalOpen, setLoginModalOpen } = useContext(TwofoldContext)\n\n  return <Modal style={{ zIndex: 3 }} isOpen={loginModalOpen} >\n\n    <h1>\n      Please Login\n      <button onClick={() => setLoginModalOpen(false)} >[x]</button>\n    </h1>\n    <FbLogin />\n    <PasswordLogin />\n  </Modal>\n}\n\nexport default LoginModal\n","\nimport { ethers } from 'ethers'\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { CardElement, Elements, useElements, useStripe, } from '@stripe/react-stripe-js'\nimport { loadStripe } from '@stripe/stripe-js'\nimport styled from 'styled-components'\nimport Web3 from 'web3'\nimport { useWeb3React, Web3ReactProvider } from \"@web3-react/core\"\nimport { InjectedConnector } from '@web3-react/injected-connector'\n\nimport config from \"config\"\n\nimport {\n  Btn,\n  FlexCol, FlexRow,\n  logg,\n  request,\n  S,\n  TwofoldContext,\n  useApi,\n} from \"$shared\"\nimport bodyNFT from '$src/artifacts/contracts/Body.sol/BodyNFT.json'\nimport { FbLogin2, Logout,\n  PasswordLoginMobile, PasswordRegisterMobile,\n} from \"./\"\n\n/*\n * ropsten, _vp_ 2021-10-26\n * Dana, nude 1 (nude 3)\n */\nconst bodyAddress = '0x3e1a03a9e1682f4dd95413e0be69e5b7bccaf15d'\n\nconst BuyBtn = styled.span`\n  border: 1px solid ${p => p.theme.colors.text};\n\n  padding: 5px;\n  cursor: pointer;\n`;\n\nconst Cell = styled.div`\n  // display: flex;\n`;\n\n\n\nconst _Img = styled.div`\n  border: 1px solid red;\n  background: white;\n\n  max-width: 100px;\n  max-height: 100px;\n  width: 100px;\n  height: 100px;\n\n\n`;\nconst Img = ({ src }) => {\n  return <_Img><img src={src} alt='' /></_Img>\n}\nconst injected = new InjectedConnector() // { supportedChainIds: [1, 3, 4, 5, 42], })\n\nconst stripePromise = loadStripe('pk_test_qr1QPmSpLdBFt1F7itdWJOj3') // @TODO: this is active, but change.\n\nconst Login = (props) => {\n  const {\n    setRegisterModalIsOpen,\n  } = useContext(TwofoldContext)\n\n  const s = {\n    default: null,\n    register: 'register-with-email',\n  }\n  const [ state, setState ] = useState(s.default)\n\n  switch (state) {\n    case s.default:\n      return <FlexCol>\n        <FbLogin2 />\n        <RegisterWithEmail onClick={() => setRegisterModalIsOpen(true) } />\n        <LoginWithEmail onClick={() => setState(s.login)} />\n      </FlexCol>\n    case s.register:\n      return <PasswordRegisterMobile />\n    case s.login:\n      return <PasswordLoginMobile />\n    default:\n      throw 'not implemented tr5'\n  }\n};\n\nconst RegisterWithEmail = (props) => {\n  return <Btn {...props} >Register with Email</Btn>\n}\nconst LoginWithEmail = (props) => {\n  return <Btn {...props} >Login with Email</Btn>\n}\n\nconst W0 = styled.div`\n  // border: 1px solid cyan;\n\n  display: flex;\n  justify-content: flex-start;\n  align-items: center;\n\n  // background: #dedede;\n  // background: white;\n  // height: 100px;\n  // width: calc(100vw - 2*${p => p.theme.borderWidth});\n  // padding: 1em;\n  // margin-bottom: ${p => p.theme.borderWidth};\n`;\n\nconst MyAccountWidget = (props) => {\n  // logg(props, 'MyAccountWidget')\n\n  const api = useApi()\n  const {\n    currentUser, setCurrentUser,\n    purchaseModalIsOpen, setPurchaseModalIsOpen,\n  } = useContext(TwofoldContext)\n  // logg(useContext(TwofoldContext), 'MyAccountWidget#usedTwofoldContext')\n\n  const stripe = useStripe()\n  const elements = useElements()\n\n  /*\n   * @TODO: avatar would be an object s.t. multiple styles/sizes are there,\n   * and it should be in a context - shared across threemap, and accountWidget.\n   */\n  const [ avatar, setAvatar ] = useState(\"\")\n\n  // buy unlocks (coins)\n  // @TODO: rename\n  const handleSubmit = async (event) => {\n    event.preventDefault()\n\n    if (!stripe || !elements) { return }\n    const cardElement = elements.getElement(CardElement)\n    let client_secret = await api.getPayments()\n\n    const result = await stripe.confirmCardPayment(client_secret.client_secret, {\n      payment_method: {\n        card: elements.getElement(CardElement),\n      },\n    })\n\n    if (result.error) {\n      logg(result.error.message, 'error message')\n    } else {\n      if (result.paymentIntent.status === 'succeeded') {\n        let response = await api.getMyAccount()\n        logg(response, 'tr2')\n        setCurrentUser(response)\n        setPurchaseModalIsOpen(false)\n      }\n    }\n  }\n\n  const { active, account, library, connector, activate, deactivate } = useWeb3React()\n\n  /* useEffect(() => {\n    const fn = async () => {\n      await connect()\n      await myBodies()\n    }\n    fn()\n  }) */\n\n  async function connect() {\n    try {\n      await activate(injected)\n    } catch (ex) {\n      logg(ex, 'could not connect')\n    }\n  }\n\n  async function disconnect() {\n    try {\n      deactivate()\n    } catch (ex) {\n      console.log(ex)\n    }\n  }\n\n  // request access to the user's MetaMask account\n  const requestAccount = async () => {\n    await window.ethereum.request({ method: 'eth_requestAccounts' })\n  }\n\n  const myBodies = async () => {\n    if (window.ethereum) {\n      await requestAccount()\n      if (account) {\n        const provider = new ethers.providers.Web3Provider(window.ethereum)\n        const signer = provider.getSigner()\n        const contract = new ethers.Contract(bodyAddress, bodyNFT.abi, signer)\n        const tokensOfOwner = await contract.tokensOfOwner(account)\n\n        // @TODO: this is only first, I need to support unlimited number of bodies connected to the account.\n        const i = 0\n        const result = await contract.tokenURI(tokensOfOwner[i])\n        request.get(result).then(r => r.data.image).then(r => {\n          setAvatar(r)\n        })\n      }\n    }\n  }\n\n  return <W0 className=\"MyAccountWidget\" >\n\n    { /* currentUser.profile_photo_url && <Img src={currentUser.profile_photo_url} /> */ }\n    <Img src={avatar || currentUser?.profile_photo_url} />\n\n    <FlexCol>\n\n      { currentUser.email && <Cell>[ {currentUser.email} <Logout /> ]</Cell> }\n      { currentUser.email && <Cell>[ { typeof currentUser.n_unlocks === 'undefined' ? '?' : currentUser.n_unlocks} coins <BuyBtn onClick={() => setPurchaseModalIsOpen(true) }>ADD</BuyBtn> ]</Cell> }\n      { !currentUser.email && <Login /> }\n\n\n      { active && <F> [\n          <span>Connected with <b>{account}</b></span>\n          <button onClick={disconnect} >Disconnect</button>\n          <button onClick={myBodies} >myBodies</button> ]</F> }\n      { !active && <F>\n        {/* <span>Not Connected</span>  */}\n        {/* <button onClick={connect} >Connect to MetaMask</button> */}\n      </F> }\n\n    </FlexCol>\n\n    <Modal isOpen={purchaseModalIsOpen} ariaHideApp={false} >\n      <h1>\n        Buy unlocks\n        <span onClick={() => { setPurchaseModalIsOpen(false) } } >[x]</span>\n      </h1>\n      <form onSubmit={handleSubmit} >\n        <CardElement />\n        <button type=\"submit\" disabled={!stripe} >Pay</button>\n      </form>\n    </Modal>\n\n  </W0>\n}\n\n// no props?!\nMyAccountWidget.propTypes = {\n}\n\nconst WrappedMyAccountWidget = (props) => <Elements stripe={stripePromise}><MyAccountWidget {...props} /></Elements>;\n\nexport default WrappedMyAccountWidget\n","\nimport { IonPage, IonContent } from \"@ionic/react\"\nimport { Container, Grid } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport React, { Fragment as F, useContext, useEffect, useState } from \"react\"\nimport Modal from 'react-modal'\nimport { Link } from 'react-router-dom'\nimport styled from 'styled-components'\nimport { ToastContainer, toast } from 'react-toastify'\n\nimport {\n  FbLogin,\n  Logout,\n  PasswordLogin,\n} from \"./\"\nimport {\n  Btn,\n  C,\n  FlexCol, FlexRow,\n  logg,\n  TwofoldContext,\n  useApi,\n} from \"$shared\"\n\nconst RegisterModal = (props) => {\n  // logg(props, 'RegisterModal')\n\n  const {\n    currentUser, setCurrentUser,\n    registerModalIsOpen, setRegisterModalIsOpen,\n  } = useContext(TwofoldContext)\n  logg(useContext(TwofoldContext), 'registerModalUsedContext')\n\n  const api = useApi()\n  const [ email, setEmail ] = useState('')\n  const [ password, setPassword ] = useState('')\n  const [ password2, setPassword2 ] = useState('')\n\n  const doRegister = async (email, password, password2) => {\n    if (password !== password2) {\n      return toast('Passwords do not match')\n    }\n    api.doRegister({ email, password }).then((r) => {\n      logg(r, 'registered')\n      localStorage.setItem(C.jwt_token, r.jwt_token)\n      localStorage.setItem(C.current_user, JSON.stringify(r))\n      setCurrentUser(r)\n      setRegisterModalIsOpen(false)\n    }).catch((e) => {\n      logg(e, 'e322')\n      toast(\"Registration failed\")\n    })\n  }\n\n  return <Modal style={{ zIndex: 3 }} isOpen={registerModalIsOpen} >\n    <div onClick={() => setRegisterModalIsOpen(false)}>[x]</div>\n    <FlexCol>\n      <label for='email'>Email</label>\n      <input type='email'    name='email'     value={email}    onChange={(e) => setEmail(e.target.value)    } />\n\n      <label for='password'>Password</label>\n      <input type='password' name='password'  value={password} onChange={(e) => setPassword(e.target.value) } />\n\n      <label for='password2'>Confirm Password</label>\n      <input type='password' name='password2' value={password2} onChange={(e) => setPassword2(e.target.value) } />\n\n      <FlexRow>\n        <Btn onClick={() => doRegister(email, password, password2) }>Register</Btn>\n        <Btn onClick={() => setRegisterModalIsOpen(false) }>Cancel</Btn>\n      </FlexRow>\n    </FlexCol>\n  </Modal>\n}\n\nexport default RegisterModal\n","/*\n * components / users / index\n */\nimport { Plugins } from '@capacitor/core'\nimport { FacebookLoginResponse } from '@capacitor-community/facebook-login'\nimport React, { Fragment as F, useContext, useState, } from 'react'\nimport { ToastContainer, toast } from 'react-toastify'\nimport styled from 'styled-components'\n\nimport 'react-toastify/dist/ReactToastify.css'\n\nimport config from 'config'\nimport {\n  Btn,\n  C,\n  FlexCol,\n  logg, request, TwofoldContext, useApi,\n} from \"$shared\"\n\n/* A */\nexport { default as Account } from \"./Account\"\n\n\n/* F */\nconst { FacebookLogin } = Plugins\n\nconst FACEBOOK_PERMISSIONS = ['email']\n\nexport const FbLogin = (props) => {\n  const api = useApi()\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n\n  const doFbLogin = async () => {\n    const result = await FacebookLogin.login({ permissions: FACEBOOK_PERMISSIONS });\n    if (result.accessToken) {\n      request.post(`${config.apiOrigin}${api.longTermTokenPath}`, { accessToken: result.accessToken.token }).then((resp) => {\n        localStorage.setItem(C.jwt_token, resp.data.jwt_token)\n        localStorage.setItem(C.current_user, JSON.stringify(resp.data) )\n        setCurrentUser(resp.data)\n      }).catch((err) => {\n        logg(err, `Could not post request to ${config.apiOrigin}${api.longTermTokenPath}`)\n      })\n    } else {\n      // Canceled by user.\n      logg('canceled')\n    }\n  }\n  return <Btn onClick={doFbLogin}>FB Login</Btn>\n}\n\nexport const FbLogin2 = (props) => {\n  const api = useApi()\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n\n  const doFbLogin = async () => {\n    const result = await FacebookLogin.login({ permissions: FACEBOOK_PERMISSIONS });\n    if (result.accessToken) {\n      request.post(`${config.apiOrigin}${api.longTermTokenPath}`, { accessToken: result.accessToken.token }).then((resp) => {\n        localStorage.setItem(C.jwt_token, resp.data.jwt_token)\n        localStorage.setItem(C.current_user, JSON.stringify(resp.data) )\n        setCurrentUser(resp.data)\n      }).catch((err) => {\n        logg(err, `Could not post request to ${config.apiOrigin}${api.longTermTokenPath}`)\n      })\n    } else {\n      // Canceled by user.\n      logg('canceled')\n    }\n  }\n  return <Btn onClick={doFbLogin}>Login or Register with Facebook</Btn>\n}\n\n/* L */\nexport { default as LoginModal } from \"./LoginModal\"\n\nconst BuyBtn = styled.span`\n  border: 1px solid ${p => p.theme.colors.text};\n\n  padding: 5px;\n  cursor: pointer;\n`;\n\nexport const Logout = () => {\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  const doLogout = () => {\n    localStorage.removeItem(C.jwt_token)\n    localStorage.removeItem(C.current_user)\n    setCurrentUser({})\n  }\n  return <BuyBtn onClick={doLogout}>X</BuyBtn>\n}\n\nconst _W = styled.div`\n  display: flex;\n\n  > * {\n    // margin: auto .4em;\n  }\n`;\n\n/* M */\nexport { default as MyAccountWidget } from \"./MyAccountWidget\"\n\n/* P */\nexport const PasswordLogin = (props) => {\n  // logg(props, 'PasswordLogin')\n\n  const api = useApi()\n  const {\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n  } = useContext(TwofoldContext)\n  const [ email, setEmail ] = useState('')\n  const [ password, setPassword ] = useState('')\n\n  // @TODO: this used to be async/await\n  const doPasswordLogin =  (email, password) => {\n    request.post(`${config.apiOrigin}${api.loginPath}`, { email, password\n    }).then((r) => r.data\n    ).then((resp) => {\n      localStorage.setItem(C.jwt_token, resp.jwt_token)\n      localStorage.setItem(C.current_user, JSON.stringify(resp))\n      setCurrentUser(resp) // must be done *after* setting C.jwt_token\n      setLoginModalOpen(false)\n    }).catch((e) => {\n      logg(e, 'e322')\n      toast(\"Login failed\")\n      setCurrentUser(C.anonUser)\n    })\n  }\n\n  return <_W>\n    <input type='email'    value={email}    onChange={(e) => setEmail(e.target.value)    } /><br />\n    <input type='password' value={password} onChange={(e) => setPassword(e.target.value) }\n      onKeyDown={(e) => { if (e.key === 'Enter') { doPasswordLogin(email, password) } }}\n    />\n    <Btn onClick={() => doPasswordLogin(email, password)}>Password Login</Btn>\n  </_W>\n}\n\nexport const PasswordRegisterMobile = (props) => {\n  // logg(props, 'PasswordRegisterMobile')\n\n  const api = useApi()\n  const {\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n  } = useContext(TwofoldContext)\n  const [ email, setEmail ] = useState('')\n  const [ password, setPassword ] = useState('')\n  const [ passwordConfirm, setPasswordConfirm ] = useState('')\n\n  const doPasswordRegister = async (email, password, passwordConfirm) => {\n    request.post(`${config.apiOrigin}${api.loginPath}`, { email, password }).then((r) => r.data).then((resp) => {\n      localStorage.setItem(C.jwt_token, resp.jwt_token)\n      localStorage.setItem(C.current_user, JSON.stringify(resp))\n      setCurrentUser(resp) // must be done *after* setting C.jwt_token\n      setLoginModalOpen(false)\n    }).catch((e) => {\n      logg(e, 'e322')\n      toast(\"Login failed\")\n      setCurrentUser(C.anonUser)\n    })\n  }\n  return <FlexCol>\n    <input type='email'    value={email}    onChange={(e) => setEmail(e.target.value)    } />\n    <input type='password' value={password} onChange={(e) => setPassword(e.target.value) } />\n    <input type='password' value={passwordConfirm} onChange={(e) => setPasswordConfirm(e.target.value) } />\n    <Btn onClick={() => doPasswordRegister(email, password, passwordConfirm)}>Register</Btn>\n  </FlexCol>\n}\n\nexport const PasswordLoginMobile = (props) => {\n  // logg(props, 'PasswordLoginMobile')\n\n  const api = useApi()\n  const {\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n  } = useContext(TwofoldContext)\n  const [ email, setEmail ] = useState('')\n  const [ password, setPassword ] = useState('')\n\n  const doPasswordLogin = async (email, password) => {\n    request.post(`${config.apiOrigin}${api.loginPath}`, { email, password }).then((r) => r.data).then((resp) => {\n      localStorage.setItem(C.jwt_token, resp.jwt_token)\n      localStorage.setItem(C.current_user, JSON.stringify(resp))\n      setCurrentUser(resp) // must be done *after* setting C.jwt_token\n      setLoginModalOpen(false)\n    }).catch((e) => {\n      logg(e, 'e322')\n      toast(\"Login failed\")\n      setCurrentUser(C.anonUser)\n    })\n  }\n\n  return <FlexCol>\n    <input type='email'    value={email}    onChange={(e) => setEmail(e.target.value)    } /><br />\n    <input type='password' value={password} onChange={(e) => setPassword(e.target.value) }\n      onKeyDown={(e) => { if (e.key === 'Enter') { doPasswordLogin(email, password) } }}\n    />\n    <Btn onClick={() => doPasswordLogin(email, password)}>Password Login</Btn>\n  </FlexCol>\n}\n\n/* R */\nexport { default as RegisterModal } from './RegisterModal'\n\n","\n/*\n *  $shared / AppMock\n */\n\nimport { createMemoryHistory } from 'history'\nimport _Box from '@material-ui/core/Box'\nimport React, { useState } from 'react'\nimport {\n  Link, Switch, Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\nimport styled from 'styled-components'\nimport { ThemeProvider } from 'styled-components'\n\nimport {\n  C,\n  logg,\n  S,\n  TwofoldContext, TwofoldContextProvider,\n} from \"$shared\"\nimport { LoginModal } from \"$components/users\"\n\nconst AppMock = (props) => {\n  // logg(props, 'AppMock')\n  let {\n    currentUser, setCurrentUser,\n    itemToUnlock, setItemToUnlock,\n    purchaseModalIsOpen, setPurchaseModalIsOpen,\n    zoom, setZoom,\n  } = props\n  const history = createMemoryHistory()\n  history.push(\"/en/cities/travel-to/chicago\") // @TODO: move where appropriate\n\n  const [ localItemToUnlock, setLocalItemToUnlock ] = useState({})\n  const [ localCurrentUser, setLocalCurrentUser ] = useState(C.anonUser)\n  const [ localPurchaseModalIsOpen, setLocalPurchaseModalIsOpen ] = useState(false)\n  const [ localZoom, setLocalZoom ] = useState(1)\n  if (!currentUser) {\n    currentUser = localCurrentUser\n    setCurrentUser = setLocalCurrentUser\n  }\n  if (!itemToUnlock) {\n    itemToUnlock = localItemToUnlock\n    setItemToUnlock = setLocalItemToUnlock\n  }\n  if (!purchaseModalIsOpen) {\n    purchaseModalIsOpen = localPurchaseModalIsOpen\n    setPurchaseModalIsOpen = setLocalPurchaseModalIsOpen\n  }\n  if (!zoom) {\n    // logg('no props.zoom?!')\n    zoom = localZoom\n    setZoom = setLocalZoom\n  }\n\n  return <ThemeProvider theme={S.lightTheme}>\n    <Router history={history} >\n      <TwofoldContextProvider {...{\n        // bottomDrawerOpen, setBottomDrawerOpen,\n        currentUser, setCurrentUser,\n        itemToUnlock, setItemToUnlock,\n        // layout, setLayout,\n        purchaseModalIsOpen, setPurchaseModalIsOpen,\n        // showUrl, setShowUrl,\n        zoom, setZoom,\n      }} >\n        { props.children }\n        <LoginModal />\n      </TwofoldContextProvider>\n    </Router>\n  </ThemeProvider>\n}\n\nexport default AppMock\n","\nconst AppRouter = {\n\n  cityVenuesPath: (slug) => `/en/cities/travel-to/${slug}/venues`,\n  cityPath: (slug) => `/en/cities/travel-to/${slug}`,\n\n};\n\nexport default AppRouter;\n","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from 'react'\nimport styled from 'styled-components'\n\nimport {\n  C, CollapsibleContext,\n  logg,\n  S,\n  WBordered, WBorderedItem,\n} from '$shared'\n\nconst Gt = () => <span>&nbsp;&gt;&nbsp;&nbsp;</span>\n\nconst Inner = styled.div`\n  // border: 2px solid red;\n  // max-height: 100vh;\n\n  clear: left;\n`;\n\nconst Lt = () => <span>&nbsp;&lt;&nbsp;&nbsp;</span>\n\nconst Label = styled.div`\n  display: flex;\n  margin-bottom: ${p => p.theme.borderWidth};\n  color: ${p => p.theme.colors.text};\n`;\n\nconst WTransparent = styled.div`\n  background: ${p => p.theme.colors.background};\n  padding: 0 .5em .5em .5em;\n`;\nconst W = ({ children, variant, ...props }) => {\n  switch (variant) {\n    case C.variants.bordered:\n      return <WBordered {...props} >{children}</WBordered>\n    default:\n      return <WTransparent {...props} >{children}</WTransparent>\n  }\n}\n\n\n/**\n * Collapsible\n *\n * @TODO: test-driven _vp_ 2021-10-29\n */\nconst Collapsible = ({ children, ...props }) => {\n  // logg(props, 'Collapsible')\n  const {\n    className='', config, variant,\n  } = props\n\n  const ctx = useContext(CollapsibleContext)\n  if (!ctx) { return null }\n  const { collapsibles, setCollapsibles } = ctx\n\n  const doToggle = () => setCollapsibles({ ...collapsibles, [props.slug]: !collapsibles[props.slug] })\n\n  const collapsible = typeof config === 'undefined' ? true\n    : typeof config.collapsible === 'undefined' ? true\n      : config.collapsible\n  const folded = false // collapsible ? !!collapsibles[props.slug] : false\n\n  return <W variant={variant} className={`Collapsible ${className}`} >\n    { props.label &&  collapsible && <Label onClick={doToggle} >{folded ? <Lt /> : <Gt />} {props.label}</Label> }\n    { props.label && !collapsible && <Label >{props.label}</Label> }\n    { !folded && <Inner>{ children }</Inner> }\n  </W>\n}\n\nCollapsible.propTypes = {\n  className: PropTypes.string,\n  config: PropTypes.shape({\n    collapsible: PropTypes.bool,\n  }),\n  label: PropTypes.string,\n  slug: PropTypes.string.isRequired,\n  variant: PropTypes.string,\n}\nexport default Collapsible\n","import axios from \"axios\";\nimport config from \"config\";\n\nconst settings = {\n  baseURL: config.apiOrigin\n}\n\nexport default axios.create(settings);","\n/**\n * Style Constants\n */\nconst S = {\n  // Twofold layout\n  borderWidth: '10px',\n  bottomDrawerClosedHeight: '20px',\n  bottomDrawerOpenHeight: '115px',\n  breadcrumbsHeight: '30px',\n\n  thinBorderWidth: '2px',\n  thinBorderRadius: '5px',\n}\n\nconst lightTheme = {\n  ...S,\n  thinBorder: '2px solid black',\n  colors: {\n    text: 'black',\n    background: '#dedede',\n    blue: '#6aa3e9',\n    darkGrey: '#605d5d',\n    lightGrey: '#988b8b',\n    red: 'red',\n    border: 'black',\n    cardBackground: 'white'\n  }\n}\n\nconst darkTheme = {\n  ...S,\n  thinBorder: '2px solid white',\n  colors: {\n    text: 'white',\n    background: '#292929',\n    blue: '#73b0fa',\n    darkGrey: '#b3afaf',\n    lightGrey: '#4a4343',\n    red: '#eb83a8',\n    border: 'white',\n    cardBackground: '#1a1a1a'\n  }\n}\n\nexport default {\n  lightTheme,\n  darkTheme\n}","\nimport { arrowBack } from 'ionicons/icons'\nimport { IonIcon } from '@ionic/react'\nimport { CircularProgress as _CircularProgress } from '@material-ui/core'\nimport _Box from '@material-ui/core/Box'\nimport { ChevronLeft as _ChevronLeft, ChevronRight as _ChevronRight, Menu as _MenuIcon, } from '@material-ui/icons'\nimport React, { useEffect, useRef, useState } from 'react'\nimport {\n  Link, Switch, BrowserRouter as Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport {\n  C,\n  logg,\n  request,\n  useApi,\n} from \"$shared\"\n\n/**\n * ishjs has a newer version of this. _vp_ 2022-03-05\n*/\nconst TwofoldContext = React.createContext({})\nconst TwofoldContextProvider = ({ children, ...props }) => {\n  // logg(props, 'TwofoldContextProvider')\n  let {\n    currentUser, setCurrentUser, // for testing only. _vp_ 2022-03-18\n    itemToUnlock, setItemToUnlock,\n    layout, setLayout,\n    theme, toggleTheme,\n    zoom, setZoom, // it's a prop for testing only. _vp_ 2022-03-18\n  } = props\n\n  const api = useApi()\n\n  /* B */\n\n  // @TODO: does localStorage work like this on mobile?\n  // @TODO: try and catch\n  const [ bottomDrawerOpen, _setBottomDrawerOpen ] = useState(JSON.parse(localStorage.getItem(C.bottomDrawerOpen)))\n  const setBottomDrawerOpen = (m) => {\n    localStorage.setItem(C.bottomDrawerOpen, JSON.stringify(m))\n    _setBottomDrawerOpen(m)\n  }\n\n\n  /* C */\n\n  const [ localCurrentUser, setLocalCurrentUser ] = useState(C.anonUser)\n  if (!currentUser) {\n    currentUser = localCurrentUser\n    setCurrentUser = setLocalCurrentUser\n  }\n\n  /* Get the current_user on load */\n  const mountedRef = useRef('init')\n  useEffect(() => {\n    if (!mountedRef.current) { return } // @TODO: hmmm do I need this?\n\n    const fn = async () => {\n      const r = await api.getMyAccount()\n      setCurrentUser(r)\n    }\n    fn()\n\n    return () => mountedRef.current = null\n  }, [currentUser])\n\n  // Refresh current_user if is_purchasing\n  useEffect(() => {\n    let closure = setTimeout(() => {\n\n      const fn = async () => {\n        const r = await api.getMyAccount()\n        setCurrentUser(r)\n      }\n      fn()\n\n    }, 1 * 1000)\n    return () => clearTimeout(closure)\n  }, [currentUser.is_purchasing])\n\n\n  /* F */\n  const [ folded, setFolded ] = useState()\n\n  /* I */\n  const [ _itemToUnlock, _setItemToUnlock ] = useState({})\n  if (!itemToUnlock) {\n    itemToUnlock = _itemToUnlock\n    setItemToUnlock = _setItemToUnlock\n  }\n  /* why is this here? remove. _vp_ 2022-03-18 */\n  // const setItemToUnlock = (item) => {\n  //   if (itemToUnlock.id !== item.id && !loginModalOpen) {\n  //     _setItemToUnlock(item)\n  //   }\n  // }\n\n  /* L */\n  const [ location, setLocation ] = useState(null)\n  const [ loginModalOpen, setLoginModalOpen ] = useState(false)\n\n  /* M */\n  const [ mapPanelWidth, setMapPanelWidth ] = useState(null)\n  const [ mapPanelHeight, setMapPanelHeight ] = useState(null)\n\n  /* P */\n  const [ purchaseModalIsOpen, setPurchaseModalIsOpen ] = useState(false)\n\n  /* R */\n\n  const [ ratedConfirmation, _setRatedConfirmation ] = useState(JSON.parse(localStorage.getItem(C.ratedConfirmation)))\n  const setRatedConfirmation = (which) => {\n    localStorage.setItem(C.ratedConfirmation, JSON.stringify(which))\n    _setRatedConfirmation(which)\n  }\n\n  const [ registerModalIsOpen, setRegisterModalIsOpen ] = useState(false)\n\n  /* S */\n  const [ showItem, setShowItem ] = useState(false)\n  const [ showUrl, setShowUrl ] = useState(false)\n\n  /* T */\n  let tmp, defaultTwofoldPercent = 0.5\n  if (tmp = localStorage.getItem(C.twofoldPercent)) {\n    try {\n      defaultTwofoldPercent = JSON.parse(tmp)\n    } catch (err) {\n      logg(err, 'cannot get twofoldPercent from localStorage')\n    }\n  }\n  const [ twofoldPercent, setTwofoldPercent ] = useState(0.5)\n\n  /* Z */\n  const [ localZoom, setLocalZoom ] = useState(1)\n  if (!zoom) {\n    zoom = localZoom\n    setZoom = setLocalZoom\n  }\n\n  return <TwofoldContext.Provider value={{\n    bottomDrawerOpen, setBottomDrawerOpen,\n\n    currentUser, setCurrentUser,\n\n    folded, setFolded,\n\n    itemToUnlock, setItemToUnlock,\n\n    layout, setLayout,\n    location, setLocation,\n    loginModalOpen, setLoginModalOpen,\n\n    mapPanelHeight, setMapPanelHeight,\n    mapPanelWidth, setMapPanelWidth,\n\n    purchaseModalIsOpen, setPurchaseModalIsOpen,\n\n    ratedConfirmation, setRatedConfirmation,\n    registerModalIsOpen, setRegisterModalIsOpen,\n\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n\n    twofoldPercent, setTwofoldPercent,\n\n    zoom, setZoom,\n\n    theme, toggleTheme,\n  }} >{ children }</TwofoldContext.Provider>\n}\n\nexport default TwofoldContext\nexport {\n  TwofoldContextProvider,\n}\n","import { useLayoutEffect, useState, } from 'react'\n\n/**\n * useWindowSize\n */\nconst useWindowSize = () => {\n  const [size, setSize] = useState([0, 0]);\n  useLayoutEffect(() => {\n    function updateSize() {\n      setSize([window.innerWidth, window.innerHeight]);\n    }\n    window.addEventListener('resize', updateSize);\n    updateSize();\n    return () => window.removeEventListener('resize', updateSize);\n  }, []);\n  return size;\n}\n\nexport default useWindowSize\n","/*\n *  $shared / index\n */\n// alphabetized\nimport { arrowBack } from 'ionicons/icons'\nimport { IonIcon } from '@ionic/react'\nimport { CircularProgress as _CircularProgress } from '@material-ui/core'\nimport _Box from '@material-ui/core/Box'\nimport { ChevronLeft as _ChevronLeft, ChevronRight as _ChevronRight, Menu as _MenuIcon, } from '@material-ui/icons'\nimport React, { useEffect, useState } from 'react'\nimport {\n  Link, Switch, BrowserRouter as Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport C from \"./C\"\n\n/* A */\nimport useApi from \"./Api\"\nexport { default as useApi } from \"./Api\"\nexport { default as AppMock } from \"./AppMock\"\nexport { default as AppRouter } from \"./AppRouter\"\n\n/* B */\n\n/**\n * Back Button\n */\nconst BackIcon = styled(IonIcon)`\n  margin-right: 5px;\n  cursor: pointer;\n`;\nexport const BackBtn = () => {\n  const history = useHistory()\n  return <BackIcon onClick={history.goBack} icon={arrowBack}></BackIcon>\n}\n\n/**\n * Just your regular shadowed box. Pointer cursor. TDD\n */\nexport const Btn = styled.div`\n  border: 1px solid gray;\n  border-radius: 5px;\n\n  padding: .3em 1em;\n  cursor: pointer;\n`;\n\n\n/* C */\n\nexport { C }\nexport const ChevronLeft = styled(_ChevronLeft)`\n  color: ${(p) => p.theme.colors.text}\n`;\nexport const ChevronRight = styled(_ChevronRight)`\n  color: ${(p) => p.theme.colors.text}\n`;\n\n/**\n * A Card\n */\nexport const Card = styled(_Box)`\n  margin-bottom: 1em;\n  padding: 1em;\n  background: ${p => p.theme.colors.cardBackground};\n  cursor: ${p => p.cursor ? p.cursor : 'auto'};\n\n  display: flex;\n  flex-direction: column;\n`;\n\nexport { default as Collapsible } from \"./Collapsible\"\nexport const CollapsibleContext = React.createContext({})\n/**\n * @TODO: test-driven\n */\nexport const CollapsibleContextProvider = ({ children, ...props }) => {\n  // logg(props, 'CollapsibleContextProvider')\n\n  let defaultCollapsibles = {\n    [C.collapsible.descr]: true,\n  }\n  let tmp\n  if (tmp = localStorage.getItem(C.collapsibles)) {\n    try {\n      defaultCollapsibles = JSON.parse(tmp)\n    } catch (err) {\n      logg(err, 'Could not parse collapsibles from localStorage')\n    }\n  }\n  const [ collapsibles, _setCollapsibles ] = useState(defaultCollapsibles)\n  const setCollapsibles = (m) => {\n    localStorage.setItem(C.collapsibles, JSON.stringify(m))\n    _setCollapsibles(m)\n  }\n\n  return <CollapsibleContext.Provider value={{\n    collapsibles, setCollapsibles,\n  }} >{ children }</CollapsibleContext.Provider>\n}\n\n/* D */\n\n/* F */\n\nconst _FlexCol = styled.div`\n  display: flex;\n  flex-direction: column;\n\n  > * {\n    margin: auto .4em;\n  }\n`;\nexport const FlexCol = ({ children, ...props }) => <_FlexCol className=\"FlexCol\" {...props} >{children}</_FlexCol>\n\nexport const FlexRow = styled.div`\n  display: flex;\n\n  > * {\n    margin: auto .4em;\n  }\n`;\n\n/* I */\n\n/**\n * Like the rails inflector, has methods:\n * tableize()\n */\nexport const inflector = {\n  classify: (m) => {\n    if (m.slice(-3)==='ies') {\n      m = m.slice(0, -3) + 'y'\n    }\n    if (m.slice(-1)==='s') {\n      m = m.slice(0, -1)\n    }\n    const ms = m.split('_')\n    for (var i = 0; i < ms.length; i++) {\n      ms[i] = ms[i].charAt(0).toUpperCase() + ms[i].slice(1)\n    }\n    return ms.join(\"\")\n  },\n  tableize: (m) => {\n    switch(m) {\n      case 'Gallery':\n        return 'galleries'\n      default:\n      return `${m.toLowerCase()}s`\n    }\n  },\n}\n\n/* L */\n\n\n// From: https://codepen.io/charlyarg/pen/GByKja\nconst _Circle = styled.div`\n  position: fixed;\n  z-index: 999;\n  overflow: show;\n  margin: auto;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  width: 50px;\n  height: 50px;\n`;\nexport const Loading = (p) => <_Circle><_CircularProgress /></_Circle>\n\n/**\n * Usage: logg(someObject, 'label')\n *\n * This development-grade logger can be used instead of console.log() with some advantages:\n * * It encourages consistent labeling of logs. By labeling each log line, you can have dozens of log lines\n * written per action, and still know which log line comes from where.\n * The recommended label is the component name, or function name.\n * * If the label is present, the logged object is placed in the window, allowing you to inspect it in the console. The\n * label becomes the name of the object (stripped to [0-9a-zA-Z\\-_] chars). If you're logging a function, you can execute it.\n * If you log more than one thing, they can interact, allowing you to validate control flow.\n * * the logger can be turned off by making this function simply return.\n */\nconst logg = (a, b=\"\", c=null) => {\n  c = \"string\" === typeof c ? c : b.replace(/\\W/g, \"\");\n  if (c.length > 0) {\n    window[c] = a;\n  }\n\n  console.log(`+++ ${b}:`, a); // eslint-disable-line no-console\n};\n// optimized for Android (e.g. it inspects and doesn't use window)\nconst logg_android = (a, b=\"\", c=null) => {\n  console.log(`+++ ${b}:`, a.inspect); // eslint-disable-line no-console\n};\nconst logg2 = logg\nconst logg4 = logg\nconst logga = logg_android\nexport {\n  logg,\n  logg2,\n  logg4,\n  logga,\n};\n\n/* M */\nexport const MenuIcon = styled(_MenuIcon)`\n  color: ${(p) => p.theme.colors.text}\n`;\n\n/* P */\nexport const PurchasedIcon = () => {\n  return <div className=\"PurchasedIcon\">[purchased]</div>\n}\n\n/**\n * pretty print date\n */\nexport const pp_date = (d) => (d || \"\" ).substring(0, 10)\n\n/* R */\n\nexport { default as request } from \"./request\"\n\n/* S */\nexport { default as S } from \"./S\"\n\n/* T */\nexport { default as TwofoldContext } from './TwofoldContext'\nexport { TwofoldContextProvider } from './TwofoldContext'\n\n/* U */\nexport { default as useWindowSize } from './useWindowSize'\n\n/* W */\n\n/**\n * Wrapper Bordered. This expects a list? _vp_ 2021-11-02\n * Used in collapsibles and MarkersList\n */\nexport const WBordered = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.cardBackground};\n\n\n  margin-bottom: 1em;\n  padding: .5em;\n\n  cursor: ${p => p.onClick ? 'pointer' : null};\n`;\n\n/**\n * Wrapper Bordered Item. Is padded, margined.\n */\nconst _WBorderedItem = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.cardBackground};\n  color: ${p => p.theme.colors.text};\n\n  margin: 0 .5em .5em 0;\n  padding: .5em;\n\n  text-align: center;\n\n  width: 18%;\n  max-width: 140px;\n  min-width: 120px;\n`;\nexport const WBorderedItem = ({children, ...props}) => {\n  return <_WBorderedItem className=\"WBorderedItem\" {...props}>{children}</_WBorderedItem>\n}\n\n\nexport const WidgetContainer = ({ children, ...props }) => {\n  return <WBordered {...props} >{ children }</WBordered>\n}\n\nexport const Wrapper = styled.div`\n  height: 100vh;\n`;\n\n/* Z */\n\nexport const ZoomContext = React.createContext({})\n\n\n\n","import { IonPage, IonLoading, IonContent, IonIcon as _IonIcon } from '@ionic/react';\nimport { funnel, bookmark, newspaperOutline, image, videocam } from 'ionicons/icons';\nimport React, { Fragment as F, useEffect, useState } from \"react\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport styled from 'styled-components'\n\nimport { useApi, AppRouter,\n  logg, // eslint-disable-line no-unused-vars\n  Wrapper } from \"$shared\"\nimport \"./cities.scss\"\n\nconst Counts = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  margin: 1em 0px;\n`;\n\nconst Count = styled.div`\n  // border: 1px solid red;\n\n  display: flex;\n  justify-content: center;\n\n  width: 50%;\n  text-align: center;\n  position: relative;\n  padding: 0.1em;\n`;\n\nconst IonIcon = styled(_IonIcon)`\n  font-size: 2em;\n  color: ${p=>p.theme.darkGrey};\n`;\n\nconst Number = styled.div`\n  // border: 1px solid green;\n\n  padding: 0.5em;\n\n  color: ${p=>p.theme.lightGrey};\n  font-size: 0.9em;\n  font-weight: 600;\n`;\n\nconst Cities = (props) => {\n  const [cities, setCities] = useState([]);\n  const [filteredCities, setFilteredCities] = useState([]);\n  const [showLoading, setShowLoading] = useState(false);\n  const api = useApi()\n  const history = useHistory()\n\n  useEffect(() => {\n    setShowLoading(true);\n    api.getCities().then(res => {\n      setShowLoading(false);\n      setFilteredCities(res);\n      setCities(res);\n    });\n  }, [])\n\n  const filterHandler = (ev) => {\n    let filteredCities = cities.filter(city => {\n      return city.name.toLowerCase().indexOf(ev.target.value.trim().toLowerCase()) > -1;\n    });\n    setFilteredCities(filteredCities);\n  }\n\n  return <F>\n    <Wrapper className='cities' >\n      <h1 className=\"heading\" >Cities</h1>\n\n      <div className=\"filter-section\">\n        <input className=\"filter-input\" onChange={filterHandler} />\n        <IonIcon className=\"filter-icon\" icon={funnel}></IonIcon>\n      </div>\n\n      { /* @TODO: re-add! */ }\n      { /* <div className=\"bookmark-section\">\n        <label className=\"switch\">\n          <input type=\"checkbox\" onChange={() => { }} checked />\n          <span className=\"slider round\"></span>\n        </label>\n        <span className=\"bookmark-text\">Show only bookmarked</span>\n      </div> */ }\n\n      <div className=\"container\">\n        { filteredCities.map((city, i) => <div key={i} className=\"cities\" onClick={() => history.push(AppRouter.cityPath(city.slug)) } >\n            <div className=\"img-section\">\n              <span className=\"bookmark\" >\n                <IonIcon className=\"bookmark-icon\" icon={bookmark}></IonIcon>\n              </span>\n              <img className=\"city-img\" src={city.photo} />\n              <span className=\"city-title\">{city.name}</span>\n            </div>\n            <Counts>\n              <Count>\n                { /* @TODO: wire in theme provider */ }\n                <Number >{city.n_reports}</Number>\n                <IonIcon icon={newspaperOutline}></IonIcon>\n\n              </Count>\n              <Count>\n\n                <Number >{city.n_galleries}</Number>\n                <IonIcon icon={image}></IonIcon>\n              </Count>\n              <Count>\n\n                <Number >{city.n_videos}</Number>\n                <IonIcon icon={videocam}></IonIcon>\n              </Count>\n            </Counts>\n          </div>\n        ) }\n      </div>\n      &nbsp;\n    </Wrapper>\n\n    <IonLoading\n      isOpen={showLoading}\n      onDidDismiss={() => setShowLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n\n  </F>\n}\n\nexport default Cities;\n","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { Metaline } from \"$components/application\"\nimport { logg } from \"$shared\"\nimport { NewsitemContainer } from './'\nimport \"./newsitems.scss\"\n\nconst Images = styled.div`\n  position: relative;\n`;\n\nconst ImageLarge = styled.img`\n  width: 200px;\n`;\n\nconst ImageThumb1 = styled.img`\n  position: absolute;\n  left: 200px;\n  top: 0;\n`;\n\nconst ImageThumb2 = styled.img`\n  position: absolute;\n  left: 200px;\n  top: 100px;\n`;\n\n/**\n * NewsitemGallery\n */\nconst NewsitemGallery = (props) => {\n  // logg(props, 'NewsitemGallery')\n  const { item, variant } = props\n\n  return <NewsitemContainer item={item} variant={variant} >\n    <Images >\n      { item.photos[0] && <ImageLarge src={item.photos[0].thumb_url} /> }\n      { item.photos[1] && <ImageThumb1 src={item.photos[1].thumb_url} /> }\n      { item.photos[2] && <ImageThumb2 src={item.photos[2].thumb_url} /> }\n    </Images>\n  </NewsitemContainer>\n}\nNewsitemGallery.propTypes = {\n  item: PropTypes.shape({\n    photos: PropTypes.array.isRequired,\n  }),\n  variant: PropTypes.string,\n}\nexport default NewsitemGallery\n","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { NewsitemContainer } from './'\nimport { Metaline } from \"$components/application\"\nimport { logg } from \"$shared\"\n\nimport \"./newsitems.scss\"\n\nconst ImageLarge = styled.img`\n  max-width: 100%;\n`;\n\nconst W = styled.div`\n  display: flex;\n  justify-content: center;\n`;\n\n/**\n * default\n */\nconst NewsitemPhoto = (props) => {\n  logg(props, 'NewsitemPhoto')\n  const { item, variant } = props\n\n  return <NewsitemContainer className='Newsitem NewsitemPhoto' {...{ item, variant }} >\n    <W>\n      { item.photos[0] && <ImageLarge src={item.photos[0].large_url} /> }\n    </W>\n  </NewsitemContainer>\n}\n\nNewsitemPhoto.propTypes = {\n  item: PropTypes.shape({\n    photos: PropTypes.array.isRequired, // @TODO: this is wrong, just show one photo\n  }),\n  variant: PropTypes.string,\n}\nexport default NewsitemPhoto\n","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useEffect, useContext, useState } from \"react\"\n\nimport { useHistory } from \"react-router-dom\"\nimport styled from 'styled-components'\n\nimport { ItemIcon, NewsitemContainer } from \"./\"\nimport { Metaline, } from \"$components/application\"\nimport { Api, C, logg, request, TwofoldContext } from \"$shared\"\n\nimport \"./newsitems.scss\"\n\n\nconst NewsitemReport = (props) => {\n  // logg(props, \"NewsitemReport\");\n  const { item, variant, } = props\n  return (<NewsitemContainer item={item} variant={variant} />)\n}\n\nNewsitemReport.propTypes = {\n  item: PropTypes.object.isRequired,\n  variant: PropTypes.string,\n}\nexport default NewsitemReport\n\n","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { logg } from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport { NewsitemContainer } from \"./\"\nimport \"./newsitems.scss\"\n\n\nconst NewsitemVideo = (props) => {\n  // logg(props, 'NewsitemVideo')\n  const { item, variant } = props\n\n  return <NewsitemContainer item={item} variant={variant} >\n    <div style={{ display: 'flex', justifyContent: 'center' }} >\n      { item.youtube_id ?\n          <iframe className=\"iframe\" width=\"100%\" height=\"315\" src={`https://www.youtube.com/embed/${item.youtube_id}`} frameBorder=\"0\" allow=\"autoplay; encrypted-media\" allowFullScreen></iframe>\n          : <video style={{ maxWidth: '100%', maxHeight: 'min(500px, 100%)' }}  preload=\"metadata\" height=\"auto\" controls>\n            <source src={item.url} type=\"video/mp4\" />\n          </video> }\n    </div>\n  </NewsitemContainer>\n}\n\nNewsitemVideo.propTypes = {\n  item: PropTypes.object.isRequired,\n  variant: PropTypes.string,\n}\nexport default NewsitemVideo","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { GenericNewsitem } from \"./\"\nimport NewsitemGallery from \"$components/newsitems/NewsitemGallery\"\nimport NewsitemReport from \"$components/newsitems/NewsitemReport\"\nimport NewsitemPhoto from \"$components/newsitems/NewsitemPhoto\"\nimport NewsitemVideo from \"$components/newsitems/NewsitemVideo\"\nimport { Api, C, logg } from \"$shared\"\n\nimport \"./newsitems.scss\"\n\nconst ICONS = {\n  1: \"/assets/newsfeed/sunglass.png\",\n  2: \"/assets/newsfeed/gem_premium.png\"\n}\n\nconst W = styled.div`\n  // border: 2px solid yellow;\n  // margin: 0 0 0 ${p => p.variant === C.variants.bordered ? '.5em' : 0};\n`;\n\nconst Newsitems = (props) => {\n  // logg(props, 'Newsitems')\n  const { newsitems, variant } = props\n\n  if (!newsitems || !newsitems.length) { return <div>No Newsitems</div> }\n\n  return (\n    <W className=\"Newsitems\" {...{ variant }} >\n      { newsitems.map((newsitem, idx) => {\n        const premium_tier = newsitem.premium_tier || 0\n        const icon = ICONS[premium_tier]\n        let item\n\n        switch (newsitem.item_type) {\n          case C.item_types.gallery:\n            item = <NewsitemGallery item={newsitem} variant={variant} />\n            break\n          case C.item_types.report:\n            item = <NewsitemReport  item={newsitem} variant={variant} />\n            break\n          case C.item_types.video:\n            item = <NewsitemVideo   item={newsitem} variant={variant} />\n            break\n            case C.item_types.photo:\n              item = <NewsitemPhoto   item={newsitem} variant={variant} />\n              break\n          default:\n            item = <GenericNewsitem item={newsitem} />\n        }\n\n        return (\n          <div key={idx} className={`premium-${premium_tier}`}>\n            { item }\n          </div>\n        )\n      }) }\n    </W>\n  )\n}\n\nNewsitems.propTypes = {\n  newsitems: PropTypes.array.isRequired,\n  variant: PropTypes.string,\n}\nexport default Newsitems\n","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useEffect, useContext, useState } from \"react\"\n\nimport { useHistory, } from \"react-router-dom\"\nimport styled from 'styled-components'\n\nimport { ItemIcon } from \"./\"\nimport { Metaline, } from \"$components/application\"\nimport {\n  C, Card,\n  inflector,\n  logg,\n  request,\n  TwofoldContext,\n  WidgetContainer,\n} from \"$shared\"\n\n// alphabetized\n\nconst Col = styled.div`\n  display: flex;\n  flex-direction: column;\n`;\n\nconst Row = styled.div`\n  display: flex;\n  align-items: flex-start;\n`;\n\nconst Title = styled.h2`\n  margin-top: 0;\n  margin-bottom: 0;\n  color: ${p=>p.theme.colors.text};\n`;\n\nconst W0 = (props) => {\n  const { children, navigateToItem, variant } = props\n  // @TODO: better management of navigateToItem\n\n  switch (variant) {\n    case C.variants.bordered:\n      return <WidgetContainer {...props} onClick={navigateToItem} cursor=\"pointer\" >{ children }</WidgetContainer>\n    default:\n      return <Card boxShadow={2} {...props} onClick={navigateToItem} cursor=\"pointer\" ></Card>\n  }\n}\n\n/**\n * NewsitemContainer\n */\nconst NewsitemContainer = ({ children, ...props }) => {\n  // logg(props, 'NewsitemContainer')\n  const {\n    className,\n    item,\n    variant,\n  } = props\n  const { item_type, slug } = item\n\n  const history = useHistory()\n\n  const {\n    itemToUnlock, setItemToUnlock,\n    layout,\n    location,\n    showItem, setShowItem,\n  } = useContext(TwofoldContext)\n\n  const navigateToItem = () => {\n    if (item.is_premium && !item.is_purchased) {\n      setItemToUnlock(item)\n    } else {\n      if (layout === C.layout_mapui) {\n        history.push(`/en/locations/show/${location.slug}/${inflector.tableize(item_type)}/show/${slug}`)\n      } else {\n        history.push(`/en/${inflector.tableize(item_type)}/show/${slug}`)\n      }\n    }\n  }\n\n  /*\n   * @TODO: should be config with variants: standard container, container for a single photo, etc.\n   * but for now I'll use item.item_type\n   * _vp_ 2022-03-13\n   */\n\n  if (item.item_type === C.item_types.photo) {\n    return <W0 {...{ className, navigateToItem: () => {}, variant }} >\n      <Col>\n        <Title>{item.name}</Title>\n        <Metaline {...item} />\n      </Col>\n      { children }\n    </W0>\n\n  } else {\n    return <W0 {...{ className, navigateToItem, variant }} >\n      { children }\n      <Row>\n        <ItemIcon {...item} />\n        <Col>\n          <Title>{item.name}</Title>\n          <Metaline {...item} />\n        </Col>\n      </Row>\n      <p className=\"subhead\" dangerouslySetInnerHTML={{ __html: item.subhead }} />\n    </W0>\n  }\n}\nNewsitemContainer.propTypes = {\n  item: PropTypes.object.isRequired,\n  variant: PropTypes.string,\n}\nexport default NewsitemContainer\n","\nimport { Assignment as ReportIcon } from '@material-ui/icons'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport styled, { useTheme } from 'styled-components'\n\nimport { C, logg } from \"$shared\"\n\nconst W = styled.div`\n  padding: 10px;\n  margin-right: 10px;\n  width: 100px;\n  height: 100px;\n\n  box-sizing: border-box;\n`;\n\n/**\n * Displays the appropriate icon.\n *\n * @param [Boolean] props.isPurchased\n * @param [Number] props.premiumTier\n * @param [String] props.kind\n */\n export const ItemIcon = (props) => {\n  // logg(props, \"ItemIcon\")\n  const { is_purchased, item_type, premium_tier } = props\n\n  const theme = useTheme()\n\n  if (is_purchased) {\n    return <img className=\"icon\" src=\"/assets/icons/glasses.png\" alt='' />\n  }\n  if (premium_tier > 0) {\n    return <img className=\"icon\" src=\"/assets/icons/gem.png\" alt='' />\n  }\n  switch (item_type) {\n    case C.item_types.gallery:\n      return <W><img className=\"icon\" src=\"/assets/icons/gallery.png\" alt='' /></W>\n    case C.item_types.report:\n      return <W>\n        {/* <img className=\"icon\" src=\"/assets/icons/report.png\" alt='' /> */}\n        <ReportIcon style={{ color: theme.colors.text, width: '100%', height: '100%' }} />\n      </W>\n    case C.item_types.video:\n      return <W><img className=\"icon\" src=\"/assets/newsfeed/video_icon.svg\" alt='' /></W>\n    default:\n      return <W>[unknown kind]</W>\n  }\n}\nItemIcon.propTypes = {\n  is_purchased: PropTypes.bool, // .isRequired,\n  item_type: PropTypes.string.isRequired,\n  premium_tier: PropTypes.number,\n}\nexport default ItemIcon\n","/*\n * $components / newsitems / index.jsx\n */\nimport React, { Fragment as F, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { Box, inflector, logg } from \"$shared\"\n\n/* G */\n\nexport const GenericNewsitem = (props) => {\n  // logg(props, 'GenericNewsitem')\n  const { item } = props\n\n  return <F>\n    generic newsitem\n    <div dangerouslySetInnerHTML={{ __html: item.description }} />\n  </F>\n}\n\n/* N */\nexport { default as NewsitemGallery } from \"./NewsitemGallery\"\nexport { default as NewsitemPhoto } from \"./NewsitemPhoto\"\nexport { default as NewsitemReport } from \"./NewsitemReport\"\nexport { default as Newsitems } from \"./Newsitems\"\nexport { default as NewsitemContainer } from \"./NewsitemContainer\"\n\n\n\n/* I */\nexport const ICONS = {\n  1: \"/assets/newsfeed/sunglass.png\",\n  2: \"/assets/newsfeed/gem_premium.png\"\n}\n\nexport { default as ItemIcon } from \"./ItemIcon\"\n\n","import { funnel, bookmark, newspaperOutline, image, videocam } from 'ionicons/icons'\nimport { IonPage, IonContent, IonButton, IonImg, IonIcon } from \"@ionic/react\"\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { logg } from \"$shared\"\nimport { Rating } from \"$components/application\"\nimport \"./venues.scss\"\n\nconst Address = styled.p`\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  color: ${p => p.theme.darkGrey };\n  font-size: 14px;\n`;\n\nconst Col = styled.div``;\n\n// right arrow container\nconst _Ra = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n`;\nconst RightArrow = () => <_Ra><img className=\"forward-arrow\" src=\"/assets/16x16/arrow-right.png\" /></_Ra>\n\nconst Row = styled.div`\n  display: flex;\n`;\n\nconst Title = styled.div`\n  font-size: 1.5em;\n`;\n\nconst Venue = styled.div`\n  width: 100vw;\n  padding: 1em;\n  margin-bottom: 0.5em;\n  border-bottom: 1px solid #e3d3d3;\n  box-shadow: 0px 1px 5px 1px #b3aeae;\n  background-color: white;\n  position: relative;\n\n  display: flex;\n  justify-content: space-between;\n\n  img.thumb {\n    border-radius: 10px;\n  }\n\n  > div {\n    // border: 1px solid red;\n  }\n`;\n\nconst Venues = (props) => {\n  logg(props, 'Venues')\n\n  const defaultRating = 3.5\n  const [filteredVenues, setFilteredVenues] = useState(props.venues)\n\n  function filterHandler(ev) {\n    let venues = props.venues.filter(venue => {\n      return venue.name.toLowerCase().includes(ev.target.value.toLowerCase())\n    })\n    setFilteredVenues(venues)\n  }\n\n  return (\n    <div className=\"venues-section\">\n      <div>\n        <div className=\"filter-section\">\n          <input className=\"filter-input\" onChange={filterHandler} />\n          <IonIcon className=\"filter-icon\" icon={funnel}></IonIcon>\n        </div>\n      </div>\n      <div className=\"container\">\n\n        { filteredVenues.map((venue, idx) => <Venue key={idx} >\n          <Row>\n            <Col><img style={{ paddingRight: '1em' }} className='thumb' src={venue.photo} /></Col>\n            <Col>\n              <Title>{venue.name}</Title>\n              <div className=\"rating-section\">\n                <Rating rate={defaultRating}></Rating>\n                <span className=\"reviews\">5 reviews</span>\n              </div>\n              <div className=\"tags-section\">\n                { venue.tags.map((tag, idx) => <span key={idx} className=\"tags\">{tag.name}</span> )}\n              </div>\n              <p className=\"description\" dangerouslySetInnerHTML={{ __html: venue.subhead }}></p>\n              { venue.address && <Address>{venue.address}</Address> }\n            </Col>\n\n          </Row>\n          <RightArrow />\n        </Venue> )}\n\n      </div>\n    </div>\n  )\n}\n\nVenues.propTypes = {\n  venues: PropTypes.array.isRequired,\n}\nexport default Venues\n","import React, { useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport { IonPage, IonContent, IonIcon, IonLoading } from '@ionic/react'\nimport { pin, newspaperOutline, image, videocam } from 'ionicons/icons'\n\nimport { AppRouter, useApi, logg, Wrapper } from \"$shared\"\nimport { Newsitems } from \"$components/newsitems\"\nimport { Venues } from \"$components/venues\"\nimport \"./cities.scss\"\n\nconst CitiesShow = (props) => {\n  logg(props, 'CitiesShow')\n  const { match } = props\n\n  const api = useApi()\n  const history = useHistory()\n  const thisPath = AppRouter.cityPath(match.params.name)\n\n  const location = useLocation()\n\n  const [city, setCity] = useState(null)\n  const [showLoading, setShowLoading] = useState(false)\n\n  const mountedRef = useRef('init')\n  useEffect(() => {\n    setShowLoading(true)\n    api.getCity(match.params.name).then(res => {\n      if (mountedRef.current) {\n        setCity(res.data.city)\n        setShowLoading(false)\n      }\n    })\n    return () => mountedRef.current = false\n  }, [match.params.name])\n\n  // @TODO: remove this!\n  function changeMenuHandler(menu) {\n    // history.push(`${match.url}/${menu}`);\n  }\n\n  return <Wrapper>\n\n    { city && <div className='wrapper'>\n      <div className='city-show'>\n\n        <header style={{ backgroundImage: `url(${city.hero_img}}`, backgroundSize: \"contain\" }}></header>\n\n        <section className=\"section-one\">\n          <IonIcon icon={pin} className=\"location\"></IonIcon>\n          <h1 className=\"city-name\">{city.name}</h1>\n          <div className=\"status\">\n            <div className=\"status-grid\">\n              <IonIcon className=\"info-icon\" icon={newspaperOutline}></IonIcon>\n              <span className=\"numbers\">{city.n_reports}</span>\n            </div>\n            <div className=\"status-grid\">\n              <IonIcon className=\"info-icon\" icon={image}></IonIcon>\n              <span className=\"numbers\">{city.n_galleries}</span>\n            </div>\n            <div className=\"status-grid mid\">\n              <IonIcon className=\"info-icon\" icon={videocam}></IonIcon>\n              <span className=\"numbers \">{city.n_videos}</span>\n            </div>\n          </div>\n        </section>\n\n        { /* @TODO: re-add tags here! */ }\n        { /* city.tags && <section className=\"tags-section\">\n          <span className=\"btn delete-btn\" >\n            <IonIcon name=\"close\"> </IonIcon> deselect all\n          </span>\n          { city.tags.map((tag, i) => <span className=\"btn\" key={i} >{tag.name}</span>) }\n        </section> */ }\n\n        <section className=\"section-three\">\n          <div className=\"menu-option\" onClick={() => history.push(AppRouter.cityPath(match.params.name))} >\n            <img src=\"/assets/newsfeed-icon.svg\" alt=\"Newsfeed\" />\n            <p className={`${location.pathname == thisPath ? \"selected\" : \"\"} menu-item`}>Newsfeed</p>\n          </div>\n          <div className=\"menu-option\" onClick={() => history.push(AppRouter.cityVenuesPath(match.params.name))} >\n            <img src=\"/assets/venue-icon.svg\" alt=\"Venues\" />\n            <p className={`${location.pathname.includes(\"venues\") ? \"selected\" : \"\"} menu-item`}>Venues</p>\n          </div>\n        </section>\n\n\n        <Switch>\n          <Route exact path={`${match.url}/venues`} render={() => <Venues    venues={city.venues} />} />\n          <Route exact path={match.url}             render={() => <Newsitems newsitems={city.newsitems} /> } />\n        </Switch>\n\n\n      </div>\n    </div>}\n    <IonLoading\n      isOpen={showLoading}\n      onDidDismiss={() => setShowLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n\n    <br /><br /><br />\n  </Wrapper>\n}\n\nexport default CitiesShow\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { C, logg, request, TwofoldContext, BackBtn } from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport \"./galleries.scss\"\n\nconst W0 = styled.div`\n  border: 1px solid blue;\n  height: auto;\n`;\n\n/**\n * GalleriesShow\n */\nconst GalleriesShow = (props) => {\n  // logg(props, 'GalleriesShow')\n  const { match } = props\n\n  const [showLoading, setShowLoading] = useState(false) // @TODO: hmm could it be moved to TwofoldContext ?\n  const [gallery, setGallery] = useState({})\n\n  const mountedRef = useRef('init')\n\n  const {\n    currentUser, setCurrentUser,\n    itemToUnlock, setItemToUnlock,\n    loginModalOpen, setLoginModalOpen,\n  } = useContext(TwofoldContext)\n\n  // @TODO: move this into api\n  let getGallery = async () => {\n    const token = localStorage.getItem(C.jwt_token)\n    await request.get(`/api/galleries/view/${match.params.slug}`, { params: { jwt_token: token } }).then(res => {\n      if (!mountedRef.current) { return }\n      const gallery = res.data.gallery\n      if (gallery.is_premium && !gallery.is_purchased) {\n        setItemToUnlock(gallery)\n      } else {\n        setGallery(res.data.gallery)\n      }\n    }).catch((err) => {\n      logg(err, 'e65')\n    })\n  }\n\n  useEffect(() => {\n    getGallery()\n    return () => {\n      mountedRef.current = null\n    }\n  }, [gallery.id, itemToUnlock.id] )\n\n  return (<W0>\n\n    { <div className=\"gallery-show\">\n      <div className='narrow'>\n        <h1 className=\"heading\">\n          <BackBtn />\n          <img src=\"/assets/newsfeed/photos_icon.png\" />\n          <span className=\"title\">{gallery.name}</span>\n        </h1>\n        <Metaline {...gallery} />\n\n        <div className=\"thumbs\">\n          { gallery.photos && gallery.photos.map((ph, i) =>\n            <div className='card' key={i}>\n              <div className='card-inner'>\n                <IonImg src={ph.thumb_url}></IonImg>\n              </div>\n            </div>\n          ) }\n        </div>\n        <div dangerouslySetInnerHTML={{ __html: gallery.description }}></div>\n      </div>\n      <div className=\"full-img-section\">\n        { gallery.photos && gallery.photos.map((ph, i) =>\n          <div className='item' key={i}>\n            <img src={ph.large_url} />\n          </div>\n        ) }\n      </div>\n    </div>}\n\n  </W0>)\n}\n\nexport default GalleriesShow","import React, { useEffect, useState } from \"react\";\nimport { IonLoading } from \"@ionic/react\";\n\nimport request from \"$shared/request\";\nimport { logg } from \"$shared\";\nimport { Galleries } from \"./\";\nimport { NewsitemGallery } from \"$components/newsitems\";\n\nconst MyGalleries = (props) => {\n  const [galleries, setGalleries] = useState(null);\n  const [showLoading, setShowLoading] = useState(false);\n\n  useEffect(() => {\n    setShowLoading(true);\n    const token = localStorage.getItem(\"jwtToken\");\n    request.get(`/api/my/galleries`, { params: { jwt_token: token } }).then(r => {\n      logg(r.data, 'MyGalleries data')\n      setGalleries(r.data);\n      setShowLoading(false);\n    })\n  }, []);\n\n  return (<>\n    <IonLoading\n      isOpen={showLoading}\n      onDidDismiss={() => setShowLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n    { galleries && galleries.length && galleries.map((g) => <NewsitemGallery key={g.id} data={g} /> ) }\n  </>);\n}\n\nexport default MyGalleries;","\nimport {\n  IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonToggle, IonList, IonItem,\n  IonLabel, IonItemDivider,\n} from '@ionic/react'\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useState } from 'react'\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport { C, logg, request, S, TwofoldContext } from \"$shared\"\nimport { MenuLeft } from \"$components/application\"\nimport img from '$components/application/45x45_day-night-2.png'\nimport './day_night_toggle.scss'\n\n/* B */\n\n// One breadcrumb\nconst B0 = styled.div`\n  color: ${p=> p.theme.colors.text};\n  // padding-right: 0.5em;\n`;\n\n// The divider\nconst B1 = styled.div`\n  padding: 0.5em;\n  color: ${p => p.theme.colors.text};\n`;\n\n/* D */\nconst L = styled.div`\n  color: ${p=> p.theme.colors.text};\n  margin-top: .5em;\n`;\nconst WDayNight = styled.div`\n  // border: 1px solid green;\n  display: flex;\n  margin: 0 1em;\n`;\nconst DayNightToggle = (props) => {\n  const { theme, toggleTheme } = props\n  return <WDayNight>\n    <L>Day</L>\n    <IonToggle checked={theme === C.themes.dark} onIonChange={toggleTheme} value=\"DayNight\" />\n    <L>Night</L>\n  </WDayNight>\n}\nconst T0 = styled.div`\n  width: 45px;\n  height: 45px;\n  // background-image: url(${img});\n`;\nconst DayNightToggle2 = (props) => {\n  // logg(props, 'DayNightToggle2')\n  const { theme, toggleTheme } = props\n  const [ rotating, setRotating ] = useState(null)\n\n  const doTransition = () => {\n    setRotating('rotating')\n    setTimeout(() => {\n      setRotating(null)\n      toggleTheme()\n    }, 1 * 1000)\n  }\n\n  return <WDayNight onClick={doTransition} >\n    <T0 className={`theme-${theme} ${rotating}`} />\n    {/* <IonToggle checked={theme === C.themes.dark} onIonChange={toggleTheme} value=\"DayNight\" /> */}\n  </WDayNight>\n}\n\n/* W */\nconst W0 = styled.div`\n  background: ${p => p.theme.colors.cardBackground};\n  border: ${p=>p.debug?'1':'0'}px solid cyan;\n\n  display: flex;\n  align-items: center;\n  justify-content: stretch;\n\n  z-index: 1;\n\n  // height: ${p => p.theme.breadcrumbsHeight};\n`;\n\nconst WBreadcrumbs = styled.div`\n  display: block;\n  flex-grow: 1;\n  // flex-direction: row;\n  // flex-grow: 1;\n  // flex-wrap: wrap;\n\n  > * {\n    // border: 1px solid red;\n    display: inline;\n  }\n`;\n\n\n/**\n * Breadcrumbs\n * @TODO: move to src/application\n */\nconst Breadcrumbs = (props) => {\n  // logg(props, 'Breakcrumbs')\n  const { breadcrumbs=[] } = props\n  const { layout, toggleTheme, theme } = useContext(TwofoldContext)\n  const history = useHistory()\n\n  const out = []\n  breadcrumbs.map((b, idx) => {\n    if (idx+1 === props.breadcrumbs.length) {\n      // last one\n      out.push(<B0 key={idx} >{b.name}</B0>)\n    } else {\n      out.push(<B0\n        key={idx}\n        style={{ textDecoration: 'underline', cursor: 'pointer' }}\n        onClick={() => history.push(`/en/locations/show/${b.slug}`) }\n      >{b.name}</B0>)\n      out.push(<B1 key={`${idx}-divider`} >&gt;</B1>)\n    }\n  })\n\n  return <W0 debug={config.debug} className=\"Breadcrumbs\" >\n    { layout === C.layout_mapui && <MenuLeft variant={C.variants.inline} /> }\n    <WBreadcrumbs className='WBreadcrumbs' >{ out }</WBreadcrumbs>\n    <DayNightToggle2 toggleTheme={toggleTheme} theme={theme} />\n  </W0>\n}\nBreadcrumbs.propTypes = {\n  breadcrumbs: PropTypes.arrayOf(\n    PropTypes.shape({\n      name: PropTypes.string.isRequired,\n      slug: PropTypes.string.isRequired,\n    }),\n  ),\n}\nexport default Breadcrumbs\n","\nimport React, { useEffect, useState } from \"react\";\nimport styled from 'styled-components'\n\nimport config from \"config\"\nimport { useApi, Card as Box, logg, request } from \"$shared\"\n\nconst W0 = styled.div`\n  padding: 2em 0;\n`\n\n/**\n * ReportsShow\n */\nconst ReportsShow = (props) => {\n  // logg(props, \"ReportsShow\")\n\n  let [ item, setItem ] = useState({})\n  let api = useApi()\n\n  useEffect(() => {\n    api.getReport(props.match.params.slug).then((data) => {\n      setItem(data)\n    })\n  }, [])\n\n  // @TODO: logged in and no access\n\n  // @TODO: logged in and access\n\n  return (<W0>\n    {/* <Box boxShadow={2}> */}\n      <h1>Report {item.name}</h1>\n      <div className=\"description\" dangerouslySetInnerHTML={{ __html: item.description }} />\n    {/* </Box> */}\n  </W0>)\n}\n\n// @TODO: wrap in login HOC\nexport default ReportsShow\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { C, logg, request, S, TwofoldContext, ZoomContext } from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport { GalleriesShow } from \"$components/galleries\"\nimport { ReportsShow } from \"$components/reports\"\nimport { Newsitems } from \"$components/newsitems\"\n\n\nconst Fabs = styled.div`\n  // border: 1px solid red;\n\n  position: fixed;\n`;\n\n/**\n * ItemModal\n * @TODO: move to $components/application\n */\nconst ItemModal = (props) => {\n  // logg(props, 'ItemModal')\n  const { item } = props\n\n  const {\n    showItem, setShowItem, // @TODO: should navigate here!\n  } = useContext(TwofoldContext)\n\n  return <Modal isOpen={!!showItem} >\n    <Fabs className='Fabs' >\n      <div onClick={() => setShowItem(false)} >[x]</div>\n    </Fabs>\n    { item.item_type === C.item_types.report && <ReportsShow match={{ params: { slug: item.reportname } }} /> }\n    { item.item_type === C.item_types.gallery && <GalleriesShow match={{ params: { slug: item.slug } }} /> }\n  </Modal>\n}\n\nexport default ItemModal\n","\nimport { Toast } from \"@capacitor/toast\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport styled from 'styled-components'\n\nimport {\n  Breadcrumbs,\n  ItemModal,\n  MapPanel, MapPanelNoZoom, MarkersList,\n  RatedRestrictionModal,\n  WrappedMapPanel,\n} from \"./\"\nimport { CitiesList } from \"$components/cities\"\nimport { Newsitems } from \"$components/newsitems\"\nimport { LongLine } from \"$components/TwofoldLayout\"\nimport {\n  C, ChevronLeft, ChevronRight, Collapsible,\n  inflector,\n  Loading, logg,\n  MenuIcon,\n  request,\n  TwofoldContext,\n  useApi, useWindowSize,\n} from \"$shared\"\n\n/* C */\n\n/* D */\n\n// @TODO: move Description into shared ?\nconst _D = styled.div`\n`;\nconst Description = ({ item={} }) => {\n  if (!item.description) { return }\n\n  return <_D className=\"Description\" dangerouslySetInnerHTML={{ __html: item.description }} />\n}\n\n/* H */\nconst WH = styled.div`\n  // border: 1px solid cyan;\n\n  position: fixed;\n  top: 5px;\n  left: ${p => p.foldedLeft\n    ? '10px'\n    : p.foldedRight\n    ? '98%'\n    : `calc(${p.twofoldPercent*100}% - 10px)` };\n\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n\n  width: 30px;\n  height: 95%; /* @TODO: this needs to account for bottom being open */\n`;\nconst Handle = (props) => {\n  const [ w ] = useWindowSize()\n\n  const [ offsetX, setOffsetX ] = useState()\n  const [ dragging, setDragging ] = useState(false)\n\n  const foldLeft = () => {\n    if (folded === C.foldedRight) {\n      setFolded(C.foldedCenter)\n    } else {\n      setFolded(C.foldedLeft)\n    }\n  }\n\n  const foldRight = () => {\n    if (folded === C.foldedLeft) {\n      setFolded(C.foldedCenter)\n    } else {\n      setFolded(C.foldedRight)\n    }\n  }\n\n  const {\n    folded, setFolded,\n    twofoldPercent, setTwofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const onMouseDown = (e) => {\n    setDragging(true)\n    setOffsetX(e.pageX)\n  }\n\n  const onMouseMove = (e) => {\n    if (!dragging) { return }\n    if (e.clientX === 0) { return }\n    const movedBy = e.clientX - offsetX\n    if (movedBy === 0) { return }\n    const movedByPercent = movedBy/w\n    setTwofoldPercent(prev => prev + movedByPercent)\n  }\n\n  const onMouseUp = (e) => {\n    setDragging(false)\n    // document.removeEventListener('mousemove', onMouseMove)\n    // document.removeEventListener('mousedown', onMouseDown)\n  }\n\n  const foldedLeft = folded === C.foldedLeft\n  const foldedRight = folded === C.foldedRight\n\n  // draggable=\"true\"\n  return <WH className=\"Handle\" {...{ foldedLeft, foldedRight, twofoldPercent }}\n    onMouseMove={onMouseMove}\n    onMouseDown={onMouseDown}\n    onMouseLeave={onMouseUp}\n    onMouseUp={onMouseUp}\n    style={{\n      pointer: 'cursor',\n    }}\n  >\n    <MenuIcon />\n    <ChevronLeft onClick={foldLeft} />\n    <ChevronRight onClick={foldRight} />\n    { [C.foldedRight, C.foldedLeft].indexOf(folded) !== -1  && <LongLine orientation={C.vertical} /> }\n  </WH>\n}\n\n/* I */\nconst IframeModal = (props) => {\n  const { showUrl, setShowUrl } = useContext(TwofoldContext)\n\n  return (<Modal ariaHideApp={false} isOpen={!!showUrl} >\n    <span onClick={() => {  setShowUrl(false) }} >[x]</span>\n\n    <iframe height=\"100%\" style={{ width: \"100%\", height: \"100%\" }} scrolling={\"yes\"} src={props.src}\n      frameBorder=\"no\" allowtransparency=\"true\" allowFullScreen={true} >\n    </iframe>\n  </Modal>)\n}\n\n/* L */\nconst Left = styled.div`\n  background: ${p => p.theme.colors.background};\n  flex: ${p => p.foldedRight ? '99%' : `${p.twofoldPercent*100}%` };\n  overflow: hidden;\n\n  display: flex;\n  flex-direction: column;\n\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n`;\n\n\n/* R */\n\nconst Right = styled.div`\n  background: ${p => p.theme.colors.background};\n  position: relative;\n\n  padding: 0 0 0 1em;\n  flex: ${p => p.foldedRight ? '2%' : `${(1-p.twofoldPercent)*100}%` };\n  overflow-x: hidden;\n  overflox-y: auto;\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n`;\n\nconst Row = styled.div`\n  // border: 1px solid magenta;\n\n  display: flex;\n  position: relative;\n`;\n\n\n/**\n * LocationsShowDesktop\n */\nconst LocationsShowDesktop = (props) => {\n  // logg(props, 'LocationsShowDesktop')\n  const { match } = props\n\n  const [ windowWidth, windowHeight ] = useWindowSize()\n\n  const [ loading, setLoading ] = useState(false)\n  const [ markers, setMarkers ] = useState([])\n\n  const mountedRef = useRef('init')\n  const showItemRef = useRef('init')\n  const mapPanelRef = useRef(null)\n  const api = useApi()\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    location, setLocation,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  useEffect(() => {\n    if (location) {\n      setMarkers(location.markers)\n\n      if (location.is_premium && !location.is_purchased) {\n        setItemToUnlock({ closable: false, item_type: 'Location', ...location })\n      }\n    }\n  }, [ location ])\n\n  const showToast = async (msg) => await Toast.show({ text: msg })\n\n  // Load the map\n  // @TODO: move into api object\n  useEffect(() => {\n    setLoading(true)\n    const token = localStorage.getItem(\"jwt_token\")\n\n    request.get(`/api/maps/view/${match.params.slug}`, { params: { jwt_token: token } }).then(res => {\n      if (mountedRef.current === match.params.slug) { return null }\n      if (!res.data.map) {\n        setLoading(false)\n        showToast('could not get Location')\n        logg('smth fuxed')\n        return null\n      }\n\n      setLocation(res.data.map)\n      if (res.data.map.rated === C.rated.nc17 && !ratedConfirmation) { // @TODO: not test-driven, bad!\n        setRatedConfirmation(false)\n      }\n      setLoading(false)\n      // @TODO: setFlash here?! If I\"m accessing a gallery I haven't bought access to?\n    })\n\n    return () => {\n      mountedRef.current = match.params.slug\n    }\n  }, [ match.params.slug ])\n\n  // set mapPanel sizes\n  useEffect(() => {\n    if (mapPanelRef.current) {\n      setMapPanelWidth(mapPanelRef.current.offsetWidth)\n      setMapPanelHeight(mapPanelRef.current.offsetHeight)\n    }\n  }, [bottomDrawerOpen, folded, mapPanelRef.current, twofoldPercent, windowWidth, windowHeight])\n\n  // load showItem if any\n  // @TODO: this makes too many calls, improve performance\n  // @TODO: move to api\n  useEffect(() => {\n    if (!match.params.item_type) { return }\n\n    const itemType = inflector.classify(match.params.item_type)\n    switch (itemType) {\n      case C.item_types.gallery:\n        api.getGallery(match.params.item_slug).then(setShowItem)\n        break\n      case C.item_types.report:\n        api.getReport(match.params.item_slug).then(setShowItem)\n        break\n      default:\n        logg(itemType, 'cannot get this item type')\n    }\n  }, [ match.params.item_slug, match.params.item_type ])\n\n  const foldedLeft = folded === C.foldedLeft\n  const foldedRight = folded === C.foldedRight\n\n  return <Row>\n    { !foldedLeft && <Left\n        className='Left'\n        {...{ bottomDrawerOpen,\n          folded, foldedLeft, foldedRight,\n          twofoldPercent,\n        } }\n    >\n      { <Breadcrumbs {...location} /> }\n      { location && <WrappedMapPanel\n        map={location.map ? location.map : location}\n        ref={mapPanelRef}\n        slug={match.params.slug}\n      /> }\n    </Left> }\n\n    <Right\n        className='Right'\n        {...{\n          bottomDrawerOpen,\n          folded, foldedLeft, foldedRight,\n          twofoldPercent,\n        } }\n    >\n      <Handle />\n      { location && !foldedRight && <F>\n\n        { markers && markers.length && <Collapsible\n            config={{ collapsible: false }}\n            slug={C.collapsible.markers}\n            variant={C.variants.transparent}\n        >\n          <MarkersList markers={markers}\n            variant={C.variants.bordered}\n          />\n        </Collapsible> || null }\n\n        { location.description && <Collapsible\n            label={location.labels.description}\n            slug={C.collapsible.description}\n            variant={C.variants.bordered}\n        >\n          <Description item={location} />\n        </Collapsible> || null }\n\n        { location.newsitems && location.newsitems.length && <Newsitems\n            variant={C.variants.bordered} newsitems={location.newsitems}\n        /> || null }\n\n      </F> || null }\n    </Right>\n\n    { showUrl && <IframeModal src={showUrl} /> }\n    { showItem && <ItemModal item={showItem} /> }\n    { loading && <Loading /> }\n    { !ratedConfirmation && <RatedRestrictionModal {...{ ratedConfirmation, setRatedConfirmation, }} /> }\n\n  </Row>\n}\n\nexport default LocationsShowDesktop\n","import { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport {\n  Breadcrumbs,\n  ItemModal,\n  MapPanel, MapPanelNoZoom, MarkersList,\n  WrappedMapPanel,\n} from \"./\"\nimport { Metaline } from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\nimport {\n  C, Collapsible, CollapsibleContext,\n  Loading, logg,\n  request,\n  S,\n  TwofoldContext,\n  useWindowSize,\n  ZoomContext,\n} from \"$shared\"\n\nconst Div1 = styled.div`\n  // border: 2px solid brown;\n\n  text-align: center;\n  display: block;\n\n  position: relative; /* required for mobile, so that zoomCtrl, etc are inside the collapsible div */\n\n  overflow: scroll;\n  max-height: 80vh; // @TODO: huh?\n`;\n\nconst CollapsibleNoMargins = styled(Collapsible)`\n  margin: 0;\n  padding: 0;\n`;\n\nconst _Description = styled.div`\n  // border: 1px solid red;\n\n  padding: 10px;\n`;\nconst Description = ({ item }) => {\n  return <_Description dangerouslySetInnerHTML={{ __html: item.description }} />\n}\n\nconst MapWrapper = styled.div`\n  // border: 1px solid red;\n\n  position: relative;\n`;\n\n\n/* W */\n\nconst W = styled.div`\n  // border: 1px solid yellow;\n`;\n\n/* Z */\n\nconst ZoomCtrlRoot = styled.div`\n  // border: 1px solid orange;\n\n  position: absolute;\n  top: 0;\n  left: calc(100vw - 80px);\n  background: white;\n  padding: 5px;\n\n  display: flex;\n  flex-direction: column;\n  z-index: 10;\n`;\n\nconst ZoomCtrl = (props) => {\n  const { zoom, setZoom } = useContext(TwofoldContext)\n\n  const zoomIn = () => {\n    setZoom(zoom/2)\n  }\n  const zoomOut = () => {\n    setZoom(zoom*2)\n  }\n  const zoomReset = () => {\n    setZoom(1)\n  }\n\n  return <ZoomCtrlRoot >\n    <span onClick={zoomIn} >[+]</span>\n    <span onClick={zoomOut} >[-]</span>\n    <span onClick={zoomReset} >[1]</span>\n  </ZoomCtrlRoot>\n}\n\n/**\n * LocationsShowMobile\n *\n */\nconst LocationsShowMobile = (props) => {\n  // logg(props, 'LocationsShowMobile')\n  const {\n    match,\n  } = props\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const [ windowWidth, windowHeight ] = useWindowSize()\n\n  const [loading, setLoading] = useState(false)\n  const [location, setLocation ] = useState(null)\n\n  const mountedRef = useRef('init')\n  const mapPanelRef = useRef(null)\n  const history = useHistory()\n\n  // Get the location data\n  useEffect(() => {\n    setLoading(true)\n    const token = localStorage.getItem(\"jwt_token\")\n    request.get(`/api/maps/view/${match.params.slug}`, { params: { jwt_token: token } }).then(res => {\n      if (mountedRef.current === match.params.slug) return null\n      setLocation(res.data.map)\n      setLoading(false)\n      // @TODO: setFlash here?! If I\"m accessing a gallery I haven't bought access to?\n    }).catch((e) => {\n      logg(e, 'e13')\n      history.push('/')\n    }).finally(() => {\n    })\n\n    return () => {\n      mountedRef.current = match.params.slug\n    }\n  }, [ match.params.slug ])\n\n\n  // @TODO: this can probably be much improved. Take either markers of location.map, or location itself.\n  // @TODO: why is this a redirect to /null ?!\n  let markers = []\n  if (location) {\n    markers = location.markers // location ? location.markers.length ? location.markers : location.map.markers : null\n  }\n\n  // set mapPanel sizes\n  useEffect(() => {\n    if (mapPanelRef.current) {\n      setMapPanelWidth(mapPanelRef.current.offsetWidth)\n      setMapPanelHeight(mapPanelRef.current.offsetHeight)\n    }\n  }, [bottomDrawerOpen, folded, mapPanelRef.current, twofoldPercent, windowWidth, windowHeight])\n\n  // This is to not have MapPanel, only MapPanelNoZoom on mobile _vp_ 2022-03-16\n  let map\n  if (location) {\n    map = location.map || location\n    map = { ...map, config: { ...map.config, map_panel_type: C.map_panel_types.MapPanelNoZoom } }\n  }\n\n  return (<W className='LocationsShowMobile' >\n\n    { loading && <i>Loading...</i> }\n\n    { location && <Breadcrumbs {...location} /> }\n    { location && <Collapsible\n        label={location.labels.map}\n        slug={C.collapsible.map}\n    ><WrappedMapPanel\n        map={map}\n        ref={mapPanelRef}\n        slug={match.params.slug}\n        withZoom={false}\n      />\n    </Collapsible> }\n\n    { /* @TODO: recursively render map (not location) as appropriate all around in these collapsibles. */ }\n    { markers && markers.length && <Collapsible\n        label={location.labels.markers}\n        slug={C.collapsible.markers}\n    ><MarkersList markers={markers} />\n    </Collapsible> || null }\n\n    { location && location.description && <Collapsible\n        config={location.config.description}\n        label={location.labels.description}\n        slug={C.collapsible.description}\n    ><Description item={location} />\n    </Collapsible> || null }\n\n    { location && location.newsitems.length && <Collapsible\n        label={location.labels.newsitems}\n        slug=\"news-sec\"\n    ><Newsitems newsitems={location.newsitems} />\n    </Collapsible> || null }\n\n    { showUrl  && <IframeModal src={showUrl} /> }\n    { showItem && <ItemModal item={showItem} /> }\n    { loading  && <Loading /> }\n\n  </W>)\n}\n\nexport default LocationsShowMobile\n","import PropTypes from 'prop-types'\nimport React, { useContext, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport { logg, TwofoldContext } from \"$shared\"\n\nconst Div1 = styled.div`\n  // border: 3px solid green;\n\n  text-align: center;\n  display: block;\n\n  position: relative;\n  overflow: auto;\n\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.theme.breadcrumbsHeight}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n\n`;\n\n/* Same size as the map image.\n * What scrolls is this div, not the image inside it.\n */\nconst Img = styled.div`\n  // border: 2px solid cyan;\n  display: inline-block;\n  position: relative;\n`;\n\nconst Root = styled.div`\n  border: ${p=>p.debug?'1':'0'}px solid red;\n\n  position: relative;\n  overflow: auto;\n\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.theme.breadcrumbsHeight}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n\n`;\n\nconst ZoomCtrl = (props) => {\n  const { zoom, setZoom } = useContext(TwofoldContext)\n\n  const zoomIn = () => {\n    setZoom(zoom/2)\n  }\n  const zoomOut = () => {\n    setZoom(zoom*2)\n  }\n  const zoomReset = () => {\n    setZoom(1)\n  }\n\n  return <div style={{\n    position: 'absolute',\n    top: 0,\n    right: 0,\n    zIndex: 1,\n    background: 'white',\n    padding: '5px',\n\n    display: 'flex',\n    flexDirection: 'column',\n  }} >\n    <span onClick={zoomIn} >[+]</span>\n    <span onClick={zoomOut} >[-]</span>\n    <span onClick={zoomReset} >[1]</span>\n  </div>\n}\n\nconst MapPanel = (props) => {\n  // logg(props, 'MapPanel')\n  const { map, withZoom=true } = props\n\n  const {\n    bottomDrawerOpen, setBottomDrawerOpen,\n    showUrl, setShowUrl,\n    zoom, setZoom,\n  } = useContext(TwofoldContext)\n\n  const div1Ref = useRef(null)\n\n  const history = useHistory()\n\n  useEffect(() => {\n    // div1Ref.current.scrollIntoView({ block: 'end', inline: 'center' })\n    div1Ref.current.scroll({\n      top: 200,\n      left: 200,\n      behavior: 'smooth',\n     })\n  }, [])\n\n  const markers = []\n  map.markers.map((m, idx) => {\n    const out = <div\n      key={idx}\n      onClick={() => m.url ? setShowUrl(m.url) : history.push(`/en/locations/show/${m.slug}`) }\n      style={{\n        position: 'absolute',\n        top: ((m.y- m.centerOffsetY )/zoom),\n        left: ((m.x- m.centerOffsetX )/zoom),\n      }} ><img src={m.img_path} style={{\n        display: 'block',\n        maxWidth: `${m.w/zoom}px`,\n        maxHeight: `${m.h/zoom}px`,\n        width: `${m.w/zoom}px`, height: `${m.h/zoom}px`,\n      }} /></div>\n    markers.push(out)\n  })\n\n  return <Root {...{ bottomDrawerOpen }} debug={config.debug} className='MapPanel' >\n    { withZoom && <ZoomCtrl /> }\n\n    <Div1 {...{ bottomDrawerOpen }} >\n      <Img ref={div1Ref} style={{\n        width: `${map.w/zoom}px`,\n        height: `${map.h/zoom}px`,\n      }} >\n        <img\n          src={map.img_path}\n          style={{\n            width: `${map.w/zoom}px`,\n            height: `${map.h/zoom}px`,\n          }}\n        />\n        { markers }\n      </Img>\n    </Div1>\n\n  </Root>\n}\n\nMapPanel.propTypes = {\n  map: PropTypes.object.isRequired,\n  withZoom: PropTypes.bool, // @TODO: I don't like it, I'd like it to be inside a config obj.\n}\nexport default MapPanel\n\n\n","import { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport {\n  C,\n  logg, logg4,\n  TwofoldContext,\n  useWindowSize,\n} from \"$shared\"\n\n\n// W\nconst W0 = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.background};\n\n  height: 100%;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst W1 = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  position: relative;\n  height: 100%;\n`;\n\n\n/*\n * _vp_ 2021-09 @TODO: merge this into MapPanel, have zoom={false} as a prop\n * But I couldn't do it in 10 mins... It's a bit complicated?\n *\n * _vp_ 2021-10-29 But actually this component is getting more work than the zoom one right now...\n */\nconst MapPanelNoZoom = (props) => {\n  // logg(props, 'MapPanelNoZoom')\n  const { map } = props\n\n  const {\n    bottomDrawerOpen,\n    mapPanelWidth, mapPanelHeight,\n    zoom, setZoom,\n  } = useContext(TwofoldContext)\n  // logg(useContext(TwofoldContext), 'MapPanelNoZoomUsedContext')\n\n  const history = useHistory()\n  const [ windowWidth, windowHeight ] = useWindowSize()\n  // logg(useWindowSize(), 'usedWindowSize')\n\n\n  /*\n   * Sets the zoom (in panelNoZoom) to full-panel _vp_ 2021-10-29\n   * w: 1184 h: 819\n   */\n  useEffect(() => {\n    // logg([windowWidth, windowHeight, map.w, map.h], 'MapPanelNoZoom setting zoom')\n    if (windowWidth === 0) { return; }\n\n    let nextZoomByWidth = windowWidth/map.w // .3 mobile // 1.94 desktop\n    let nextZoomByHeight = windowHeight/map.h // .9 mobile // .82 desktop\n    // logg4([nextZoomByWidth, nextZoomByHeight], 'nextZoomOptions')\n\n    let nextZoom = Math.min(nextZoomByWidth, nextZoomByHeight)\n    const slack = 0.01 // image should not overlap with the border... 1% slack added.\n    nextZoom = nextZoom + slack\n\n    setZoom(nextZoom)\n  }, [\n    mapPanelWidth, mapPanelHeight, map.id,\n    windowWidth, windowHeight,\n  ])\n\n\n\n  const markers = []\n  props.map.markers.map((m, idx) => {\n    const out = <div\n      key={idx}\n      onClick={() => history.push(`/en/locations/show/${m.slug}`) }\n      style={{\n        position: 'absolute',\n        top: m.y*zoom,\n        left: m.x*zoom,\n        zIndex: 2,\n      }} ><img src={m.img_path} style={{\n        display: 'block',\n        maxWidth: `${m.w*zoom}px`,\n        maxHeight: `${m.h*zoom}px`,\n        width: 'auto', height: 'auto',\n      }} /></div>\n    markers.push(out)\n  })\n\n\n  return <W0 className=\"MapPanelNoZoom W0\" >\n    <W1 className=\"W1\" >\n      <img\n        src={map.img_path}\n        style={{\n          // width: `${map.w*zoom}px`,\n          // height: `${map.h*zoom}px`,\n\n          maxWidth: '100%',\n          maxHeight: '100%',\n          width: 'auto',\n          height: 'auto',\n\n          position: 'relative',\n          zIndex: 1,\n        }}\n      />\n      { markers }\n    </W1>\n  </W0>\n}\n\nexport default MapPanelNoZoom\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport {\n  C,\n  logg, S, TwofoldContext,\n  PurchasedIcon,\n  WBordered, WBorderedItem,\n} from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\n\n/* M */\nconst _Marker = styled.div`\n  color: ${p => p.theme.colors.text};\n\n  margin-bottom: 10px;\n  max-width: 33%;\n  min-width: 100px;\n\n  text-align: center;\n\n  width: min(33%, 100px);\n`;\nconst Marker = ({ children, variant, ...props }) => {\n  if (variant===C.variants.bordered) {\n    return <WBorderedItem {...props} >{children}</WBorderedItem>\n  } else {\n    return <_Marker className=\"Marker\" {...props} >{children}</_Marker>\n  }\n}\n\n/* W */\nconst _W = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  // justify-content: flex-start;\n\n  ::after {\n    content: \"\";\n    flex: auto;\n  }\n`;\nconst W = ({ children, variant, ...props }) => {\n  if (variant===C.variants.bordered) {\n    return <WBordered {...props}>{children}</WBordered>\n  } else {\n    return <_W {...props}>{children}</_W>\n  }\n}\n\n/**\n * Default\n */\nconst MarkersList = (props) => {\n  // logg(props, 'MarkersList')\n  const { variant } = props\n\n  const {\n    itemToUnlock, setItemToUnlock,\n    showUrl, setShowUrl,\n  } = useContext(TwofoldContext)\n\n  const history = useHistory()\n\n  const goto = (m) => {\n    if (m.premium_tier && !m.is_purchased) {\n      setItemToUnlock({ ...m })\n    } else {\n      if (m.url) {\n        setShowUrl(m.url)\n      }\n      else {\n        history.push(`/en/locations/show/${m.slug}`)\n      }\n    }\n  }\n\n  const out = []\n  props.markers.map((m, idx) => {\n    out.push(<Marker className=\"Marker\" key={idx} variant={variant}\n      onClick={() => goto(m) }\n    >\n      <img src={m.title_img_path} /><br />\n      { m.is_purchased && <PurchasedIcon /> }\n      { m.name }\n    </Marker>)\n  })\n\n  return <W className=\"MarkersList\" >\n    {out}\n  </W>\n}\n\nMarkersList.propTypes = {\n  variant: PropTypes.string,\n}\nexport default MarkersList\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { C, logg, request, S, TwofoldContext, ZoomContext } from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport { GalleriesShow } from \"$components/galleries\"\nimport { ReportsShow } from \"$components/reports\"\nimport { Newsitems } from \"$components/newsitems\"\n\n/*\n * RatedRestrictionModal\n */\nconst RatedRestrictionModal = (props) => {\n  // logg(props, 'RatedRestrictionModal')\n  const { ratedConfirmation, setRatedConfirmation } = props\n\n  return <Modal isOpen={!ratedConfirmation} >\n    <p>You must be 18 years of age or older to view this content.</p>\n    <button onClick={() => setRatedConfirmation(true) } >I am over 18</button>\n    &nbsp; &nbsp;\n    <button onClick={() => window.location = 'https://disney.com' } >I am NOT over 18</button>\n  </Modal>\n}\n\nexport default RatedRestrictionModal\n","\nimport React from 'react'\nimport styled from 'styled-components'\n\nconst Crosshair = styled.div`\n// border: 2px solid yellow;\n\nwidth: 50px;\nheight: 50px;\n\nposition: absolute;\nleft: 50%;\ntop: 50%;\n\n::before {\n  content: '';\n  position: absolute;\n  border-color: white;\n  border-style: solid;\n  border-width: 0 2px 0 0;\n  height: 20px;\n  top: -10px;\n  left: -1px;\n  transform: rotate(90deg);\n\n  // margin-top: -1em;\n\n}\n::after {\n  content: '';\n  position: absolute;\n  border-color: white;\n  border-style: solid;\n  border-width: 0 2px 0 0;\n  height: 20px;\n  top: -10px;\n  left: -1px;\n\n  // margin-top: -1em;\n  // width: 0.5em;\n}\n`;\n\nexport default Crosshair\n","import {\n\tEuler, EventDispatcher, Vector3,\n} from \"three\"\n\nconst _euler = new Euler( 0, 0, 0, 'YXZ' );\nconst _vector = new Vector3();\n\nconst _changeEvent = { type: 'change' };\nconst _lockEvent = { type: 'lock' };\nconst _unlockEvent = { type: 'unlock' };\n\nconst _PI_2 = Math.PI / 2;\n\nclass PointerLockControls extends EventDispatcher {\n\n\tconstructor( camera, domElement ) {\n\n\t\tsuper();\n\n\t\tif ( domElement === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.PointerLockControls: The second parameter \"domElement\" is now mandatory.' );\n\t\t\tdomElement = document.body;\n\n\t\t}\n\n\t\tthis.domElement = domElement;\n\t\tthis.isLocked = false;\n\n\t\t// Set to constrain the pitch of the camera\n\t\t// Range is 0 to Math.PI radians\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\tconst scope = this;\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tif ( scope.isLocked === false ) return;\n\n\t\t\tconst movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\n\t\t\tconst movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\n\n\t\t\t_euler.setFromQuaternion( camera.quaternion );\n\n\t\t\t_euler.y -= movementX * 0.002;\n\t\t\t_euler.x -= movementY * 0.002;\n\n\t\t\t_euler.x = Math.max( _PI_2 - scope.maxPolarAngle, Math.min( _PI_2 - scope.minPolarAngle, _euler.x ) );\n\n\t\t\tcamera.quaternion.setFromEuler( _euler );\n\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t}\n\n\t\tfunction onPointerlockChange() {\n\n\t\t\tif ( scope.domElement.ownerDocument.pointerLockElement === scope.domElement ) {\n\n\t\t\t\tscope.dispatchEvent( _lockEvent );\n\n\t\t\t\tscope.isLocked = true;\n\n\t\t\t} else {\n\n\t\t\t\tscope.dispatchEvent( _unlockEvent );\n\n\t\t\t\tscope.isLocked = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerlockError() {\n\n\t\t\tconsole.error( 'THREE.PointerLockControls: Unable to use Pointer Lock API' );\n\n\t\t}\n\n\t\tthis.connect = function () {\n\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'mousemove', onMouseMove );\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointerlockchange', onPointerlockChange );\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointerlockerror', onPointerlockError );\n\n\t\t};\n\n\t\tthis.disconnect = function () {\n\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'mousemove', onMouseMove );\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerlockchange', onPointerlockChange );\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerlockerror', onPointerlockError );\n\n\t\t};\n\n\t\tthis.dispose = function () {\n\n\t\t\tthis.disconnect();\n\n\t\t};\n\n\t\tthis.getObject = function () { // retaining this method for backward compatibility\n\n\t\t\treturn camera;\n\n\t\t};\n\n\t\tthis.getDirection = function () {\n\n\t\t\tconst direction = new Vector3( 0, 0, - 1 );\n\n\t\t\treturn function ( v ) {\n\n\t\t\t\treturn v.copy( direction ).applyQuaternion( camera.quaternion );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tthis.moveForward = function ( distance ) {\n\n\t\t\t// move forward parallel to the xz-plane\n\t\t\t// assumes camera.up is y-up\n\n\t\t\t_vector.setFromMatrixColumn( camera.matrix, 0 );\n\n\t\t\t_vector.crossVectors( camera.up, _vector );\n\n\t\t\tcamera.position.addScaledVector( _vector, distance );\n\n\t\t};\n\n\t\tthis.moveRight = function ( distance ) {\n\n\t\t\t_vector.setFromMatrixColumn( camera.matrix, 0 );\n\n\t\t\tcamera.position.addScaledVector( _vector, distance );\n\n\t\t};\n\n\t\tthis.lock = function () {\n\n\t\t\tthis.domElement.requestPointerLock();\n\n\t\t};\n\n\t\tthis.unlock = function () {\n\n\t\t\tscope.domElement.ownerDocument.exitPointerLock();\n\n\t\t};\n\n\t\tthis.connect();\n\n\t}\n\n}\n\nexport {\n\tPointerLockControls,\n}\n\nconst unlockEvent = _unlockEvent\nexport { unlockEvent }\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  border: 2px solid red;\n\n  position: relative;\n  // height: calc(100% - ${p => p.breadcrumbsHeight});\n  width: 700px;\n  height: 350px;\n\n  #Crosshair {\n    // border: 1px solid yellow;\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\n/**\n * Equirectangular\n * _vp_ 2021-11-13\n * It works, it shows the panoramic.\n *\n */\nconst Equirectangular = (props) => {\n  logg(props, 'Equirectangular')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n\n    /*\n     * Crosshair\n     * From: https://codepen.io/driezis/pen/jOPzjLG?editors=1000\n     */\n    var pMat = new THREE.ShaderMaterial({\n        uniforms: { main_color: {value: {r: 1, g: 1, b: 1}},\n                    border_color: {value: {r: 0, g: 0, b: 0.1}},\n\n                    thickness: {value:0.006},\n                    height: {value:0.13},\n                    offset: {value:0.05},\n                    border: {value:0.003},\n\n                    opacity: {value: 1},\n                    center: {value: {x: 0.5, y: 0.5}},\n                    rotation: {value: 0}\n                },\n        vertexShader: `\n                uniform float rotation;\n                uniform vec2 center;\n                #include <common>\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec2 scale;\n                    scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n                    scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n                    #ifndef USE_SIZEATTENUATION\n                        bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n                        if ( isPerspective ) scale *= - mvPosition.z;\n                    #endif\n                    vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n                    vec2 rotatedPosition;\n                    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n                    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n                    mvPosition.xy += rotatedPosition;\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n        fragmentShader: `\n            uniform vec3 main_color;\n            uniform vec3 border_color;\n            uniform float opacity;\n\n            uniform float thickness;\n            uniform float height;\n            uniform float offset;\n            uniform float border;\n\n            varying vec2 vUv;\n            void main() {\n\n                float a = (step(abs(vUv.x - 0.5), thickness)) * step(abs(vUv.y - 0.5), height + offset) * step(offset, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness)) * step(abs(vUv.x - 0.5), height + offset) * step(offset, abs(vUv.x - 0.5));\n                float b = (step(abs(vUv.x - 0.5), thickness - border)) * step(abs(vUv.y - 0.5), height + offset - border) * step(offset + border, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness - border)) * step(abs(vUv.x - 0.5), height + offset - border) * step(offset + border, abs(vUv.x - 0.5));\n                gl_FragColor = vec4( mix(border_color, main_color, b), a * opacity);\n            }\n        `,\n        transparent: true,\n    });\n    var sprite = new THREE.Sprite(pMat);\n    // scene.add(sprite);\n    // sprite.position.set(0,0,-5);\n\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    // document.addEventListener( 'keydown', onKeyDown )\n    // document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Floor\n     */\n\n    // // random\n    // // @TODO: it's not aligned to parcels the way I want\n    // let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    // floorGeometry.rotateX( - Math.PI / 2 )\n\n    // // vertex displacement\n    // let position = floorGeometry.attributes.position\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   vertex.fromBufferAttribute( position, i )\n    //   vertex.x += Math.random() * 20 - 10\n    //   vertex.y += Math.random() * 2\n    //   vertex.z += Math.random() * 20 - 10\n    //   position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    // }\n    // floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    // floorGeometry.x = -200\n    // floorGeometry.y = -200\n    // floorGeometry.z = -200\n    // position = floorGeometry.attributes.position\n    // const colorsFloor = []\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n    //   colorsFloor.push( color.r, color.g, color.b )\n    // }\n    // floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    // const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n\n\n\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    // let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    // floorGeometry.rotateX( - Math.PI / 2 )\n    // texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`) // moon floor\n    // const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    // const scenesPath = '/assets/scenes/'\n    // const objectsPath = '/assets/objects/'\n    // let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    // const texturePath = `${modelName}/${modelName}.mtl`\n    // const modelPath = `${modelName}/${modelName}.obj`\n    // const manager = new THREE.LoadingManager()\n    // const onProgress = (xhr) => {\n    //   if (xhr.lengthComputable) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }\n    // const onError = () => {}\n    // const onLoad = (materials) => {\n    //   materials.preload()\n    //   const objLoader = new OBJLoader( manager )\n    //   objLoader.setMaterials( materials )\n    //   objLoader.setPath( scenesPath)\n    //   objLoader.load( modelPath, ( object ) => {\n    //     object.traverse((child) => {\n    //       if (child.isMesh) {\n    //         child.geometry.scale(0.10, 0.10, 0.10) // @TODO: change?\n    //       }\n    //     })\n    //     object.position.x = Math.random() * 500\n    //     object.position.y = 10\n    //     object.position.z = Math.random() * 500\n\n    //     logg(object, '1st object')\n    //     scene.add( object )\n    //     markerObjects.push( object )\n    //     markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' }) // @TODO: change!\n\n    //   }, onProgress, onError )\n    // }\n    // const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setPath(scenesPath)\n    // mtlLoader.load(texturePath, onLoad)\n\n\n    /*\n     * Skybox\n     */\n    const textureLoader = new THREE.TextureLoader()\n    const assetPath = map.img_path\n    texture = textureLoader.load(assetPath, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( 700, 350 ) // aspect ratio 0.5\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} >\n      <div id=\"Crosshair\" />\n    </Blocker>\n  </F>\n}\n\nexport default Equirectangular\n","\"use strict\";\n\nfunction TouchControls({ container, camera, options, THREE, RotationPad }) {\n\n\tvar self = this;\n\tself.config = $.extend({\n\t\tspeedFactor: 0.5,\n\t\tdelta: 1,\n\t\trotationFactor: 0.002,\n\t\tmaxPitch: 55,\n\t\thitTest: true,\n\t\thitTestDistance: 40\n\t}, options);\n\n\tvar container = container;\n\tvar isRightMouseDown = false;\n\tvar rotationMatrices = [];\n\tvar hitObjects = [];\n\n\tvar moveForward = false;\n\tvar moveBackward = false;\n\tvar moveLeft = false;\n\tvar moveRight = false;\n\tvar lockMoveForward = false;\n\tvar lockMoveBackward = false;\n\tvar lockMoveLeft = false;\n\tvar lockMoveRight = false;\n\n\tvar ztouch = 1, xtouch = 1;\n\tvar PI_2 = Math.PI / 2;\n\tvar maxPitch = self.config.maxPitch * Math.PI / 180;\n\tvar velocity = new THREE.Vector3(0, 0, 0);\n\n\tvar cameraHolder = new THREE.Object3D();\n\tcameraHolder.name = \"cameraHolder\";\n\tcameraHolder.add(camera);\n\n\tself.scene = null;\n\tself.fpsBody = new THREE.Object3D();\n\tself.fpsBody.add(cameraHolder);\n\tself.enabled = true;\n\n\tself.mouse = new THREE.Vector2();\n\n\t// Creating rotation pad:\n\tself.rotationPad = new RotationPad(container);\n\t$(self.rotationPad).on(\"YawPitch\", function(event) {\n\t\tvar rotation = calculateCameraRotation(event.detail.deltaX, event.detail.deltaY);\n\t\tself.setRotation(rotation.rx, rotation.ry);\n\t});\n\n\t// Creating movement pad:\n\tself.movementPad = new MovementPad(container);\n\t$(self.movementPad).on(\"move\", function(event) {\n\t\tztouch = Math.abs(event.detail.deltaY);\n\t\txtouch = Math.abs(event.detail.deltaX);\n\n\t\tif (event.detail.deltaY == event.detail.middle) {\n\t\t\tztouch = 1;\n\t\t\tmoveForward = moveBackward = false;\n\t\t} else {\n\t\t\tif (event.detail.deltaY > event.detail.middle) {\n\t\t\t\tmoveForward = true;\n\t\t\t\tmoveBackward = false;\n\t\t\t}\n\t\t\telse if (event.detail.deltaY < event.detail.middle) {\n\t\t\t\tmoveForward = false;\n\t\t\t\tmoveBackward = true;\n\t\t\t}\n\t\t}\n\n\t\tif (event.detail.deltaX == event.detail.middle) {\n\t\t\txtouch = 1;\n\t\t\tmoveRight = moveLeft = false;\n\t\t} else {\n\t\t\tif (event.detail.deltaX < event.detail.middle) {\n\t\t\t\tmoveRight = true;\n\t\t\t\tmoveLeft = false;\n\t\t\t}\n\t\t\telse if (event.detail.deltaX > event.detail.middle) {\n\t\t\t\tmoveRight = false;\n\t\t\t\tmoveLeft = true;\n\t\t\t}\n\t\t}\n\t});\n\t$(self.movementPad).on(\"stopMove\", function(event) {\n\t\tztouch = xtouch = 1;\n\t\tmoveForward = moveBackward = moveLeft = moveRight = false;\n\t});\n\n\tcontainer.on(\"contextmenu\", onContextMenu);\n\tcontainer.on(\"mousedown\", onMouseDown);\n\tcontainer.on(\"mouseup\", onMouseUp);\n\n\t$(document).on(\"keydown\", onKeyDown);\n\t$(document).on(\"keyup\", onKeyUp);\n\t$(document).on(\"mousemove\", onMouseMove);\n\t$(document).on(\"mouseout\", onMouseOut);\n\n\tprepareRotationMatrices();\n\n\t//\n\t// Events:\n\t//\n\tfunction onContextMenu(event) {\n\t\tevent.preventDefault();\n\t};\n\n\tfunction onMouseDown(event) {\n\n\t\tif (self.enabled && event.button === 2) {\n\t\t\tisRightMouseDown = true;\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t}\n\t};\n\n\tfunction onMouseUp(event) {\n\n\t\tif (self.enabled && event.button === 2) {\n\t\t\tisRightMouseDown = false;\n\t\t}\n\t};\n\n\tfunction onMouseMove(event) {\n\n\t\tself.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\n\t\tself.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n\n\t\tif (!self.enabled || !isRightMouseDown) return;\n\n\t\tvar movementX = event.originalEvent.movementX || event.originalEvent.mozMovementX || event.originalEvent.webkitMovementX || 0;\n\t\tvar movementY = event.originalEvent.movementY || event.originalEvent.mozMovementY || event.originalEvent.webkitMovementY || 0;\n\t\tvar rotation = calculateCameraRotation(-1 * movementX, -1 * movementY);\n\n\t\t// console.log(self.mouse, \"\\n\", movementX, rotation);\n\n\t\tself.setRotation(rotation.rx, rotation.ry);\n\n\t\t// updateNavPad();\n\t};\n\n\tfunction onMouseOut(e) {\n\t\tisRightMouseDown = false;\n\t\t// self.stopMouseMoving();\n\t};\n\n\tfunction onKeyDown(e) {\n\n\t\tif (!self.enabled) return;\n\n\t\tswitch (e.keyCode) {\n\n\t\t\tcase 38: // up\n\t\t\tcase 87: // w\n\t\t\t\tmoveForward = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 37: // left\n\t\t\tcase 65: // a\n\t\t\t\tmoveLeft = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 40: // down\n\t\t\tcase 83: // s\n\t\t\t\tmoveBackward = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 39: // right\n\t\t\tcase 68: // d\n\t\t\t\tmoveRight = true;\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tfunction onKeyUp(e) {\n\n\t\tswitch (e.keyCode) {\n\n\t\t\tcase 38: // up\n\t\t\tcase 87: // w\n\t\t\t\tmoveForward = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 37: // left\n\t\t\tcase 65: // a\n\t\t\t\tmoveLeft = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 40: // down\n\t\t\tcase 83: // a\n\t\t\t\tmoveBackward = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 39: // right\n\t\t\tcase 68: // d\n\t\t\t\tmoveRight = false;\n\t\t\t\tbreak;\n\n\t\t}\n\t};\n\n\t//\n\t// Private functions:\n\t//\n\tfunction prepareRotationMatrices() {\n\n\t\tvar rotationMatrixF = new THREE.Matrix4();\n\t\trotationMatrixF.makeRotationY(0);\n\t\trotationMatrices.push(rotationMatrixF); // forward direction.\n\n\t\tvar rotationMatrixB = new THREE.Matrix4();\n\t\trotationMatrixB.makeRotationY(180 * Math.PI / 180);\n\t\trotationMatrices.push(rotationMatrixB);\n\n\t\tvar rotationMatrixL = new THREE.Matrix4();\n\t\trotationMatrixL.makeRotationY(90 * Math.PI / 180);\n\t\trotationMatrices.push(rotationMatrixL);\n\n\t\tvar rotationMatrixR = new THREE.Matrix4();\n\t\trotationMatrixR.makeRotationY((360 - 90) * Math.PI / 180);\n\t\trotationMatrices.push(rotationMatrixR);\n\t};\n\n\tfunction calculateCameraRotation(dx, dy, factor) {\n\t\tvar factor = factor ? factor : self.config.rotationFactor;\n\t\tvar ry = self.fpsBody.rotation.y - (dx * factor);\n\t\tvar rx = cameraHolder.rotation.x - (dy * factor);\n\t\trx = Math.max(-maxPitch, Math.min(maxPitch, rx));\n\n\t\treturn {\n\t\t\trx: rx,\n\t\t\try: ry\n\t\t};\n\t};\n\n\tfunction lockDirectionByIndex(index) {\n\t\tif (index == 0)\n\t\t\tself.lockMoveForward(true);\n\t\telse if (index == 1)\n\t\t\tself.lockMoveBackward(true);\n\t\telse if (index == 2)\n\t\t\tself.lockMoveLeft(true);\n\t\telse if (index == 3)\n\t\t\tself.lockMoveRight(true);\n\t}\n\n\t//\n\t// Public functions:\n\t//\n\tself.update = function() {\n\t\tif (self.config.hitTest)\n\t\t\tself.hitTest();\n\n\t\tvelocity.x += (-1 * velocity.x) * 0.75 * self.config.delta;\n\t\tvelocity.z += (-1 * velocity.z) * 0.75 * self.config.delta;\n\n\t\tif (moveForward && !lockMoveForward) velocity.z -= ztouch * self.config.speedFactor * self.config.delta;\n\t\tif (moveBackward && !lockMoveBackward) velocity.z += ztouch * self.config.speedFactor * self.config.delta;\n\n\t\tif (moveLeft && !lockMoveLeft) velocity.x -= xtouch * self.config.speedFactor * self.config.delta;\n\t\tif (moveRight && !lockMoveRight) velocity.x += xtouch * self.config.speedFactor * self.config.delta;\n\n\t\tself.fpsBody.translateX(velocity.x);\n\t\tself.fpsBody.translateY(velocity.y);\n\t\tself.fpsBody.translateZ(velocity.z);\n\t};\n\n\tself.hitTest = function() {\n\t\tself.unlockAllDirections();\n\t\thitObjects = [];\n\t\tvar cameraDirection = self.getDirection2(new THREE.Vector3(0, 0, 0)).clone();\n\n\t\tfor (var i = 0; i < 4; i++) {\n\t\t\t// Applying rotation for each direction:\n\t\t\tvar direction = cameraDirection.clone();\n\t\t\tdirection.applyMatrix4(rotationMatrices[i]);\n\n\t\t\tvar rayCaster = new THREE.Raycaster(self.fpsBody.position, direction);\n\t\t\tvar intersects = rayCaster.intersectObject(self.scene, true);\n\t\t\tif ((intersects.length > 0 && intersects[0].distance < self.config.hitTestDistance)) {\n\t\t\t\tlockDirectionByIndex(i);\n\t\t\t\thitObjects.push(intersects[0]);\n\t\t\t\t// console.log(intersects[0].object.name, i);\n\t\t\t}\n\t\t}\n\n\t\treturn hitObjects;\n\t};\n\n\tself.getDirection2 = function(v) {\n\t\tvar self = this;\n\t\tvar direction = new THREE.Vector3(0, 0, -1);\n\t\tvar rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\n\t\tvar rx = self.fpsBody.getObjectByName(\"cameraHolder\").rotation.x;;\n\t\tvar ry = self.fpsBody.rotation.y;\n\n\t\t// console.log(\"DIRECTION:\", this);\n\t\trotation.set(rx, ry, 0);\n\t\tv.copy(direction).applyEuler(rotation);\n\t\t// console.log(v);\n\t\treturn v;\n\t};\n\n\tself.getDirection = function() {\n\t\tvar self = this;\n\t\tvar rx = 0;\n\t\tvar ry = 0;\n\t\tvar direction = new THREE.Vector3(0, 0, -1);\n\t\tvar rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\n\n\t\t// console.log(\"DIRECTION:\", this);\n\t\tif (self != undefined) {\n\t\t\trx = self.fpsBody.getObjectByName(\"cameraHolder\").rotation.x;\n\t\t\try = self.fpsBody.rotation.y;\n\t\t\tconsole.log(rx, ry);\n\t\t}\n\t\t// var camHolder = self.fpsBody.getObjectByName(\"cameraHolder\");\n\n\t\treturn function(v) {\n\t\t\trotation.set(rx, ry, 0);\n\t\t\tv.copy(direction).applyEuler(rotation);\n\t\t\t// console.log(v);\n\t\t\treturn v;\n\t\t}\n\t}();\n\n\tself.moveLeft = function() {\n\t\treturn moveLeft;\n\t};\n\n\tself.moveRight = function() {\n\t\treturn moveRight;\n\t};\n\n\tself.moveForward = function() {\n\t\treturn moveForward;\n\t};\n\n\tself.moveBackward = function() {\n\t\treturn moveBackward;\n\t};\n\n\tself.lockMoveForward = function(boolean) {\n\t\tlockMoveForward = boolean;\n\t};\n\n\tself.lockMoveBackward = function(boolean) {\n\t\tlockMoveBackward = boolean;\n\t};\n\n\tself.lockMoveLeft = function(boolean) {\n\t\tlockMoveLeft = boolean;\n\t};\n\n\tself.lockMoveRight = function(boolean) {\n\t\tlockMoveRight = boolean;\n\t};\n\n\tself.unlockAllDirections = function() {\n\t\tself.lockMoveForward(false);\n\t\tself.lockMoveBackward(false);\n\t\tself.lockMoveLeft(false);\n\t\tself.lockMoveRight(false);\n\t};\n};\n\nTouchControls.prototype = {\n\taddToScene: function(scene) {\n\t\tthis.scene = scene;\n\t\tscene.add(this.fpsBody);\n\t},\n\n\tsetPosition: function(x, y, z) {\n\t\tthis.fpsBody.position.set(x, y, z);\n\t},\n\n\tstopMouseMoving: function() {\n\t\tisRightMouseDown = false;\n\t},\n\n\tsetRotation: function(x, y) {\n\t\tvar camHolder = this.fpsBody.getObjectByName(\"cameraHolder\");\n\n\t\tif (x !== null)\n\t\t\tcamHolder.rotation.x = x;\n\n\t\tif (y !== null)\n\t\t\tthis.fpsBody.rotation.y = y;\n\t},\n\n\tgetHitObjects: function() {\n\t\treturn hitObjects;\n\t}\n\n};\n\nexport default TouchControls\n","import React, { useRef, } from 'react'\nimport styled from 'styled-components'\n\nconst RotationPad = (props) => {\n\t// logg(props, 'RotationPad')\n\n\tvar mouseDown = false;\n\tvar mouseStopped = false;\n\tvar mouseStopTimeout, eventRepeatTimeout;\n\tvar newLeft, newTop, distance, angle;\n\n\tconst handleRef = useRef(null)\n\tconst handleEl = handleRef.current\n\tconst regionRef = useRef(null)\n\tconst regionEl = regionRef.current\n\n\t/* Aligning pad: */\n\t// rotationPadEl.css({\n\t// \ttop: container.find(\"canvas\").height() + container.position().top - regionEl.outerHeight() - 10,\n\t// \tleft: container.find(\"canvas\").width() - regionEl.outerWidth() - 20\n\t// });\n\n\n\n\tconst regionData = {};\n\tconst handleData = {};\n\n\t// regionData.width = regionEl.outerWidth();\n\t// regionData.height = regionEl.outerHeight();\n\t// regionData.position = regionEl.position();\n\t// regionData.offset = regionEl.offset();\n\t// regionData.radius = regionData.width / 2;\n\t// regionData.centerX = regionData.position.left + regionData.radius;\n\t// regionData.centerY = regionData.position.top + regionData.radius;\n\n\t// handleData.width = handleEl.outerWidth();\n\t// handleData.height = handleEl.outerHeight();\n\t// handleData.radius = handleData.width / 2;\n\n\t// regionData.radius = regionData.width / 2 - handleData.radius;\n\n\tconst resetHandlePosition = () => {\n\t\thandleEl.animate({\n\t\t\ttop: this.regionData.centerY - handleData.radius,\n\t\t\tleft: this.regionData.centerX - handleData.radius,\n\t\t\topacity: 0.1\n\t\t}, \"fast\");\n\t}\n\n\t// Mouse events:\n\tregionEl && regionEl.on(\"mousedown\", function (event) {\n\t\tmouseDown = true;\n\t\thandleEl.css(\"opacity\", \"1.0\");\n\t\tupdate(event.pageX, event.pageY);\n\t});\n\n\t$(document).on(\"mouseup\", function () {\n\t\tmouseDown = false;\n\t\thandleEl && resetHandlePosition();\n\t});\n\n\t$(document).on(\"mousemove\", function(event) {\n\t\tif (!mouseDown) return;\n\t\tupdate(event.pageX, event.pageY);\n\t});\n\n\t//Touch events:\n\tregionEl && regionEl.on(\"touchstart\", function (event) {\n\t\tmouseDown = true;\n\t\thandleEl.css(\"opacity\", \"1.0\");\n\t\tupdate(event.originalEvent.targetTouches[0].pageX, event.originalEvent.targetTouches[0].pageY);\n\t});\n\n\t$(document).on(\"touchend touchcancel\", function () {\n\t\tmouseDown = false;\n\t\thandleEl && resetHandlePosition();\n\t});\n\n\t$(document).on(\"touchmove\", function(event) {\n\t\tif (!mouseDown) return;\n\t\tupdate(event.originalEvent.touches[0].pageX, event.originalEvent.touches[0].pageY);\n\t});\n\n\n\tfunction update(pageX, pageY) {\n\t\tnewLeft = (pageX - regionData.offset.left);\n\t\tnewTop = (pageY - regionData.offset.top);\n\n\t\t// If handle reaches the pad boundaries.\n\t\tdistance = Math.pow(regionData.centerX - newLeft, 2) + Math.pow(regionData.centerY - newTop, 2);\n\t\tif (distance > Math.pow(regionData.radius, 2)) {\n\t\t\tangle = Math.atan2((newTop - regionData.centerY), (newLeft - regionData.centerX));\n\t\t\tnewLeft = (Math.cos(angle) * regionData.radius) + regionData.centerX;\n\t\t\tnewTop = (Math.sin(angle) * regionData.radius) + regionData.centerY;\n\t\t}\n\t\tnewTop = Math.round(newTop * 10) / 10;\n\t\tnewLeft = Math.round(newLeft * 10) / 10;\n\n\t\thandleEl.css({\n\t\t\ttop: newTop - handleData.radius,\n\t\t\tleft: newLeft - handleData.radius\n\t\t});\n\t\t// console.log(newTop , newLeft);\n\n\t\t// Providing event and data for handling camera movement.\n\t\tvar deltaX = regionData.centerX - parseInt(newLeft);\n\t\tvar deltaY = regionData.centerY - parseInt(newTop);\n\t\t// Normalize x,y between -2 to 2 range.\n\t\tdeltaX = -2 + (2+2) * (deltaX - (-regionData.radius)) / (regionData.radius - (-regionData.radius));\n\t\tdeltaY = -2 + (2+2) * (deltaY - (-regionData.radius)) / (regionData.radius - (-regionData.radius));\n\t\tdeltaX = -1 * Math.round(deltaX * 10) / 10;\n\t\tdeltaY = -1 * Math.round(deltaY * 10) / 10;\n\t\t// console.log(deltaX, deltaY);\n\n\t\tsendEvent(deltaX, deltaY);\n\t}\n\n\tfunction sendEvent(dx, dy) {\n\t\tif (!mouseDown) {\n\t\t\tclearTimeout(eventRepeatTimeout);\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(eventRepeatTimeout);\n\t\teventRepeatTimeout = setTimeout(function() {\n\t\t\tsendEvent(dx, dy);\n\t\t}, 5);\n\n\t\tvar moveEvent = $.Event(\"YawPitch\", {\n\t\t\tdetail: {\n\t\t\t\t\"deltaX\": dx,\n\t\t\t\t\"deltaY\": dy\n\t\t\t},\n\t\t\tbubbles: false\n\t\t});\n\t\t$(self).trigger(moveEvent);\n\t}\n\n\thandleEl && resetHandlePosition();\n\n\treturn \t<div className=\"rotation-pad\">\n\t  <div className=\"region\" ref={regionRef} ></div>\n\t  <div className=\"handle\" ref={handleRef} ></div>\n\t</div>\n}\n\nexport default RotationPad\n","\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { PointerLockControls } from './PointerLockControls'\nimport TouchControls from \"./TouchControls\"\nimport RotationPad from \"./RotationPad\"\nimport {\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst Blocker = styled.div`\n  border: 1px dashed red;\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n\n  #Crosshair {\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\nconst W = styled.div`\n  border: 1px solid blue;\n  height: 90vh;\n`;\n\n/**\n * Equirectangular2\n * _vp_ 2021-11-15\n * Let's wire in a simple floor and full-window sizing.\n *\n * Threejs units of measure are centimeters (cm).\n *\n */\nconst Equirectangular2 = (props) => {\n  logg(props, 'Equirectangular2')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene;\n\n  var width, height;\n  var viewAngle = 45,\n    near = 1,\n    far = 10000;\n  var aspect;\n  var stats;\n  var sceneObject, intersected;\n\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const blockerRef = useRef(null)\n  const wContainerRef = useRef(null)\n  const instructionsRef = useRef(null)\n\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  useEffect(() => {\n    window.dispatchEvent(new Event('resize'));\n  }, [ bottomDrawerOpen, folded, twofoldPercent ])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 ) // @TODO: what this?\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 ) // @TODO: what this?\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Origin: axis helper\n     */\n    var axes = new THREE.AxisHelper(700)\n\t\tscene.add(axes)\n\n    const wContainer = wContainerRef.current\n\n    function addControls() {\n      var options = {\n        speedFactor: 0.5,\n        delta: 1,\n        rotationFactor: 0.002,\n        maxPitch: 55,\n        hitTest: true,\n        hitTestDistance: 40\n      };\n      controls = new TouchControls({\n        container: wContainer, camera,\n        options,\n        RotationPad: rotationPad,\n        THREE,\n      });\n      controls.setPosition(0, 35, 400);\n      controls.addToScene(scene);\n      // controls.setRotation(0.15, -0.15);\n    }\n    addControls()\n\n    /*\n     * Floor\n     */\n\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.PlaneGeometry( 100, 100, 10, 10 ) // width, height, w segments, h segments\n    // let floorGeometry = new THREE.CircleGeometry(100, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/100x100_lazer-floor.png`)\n    texture.wrapS = THREE.RepeatWrapping\n    texture.wrapT = THREE.RepeatWrapping\n    texture.repeat.set( 10, 10 )\n    const floorMaterial = new THREE.MeshPhongMaterial({\n      map: texture,\n      // transparent: true,\n    })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    // const scenesPath = '/assets/scenes/'\n    // const objectsPath = '/assets/objects/'\n    // let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    // const texturePath = `${modelName}/${modelName}.mtl`\n    // const modelPath = `${modelName}/${modelName}.obj`\n    // const manager = new THREE.LoadingManager()\n    // const onProgress = (xhr) => {\n    //   if (xhr.lengthComputable) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }\n    // const onError = () => {}\n    // const onLoad = (materials) => {\n    //   materials.preload()\n    //   const objLoader = new OBJLoader( manager )\n    //   objLoader.setMaterials( materials )\n    //   objLoader.setPath( scenesPath)\n    //   objLoader.load( modelPath, ( object ) => {\n    //     object.traverse((child) => {\n    //       if (child.isMesh) {\n    //         child.geometry.scale(0.10, 0.10, 0.10) // @TODO: change?\n    //       }\n    //     })\n    //     object.position.x = Math.random() * 500\n    //     object.position.y = 10\n    //     object.position.z = Math.random() * 500\n\n    //     logg(object, '1st object')\n    //     scene.add( object )\n    //     markerObjects.push( object )\n    //     markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' }) // @TODO: change!\n\n    //   }, onProgress, onError )\n    // }\n    // const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setPath(scenesPath)\n    // mtlLoader.load(texturePath, onLoad)\n\n\n    /*\n     * Skybox\n     */\n    const textureLoader = new THREE.TextureLoader()\n    const assetPath = map.img_path\n    texture = textureLoader.load(assetPath, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  /* From: https://threejsfundamentals.org/threejs/lessons/threejs-responsive.html */\n  function resizeRendererToDisplaySize() {\n    const canvas = renderer.domElement\n    const width = blockerRef.current.clientWidth\n    const height = blockerRef.current.clientHeight\n    const needResize = canvas.width !== width || canvas.height !== height\n    if (needResize) {\n      renderer.setSize(width, height)\n    }\n    return needResize\n  }\n  function onWindowResize() {\n    if (resizeRendererToDisplaySize()) {\n      const width = blockerRef.current.clientWidth\n      const height = blockerRef.current.clientHeight\n      camera.aspect = width / height\n      camera.updateProjectionMatrix()\n    }\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <W ref={wContainerRef} >\n    <div ref={instructionsRef} />\n    <Blocker ref={blockerRef} >\n      <div id=\"Crosshair\" />\n\n      <RotationPad />\n    </Blocker>\n  </W>\n}\n\nexport default Equirectangular2\n","\n/*\n * @TODO: this is just a copy of equirectangular2, discard\n */\n\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { PointerLockControls } from './PointerLockControls'\nimport TouchControls from \"./TouchControls\"\nimport RotationPad from \"./RotationPad\"\nimport {\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst Blocker = styled.div`\n  border: 1px dashed red;\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n\n  #Crosshair {\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\nconst W = styled.div`\n  border: 1px solid blue;\n  height: 90vh;\n`;\n\n/**\n * Equirectangular2\n * _vp_ 2021-11-15\n * Let's wire in a simple floor and full-window sizing.\n *\n * Threejs units of measure are centimeters (cm).\n *\n */\nconst Equirectangular2 = (props) => {\n  logg(props, 'Equirectangular2')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene;\n\n  var width, height;\n  var viewAngle = 45,\n    near = 1,\n    far = 10000;\n  var aspect;\n  var stats;\n  var sceneObject, intersected;\n\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const blockerRef = useRef(null)\n  const wContainerRef = useRef(null)\n  const instructionsRef = useRef(null)\n\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  useEffect(() => {\n    window.dispatchEvent(new Event('resize'));\n  }, [ bottomDrawerOpen, folded, twofoldPercent ])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 ) // @TODO: what this?\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 ) // @TODO: what this?\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Origin: axis helper\n     */\n    var axes = new THREE.AxisHelper(700)\n\t\tscene.add(axes)\n\n    const wContainer = wContainerRef.current\n\n    function addControls() {\n      var options = {\n        speedFactor: 0.5,\n        delta: 1,\n        rotationFactor: 0.002,\n        maxPitch: 55,\n        hitTest: true,\n        hitTestDistance: 40\n      };\n      controls = new TouchControls({\n        container: wContainer, camera,\n        options,\n        RotationPad: rotationPad,\n        THREE,\n      });\n      controls.setPosition(0, 35, 400);\n      controls.addToScene(scene);\n      // controls.setRotation(0.15, -0.15);\n    }\n    addControls()\n\n    /*\n     * Floor\n     */\n\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.PlaneGeometry( 100, 100, 10, 10 ) // width, height, w segments, h segments\n    // let floorGeometry = new THREE.CircleGeometry(100, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/100x100_lazer-floor.png`)\n    texture.wrapS = THREE.RepeatWrapping\n    texture.wrapT = THREE.RepeatWrapping\n    texture.repeat.set( 10, 10 )\n    const floorMaterial = new THREE.MeshPhongMaterial({\n      map: texture,\n      // transparent: true,\n    })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    // const scenesPath = '/assets/scenes/'\n    // const objectsPath = '/assets/objects/'\n    // let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    // const texturePath = `${modelName}/${modelName}.mtl`\n    // const modelPath = `${modelName}/${modelName}.obj`\n    // const manager = new THREE.LoadingManager()\n    // const onProgress = (xhr) => {\n    //   if (xhr.lengthComputable) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }\n    // const onError = () => {}\n    // const onLoad = (materials) => {\n    //   materials.preload()\n    //   const objLoader = new OBJLoader( manager )\n    //   objLoader.setMaterials( materials )\n    //   objLoader.setPath( scenesPath)\n    //   objLoader.load( modelPath, ( object ) => {\n    //     object.traverse((child) => {\n    //       if (child.isMesh) {\n    //         child.geometry.scale(0.10, 0.10, 0.10) // @TODO: change?\n    //       }\n    //     })\n    //     object.position.x = Math.random() * 500\n    //     object.position.y = 10\n    //     object.position.z = Math.random() * 500\n\n    //     logg(object, '1st object')\n    //     scene.add( object )\n    //     markerObjects.push( object )\n    //     markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' }) // @TODO: change!\n\n    //   }, onProgress, onError )\n    // }\n    // const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setPath(scenesPath)\n    // mtlLoader.load(texturePath, onLoad)\n\n\n    /*\n     * Skybox\n     */\n    const textureLoader = new THREE.TextureLoader()\n    const assetPath = map.img_path\n    texture = textureLoader.load(assetPath, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  /* From: https://threejsfundamentals.org/threejs/lessons/threejs-responsive.html */\n  function resizeRendererToDisplaySize() {\n    const canvas = renderer.domElement\n    const width = blockerRef.current.clientWidth\n    const height = blockerRef.current.clientHeight\n    const needResize = canvas.width !== width || canvas.height !== height\n    if (needResize) {\n      renderer.setSize(width, height)\n    }\n    return needResize\n  }\n  function onWindowResize() {\n    if (resizeRendererToDisplaySize()) {\n      const width = blockerRef.current.clientWidth\n      const height = blockerRef.current.clientHeight\n      camera.aspect = width / height\n      camera.updateProjectionMatrix()\n    }\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <W ref={wContainerRef} >\n    <div ref={instructionsRef} />\n    <Blocker ref={blockerRef} >\n      <div id=\"Crosshair\" />\n\n      <RotationPad />\n    </Blocker>\n  </W>\n}\n\nexport default Equirectangular2\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport * as THREE from \"three\"\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  height: calc(100% - ${p => p.breadcrumbsHeight});\n`;\n\n/**\n * Excellent documentation. From: https://threejs.org/examples/#misc_controls_pointerlock\n * Right now the unit is 1cm, 1/10 of a meter.\n */\n\n\nconst Loc = (props) => {\n  let camera, controls,\n    object, objects = [],\n    raycaster, renderer,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n    /*\n    // PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n    // fov  Camera frustum vertical field of view.\n    // aspect  Camera frustum aspect ratio.\n    // near  Camera frustum near plane.\n    // far  Camera frustum far plane.\n    */\n    // camera = new THREE.PerspectiveCamera( 75, 2, 1, 100 )\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 300 )\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    // floor\n    // @TODO: it's not aligned to parcels the way I want\n    let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    floorGeometry.rotateX( - Math.PI / 2 )\n\n    // vertex displacement\n    let position = floorGeometry.attributes.position\n    for ( let i = 0, l = position.count; i < l; i ++ ) {\n      vertex.fromBufferAttribute( position, i )\n      vertex.x += Math.random() * 20 - 10\n      vertex.y += Math.random() * 2\n      vertex.z += Math.random() * 20 - 10\n      position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    }\n    floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    floorGeometry.x = -200\n    floorGeometry.y = -200\n    floorGeometry.z = -200\n    position = floorGeometry.attributes.position\n    const colorsFloor = []\n    for ( let i = 0, l = position.count; i < l; i ++ ) {\n      color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n      colorsFloor.push( color.r, color.g, color.b )\n    }\n    floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    // objects\n    /*\n    const boxGeometry = new THREE.BoxGeometry( 20, 20, 20 ).toNonIndexed()\n    position = boxGeometry.attributes.position\n    const colorsBox = []\n    for ( let i = 0, l = position.count; i < l; i ++ ) {\n      color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n      colorsBox.push( color.r, color.g, color.b )\n    }\n    boxGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsBox, 3 ) )\n    for ( let i = 0; i < 500; i ++ ) {\n      const boxMaterial = new THREE.MeshPhongMaterial( { specular: 0xffffff, flatShading: true, vertexColors: true } )\n      boxMaterial.color.setHSL( Math.random() * 0.2 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n\n      const box = new THREE.Mesh( boxGeometry, boxMaterial )\n      box.position.x = Math.floor( Math.random() * 20 - 10 ) * 20\n      box.position.y = Math.floor( Math.random() * 20 ) * 20 + 10\n      box.position.z = Math.floor( Math.random() * 20 - 10 ) * 20\n      scene.add( box )\n      objects.push( box )\n    }\n    */\n\n    // load OBJ\n\n    // manager\n\n    // this is specifically for tiny-house-1\n    const loadModel = () => {\n      object.traverse((child) => {\n        if ( child.isMesh ) {\n          child.material.map = texture\n          child.geometry.scale(10, 10, 10)\n        }\n      })\n      object.position.x = 100\n      object.position.y = 10\n      object.position.z = 100\n\n      scene.add( object )\n    }\n    const manager = new THREE.LoadingManager( loadModel )\n    manager.onProgress = function ( item, loaded, total ) {\n      console.log( item, loaded, total )\n    }\n\n    // texture\n\n    const textureLoader = new THREE.TextureLoader( manager )\n    const texture = textureLoader.load( 'textures/uv_grid_opengl.jpg' )\n\n    // model\n\n    // tiny-house-1\n    const loader = new OBJLoader( manager )\n    loader.load( '/assets/scenes/tiny-house-1/tiny-house-1.obj', ( obj ) => {\n      object = obj\n    }, ( xhr ) => {\n      if ( xhr.lengthComputable ) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }, (e) => {\n      logg(e, 'onError')\n    } )\n\n\n    // some delimiters for the first 6 parcels!\n    let geometry = new THREE.BoxGeometry( 10, 10, 10 )\n    let material = new THREE.MeshBasicMaterial( {color: 0x00ff00} )\n    let cube = new THREE.Mesh( geometry, material )\n    cube.position.x = 0\n    cube.position.y = 5\n    cube.position.z = 0\n    scene.add( cube )\n    const items = [\n      { color: 0xff0000, x: 1, y: 0, z: 0 },\n      { color: 0x00ff00, x: 0, y: 1, z: 0 },\n      { color: 0x0000ff, x: 0, y: 0, z: 1 }\n    ]\n    items.map((item, idx) => {\n      logg(item, 'item')\n      const { color, x, y, z } = item\n      geometry = new THREE.BoxGeometry( 1 + x*10, 1 + y*10, 1 + z*10 )\n      material = new THREE.MeshBasicMaterial({ color: color })\n      cube = new THREE.Mesh( geometry, material )\n      cube.position.x = x*5\n      cube.position.y = 10+y*5\n      cube.position.z = z*5\n      scene.add( cube )\n    })\n\n    const parcels = [\n      { color: 0xff0000, x: 100, y: 1, z: 100 },\n      { color: 0x00ff00, x: 100, y: 1, z: 320 },\n      { color: 0x0000ff, x: -120, y: 1, z: 320 },\n\n      { color: 0x660000, x: -120, y: 1, z: 100 },\n      { color: 0x006600, x: -120, y: 1, z: -120 },\n      { color: 0x000066, x: 100, y: 1, z: -120 },\n    ]\n    parcels.map((item, idx) => {\n      const { color, x, y, z } = item\n      const g = new THREE.BoxGeometry( 200, 2, 200 )\n      const m = new THREE.MeshBasicMaterial({color: color})\n      const p = new THREE.Mesh( g, m )\n      p.position.x = x\n      p.position.y = y\n      p.position.z = z\n      scene.add( p )\n    })\n\n    //\n\n\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    // renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setPixelRatio(1)\n    renderer.setSize( 800, 400 )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n      raycaster.ray.origin.copy( controls.getObject().position )\n      raycaster.ray.origin.y -= 10\n      const intersections = raycaster.intersectObjects( objects, false )\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} />\n  </F>\n}\n\nexport default Loc\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  border: 2px solid red;\n\n  position: relative;\n  // height: calc(100% - ${p => p.breadcrumbsHeight});\n  width: 700px;\n  height: 350px;\n\n  #Crosshair {\n    // border: 1px solid yellow;\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\n/**\n * Loc = Location\n *\n * Excellent documentation. From: https://threejs.org/examples/#misc_controls_pointerlock\n * Right now the unit is 1cm, 1/10 of a meter.\n */\nconst Loc = (props) => {\n  // logg(props, 'Loc')\n\n  const history = useHistory()\n\n  let camera, controls,\n    object, objects = [], markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n\n    /*\n     * Crosshair\n     * From: https://codepen.io/driezis/pen/jOPzjLG?editors=1000\n     */\n    var pMat = new THREE.ShaderMaterial({\n        uniforms: { main_color: {value: {r: 1, g: 1, b: 1}},\n                    border_color: {value: {r: 0, g: 0, b: 0.1}},\n\n                    thickness: {value:0.006},\n                    height: {value:0.13},\n                    offset: {value:0.05},\n                    border: {value:0.003},\n\n                    opacity: {value: 1},\n                    center: {value: {x: 0.5, y: 0.5}},\n                    rotation: {value: 0}\n                },\n        vertexShader: `\n                uniform float rotation;\n                uniform vec2 center;\n                #include <common>\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec2 scale;\n                    scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n                    scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n                    #ifndef USE_SIZEATTENUATION\n                        bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n                        if ( isPerspective ) scale *= - mvPosition.z;\n                    #endif\n                    vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n                    vec2 rotatedPosition;\n                    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n                    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n                    mvPosition.xy += rotatedPosition;\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n        fragmentShader: `\n            uniform vec3 main_color;\n            uniform vec3 border_color;\n            uniform float opacity;\n\n            uniform float thickness;\n            uniform float height;\n            uniform float offset;\n            uniform float border;\n\n            varying vec2 vUv;\n            void main() {\n\n                float a = (step(abs(vUv.x - 0.5), thickness)) * step(abs(vUv.y - 0.5), height + offset) * step(offset, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness)) * step(abs(vUv.x - 0.5), height + offset) * step(offset, abs(vUv.x - 0.5));\n                float b = (step(abs(vUv.x - 0.5), thickness - border)) * step(abs(vUv.y - 0.5), height + offset - border) * step(offset + border, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness - border)) * step(abs(vUv.x - 0.5), height + offset - border) * step(offset + border, abs(vUv.x - 0.5));\n                gl_FragColor = vec4( mix(border_color, main_color, b), a * opacity);\n            }\n        `,\n        transparent: true,\n    });\n    var sprite = new THREE.Sprite(pMat);\n    // scene.add(sprite);\n    // sprite.position.set(0,0,-5);\n\n    /*\n     * Reticle\n     */\n    // var scale = 3\n    // var cursorSize = 500\n    // var reticle = new THREE.Mesh(\n    //   new THREE.RingBufferGeometry( 0.85 * cursorSize, cursorSize, 32),\n    //   new THREE.MeshBasicMaterial({color: 0xffffff, blending: THREE.AdditiveBlending, side: THREE.DoubleSide })\n    // );\n    // reticle.position.z = -100\n    // reticle.lookAt(camera.position)\n    // camera.add(reticle)\n\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Floor\n     */\n\n    // // random\n    // // @TODO: it's not aligned to parcels the way I want\n    // let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    // floorGeometry.rotateX( - Math.PI / 2 )\n\n    // // vertex displacement\n    // let position = floorGeometry.attributes.position\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   vertex.fromBufferAttribute( position, i )\n    //   vertex.x += Math.random() * 20 - 10\n    //   vertex.y += Math.random() * 2\n    //   vertex.z += Math.random() * 20 - 10\n    //   position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    // }\n    // floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    // floorGeometry.x = -200\n    // floorGeometry.y = -200\n    // floorGeometry.z = -200\n    // position = floorGeometry.attributes.position\n    // const colorsFloor = []\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n    //   colorsFloor.push( color.r, color.g, color.b )\n    // }\n    // floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    // const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n    // moon floor\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`)\n\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    const scenesPath = '/assets/scenes/'\n    const objectsPath = '/assets/objects/'\n    let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    let modelName2 = 'girl'\n    const texturePath = `${modelName}/${modelName}.mtl`\n    const modelPath = `${modelName}/${modelName}.obj`\n    const modelPath2 = `${modelName2}/${modelName2}.obj`\n    const manager = new THREE.LoadingManager()\n\n    const onProgress = (xhr) => {\n      if (xhr.lengthComputable) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }\n    // onProgress = function ( item, loaded, total ) {\n    //   console.log( item, loaded, total )\n    // }\n    const onError = () => {}\n    const onLoad = (materials) => {\n      materials.preload()\n      const objLoader = new OBJLoader( manager )\n      objLoader.setMaterials( materials )\n      objLoader.setPath( scenesPath)\n      objLoader.load( modelPath, ( object ) => {\n        object.traverse((child) => {\n          if (child.isMesh) {\n            child.geometry.scale(0.10, 0.10, 0.10)\n          }\n        })\n        object.position.x = Math.random() * 500\n        object.position.y = 10\n        object.position.z = Math.random() * 500\n\n        logg(object, '1st object')\n        scene.add( object )\n        markerObjects.push( object )\n        markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' })\n\n      }, onProgress, onError )\n    }\n    const onLoad2 = (materials) => {\n      // materials.preload()\n      const objLoader = new OBJLoader( manager )\n      // objLoader.setMaterials( materials )\n      objLoader.setPath( objectsPath )\n      objLoader.load( modelPath2, ( object ) => {\n        object.traverse((child) => {\n          if (child.isMesh) {\n            child.geometry.scale(10, 10, 10)\n          }\n        })\n        object.position.x = Math.random() * 500\n        object.position.y = 10\n        object.position.z = Math.random() * 500\n\n        logg(object, '2st object')\n        scene.add( object )\n        markerObjects.push( object )\n        markerObjectsIdxs.push({ uuid: object.uuid, name: 'girl', slug: 'demmitv' })\n\n      }, onProgress, onError )\n    }\n    const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setBaseUrl(scenesPath)\n    mtlLoader.setPath(scenesPath)\n    mtlLoader.load(texturePath, onLoad)\n    mtlLoader.load(texturePath, onLoad2)\n\n\n    // /* texture */\n    // const textureLoader = new THREE.TextureLoader( manager )\n    // const texture = textureLoader.load( 'textures/uv_grid_opengl.jpg' )\n\n\n    // const loader = new OBJLoader( manager )\n    // loader.load( `/assets/scenes/${modelName}/${modelName}.obj`, ( obj ) => {\n    //   object = obj\n    // }, ( xhr ) => {\n    //   if ( xhr.lengthComputable ) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }, (e) => {\n    //   logg(e, 'onError')\n    // } )\n\n\n    /*\n     * parcels\n     */\n\n    // // some delimiters for the first 6 parcels!\n    // let geometry = new THREE.BoxGeometry( 10, 10, 10 )\n    // let material = new THREE.MeshBasicMaterial( {color: 0x00ff00} )\n    // let cube = new THREE.Mesh( geometry, material )\n    // cube.position.x = 0\n    // cube.position.y = 5\n    // cube.position.z = 0\n    // // scene.add( cube )\n    // const items = [\n    //   { color: 0xff0000, x: 1, y: 0, z: 0 },\n    //   { color: 0x00ff00, x: 0, y: 1, z: 0 },\n    //   { color: 0x0000ff, x: 0, y: 0, z: 1 }\n    // ]\n    // items.map((item, idx) => {\n    //   logg(item, 'item')\n    //   const { color, x, y, z } = item\n    //   geometry = new THREE.BoxGeometry( 1 + x*10, 1 + y*10, 1 + z*10 )\n    //   material = new THREE.MeshBasicMaterial({ color: color })\n    //   cube = new THREE.Mesh( geometry, material )\n    //   cube.position.x = x*5\n    //   cube.position.y = 10+y*5\n    //   cube.position.z = z*5\n    //   // scene.add( cube )\n    // })\n\n    // const parcels = [\n    //   { color: 0xff0000, x: 100, y: 1, z: 100 },\n    //   { color: 0x00ff00, x: 100, y: 1, z: 320 },\n    //   { color: 0x0000ff, x: -120, y: 1, z: 320 },\n\n    //   { color: 0x660000, x: -120, y: 1, z: 100 },\n    //   { color: 0x006600, x: -120, y: 1, z: -120 },\n    //   { color: 0x000066, x: 100, y: 1, z: -120 },\n    // ]\n    // parcels.map((item, idx) => {\n    //   const { color, x, y, z } = item\n    //   const g = new THREE.BoxGeometry( 200, 2, 200 )\n    //   const m = new THREE.MeshBasicMaterial({color: color})\n    //   const p = new THREE.Mesh( g, m )\n    //   p.position.x = x\n    //   p.position.y = y\n    //   p.position.z = z\n    //   // scene.add( p )\n    // })\n\n\n    /*\n     * Skybox\n     */\n    const loader = new THREE.TextureLoader()\n    texture = loader.load(`/assets/textures/space-5.jpg`, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( 700, 350 ) // aspect ratio 0.5\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} >\n      <div id=\"Crosshair\" />\n    </Blocker>\n  </F>\n}\n\nexport default Loc\n","\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\nimport * as THREE from \"three\"\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\n\nimport { Crosshair } from \"./\"\nimport { PointerLockControls, } from './PointerLockControls'\nimport {\n  C,\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst Blocker = styled.div`\n  // border: 2px solid red;\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n`;\n\n/**\n * Loc = Location\n *\n * Excellent documentation. From: https://threejs.org/examples/#misc_controls_pointerlock\n * Right now the unit is 1cm, 1/10 of a meter.\n */\nconst Loc = (props) => {\n  // logg(props, 'Loc')\n  logg([window.innerWidth, window.innerHeight], 'windowWidthHeight')\n\n  const history = useHistory()\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  let camera, controls,\n    glow,\n    markerObjects = [],\n    pickedObject,\n    raycaster, removedObject, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  useEffect(() => {\n    window.dispatchEvent(new Event('resize'));\n  }, [ bottomDrawerOpen, folded, twofoldPercent ])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n\n\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    const aspect = blockerRef.current.clientWidth / blockerRef.current.clientHeight\n    camera = new THREE.PerspectiveCamera( 75, aspect, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    // scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onClick = (event) => {\n      // logg(event, 'onCLick')\n      // logg(pickedObject, 'pickedObject')\n\n      // @TODO: prevent lock-outs!\n      if (pickedObject) {\n        // controls.unlock()\n        // history.push(`/en/locations/show/${pickedObject.slug}`)\n      }\n    }\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n    document.addEventListener( 'click', onClick )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n\n    /*\n     * Floor\n     */\n\n    // moon floor\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`)\n\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    const scenesPath = '/assets/scenes/'\n    const objectsPath = '/assets/objects/'\n    const manager = new THREE.LoadingManager()\n\n    let importModels = [\n      // { modelName: 'wasyaco-reception-2', slug: 'construct1' },\n\n      { modelName: 'camaro75', slug: 'construct1' },\n      { modelName: 'girl',     slug: 'demmitv' },\n\n      // { modelName: 'girl-5',     slug: 'demmitv' },\n    ]\n\n    const onProgress = (xhr) => {\n      if (xhr.lengthComputable) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }\n    const onError = () => {}\n    const mtlLoader = new MTLLoader(manager)\n    mtlLoader.setPath(objectsPath)\n\n    importModels.map(({ modelName, slug }) => {\n      const texturePath = `${modelName}/${modelName}.mtl`\n      const modelPath = `${modelName}/${modelName}.obj`\n      const wrappedOnLoad = (modelPath) => {\n        return (materials) => {\n          materials.preload()\n          const objLoader = new OBJLoader( manager )\n          objLoader.setMaterials( materials )\n\n          objLoader.setPath(objectsPath)\n          objLoader.load( modelPath, ( object ) => {\n            object.traverse((child) => {\n              if (child.isMesh) {\n                child.geometry.scale(10, 10, 10)\n              }\n            })\n            object.position.x = Math.random() * 200\n            object.position.y = 10\n            object.position.z = Math.random() * 200\n\n            scene.add( object )\n            markerObjects.push({ uuid: object.uuid, name: 'camaro75', object, slug: 'construct1', })\n\n          }, onProgress, onError )\n        }\n      }\n      mtlLoader.load(texturePath, wrappedOnLoad(modelPath))\n    })\n\n\n\n\n    /*\n     * Skybox\n     */\n    const loader = new THREE.TextureLoader()\n    texture = loader.load(`/assets/textures/space-5.jpg`, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = blockerRef.current.clientWidth / blockerRef.current.clientHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      // hmmm unneeded\n      // let mouse = new THREE.Vector2()\n      // mouse.x = ( cameraDirection.x / window.innerWidth ) * 2 - 1;\n\t    // mouse.y = - ( cameraDirection.y / window.innerHeight ) * 2 + 1;\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      pickedObject = null\n      scene.remove( glow )\n      if (removedObject) {\n        scene.add( removedObject )\n        removedObject = null\n      }\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects.map(m=>m.object), true )\n      if (intersections.length) {\n        const _pickedObject = intersections[0].object\n\n        // glow\n        markerObjects.map((item, idx) => {\n          if (item.uuid === _pickedObject.parent.uuid) {\n            glow = item.object.clone()\n            glow.traverse((child) => {\n              if (child.isMesh) {\n                child.material = new THREE.MeshBasicMaterial()\n                child.material.color = new THREE.Color(0Xffff00)\n              }\n            })\n            glow.position.set(_pickedObject.parent.position.x, _pickedObject.parent.position.y, _pickedObject.parent.position.z)\n            // glow.scale.multiplyScalar(1.05)\n            scene.add( glow )\n            removedObject = _pickedObject.parent.clone()\n            scene.remove( _pickedObject.parent )\n          }\n        })\n\n        /* collision @TODO */\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker ref={blockerRef} >\n      <Crosshair />\n    </Blocker>\n  </F>\n}\n\nexport default Loc\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  border: 2px solid red;\n\n  position: relative;\n  // height: calc(100% - ${p => p.breadcrumbsHeight});\n  width: 700px;\n  height: 350px;\n\n  #Crosshair {\n    // border: 1px solid yellow;\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\n/**\n * ThreePanelV4\n * Markers are obejcts _vp_ 2021-11-14\n *\n */\nconst ThreePanelV4 = (props) => {\n  logg(props, 'ThreePanelV4')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    object, objects = [], markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n\n    /*\n     * Crosshair\n     * From: https://codepen.io/driezis/pen/jOPzjLG?editors=1000\n     */\n    var pMat = new THREE.ShaderMaterial({\n        uniforms: { main_color: {value: {r: 1, g: 1, b: 1}},\n                    border_color: {value: {r: 0, g: 0, b: 0.1}},\n\n                    thickness: {value:0.006},\n                    height: {value:0.13},\n                    offset: {value:0.05},\n                    border: {value:0.003},\n\n                    opacity: {value: 1},\n                    center: {value: {x: 0.5, y: 0.5}},\n                    rotation: {value: 0}\n                },\n        vertexShader: `\n                uniform float rotation;\n                uniform vec2 center;\n                #include <common>\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec2 scale;\n                    scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n                    scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n                    #ifndef USE_SIZEATTENUATION\n                        bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n                        if ( isPerspective ) scale *= - mvPosition.z;\n                    #endif\n                    vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n                    vec2 rotatedPosition;\n                    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n                    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n                    mvPosition.xy += rotatedPosition;\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n        fragmentShader: `\n            uniform vec3 main_color;\n            uniform vec3 border_color;\n            uniform float opacity;\n\n            uniform float thickness;\n            uniform float height;\n            uniform float offset;\n            uniform float border;\n\n            varying vec2 vUv;\n            void main() {\n\n                float a = (step(abs(vUv.x - 0.5), thickness)) * step(abs(vUv.y - 0.5), height + offset) * step(offset, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness)) * step(abs(vUv.x - 0.5), height + offset) * step(offset, abs(vUv.x - 0.5));\n                float b = (step(abs(vUv.x - 0.5), thickness - border)) * step(abs(vUv.y - 0.5), height + offset - border) * step(offset + border, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness - border)) * step(abs(vUv.x - 0.5), height + offset - border) * step(offset + border, abs(vUv.x - 0.5));\n                gl_FragColor = vec4( mix(border_color, main_color, b), a * opacity);\n            }\n        `,\n        transparent: true,\n    });\n    var sprite = new THREE.Sprite(pMat);\n    // scene.add(sprite);\n    // sprite.position.set(0,0,-5);\n\n    /*\n     * Reticle\n     */\n    // var scale = 3\n    // var cursorSize = 500\n    // var reticle = new THREE.Mesh(\n    //   new THREE.RingBufferGeometry( 0.85 * cursorSize, cursorSize, 32),\n    //   new THREE.MeshBasicMaterial({color: 0xffffff, blending: THREE.AdditiveBlending, side: THREE.DoubleSide })\n    // );\n    // reticle.position.z = -100\n    // reticle.lookAt(camera.position)\n    // camera.add(reticle)\n\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Floor\n     */\n\n    // // random\n    // // @TODO: it's not aligned to parcels the way I want\n    // let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    // floorGeometry.rotateX( - Math.PI / 2 )\n\n    // // vertex displacement\n    // let position = floorGeometry.attributes.position\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   vertex.fromBufferAttribute( position, i )\n    //   vertex.x += Math.random() * 20 - 10\n    //   vertex.y += Math.random() * 2\n    //   vertex.z += Math.random() * 20 - 10\n    //   position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    // }\n    // floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    // floorGeometry.x = -200\n    // floorGeometry.y = -200\n    // floorGeometry.z = -200\n    // position = floorGeometry.attributes.position\n    // const colorsFloor = []\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n    //   colorsFloor.push( color.r, color.g, color.b )\n    // }\n    // floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    // const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n    // moon floor\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`)\n\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    const scenesPath = '/assets/scenes/'\n    const objectsPath = '/assets/objects/'\n    const texturesPath = '/assets/textures/'\n    const manager = new THREE.LoadingManager()\n    const mtlLoader = new MTLLoader(manager)\n    mtlLoader.setPath(texturesPath)\n    const onProgress = (xhr) => {\n      if (xhr.lengthComputable) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }\n    const onError = () => {}\n\n\n    map.markers.map((marker, idx) => {\n      let modelName = marker.slug\n      const texturePath = `${modelName}/${modelName}.mtl`\n      const modelPath = `${modelName}/${modelName}.obj`\n      const wrappedOnLoad = (modelPath, modelName) => {\n        return (materials) => {\n          materials.preload()\n          const objLoader = new OBJLoader( manager )\n          objLoader.setMaterials( materials )\n          objLoader.setPath( objectsPath )\n          objLoader.load( modelPath, ( object ) => {\n            object.traverse((child) => {\n              if (child.isMesh) {\n                child.geometry.scale(10, 10, 10) // @TODO change, girl-6 accepts 1,1,1\n              }\n            })\n            object.position.x = Math.random() * 100\n            object.position.y = 10\n            object.position.z = Math.random() * 100\n\n            // object.rotateX( - Math.PI / 2 ) // girl-6 only.\n\n            logg(object, 'loaded obj')\n\n            scene.add( object )\n            markerObjects.push( object )\n            markerObjectsIdxs.push({ uuid: object.uuid, name: modelName })\n\n          }, onProgress, onError )\n        }\n      }\n      mtlLoader.load(texturePath, wrappedOnLoad(modelPath, modelName))\n    })\n\n    // /* texture */\n    // const textureLoader = new THREE.TextureLoader( manager )\n    // const texture = textureLoader.load( 'textures/uv_grid_opengl.jpg' )\n\n\n    // const loader = new OBJLoader( manager )\n    // loader.load( `/assets/scenes/${modelName}/${modelName}.obj`, ( obj ) => {\n    //   object = obj\n    // }, ( xhr ) => {\n    //   if ( xhr.lengthComputable ) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }, (e) => {\n    //   logg(e, 'onError')\n    // } )\n\n\n    /*\n     * parcels\n     */\n\n    // // some delimiters for the first 6 parcels!\n    // let geometry = new THREE.BoxGeometry( 10, 10, 10 )\n    // let material = new THREE.MeshBasicMaterial( {color: 0x00ff00} )\n    // let cube = new THREE.Mesh( geometry, material )\n    // cube.position.x = 0\n    // cube.position.y = 5\n    // cube.position.z = 0\n    // // scene.add( cube )\n    // const items = [\n    //   { color: 0xff0000, x: 1, y: 0, z: 0 },\n    //   { color: 0x00ff00, x: 0, y: 1, z: 0 },\n    //   { color: 0x0000ff, x: 0, y: 0, z: 1 }\n    // ]\n    // items.map((item, idx) => {\n    //   logg(item, 'item')\n    //   const { color, x, y, z } = item\n    //   geometry = new THREE.BoxGeometry( 1 + x*10, 1 + y*10, 1 + z*10 )\n    //   material = new THREE.MeshBasicMaterial({ color: color })\n    //   cube = new THREE.Mesh( geometry, material )\n    //   cube.position.x = x*5\n    //   cube.position.y = 10+y*5\n    //   cube.position.z = z*5\n    //   // scene.add( cube )\n    // })\n\n    // const parcels = [\n    //   { color: 0xff0000, x: 100, y: 1, z: 100 },\n    //   { color: 0x00ff00, x: 100, y: 1, z: 320 },\n    //   { color: 0x0000ff, x: -120, y: 1, z: 320 },\n\n    //   { color: 0x660000, x: -120, y: 1, z: 100 },\n    //   { color: 0x006600, x: -120, y: 1, z: -120 },\n    //   { color: 0x000066, x: 100, y: 1, z: -120 },\n    // ]\n    // parcels.map((item, idx) => {\n    //   const { color, x, y, z } = item\n    //   const g = new THREE.BoxGeometry( 200, 2, 200 )\n    //   const m = new THREE.MeshBasicMaterial({color: color})\n    //   const p = new THREE.Mesh( g, m )\n    //   p.position.x = x\n    //   p.position.y = y\n    //   p.position.z = z\n    //   // scene.add( p )\n    // })\n\n\n    /*\n     * Skybox\n     */\n    const loader = new THREE.TextureLoader()\n    texture = loader.load(`/assets/textures/space-5.jpg`, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( 700, 350 ) // aspect ratio 0.5\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        /* collision */\n        // if (intersections[0].distance < 5) {\n        //   moveForward = false\n        // }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} >\n      <div id=\"Crosshair\" />\n    </Blocker>\n  </F>\n}\n\nexport default ThreePanelV4\n","\n\nimport { CircularProgress as _CircularProgress } from '@material-ui/core'\nimport { ChevronLeft, ChevronRight, Menu as MenuIcon, } from '@material-ui/icons'\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport styled from 'styled-components'\n\nimport {\n  Breadcrumbs,\n  ItemModal,\n  MapPanel, MapPanelNoZoom, MarkersList,\n} from \"./\"\nimport {\n  Equirectangular, Equirectangular2, Equirectangular4,\n  ThreePanelV1, ThreePanelV2, ThreePanelV3, ThreePanelV4,\n} from \"$components/locations3\"\nimport { Newsitems } from \"$components/newsitems\"\nimport { LongLine } from \"$components/TwofoldLayout\"\nimport {\n  C, Collapsible,\n  logg,\n  request,\n  TwofoldContext,\n  useWindowSize,\n} from \"$shared\"\n\n/* W */\nconst W = styled.div`\n  overflow: hidden;\n\n  flex-grow: 1;\n\n  // max-height: 100vh;\n  // min-height: 50vh;\n\n`;\n\n/**\n * Renders either MapPanel (W really, a simple wrapper), MapPanelNoZoom, or ThreePanelV1\n * or some other MapPanel.\n */\nconst WrappedMapPanel = React.forwardRef((props, ref) => {\n  // logg(props.map, 'WrappedMapPanel')\n\n  switch (props.map.config.map_panel_type) {\n\n    case C.map_panel_types.Equirectangular:\n      // return <W ref={ref} className=\"Equirectangular\" ><Equirectangular {...props} /></W>\n      // return <W ref={ref} className=\"Equirectangular2\" ><Equirectangular2 {...props} /></W>\n      return <W ref={ref} className=\"Equirectangular4\" ><Equirectangular4 {...props} /></W>\n\n    case C.map_panel_types.MapPanelNoZoom:\n      return <W ref={ref} className=\"WrappedMapPanel\" ><MapPanelNoZoom withZoom={false} {...props} /></W>\n\n    case C.map_panel_types.ThreePanelV1:\n      switch (props.slug) {\n        case 'threev1':\n          return <W><ThreePanelV1 {...props} /></W>\n        case 'threev2':\n          return <W><ThreePanelV2 {...props} /></W>\n          case 'threev3':\n            return <W><ThreePanelV3 {...props} /></W>\n\n        default:\n          logg(props.slug, `this 3d panel is not implemented`)\n          return <W ref={ref} className=\"WrappedMapPanel\" ><MapPanel {...props} /></W>\n      }\n\n    case C.map_panel_types.ThreePanelV4: // markers are objects\n      return <W><ThreePanelV4 {...props} /></W>\n\n    default:\n      return <W ref={ref} className=\"WrappedMapPanel\" ><MapPanel {...props} /></W>\n  }\n})\nexport default WrappedMapPanel\n\n","\nimport PropTypes from 'prop-types'\nimport React, { useContext, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport {\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst W = styled.div`\n  position: absolute;\n  top: 0;\n  right: 0;\n  z-index: 1;\n  background: white;\n  padding: 5px;\n\n  display: flex;\n  flex-direction: column;\n`;\n\n/**\n * ZoomCtrl\n */\nconst ZoomCtrl = (props) => {\n  logg(props, 'ZoomCtrl')\n\n  const { zoom, setZoom } = useContext(TwofoldContext)\n\n  const zoomIn = () => {\n    setZoom(zoom/2)\n  }\n  const zoomOut = () => {\n    setZoom(zoom*2)\n  }\n  const zoomReset = () => {\n    setZoom(1)\n  }\n\n  return <W className='ZoomCtrl' >\n    <span onClick={zoomIn} >[+]</span>\n    <span onClick={zoomOut} >[-]</span>\n    <span onClick={zoomReset} >[1]</span>\n  </W>\n}\n\nexport default ZoomCtrl\n","\nimport PropTypes from 'prop-types'\nimport { Grid } from '@material-ui/core'\nimport React, { Fragment as F, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, useApi, } from \"$shared\"\n\nconst Label = styled.div``;\n\nconst Features = ({ features, label, ...props }) => {\n  // logg(props, 'Features')\n\n  const out = []\n  features.map((f) => {\n    if (f.inner_html) {\n      out.push(<Grid item sm={3} dangerouslySetInnerHTML={{ __html: f.inner_html }} />)\n    }\n  })\n\n  return <F>\n    {label && <Label>{label}</Label>}\n    <Grid style={{ marginBottom: '1em' }} container spacing={2}>\n      { out }\n    </Grid>\n  </F>\n}\n\nFeatures.propTypes = {\n  features: PropTypes.arrayOf(PropTypes.shape({\n    inner_html: PropTypes.string,\n  }) ),\n  label: PropTypes.string,\n}\nexport default Features","import { IonPage, IonLoading, IonContent } from '@ionic/react'\nimport React, { Fragment as F, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, useApi, } from \"$shared\"\nimport { Features } from \"./\"\nimport {\n  MainHeader,\n} from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\n\nconst _Hero = styled.div`\n  height: 370px;\n  text-align: center;\n\n  img {\n    max-width: 100%;\n  }\n`\nconst Hero = () => <_Hero><img className=\"image\" src=\"/assets/hero.png\" /></_Hero>\n\nconst Root = styled.div`\n  margin: 0;\n  padding-bottom: 1em;\n`\n\nconst SitesShow = (props) => {\n  // logg(props, 'SitesShow')\n\n  let [ site, setSite ] = useState({ features: [], newsitems: [] })\n  let [ loading, setLoading ] = useState(false)\n\n  const api = useApi()\n  const mountedRef = useRef('init')\n\n  useEffect(() => {\n    api.applicationHome().then(data => {\n      if (!mountedRef.current) { return null }\n      setSite(data)\n      setLoading(false)\n    })\n    return () => { mountedRef.current = false }\n  }, [])\n\n  return <F>\n    <Root>\n      { /* <Hero /> */ }\n      <MainHeader />\n\n      <Features features={site.features} />\n      <Newsitems newsitems={site.newsitems} />\n    </Root>\n    <IonLoading\n      isOpen={loading}\n      onDidDismiss={() => setLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n  </F>\n}\n\nexport default SitesShow\n","import { IonPage, IonLoading, IonContent } from '@ionic/react'\nimport React, { Fragment as F, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, useApi, } from \"$shared\"\nimport { Features } from \"./\"\nimport {\n  BottomDrawer,\n  MainHeader, Menu, MenuBottom, MenuLeft,\n  UnlockModal\n} from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\n\nconst _Hero = styled.div`\n  height: 370px;\n  text-align: center;\n\n  img {\n    max-width: 100%;\n  }\n`\nconst Hero = () => <_Hero><img className=\"image\" src=\"/assets/hero.png\" /></_Hero>\n\nconst Root = styled.div`\n  margin: 0;\n  padding-bottom: 1em;\n`\n\n// Currently a homepage, like a wp page.\nconst SitesShow1 = (props) => {\n  // logg(props, 'SitesShow1')\n\n  let [ site, setSite ] = useState({ features: [], newsitems: [] })\n  let [ artTag, setArtTag ] = useState({ features: [] })\n  let [ homeRow1Tag, setHomeRow1Tag ] = useState({ features: [] })\n  let [ interestingLocationsTag, setInterestingLocationsTag ] = useState({ features: [] })\n  let [ loading, setLoading ] = useState(false)\n\n\n  const api = useApi()\n  const mountedRef = useRef('init')\n\n  // loads all data\n  useEffect(() => {\n    // setLoading(true)\n\n    const fn = async () => {\n\n      if (!mountedRef.current) { return }\n      const data = await api.applicationHome()\n      logg(data, 'zeDataZ')\n      setSite(data)\n\n      // @TODO: this was here before, but not anymore. Check it out. _vp_ 2022-03-19\n\n      // api.getTag({ slug: 'interesting-locations' }).then(data => {\n      //   if (!mountedRef.current) { return null }\n      //   logg(data, 'setInterestingLocations')\n      //   setInterestingLocationsTag(data)\n      //   // setLoading(false)\n      // })\n\n      // api.getTag({ slug: 'home-row-1' }).then(data => {\n      //   if (!mountedRef.current) { return null }\n      //   setHomeRow1Tag(data)\n      // })\n\n      // api.getTag({ slug: 'art' }).then(data => {\n      //   if (!mountedRef.current) { return null }\n      //   setArtTag(data)\n      // })\n\n    }\n    fn()\n\n    return () => { mountedRef.current = false }\n  }, [])\n\n  return <F>\n    <Root>\n\n      <MainHeader />\n      { /* <Hero /> */ }\n\n      <Features features={interestingLocationsTag.features} label=\"Interesting Locations\" />\n      <Features features={homeRow1Tag.features} label=\"Interesting Tags\" />\n      <Features features={artTag.features} label=\"art\" />\n      <Newsitems newsitems={site.newsitems} />\n    </Root>\n    <IonLoading\n      isOpen={loading}\n      onDidDismiss={() => setLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n  </F>\n}\n\nexport default SitesShow1\n","import { IonPage, IonContent, IonIcon, IonLoading } from '@ionic/react';\nimport { Container, Grid, GridList } from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { useEffect, useState } from \"react\";\nimport styled from 'styled-components'\nimport config from \"config\";\n\nimport { useApi, logg, request } from \"$shared\";\n\nconst useStyles = makeStyles((theme) => ({\n\n  paper: {\n    padding: theme.spacing(2),\n    textAlign: 'center',\n    color: theme.palette.text.secondary,\n  },\n  redBorder: {\n    border: '1px solid red',\n  },\n  root: {\n    flexGrow: 1,\n    overflow: 'scroll',\n    height: '100vh',\n  },\n\n}));\n\nconst VideoItem = styled.div`\n  border-bottom: 1px solid red;\n`;\n\nconst Video = (props) => {\n  logg(props, 'Video');\n  const api = useApi()\n\n  const { item: video } = props;\n\n  return <VideoItem key={props.idx} >\n    <h5>Video {video.name}</h5>\n    <p>created {video.created_at}</p>\n    <video controls preload=\"metadata\" type=\"video/mp4\" src={video.video_url}\n      style={{ maxWidth: '500px', maxHeight: '90vh' }} ></video>\n  </VideoItem>;\n};\n\nconst Videos = () => {\n  logg(config, 'Videos component');\n  console.log(JSON.stringify(config));\n\n  const [videos, setVideos] = useState([]);\n\n  const jwtToken = localStorage.getItem(\"jwtToken\");\n\n  const classes = useStyles();\n  const api = useApi()\n\n  useEffect(() => {\n    logg('posting...');\n    request.post(api.myVideosPath, { jwtToken: jwtToken }).then(r => r.data\n      ).then(({ videos }) => {\n        logg(videos, 'data')\n        setVideos(videos);\n      })\n  }, []);\n\n  return <Container maxWidth=\"md\">\n    <Grid container className={classes.root} >\n      <Grid item xs={12} >\n        <h2>My Videos</h2>\n      </Grid>\n      <Grid item xs={12}>\n        { videos && videos.map((v, idx) => <Video key={idx} item={v} ></Video> ) }\n      </Grid>\n    </Grid>\n  </Container>;\n\n};\n\nexport default Videos;\n","\nimport '@ionic/react/css/core.css'\nimport '@ionic/react/css/normalize.css'\nimport '@ionic/react/css/structure.css'\nimport '@ionic/react/css/typography.css'\nimport '@ionic/react/css/padding.css'\nimport '@ionic/react/css/float-elements.css'\nimport '@ionic/react/css/text-alignment.css'\nimport '@ionic/react/css/text-transformation.css'\nimport '@ionic/react/css/flex-utils.css'\nimport '@ionic/react/css/display.css'\n\nimport { Container as _Container, Grid, GridList } from '@material-ui/core'\nimport React, { Fragment as F, useEffect, useRef, useState } from 'react'\nimport {\n  Link, Switch, BrowserRouter as Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\nimport { ToastContainer, toast } from 'react-toastify'\nimport 'react-toastify/dist/ReactToastify.css'\nimport styled from 'styled-components'\n\nimport config from \"config\"\n\nimport {\n  BottomDrawer,\n  MainHeader, Menu, MenuBottom, MenuLeft,\n  UnlockModal\n} from \"$components/application\"\nimport MapuiLayout from \"$components/application/MapuiLayout\"\nimport { CitiesList, CitiesShow } from \"$components/cities\"\n// @TODO: MyGalleries doesn't look right...\nimport { GalleriesShow, MyGalleries } from \"$components/galleries\"\nimport { LocationsShowDesktop } from \"$components/locations\"\nimport Three from \"$components/locations3/ThreePanelV1\"\nimport { ReportsShow } from \"$components/reports\"\n// import { SitesShow } from '$components/sites'\nimport SitesShow from '$components/sites/SitesShow1'\nimport { Account, LoginModal, RegisterModal } from \"$components/users\"\nimport { Videos } from \"$components/videos\"\nimport {\n  C, CollapsibleContext, CollapsibleContextProvider,\n  Debug, logg, request, TwofoldContext, TwofoldContextProvider , useApi,\n} from \"$shared\"\n\nimport './theme/variables.css'\n\n\nconst Root = styled.div`\n  // border: 1px solid #741741;\n\n  background: ${p => p.theme.colors.background};\n  height: 100vh;\n  overflow: auto;\n`;\n\n\nconst AppDesktop = (props) => {\n  // logg(props, 'AppDesktop')\n  const {} = props\n\n  const api = useApi()\n\n  const [ layout, setLayout ] = useState(C.layout_onecol)\n\n  const Container = (props) => {\n    switch(layout) {\n      case C.layout_onecol:\n        // main case\n        return <_Container maxWidth=\"md\" {...props} />\n      case C.layout_mapui:\n        return <MapuiLayout {...props} />\n    }\n  }\n\n  const Route = (props) => {\n    useEffect(() => {\n      if (props.layout) {\n        setLayout(props.layout)\n      } else {\n        setLayout(C.layout_onecol)\n      }\n    }, [props.layout])\n\n    return <_Route {...props} />\n  }\n\n  return (<Router>\n    <TwofoldContextProvider {...props} {...{ layout, setLayout }} >\n      <CollapsibleContextProvider >\n        <Root>\n\n          { /* This no more, if I want it to look like Financial Times */ }\n          { /* layout === C.layout_onecol && <MenuLeft variant={C.variants.floating} /> */ }\n          { /* <MainHeader /> */ }\n\n          <Container >\n            <Switch id=\"main\" main >\n\n              <Redirect exact from=\"/\" to={config.homeLocation} />\n              <Route exact path=\"/en\" ><SitesShow /></Route>\n\n              <Route exact path=\"/en/account\" component={Account} />\n              <Route exact path=\"/en/account/my/videos\" component={Videos} />\n              <Route exact path=\"/en/account/my/galleries\" component={MyGalleries} />\n\n              <Route exact path=\"/en/cities\"                 component={CitiesList} />\n              <Route       path=\"/en/cities/travel-to/:name\" component={CitiesShow} />\n\n              <Route exact path=\"/en/galleries/show/:slug\" component={GalleriesShow} />\n\n              <Route exact path=\"/en/reports/show/:slug\" component={ReportsShow} />\n\n              <Route exact path=\"/en/locations/show/:slug\" component={LocationsShowDesktop} layout={C.layout_mapui} />\n              <Route exact path=\"/en/locations/show/:slug/:item_type/show/:item_slug\" component={LocationsShowDesktop} layout={C.layout_mapui} />\n\n            </Switch>\n          </Container>\n        </Root>\n\n        <BottomDrawer />\n        <UnlockModal />\n        <LoginModal />\n        <RegisterModal />\n        <ToastContainer />\n\n      </CollapsibleContextProvider>\n    </TwofoldContextProvider>\n  </Router>)\n}\n\nexport default AppDesktop\n","import { Container as _Container, Grid, GridList } from '@material-ui/core'\n\nimport React, { Fragment as F, useContext, useEffect, useState } from 'react'\nimport Modal from \"react-modal\"\nimport {\n  Switch, BrowserRouter as Router, Redirect, Route as _Route,\n} from 'react-router-dom'\nimport styled, { useTheme } from 'styled-components'\nimport { ToastContainer, toast } from 'react-toastify'\n\nimport '@ionic/react/css/core.css'\nimport '@ionic/react/css/normalize.css'\nimport '@ionic/react/css/structure.css'\nimport '@ionic/react/css/typography.css'\nimport '@ionic/react/css/padding.css'\nimport '@ionic/react/css/float-elements.css'\nimport '@ionic/react/css/text-alignment.css'\nimport '@ionic/react/css/text-transformation.css'\nimport '@ionic/react/css/flex-utils.css'\nimport '@ionic/react/css/display.css'\nimport './theme/variables.css'\n\nimport config from \"config\"\nimport { BottomDrawer, Menu, MenuBottom, MenuLeft, UnlockModal } from \"$components/application\"\nimport { MapuiMobileLayout } from \"$components/application\"\nimport { CitiesList, CitiesShow } from \"$components/cities\"\nimport { GalleriesShow } from \"$components/galleries\"\nimport { LocationsShowMobile } from \"$components/locations\"\nimport { ReportsShow } from \"$components/reports\"\nimport { SitesShow } from '$components/sites'\nimport {\n  Account,\n  LoginModal,\n  RegisterModal,\n} from \"$components/users\"\nimport { Videos } from \"$components/videos\"\nimport { Galleries, MyGalleries } from \"$components/galleries\"\nimport {\n  C, CollapsibleContextProvider,\n  logg,\n  TwofoldContext, TwofoldContextProvider,\n  useApi,\n} from \"$shared\"\n\nconst Root = styled.div`\n  background: ${p => p.theme.colors.background};\n  height: 100vh;\n  overflow: auto;\n`;\n\nconst __Container = styled(_Container)`\n  padding: 0;\n  height: 100vh;\n  overflow: scroll;\n`;\n\nconst AppMobile = (props) => {\n  // logg(props, 'AppMobile')\n\n  const [ layout, setLayout ] = useState(C.layout_onecol)\n  // const [ bottomDrawerOpen, setBottomDrawerOpen ] = React.useState(false)\n  // const [ itemToUnlock, setItemToUnlock ] = React.useState(false)\n  // const [ zoom, setZoom ] = useState(1)\n  // const api = useApi()\n  const theme = useTheme()\n\n  // @TODO: move into its own component!\n  const Container = ({ children, ...props }) => {\n    // logg(props, 'Container')\n\n    const {\n      bottomDrawerOpen,\n    } = useContext(TwofoldContext)\n\n    const style = {\n      paddingBottom: bottomDrawerOpen ? theme.bottomDrawerOpenHeight : null\n    }\n\n    switch(layout) {\n      case C.layout_onecol:\n        return <__Container style={style} maxWidth=\"md\" {...props} >{ children }</__Container>\n      case C.layout_mapui:\n        // This is true right now (2021-10-20) for mobile even when it's one column\n        return <MapuiMobileLayout style={style} {...props} >{ children }</MapuiMobileLayout>\n    }\n  }\n\n  const Route = (props) => {\n    useEffect(() => {\n      if (props.layout) {\n        setLayout(props.layout)\n      } else {\n        setLayout(C.layout_onecol)\n      }\n    }, [props.layout])\n\n    return <_Route {...props} />\n  }\n\n  // const doUnlock = async () => {\n  //   // @TODO: check how many unlocks I have, and offer to purchase more if not enough.\n  //   const path = api.doUnlock({ kind: 'Report', id: itemToUnlock.report_id })\n  //   const result = await request.post(`${config.apiOrigin}${path}`)\n  //   logg(result, 'result of unlocking')\n  // }\n\n  return (<Router>\n    <TwofoldContextProvider {...props} {...{ layout, setLayout }} >\n      <CollapsibleContextProvider >\n        { layout === C.layout_onecol && <MenuLeft variant={C.variants.floating} /> }\n        <Root className=\"Root\" >\n\n          <Container className=\"Container\" >\n            <Switch id=\"main\" main >\n\n              <Redirect exact from=\"/\" to={config.homeLocation} />\n              <Route exact path=\"/en\" ><SitesShow /></Route>\n\n              <Route exact path=\"/en/account\" component={Account} />\n              <Route exact path=\"/en/account/my/videos\" component={Videos} />\n              <Route exact path=\"/en/account/my/galleries\" component={MyGalleries} />\n\n              <Route exact path=\"/en/cities\"                 component={CitiesList} />\n              <Route       path=\"/en/cities/travel-to/:name\" component={CitiesShow} />\n\n              <Route exact path=\"/en/galleries/show/:slug\" component={GalleriesShow} />\n\n              <Route exact path=\"/en/reports/show/:slug\" component={ReportsShow} />\n\n              <Route exact path=\"/en/locations/show/:slug\" component={LocationsShowMobile} layout={C.layout_mapui} />\n\n            </Switch>\n          </Container>\n\n        </Root>\n\n        <BottomDrawer />\n        <UnlockModal />\n        <LoginModal />\n        <RegisterModal />\n        <ToastContainer />\n\n      </CollapsibleContextProvider>\n    </TwofoldContextProvider>\n  </Router>)\n}\n\nexport default AppMobile\n","\nimport { Device } from '@capacitor/device'\nimport React, { useContext, useEffect, useRef, useState, } from 'react'\nimport { ThemeProvider } from 'styled-components'\n\nimport config from 'config'\nimport { C, logg, request, S, useApi } from \"$shared\"\nimport AppDesktop from './AppDesktop'\nimport AppMobile from './AppMobile'\n\n/**\n * Choses mobile vs desktop\n */\nconst AppWrapper = (props) => {\n  // logg(props, 'AppWrapper')\n\n  const [ os, setOs ] = useState(null)\n  // info.operatingSystem === 'ios' || 'android'\n  const fn = async () => {\n    let info = await Device.getInfo()\n    setOs(info.operatingSystem)\n  }\n  fn()\n\n  const [theme, setTheme] = useState(window.localStorage.getItem(C.theme) || C.themes.light)\n  const toggleTheme = (e) => {\n    if (theme === C.themes.light) {\n      window.localStorage.setItem(C.theme, C.themes.dark)\n      setTheme(C.themes.dark)\n    } else {\n      window.localStorage.setItem(C.theme, C.themes.light)\n      setTheme(C.themes.light)\n    }\n  }\n\n  const childProps = {\n    theme, toggleTheme,\n  }\n\n  if (!os) { return null }\n  return <ThemeProvider theme={theme == C.themes.light ? S.lightTheme: S.darkTheme} >\n    { \"ios android\".includes(os) ?\n      <AppMobile {...childProps} />\n      : <AppDesktop {...childProps} /> }\n  </ThemeProvider>\n}\n\nexport default AppWrapper\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport AppWrapper from './AppWrapper'\nimport * as serviceWorker from './serviceWorker'\nimport {\n  Link, Switch, BrowserRouter as Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\n\nReactDOM.render(<AppWrapper />, document.getElementById('root'))\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n\n\n\n"],"sourceRoot":""}