{"version":3,"sources":["../config/environments/production_ish/config.js","../node_modules/@ionic/core/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","../node_modules/ionicons/dist/esm-es5 lazy /^/.//.*/.entry/.js$/ groupOptions: {} namespace object","shared/C.jsx","shared/Api.jsx","components/TwofoldLayout/index.jsx","components/application/BottomDrawer.jsx","components/application/MainHeader.jsx","components/application/MapuiLayout.jsx","components/application/MapuiMobileLayout.jsx","components/application/Menu.jsx","components/application/MenuLeft.jsx","components/application/Metaline.jsx","components/application/Rating.jsx","components/application/UnlockModal.jsx","components/users/Account.jsx","components/users/LoginModal.jsx","components/users/MyAccountWidget.jsx","components/users/index.jsx","shared/AppMock.jsx","shared/AppRouter.jsx","shared/Collapsible.jsx","shared/request.jsx","shared/S.jsx","shared/useWindowSize.jsx","shared/index.jsx","components/cities/CitiesList.jsx","components/newsitems/NewsitemGallery.jsx","components/newsitems/NewsitemPhoto.jsx","components/newsitems/NewsitemReport.jsx","components/newsitems/NewsitemVideo.jsx","components/newsitems/Newsitems.jsx","components/newsitems/NewsitemContainer.jsx","components/newsitems/ItemIcon.jsx","components/newsitems/index.js","components/venues/Venues.jsx","components/cities/CitiesShow.jsx","components/galleries/GalleriesShow.jsx","components/galleries/MyGalleries.jsx","components/locations/Breadcrumbs.jsx","components/reports/ReportsShow.jsx","components/locations/ItemModal.jsx","components/locations/LocationsShowDesktop.jsx","components/locations/LocationsShowMobile.jsx","components/locations/MapPanel.jsx","components/locations/MapPanelNoZoom.jsx","components/locations/MarkersList.jsx","components/locations/RatedRestrictionModal.jsx","components/locations3/Crosshair.jsx","components/locations3/PointerLockControls.js","components/locations3/Equirectangular.jsx","components/locations3/TouchControls.jsx","components/locations3/RotationPad.jsx","components/locations3/Equirectangular2.jsx","components/locations3/Equirectangular4.jsx","components/locations3/ThreePanelV1.jsx","components/locations3/ThreePanelV2.jsx","components/locations3/ThreePanelV3.jsx","components/locations3/ThreePanelV4.jsx","components/locations/WrappedMapPanel.jsx","components/locations/ZoomCtrl.jsx","components/sites/Features.jsx","components/sites/SitesShow.jsx","components/sites/SitesShow1.jsx","components/videos/Videos.jsx","AppDesktop.jsx","AppMobile.jsx","AppWrapper.jsx","serviceWorker.js","index.jsx"],"names":["module","exports","map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","keys","Object","C","anonUser","bottomDrawerOpen","collapsible","description","extra1","extra2","extra3","markers","collapsibles","current_user","foldedCenter","foldedLeft","foldedRight","horizontal","item_types","gallery","report","photo","video","jwt_token","layout_onecol","layout_mapui","locations","earth","map_panel_types","Equirectangular","MapPanel","MapPanelNoZoom","ThreePanelV1","ThreePanelV4","rated","nc17","ratedConfirmation","theme","themes","dark","light","twofoldPercent","variants","bordered","floating","inline","transparent","vertical","useApi","useContext","TwofoldContext","token","currentUser","setCurrentUser","localStorage","getItem","doUnlock","kind","path","request","post","config","apiOrigin","r","data","getCities","get","getCity","slug","getMyAccount","logg","getPayments","getTag","tag","loginPath","longTermTokenPath","myAccount","myVideosPath","reportsGet","a","JSON","parse","jwt","applicationHome","domain","params","out","LongLine","styled","div","p","thinBorder","thinBorderRadius","orientation","colors","background","propTypes","PropTypes","string","Drawer","_Drawer","getLibrary","provider","Web3","Inner0","Inner1","bottomDrawerOpenHeight","borderHeight","borderWidth","Inner2","cardBackground","WClosed","BottomDrawer","props","layout","setBottomDrawerOpen","IconButton","aria-label","onClick","MenuIcon","fontSize","anchor","elevation","open","onClose","BackdropProps","invisible","variant","style","paddingRight","Header","Root","MainHeader","MapuiContainer","bottomDrawerHeight","MapuiLayout","bottomDrawerClosedHeight","MapuiMobileLayout","S","newspaperOutline","bus","person","powerOutline","W1","MenuLeft","React","useState","drawerOpen","setDrawerOpen","history","useHistory","Fab","position","top","left","margin","List","ListItem","button","key","push","homeLocation","bookmarks","b","idx","name","W","text","withRouter","created_at","username","city","tags","className","pp_date","i","Rating","rate","rating","setRating","iconMapping","0","starOutline","1","starHalf","2","star","useEffect","Array","fill","icon","Btn0","BtnRow","modalStyle","overlay","content","maxWidth","UnlockModal","itemToUnlock","setItemToUnlock","setLoginModalOpen","loginModalOpen","setPurchaseModalIsOpen","purchaseModalIsOpen","setRatedConfirmation","api","item_type","mountedRef","useRef","jwtToken","current","fn","closable","cost","premium_tier","ariaHideApp","isOpen","n_unlocks","Btn","isPushNotificationsAvailable","Capacitor","isPluginAvailable","greeterAddress","tokenAddress","LoginRow","Account","greeting","setGreetingValue","notifications","setNotifications","scratchpad","setScratchpad","register","PushNotifications","addListener","showToast","error","alert","stringify","_n","n","logg2","ns","type","nofitication","msg","Toast","show","requestAccount","window","ethereum","method","fetchGreeting","ethers","providers","Web3Provider","contract","Contract","Greeter","abi","greet","console","log","account","Token","balanceOf","balance","toString","signer","getSigner","setGreeting","transaction","wait","transfer","userAccount","amount","transation","checkPermissions","res","receive","requestPermissions","Grid","container","spacing","item","xs","src","alt","value","onChange","target","placeholder","setUserAccount","setAmount","email","to","length","notif","title","body","color","expand","LoginModal","zIndex","BuyBtn","Cell","FlexRow","_Img","Img","injected","InjectedConnector","stripePromise","loadStripe","Login","active","setActive","MyAccountWidget","stripe","useStripe","elements","useElements","avatar","setAvatar","handleSubmit","event","preventDefault","getElement","CardElement","client_secret","confirmCardPayment","payment_method","card","result","message","paymentIntent","status","response","useWeb3React","activate","library","connector","deactivate","ex","myBodies","bodyNFT","tokensOfOwner","tokenURI","image","profile_photo_url","onSubmit","disabled","WrappedMyAccountWidget","FacebookLogin","Plugins","FACEBOOK_PERMISSIONS","FbLogin","doFbLogin","login","permissions","accessToken","resp","setItem","err","Logout","removeItem","_W","PasswordLogin","setEmail","password","setPassword","doPasswordLogin","toast","onKeyDown","AppRouter","cityVenuesPath","cityPath","Gt","Inner","Lt","Label","WTransparent","children","WBordered","Collapsible","ctx","CollapsibleContext","setCollapsibles","folded","label","shape","bool","isRequired","settings","baseURL","axios","create","breadcrumbsHeight","thinBorderWidth","lightTheme","blue","darkGrey","lightGrey","red","border","darkTheme","useWindowSize","size","setSize","useLayoutEffect","updateSize","innerWidth","innerHeight","addEventListener","removeEventListener","BackIcon","IonIcon","BackBtn","goBack","arrowBack","ChevronLeft","_ChevronLeft","ChevronRight","_ChevronRight","Card","_Box","cursor","createContext","CollapsibleContextProvider","tmp","defaultCollapsibles","descr","_setCollapsibles","Provider","m","inflector","toLowerCase","_Circle","Loading","c","replace","inspect","_MenuIcon","PurchasedIcon","d","substring","TwofoldContextProvider","setLayout","toggleTheme","closure","setTimeout","clearTimeout","is_purchasing","_setBottomDrawerOpen","setFolded","_setItemToUnlock","mapPanelWidth","setMapPanelWidth","mapPanelHeight","setMapPanelHeight","_setRatedConfirmation","showItem","setShowItem","showUrl","setShowUrl","setTwofoldPercent","zoom","setZoom","which","WBorderedItem","WidgetContainer","Wrapper","Counts","Count","_IonIcon","Number","Cities","cities","setCities","filteredCities","setFilteredCities","showLoading","setShowLoading","ev","filter","indexOf","trim","funnel","bookmark","n_reports","n_galleries","n_videos","videocam","onDidDismiss","duration","Images","ImageLarge","img","ImageThumb1","ImageThumb2","NewsitemGallery","photos","thumb_url","array","NewsitemPhoto","NewsitemReport","object","NewsitemVideo","youtube_id","width","height","frameBorder","allow","allowFullScreen","preload","controls","url","Newsitems","newsitems","newsitem","Col","Row","Title","h2","navigateToItem","boxShadow","NewsitemContainer","is_premium","is_purchased","dangerouslySetInnerHTML","__html","subhead","ItemIcon","number","GenericNewsitem","Address","_Ra","RightArrow","Venue","Venues","venues","filteredVenues","setFilteredVenues","venue","includes","address","CitiesShow","match","thisPath","location","useLocation","setCity","backgroundImage","hero_img","backgroundSize","pin","pathname","exact","render","GalleriesShow","setGallery","getGallery","ph","large_url","MyGalleries","galleries","setGalleries","g","B","B1","L","WDayNight","DayNightToggle","checked","onIonChange","debug","WBreadcrumbs","Breadcrumbs","breadcrumbs","textDecoration","arrayOf","ReportsShow","getReport","ItemModal","reportname","_D","Description","WH","Handle","w","offsetX","setOffsetX","dragging","setDragging","onMouseUp","onMouseMove","clientX","movedBy","movedByPercent","prev","onMouseDown","pageX","onMouseLeave","pointer","IframeModal","scrolling","allowtransparency","Left","Right","LocationsShowDesktop","windowWidth","windowHeight","loading","setLoading","setLocation","setMarkers","mapPanelRef","offsetWidth","offsetHeight","ref","labels","_Description","LocationsShowMobile","withZoom","Div1","ZoomCtrl","right","padding","display","flexDirection","div1Ref","scroll","behavior","y","centerOffsetY","x","centerOffsetX","img_path","maxHeight","h","W0","nextZoomByWidth","nextZoomByHeight","nextZoom","Math","min","_Marker","Marker","MarkersList","goto","title_img_path","RatedRestrictionModal","Crosshair","_euler","Euler","_vector","Vector3","_changeEvent","_lockEvent","_unlockEvent","_PI_2","PI","PointerLockControls","camera","domElement","undefined","warn","document","isLocked","minPolarAngle","maxPolarAngle","scope","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","setFromQuaternion","quaternion","max","setFromEuler","dispatchEvent","onPointerlockChange","ownerDocument","pointerLockElement","onPointerlockError","connect","disconnect","dispose","this","getObject","getDirection","direction","v","copy","applyQuaternion","moveForward","distance","setFromMatrixColumn","matrix","crossVectors","up","addScaledVector","moveRight","lock","requestPointerLock","unlock","exitPointerLock","EventDispatcher","TouchControls","options","THREE","RotationPad","self","$","extend","speedFactor","delta","rotationFactor","maxPitch","hitTest","hitTestDistance","isRightMouseDown","rotationMatrices","hitObjects","moveBackward","moveLeft","lockMoveForward","lockMoveBackward","lockMoveLeft","lockMoveRight","ztouch","xtouch","velocity","cameraHolder","Object3D","calculateCameraRotation","dx","dy","factor","ry","fpsBody","rotation","rx","add","scene","enabled","mouse","Vector2","rotationPad","on","detail","deltaX","deltaY","setRotation","movementPad","MovementPad","abs","middle","stopPropagation","keyCode","clientY","originalEvent","rotationMatrixF","Matrix4","makeRotationY","rotationMatrixB","rotationMatrixL","rotationMatrixR","prepareRotationMatrices","update","z","translateX","translateY","translateZ","unlockAllDirections","index","cameraDirection","getDirection2","clone","applyMatrix4","intersects","Raycaster","intersectObject","getObjectByName","set","applyEuler","boolean","prototype","addToScene","setPosition","stopMouseMoving","camHolder","getHitObjects","eventRepeatTimeout","newLeft","newTop","angle","mouseDown","handleRef","handleEl","regionRef","regionEl","regionData","handleData","resetHandlePosition","animate","centerY","radius","centerX","opacity","pageY","offset","pow","atan2","cos","sin","round","css","parseInt","sendEvent","moveEvent","Event","bubbles","trigger","targetTouches","touches","Blocker","Equirectangular2","renderer","texture","markerObjects","blockerRef","wContainerRef","instructionsRef","fog","canJump","axes","wContainer","floorGeometry","rotateX","loadTexture","wrapS","wrapT","repeat","floorMaterial","floor","textureLoader","assetPath","load","rt","fromEquirectangularTexture","antialias","setPixelRatio","devicePixelRatio","clientWidth","clientHeight","appendChild","onWindowResize","init","prevTime","performance","now","canvas","needResize","resizeRendererToDisplaySize","aspect","updateProjectionMatrix","requestAnimationFrame","time","intersections","intersectObjects","onObject","normalize","Loc","raycaster","objects","attributes","l","count","vertex","fromBufferAttribute","random","setXYZ","toNonIndexed","colorsFloor","setHSL","setAttribute","vertexColors","manager","traverse","child","isMesh","material","geometry","scale","onProgress","loaded","total","OBJLoader","obj","xhr","lengthComputable","percentComplete","cube","ray","origin","markerObjectsIdxs","pMat","uniforms","main_color","border_color","thickness","center","vertexShader","fragmentShader","texturePath","modelPath","modelPath2","onError","mtlLoader","MTLLoader","setPath","materials","objLoader","setMaterials","uuid","loader","glow","removedObject","modelName","wrappedOnLoad","remove","_pickedObject","parent","marker","WrappedMapPanel","forwardRef","map_panel_type","Equirectangular4","ThreePanelV2","ThreePanelV3","Features","features","f","inner_html","sm","marginBottom","SitesShow","site","setSite","SitesShow1","artTag","setArtTag","homeRow1Tag","setHomeRow1Tag","interestingLocationsTag","setInterestingLocationsTag","useStyles","makeStyles","paper","textAlign","palette","secondary","redBorder","root","flexGrow","overflow","VideoItem","Video","video_url","Videos","videos","setVideos","classes","AppDesktop","Container","Route","main","from","component","CitiesList","__Container","_Container","AppMobile","AppWrapper","requireLogin","os","setOs","Device","getInfo","info","operatingSystem","setTheme","childProps","Boolean","hostname","ReactDOM","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"4znBACAA,EAAOC,QAAU,CACf,UAAa,+BACb,aAAgB,YAEhB,OAAU,mBAEV,aAAgB,gCAEhB,cAAgB,I,+j0DCTlB,IAAIC,EAAM,CACT,8BAA+B,CAC9B,IACA,GAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,GAED,0BAA2B,CAC1B,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,sBAAuB,CACtB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,qBAAsB,CACrB,IACA,IAED,mCAAoC,CACnC,IACA,IAED,uBAAwB,CACvB,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,wBAAyB,CACxB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,uBAAwB,CACvB,IACA,GAED,uBAAwB,CACvB,IACA,IAED,yBAA0B,CACzB,IACA,GAED,8BAA+B,CAC9B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,uBAAwB,CACvB,IACA,IAED,6BAA8B,CAC7B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,+BAAgC,CAC/B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,yBAA0B,CACzB,IACA,IAED,yBAA0B,CACzB,IACA,IAED,4BAA6B,CAC5B,IACA,IAED,2BAA4B,CAC3B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,sBAAuB,CACtB,IACA,IAED,0BAA2B,CAC1B,IACA,IAED,uBAAwB,CACvB,IACA,IAED,wBAAyB,CACxB,IACA,IAED,gCAAiC,CAChC,IACA,KAGF,SAASC,EAAoBC,GAC5B,IAAIC,EAAoBC,EAAEJ,EAAKE,GAC9B,OAAOG,QAAQC,UAAUC,MAAK,WAC7B,IAAIC,EAAI,IAAIC,MAAM,uBAAy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","file":"static/js/main.7f3d9de8.chunk.js","sourcesContent":["\nmodule.exports = {\n  \"apiOrigin\": \"https://manager.piousbox.com\",\n  \"appIndexPath\": \"src/index\",\n\n  \"domain\": \"tgm.piousbox.com\", // required! 20210831\n\n  \"homeLocation\": \"/en/locations/show/construct0\",\n\n  \"requireLogin\": false,\n};\n","var map = {\n\t\"./ion-action-sheet.entry.js\": [\n\t\t799,\n\t\t5\n\t],\n\t\"./ion-alert.entry.js\": [\n\t\t800,\n\t\t6\n\t],\n\t\"./ion-app_8.entry.js\": [\n\t\t801,\n\t\t7\n\t],\n\t\"./ion-avatar_3.entry.js\": [\n\t\t802,\n\t\t17\n\t],\n\t\"./ion-back-button.entry.js\": [\n\t\t803,\n\t\t18\n\t],\n\t\"./ion-backdrop.entry.js\": [\n\t\t804,\n\t\t46\n\t],\n\t\"./ion-button_2.entry.js\": [\n\t\t805,\n\t\t19\n\t],\n\t\"./ion-card_5.entry.js\": [\n\t\t806,\n\t\t20\n\t],\n\t\"./ion-checkbox.entry.js\": [\n\t\t807,\n\t\t21\n\t],\n\t\"./ion-chip.entry.js\": [\n\t\t808,\n\t\t22\n\t],\n\t\"./ion-col_3.entry.js\": [\n\t\t809,\n\t\t47\n\t],\n\t\"./ion-datetime_3.entry.js\": [\n\t\t810,\n\t\t10\n\t],\n\t\"./ion-fab_3.entry.js\": [\n\t\t811,\n\t\t23\n\t],\n\t\"./ion-img.entry.js\": [\n\t\t812,\n\t\t48\n\t],\n\t\"./ion-infinite-scroll_2.entry.js\": [\n\t\t813,\n\t\t49\n\t],\n\t\"./ion-input.entry.js\": [\n\t\t814,\n\t\t24\n\t],\n\t\"./ion-item-option_3.entry.js\": [\n\t\t815,\n\t\t25\n\t],\n\t\"./ion-item_8.entry.js\": [\n\t\t816,\n\t\t26\n\t],\n\t\"./ion-loading.entry.js\": [\n\t\t817,\n\t\t27\n\t],\n\t\"./ion-menu_3.entry.js\": [\n\t\t818,\n\t\t28\n\t],\n\t\"./ion-modal.entry.js\": [\n\t\t819,\n\t\t8\n\t],\n\t\"./ion-nav_2.entry.js\": [\n\t\t820,\n\t\t14\n\t],\n\t\"./ion-popover.entry.js\": [\n\t\t821,\n\t\t9\n\t],\n\t\"./ion-progress-bar.entry.js\": [\n\t\t822,\n\t\t29\n\t],\n\t\"./ion-radio_2.entry.js\": [\n\t\t823,\n\t\t30\n\t],\n\t\"./ion-range.entry.js\": [\n\t\t824,\n\t\t31\n\t],\n\t\"./ion-refresher_2.entry.js\": [\n\t\t825,\n\t\t11\n\t],\n\t\"./ion-reorder_2.entry.js\": [\n\t\t826,\n\t\t16\n\t],\n\t\"./ion-ripple-effect.entry.js\": [\n\t\t827,\n\t\t50\n\t],\n\t\"./ion-route_4.entry.js\": [\n\t\t828,\n\t\t32\n\t],\n\t\"./ion-searchbar.entry.js\": [\n\t\t829,\n\t\t33\n\t],\n\t\"./ion-segment_2.entry.js\": [\n\t\t830,\n\t\t34\n\t],\n\t\"./ion-select_3.entry.js\": [\n\t\t831,\n\t\t35\n\t],\n\t\"./ion-slide_2.entry.js\": [\n\t\t832,\n\t\t51\n\t],\n\t\"./ion-spinner.entry.js\": [\n\t\t833,\n\t\t13\n\t],\n\t\"./ion-split-pane.entry.js\": [\n\t\t834,\n\t\t52\n\t],\n\t\"./ion-tab-bar_2.entry.js\": [\n\t\t835,\n\t\t36\n\t],\n\t\"./ion-tab_2.entry.js\": [\n\t\t836,\n\t\t15\n\t],\n\t\"./ion-text.entry.js\": [\n\t\t837,\n\t\t37\n\t],\n\t\"./ion-textarea.entry.js\": [\n\t\t838,\n\t\t38\n\t],\n\t\"./ion-toast.entry.js\": [\n\t\t839,\n\t\t39\n\t],\n\t\"./ion-toggle.entry.js\": [\n\t\t840,\n\t\t12\n\t],\n\t\"./ion-virtual-scroll.entry.js\": [\n\t\t841,\n\t\t53\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 408;\nmodule.exports = webpackAsyncContext;","var map = {\n\t\"./ion-icon.entry.js\": [\n\t\t842,\n\t\t60\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__(id);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 410;\nmodule.exports = webpackAsyncContext;","\n/**\n * Constants\n */\nconst C = {\n\n  // A\n  anonUser: {}, // as opposed to null\n\n  // B\n  bottomDrawerOpen: 'bottom-drawer-open', // localStorage\n\n  // C\n  collapsible: {\n    description: \"descr-sec\",\n    extra1: \"extra1-sec\",\n    extra2: \"extra2-sec\",\n    extra3: \"extra3-sec\",\n    map: \"map-sec\",\n    markers: \"markers-sec\",\n  },\n  collapsibles: 'collapsibles', // localStorage\n  current_user: 'current_user',\n\n  // F\n  foldedCenter: 'folded-center',\n  foldedLeft: 'folded-left', // twofoldContext\n  foldedRight: 'folded-right',\n\n  // H\n  horizontal: 'horizontal',\n\n  // I\n  item_types: {\n    gallery: 'Gallery',\n    report: 'Report',\n    photo: 'Photo',\n    video: 'Video',\n  },\n\n  // J\n  jwt_token: 'jwt_token',\n\n  // L\n  layout_onecol: 'onecol',\n  layout_mapui: 'mapui',\n  locations: {\n    earth: 'earth',\n  },\n\n  // M\n  map_panel_types: {\n    Equirectangular: \"Equirectangular\",\n    MapPanel: \"MapPanel\",\n    MapPanelNoZoom: \"MapPanelNoZoom\",\n    ThreePanelV1: \"ThreePanelV1\",\n    ThreePanelV4: \"ThreePanelV4\",\n  },\n\n  // R\n  rated: {\n    nc17: 'nc-17',\n  },\n  ratedConfirmation: 'rated-confirmation', // localStorage\n\n  // T\n  theme: 'theme',\n  themes: {\n    dark: 'dark',\n    light: 'light',\n  },\n  twofoldPercent: 'twofold-percent', // localStorage\n\n  // V\n  variants: {\n    bordered: 'bordered', // for Newsitems\n    floating: 'floating', // for main-menu btn\n    inline: 'inline',     // for main-menu btn\n    transparent: 'transparent', // for markers on Right\n  },\n  vertical: 'vertical',\n}\nexport default C\n","import React, { useContext } from 'react'\n\nimport config from \"config\"\nimport { C,\n  logg, // eslint-disable-line no-unused-vars\nrequest, TwofoldContext } from \"$shared\"\n\nconst useApi = () => {\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  const token = localStorage.getItem(C.jwt_token);\n\n  return {\n\n    // returns current user\n    doUnlock: ({ kind, id }) => {\n      const jwt_token = localStorage.getItem('jwt_token')\n      const path = `/api/payments/unlock?kind=${kind}&id=${id}&jwt_token=${jwt_token}`\n      return request.post(`${config.apiOrigin}${path}`).then((r) => r.data)\n    },\n\n\n    getCities: ()   => request.get(`${config.apiOrigin}/api/cities`).then((r) => r.data),\n    getCity: (slug) => request.get(`${config.apiOrigin}/api/cities/view/${slug}`),\n    getMyAccount: () => request.post(`/api/my/account`, {\n        jwt_token: localStorage.getItem('jwt_token'),\n      }).then((r) => {\n        logg(r.data, 'getmyaccount')\n        return r.data\n      }),\n    getPayments: () => request.get(`${config.apiOrigin}/api/payments2?jwt_token=${token}`).then((r) => r.data),\n    getTag: (tag) => request.get(`${config.apiOrigin}/api/tags/view/${tag.slug}`).then((r) => r.data),\n\n    loginPath: '/api/users/login.json',\n    longTermTokenPath: '/api/users/long_term_token',\n\n    myAccount: () => \"/api/my/account\",\n    myVideosPath: \"/api/my/videos\",\n\n    reportsGet: (a) => {\n      const currentUser = JSON.parse(localStorage.getItem(\"current_user\")) || {};\n      let jwt = \"\";\n      if (currentUser) {\n        jwt = `jwt_token=${currentUser.jwt_token}`\n      }\n      return `${config.apiOrigin}/api/reports/view/${a}?${jwt}`;\n    },\n\n\n    applicationHome: async () => {\n      const out = await request.get(`${config.apiOrigin}/api/sites/view/${config.domain}`, { params: { jwt_token: token } })\n      return out.data\n    }\n  }\n\n}\n\nexport default useApi\n","/*\n * components / TwofoldLayout / index.jsx\n */\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\n\nimport { C, logg } from \"$shared\"\n\n/**\n * Documentation\n */\nconst LongLine = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n\n  flex-grow: 1;\n\n  width: ${p => p.orientation === C.horizontal ? 'auto' : '10px'};\n  height: ${p => p.orientation === C.horizontal ? '10px' : 'auto'};\n\n  padding: 2px;\n  background: ${p => p.theme.colors.background};\n`;\nLongLine.propTypes = {\n  orientation: PropTypes.string,\n}\n\nexport { LongLine }\n","\nimport _Drawer from '@material-ui/core/Drawer'\nimport IconButton from '@material-ui/core/IconButton'\nimport React, { Fragment as F, useContext, useState } from 'react'\nimport styled from 'styled-components'\nimport Web3 from 'web3'\nimport { useWeb3React, Web3ReactProvider } from \"@web3-react/core\"\nimport { InjectedConnector } from '@web3-react/injected-connector'\n\nimport { C, logg, MenuIcon, S, TwofoldContext, } from \"$shared\"\nimport { LongLine } from \"$components/TwofoldLayout\"\nimport { MyAccountWidget } from \"$components/users\"\n\n\n\nconst Drawer = styled(_Drawer)`\n  .MuiDrawer-paper {\n    // border: 1px solid cyan;\n\n    background: ${p=>p.theme.colors.background};\n  }\n\n  .MuiDrawer-paperAnchorDockedBottom {\n    border-top: 0;\n  }\n\n`;\n\nfunction getLibrary(provider) {\n  return new Web3(provider)\n}\n\nconst Inner0 = styled.div`\n  display: flex;\n  align-items: flex-start;\n`;\n\nconst Inner1 = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n\n  background: ${p=>p.theme.colors.background};\n  height: calc(${p=>p.theme.bottomDrawerOpenHeight} + 1*${p=>p.theme.borderHeight});\n  margin: ${p=>p.theme.borderWidth};\n\n  flex-grow: 1;\n`;\n\n// TODO: I may not need this\nconst Inner2 = styled.div`\n  // border: 1px solid green;\n\n  background: ${p=>p.theme.colors.cardBackground};\n  height: 100px;\n  display: flex;\n`;\n\nconst WClosed = styled.div`\n  // border: 1px solid yellow;\n\n  position: absolute;\n  bottom: -10px;\n  // left: 10px;\n\n  width: calc(100% - 2*${p=>p.theme.borderWidth});\n\n  display: flex;\n  align-items: center;\n`;\n\n/**\n * Documentation?\n */\nconst BottomDrawer = (props) => {\n  // logg(props, 'BottomDrawer')\n\n  const { bottomDrawerOpen, layout, setBottomDrawerOpen } = useContext(TwofoldContext)\n\n  // @TODO: move the component to layout_onecol then\n  if (layout === C.layout_onecol) { return null; }\n\n  return <F>\n\n    <WClosed>\n      <IconButton\n        aria-label=\"open drawer\"\n        onClick={() => setBottomDrawerOpen(true)}\n      ><MenuIcon\n        fontSize=\"small\"\n      /></IconButton>\n      <LongLine orientation={C.horizontal} />\n    </WClosed>\n\n\n    <Drawer anchor={\"bottom\"}\n      elevation={1}\n      open={bottomDrawerOpen}\n      onClose={() => setBottomDrawerOpen(false)}\n      BackdropProps={{ invisible: true }}\n      variant={\"persistent\"}\n    >\n      <Inner0 >\n        <IconButton\n          aria-label=\"open drawer\"\n          onClick={() => setBottomDrawerOpen(false)}\n          style={{ paddingRight: 0 }}\n        ><MenuIcon\n          fontSize=\"small\"\n        /></IconButton>\n\n        <Inner1 >\n          <Inner2 >\n\n            <Web3ReactProvider getLibrary={getLibrary}>\n              <MyAccountWidget />\n            </Web3ReactProvider>\n\n          </Inner2>\n        </Inner1>\n      </Inner0>\n    </Drawer>\n  </F>\n}\n\nexport default BottomDrawer\n","import React from 'react'\nimport styled from 'styled-components'\n\nimport { logg, C, } from \"$shared\"\nimport { MenuLeft, } from \"$components/application\"\n\nconst Header = styled.div`\n  // border: 1px solid red;\n\n  flex-grow: 1;\n\n  text-align: center;\n  font-size: 2em;\n\n\n`;\n\nconst Root = styled.div`\n  // border: 1px solid blue;\n\n  display: flex;\n  justify-content: center;\n  line-height: 2em;\n  padding: 2em 0;\n`;\n\nconst MainHeader = (props) => {\n  // logg(props, 'MainMenu')\n\n  return <Root>\n    <MenuLeft variant={C.variants.inline} />\n    <Header>My Local Guide</Header>\n  </Root>\n}\n\nexport default MainHeader\n","\nimport React from 'react'\nimport styled from 'styled-components'\n\nconst MapuiContainer = styled.div`\n  // border: 1px solid purple;\n\n  background: white;\n\n  overflow: hidden;\n  margin: 10px;\n  height: calc(100vh - ${p => p.borderWidth*2}px - ${p => p.bottomDrawerOpen ? `${p.bottomDrawerHeight - p.borderWidth/2}px` : '0px' });\n`\n\nexport {\n  MapuiContainer,\n}\n\nconst MapuiLayout = (props) => {\n  return <MapuiContainer {...props} />\n}\n\nexport default MapuiLayout\n","\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, request, S, TwofoldContext, ZoomContext } from \"$shared\"\n\nconst MapuiContainer = styled.div`\n  // border: 1px solid cyan;\n\n  background: white;\n\n  overflow-y: auto;\n\n  height: calc(100vh\n    - ${p => p.bottomDrawerOpen ? p.bottomDrawerOpenHeight : p.bottomDrawerClosedHeight });\n`;\n\nexport {\n  MapuiContainer,\n}\n\nconst MapuiMobileLayout = (props) => {\n  const { bottomDrawerOpen } = useContext(TwofoldContext)\n  return <MapuiContainer {...props} {...{ bottomDrawerOpen }} {...S} />\n}\n\nexport default MapuiMobileLayout\n","import {\n  IonContent,\n  IonIcon,\n  IonItem,\n  IonLabel,\n  IonList,\n  IonMenu,\n  IonMenuToggle,\n  IonHeader,\n  IonToolbar,\n  IonTitle,\n} from '@ionic/react';\n\nimport React from 'react';\nimport { newspaperOutline, bus, person, powerOutline } from 'ionicons/icons';\nimport './application.scss';\n\nconst appPages = [\n  {\n    title: 'Homefeed',\n    icon: newspaperOutline,\n    url: \"/en\"\n  },\n  {\n    title: 'Cities',\n    icon: bus,\n    url: \"/en/cities\"\n  },\n  {\n    title: 'My Account',\n    icon: person,\n    url: \"/en/account\"\n  },\n  {\n    title: 'Account2',\n    icon: person,\n    url: \"/en/account2\"\n  },\n  {\n    title: 'Login',\n    icon: powerOutline\n  }\n];\n\n/**\n * 20210529 - I think this is obsolete somehow, I'm using MyDrawer in App.jsx\n *\n */\nconst Menu = () => {\n  return (\n    <IonMenu contentId=\"main\" type=\"overlay\">\n      <IonHeader>\n        <IonToolbar color=\"primary\">\n          <IonTitle>Menu</IonTitle>\n        </IonToolbar>\n      </IonHeader>\n      <IonContent>\n        <img src=\"/assets/hero.png\" />\n        <IonList id=\"inbox-list\">\n          { appPages.map((appPage, index) => <IonMenuToggle key={index} autoHide={false}>\n            <IonItem\n              routerLink={appPage.url}\n              routerDirection=\"none\"\n              lines=\"none\"\n              detail={false}>\n              <IonIcon\n                slot=\"start\"\n                ios={appPage.icon}\n                md={appPage.icon} />\n              <IonLabel>{appPage.title}</IonLabel>\n            </IonItem>\n          </IonMenuToggle>) }\n        </IonList>\n      </IonContent>\n    </IonMenu>\n  )\n}\n\nexport default Menu\n","import { IonApp, IonButtons, IonMenuButton } from '@ionic/react'\nimport Drawer from '@material-ui/core/Drawer'\nimport Fab from '@material-ui/core/Fab'\nimport IconButton from '@material-ui/core/IconButton'\nimport List from '@material-ui/core/List'\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport { Menu } from \"$components/application\"\nimport { Api, C, Debug, logg, MenuIcon, TwofoldContext, } from \"$shared\"\n\nconst _LeftWrapper = styled.div`\n  // border: 1px solid green;\n`;\n\nconst W1 = styled.div`\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  align-content: space-between;\n`;\n\nconst W2 = styled.div`\n`;\n\nconst MenuLeft= (props) => {\n  // logg(props, 'MenuLeft')\n\n  const [ drawerOpen, setDrawerOpen ] = React.useState(false)\n  const [ loading, setLoading ] = useState(false)\n  const history = useHistory()\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  return <F>\n\n    { /* <Menu /> */ }\n\n    { /* @TODO: probably remove from here, too many variations of the button, it gotta be separate */ }\n    { props.variant === C.variants.floating ?\n      <Fab onClick={() => setDrawerOpen(true)} style={{ position: 'absolute', top: 0, left: 0, margin: '.5em' }} aria-label='main menu'><MenuIcon /></Fab>\n      : <MenuIcon onClick={() => setDrawerOpen(true)} /> }\n\n    <Drawer anchor={\"left\"} open={drawerOpen} onClose={() => setDrawerOpen(false)} >\n      <W1>\n        <List>\n\n          <ListItem button key={'newsfeed'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(config.homeLocation)\n            } } >Home\n          </ListItem>\n\n          { /* <ListItem button key={'three'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/locations/show/threev1\")\n            } } >Three\n          </ListItem>\n\n          <ListItem button key={'three'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/locations/show/construct03d\")\n            } } >Construct0 3D\n          </ListItem>\n\n          <ListItem button key={'cities'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/cities\")\n            } }>\n            <span >Cities</span>\n          </ListItem>\n\n          <ListItem button key={'map 1'} >\n            <span onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/locations\")\n            } }>The Directory</span>\n          </ListItem> */ }\n\n          { currentUser && currentUser.bookmarks?.map((b, idx) =>\n            <ListItem button key={idx}\n              onClick={() => {\n                setDrawerOpen(false)\n                history.push(`/en/locations/show/${b.slug}`)\n              } } >\n              <span >{b.name}</span>\n            </ListItem>\n          ) }\n\n          <ListItem button key={'account'}\n            onClick={() => {\n              setDrawerOpen(false)\n              history.push(\"/en/account\")\n            } } >\n            <span >Account</span>\n          </ListItem>\n\n        </List>\n        { /* <W2>\n          { loading && 'Loading...' }\n          { currentUser && <F>\n            {currentUser.email}<br />\n            {currentUser.n_stars}<br />\n            some action\n          </F> }\n        </W2> */ }\n      </W1>\n    </Drawer>\n  </F>\n}\n\nMenuLeft.propTypes = {\n  variant: PropTypes.string,\n}\nexport default MenuLeft\n","import React from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport \"./application.scss\";\nimport styled from 'styled-components'\n\nimport { Api, logg, request, pp_date } from \"$shared\"\n\nconst W = styled.div`\n  margin-top: .5em;\n  color: ${p=>p.theme.colors.text};\n`\n\nconst Metaline = (props) => {\n  // logg(props, 'Metaline')\n\n  const { created_at, username, city, tags = [] } = props;\n\n  function navigateToCity(){\n    props.history.push(`/en/cities/travel-to/${city.slug}/show/newsfeed`);\n  }\n\n  return (\n    <W>\n      { created_at && <span className=\"date\"> On {pp_date(created_at)} </span>}\n      { username && <>by <span className=\"user\"> {username} </span></> }\n      { city     && <>in <span className=\"city\" onClick={navigateToCity}> {city.name} </span></> }\n      { tags     && tags.map((tag, i) => <span key={i} className=\"tags\">{tag.name}</span>) }\n    </W>\n  );\n\n}\n\nexport default withRouter(Metaline);","import React, { useEffect, useState } from \"react\";\nimport { IonIcon } from \"@ionic/react\";\nimport { starOutline, starHalf, star } from 'ionicons/icons';\nimport \"./application.scss\";\n\nconst Rating = (props) => {\n\n  let rate = props.rate;\n  let [rating, setRating] = useState([]);\n\n  let iconMapping = {\n    0: starOutline,\n    1: starHalf,\n    2: star\n  };\n\n  useEffect(() => {\n\n    let rating = (new Array(5)).fill(0);\n    let i = 0;\n    while (rate > 0) {\n      if (rate < 1) {\n        rating[i] = 1;\n      } else {\n        rating[i] = 2;\n      }\n      rate--;\n      i++;\n    }\n\n    setRating(rating);\n\n  }, []);\n\n  return (\n    <div className=\"rating\">\n      { rating.map((r, i) => <IonIcon key={i} className=\"stars\" icon={iconMapping[r]} ></IonIcon>) }\n    </div>\n  )\n\n}\n\nexport default Rating;","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useRef, } from 'react'\nimport Modal from \"react-modal\"\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport './UnlockModal.scss'\nimport { Btn, C, logg, request, TwofoldContext, useApi, } from \"$shared\"\n\nconst Btn0 = styled.div`\n  display: inline;\n  cursor: pointer;\n`;\nconst BtnRow = styled.div`\n  display: flex;\n  justify-content: space-around;\n`;\n\nconst Header = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst modalStyle = {\n  overlay: {},\n  content: {\n    margin: 'auto',\n    maxWidth: '400px',\n\n  }\n}\n\n/**\n * UnlockModal\n */\nconst UnlockModal = (props) => {\n  // logg(props, 'UnlockModal')\n\n  const history = useHistory()\n\n  const {\n    currentUser, setCurrentUser,\n    itemToUnlock, setItemToUnlock,\n    loginModalOpen, setLoginModalOpen,\n    purchaseModalIsOpen, setPurchaseModalIsOpen,\n    ratedConfirmation, setRatedConfirmation,\n  } = useContext(TwofoldContext)\n  // const usedTwofoldContext = useContext(TwofoldContext)\n  // logg(usedTwofoldContext, 'unlockModalUsedTwofoldContext')\n\n  const api = useApi()\n\n  const doUnlock = async () => {\n    // @TODO: check how many unlocks I have, and offer to purchase more if not enough.\n    await api.doUnlock({ kind: itemToUnlock.item_type, id: itemToUnlock.id }).then((r) => {\n      setItemToUnlock({})\n      setCurrentUser(r)\n      // refresh the newsfeed?\n    }).catch((e) => {\n      logg(e, 'e19')\n    })\n  }\n\n  const mountedRef = useRef('init')\n  useEffect(() => {\n\n    const fn = async () => {\n      const jwtToken = localStorage.getItem(C.jwt_token)\n      await request.get(`${config.apiOrigin}${api.myAccount()}?jwt_token=${jwtToken}`).then((r) => {\n        if (!mountedRef.current) { return }\n        setCurrentUser(r.data)\n      }).catch((e) => {\n        // logg(e, 'e12')\n        // setCurrentUser(null)\n      })\n    }\n    fn()\n    return () => mountedRef.current = null\n  }, [itemToUnlock.id])\n\n  if (!itemToUnlock.id) { return null }\n\n  let closable = typeof itemToUnlock.closable === 'undefined' ? true : itemToUnlock.closable\n\n  // @TODO: this is messy\n  let gohome = () => {\n    setItemToUnlock({})\n    setRatedConfirmation(true)\n    history.push(config.homeLocation)\n  }\n\n  const cost = itemToUnlock.premium_tier\n\n  return (<Modal style={modalStyle} ariaHideApp={false} isOpen={!!itemToUnlock.id} >\n    <Header>\n      <h1>Unlock this item?</h1>\n      { closable && <Btn0 onClick={() => closable && setItemToUnlock(false) } >&times;</Btn0> }\n    </Header>\n    <p>To access this content, please unlock it first. It costs {cost} coin(s) to unlock.</p>\n    { currentUser && <F>\n      <p>You have <b>{currentUser.n_unlocks}</b> unlocks.</p>\n      { currentUser.n_unlocks >= cost && <Btn onClick={doUnlock} >Unlock</Btn> }\n      { currentUser.n_unlocks < cost && <F>\n        <p>You don't have enough unlocks.</p>\n        <Btn onClick={() => { setPurchaseModalIsOpen(true) ; setItemToUnlock(false)} } >Purchase more.</Btn>\n      </F> }\n    </F> }\n    { !currentUser && <F>\n      <p>You have to be logged in to unlock content. <a onClick={() => { setLoginModalOpen(true) ; setItemToUnlock(false) }}>Please login.</a></p>\n    </F> }\n    <BtnRow>\n      { !closable && <Btn onClick={gohome} >Go Home</Btn> }\n    </BtnRow>\n  </Modal>)\n\n}\n\nexport default UnlockModal\n","\nimport { Capacitor } from '@capacitor/core'\nimport { PushNotifications } from '@capacitor/push-notifications'\nimport { Toast } from \"@capacitor/toast\"\nimport { ethers } from 'ethers'\nimport {\n  IonButton, IonButtons,\n  IonCard, IonCardContent, IonContent,\n  IonFooter,\n  IonHeader,\n  IonItem,\n  IonLabel, IonListHeader, IonList,\n  IonMenuButton,\n  IonPage,\n  IonText, IonTitle, IonToolbar,\n} from '@ionic/react'\nimport { Container, Grid } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport React, {\n  Fragment as F,\n  useContext, useEffect, useState,\n} from \"react\"\nimport { Link } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { FbLogin, Logout, PasswordLogin } from \"./\"\nimport { C, logg, logg2, TwofoldContext } from \"$shared\"\nimport { MenuLeft } from \"$components/application\"\nimport Greeter from '$src/artifacts/contracts/Greeter.sol/Greeter.json'\nimport Token from '$src/artifacts/contracts/Token.sol/Token.json'\n\nconst isPushNotificationsAvailable = Capacitor.isPluginAvailable('PushNotifications')\n\n// Update with the contract address logged out to the CLI when it was deployed\nconst greeterAddress = \"0x4bE9765Ca063E73E0aaEd227fd6731473508DbE0\"\nconst tokenAddress = \"0xffa52d00685aC60e65457922aEae2c2783c0cB0E\"\n\nconst LoginRow = styled.div`\n  display: flex;\n  // border: 1px solid yellow;\n\n  > * {\n    margin: auto .4em;\n  }\n`;\n\nconst Account = (props) => {\n  logg(props, 'Account')\n\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  const [ greeting, setGreetingValue ] = useState(\"\")\n  const [notifications, setNotifications] = useState([])\n  const [ scratchpad, setScratchpad ] = useState(\"\")\n  const saveScratchpad = () => {}\n\n  // push notifications\n  const register = () => {\n    // Register with Apple / Google to receive push via APNS/FCM\n    PushNotifications.register()\n\n    // On success, we should be able to receive notifications\n    PushNotifications.addListener('registration', (token) => {\n      showToast('Push registration success')\n    })\n\n    // Some issue with our setup and push will not work\n    PushNotifications.addListener('registrationError', (error) => {\n      alert('Error on registration: ' + JSON.stringify(error))\n    })\n\n    // Show us the notification payload if the app is open on our device\n    PushNotifications.addListener('pushNotificationReceived', (_n) => {\n      const n = _n\n      logg2(n, 'pushNotificationReceived')\n      setNotifications((ns) => {\n        logg2(ns, 'setNofitications')\n        return [...ns, { ...n, type: 'foreground' }]\n      })\n    })\n\n    // Method called when tapping on a notification\n    PushNotifications.addListener('pushNotificationActionPerformed', ({ nofitication: n }) => {\n      logg2(n, 'pushNotificationActionPerformed')\n      setNotifications((ns) => {\n        logg2(ns, 'setNofitications')\n        return [...ns, { ...n, type: 'action' }]\n      })\n    })\n  }\n\n  const showToast = async (msg) => await Toast.show({ text: msg })\n\n  // push notifications\n  useEffect(() => {\n    if (!isPushNotificationsAvailable) { return }\n\n    PushNotifications.checkPermissions().then((res) => {\n        if (res.receive === 'granted') {\n          register()\n        } else {\n          PushNotifications.requestPermissions().then((res) => {\n            if (res.receive === 'denied') {\n              showToast('Push Notification permission denied')\n            } else {\n              showToast('Push Notification permission granted')\n              register()\n            }\n          })\n        }\n      })\n  }, [])\n\n  // request access to the user's MetaMask account\n  async function requestAccount() {\n    await window.ethereum.request({ method: 'eth_requestAccounts' });\n  }\n\n  // call the smart contract, read the current greeting value\n  async function fetchGreeting() {\n    if (typeof window.ethereum !== 'undefined') {\n      const provider = new ethers.providers.Web3Provider(window.ethereum)\n      const contract = new ethers.Contract(greeterAddress, Greeter.abi, provider)\n      try {\n        const data = await contract.greet()\n        setGreetingValue(data)\n        // console.log('data: ', data)\n      } catch (err) {\n        console.log(\"Error: \", err)\n      }\n    }\n  }\n\n  async function getBalance() {\n    if (typeof window.ethereum !== 'undefined') {\n      const [account] = await window.ethereum.request({ method: 'eth_requestAccounts' })\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const contract = new ethers.Contract(tokenAddress, Token.abi, provider)\n      const balance = await contract.balanceOf(account);\n      console.log(\"Balance: \", balance.toString());\n    }\n  }\n\n  // call the smart contract, send an update\n  async function setGreeting() {\n    if (!greeting) return\n    if (typeof window.ethereum !== 'undefined') {\n      await requestAccount()\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const signer = provider.getSigner()\n      const contract = new ethers.Contract(greeterAddress, Greeter.abi, signer)\n      const transaction = await contract.setGreeting(greeting)\n      await transaction.wait()\n      fetchGreeting()\n    }\n  }\n\n  async function sendCoins() {\n    if (typeof window.ethereum !== 'undefined') {\n      await requestAccount()\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const signer = provider.getSigner();\n      const contract = new ethers.Contract(tokenAddress, Token.abi, signer);\n      const transation = await contract.transfer(userAccount, amount);\n      await transation.wait();\n      console.log(`${amount} Coins successfully sent to ${userAccount}`);\n    }\n  }\n\n  return <IonPage>\n    <Grid container>\n      <MenuLeft variant={C.variants.inline} />\n      <h1>Account</h1>\n    </Grid>\n    <IonContent className=\"ion-padding\">\n\n      <Grid container spacing={2} >\n        <Grid item xs={12}>\n          <Grid container>\n            <Grid item xs={6}>\n              <img src=\"/assets/accounts/default-avatar.png\" alt=\"profile pic\" />\n\n              { /* NFT */ }\n              <div>\n                <button onClick={fetchGreeting}>Fetch Greeting</button>\n                <br />\n                <button onClick={setGreeting}>Set Greeting</button>\n                <br />\n                <input value={greeting} onChange={e => setGreetingValue(e.target.value)} placeholder=\"Set greeting\" />\n              </div>\n              <hr />\n              <div>\n                <button onClick={getBalance}>Get Balance</button>\n                <br />\n                <button onClick={sendCoins}>Send Coins</button>\n                <br />\n                <input onChange={e => setUserAccount(e.target.value)} placeholder=\"Account ID\" />\n                <br />\n                <input onChange={e => setAmount(e.target.value)} placeholder=\"Amount\" />\n              </div>\n\n            </Grid>\n            <Grid item xs={6}>\n              { !!currentUser\n                && <F>\n                  <h4>{currentUser.email}</h4>\n                  <ul>\n                    <li><Link to={\"/en/account/my/galleries\"} >My Galleries</Link></li>\n                    <li><a onClick={() => props.history.push(\"/en/account/my/videos\")}>My Videos</a></li>\n                    <li><Logout /></li>\n                  </ul>\n                </F>\n                || <F>\n                  <h4>Not logged in</h4>\n\n                  <LoginRow>\n                    <FbLogin />\n                    <PasswordLogin />\n                  </LoginRow>\n\n                </F> }\n            </Grid>\n          </Grid>\n          <Grid container spacing={2}>\n            <Grid item xs={6} >\n              <textarea value={scratchpad} onChange={setScratchpad} />\n              <button type='submit' onClick={saveScratchpad}>Save Scratchpad</button>\n            </Grid>\n          </Grid>\n        </Grid>\n      </Grid>\n\n      <hr />\n      { /* push notifications */ }\n      { notifications.length && <IonList>\n        { notifications.map((notif) => <IonItem key={notif.id}>\n          <IonLabel>\n            <IonText><h3 className=\"notif-title\">{ notif.title }</h3></IonText>\n            <p>{ notif.body }</p>\n            { notif.type==='foreground' && <p>This data was received in foreground</p> }\n            { notif.type==='action' && <p>This data was received on tap</p> }\n          </IonLabel>\n        </IonItem>) }\n      </IonList> || 'no notifications so far' }\n\n    </IonContent>\n    <IonFooter>\n      <IonToolbar>\n        { isPushNotificationsAvailable && <IonButton\n          color=\"success\" expand=\"full\" onClick={register}>Register for Push</IonButton>\n          || <div><h1>Push notifications not available</h1></div> }\n      </IonToolbar>\n    </IonFooter>\n  </IonPage>\n}\n\nexport default Account\n","\nimport { IonPage, IonContent } from \"@ionic/react\"\nimport { Container, Grid } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport React, { Fragment as F, useContext, useEffect, useState } from \"react\"\nimport Modal from 'react-modal'\nimport { Link } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { FbLogin, Logout, PasswordLogin } from \"./\"\nimport { C, logg, TwofoldContext } from \"$shared\"\n\n\nconst LoginModal = (props) => {\n  // logg(props, 'LoginModal')\n  const { loginModalOpen, setLoginModalOpen } = useContext(TwofoldContext)\n\n  return <Modal style={{ zIndex: 3 }} isOpen={loginModalOpen} >\n\n    <h1>\n      Please Login\n      <button onClick={() => setLoginModalOpen(false)} >[x]</button>\n    </h1>\n    <FbLogin />\n    <PasswordLogin />\n  </Modal>\n}\n\nexport default LoginModal\n","\nimport { ethers } from 'ethers'\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { CardElement, Elements, useElements, useStripe, } from '@stripe/react-stripe-js'\nimport { loadStripe } from '@stripe/stripe-js'\nimport styled from 'styled-components'\nimport Web3 from 'web3'\nimport { useWeb3React, Web3ReactProvider } from \"@web3-react/core\"\nimport { InjectedConnector } from '@web3-react/injected-connector'\n\nimport config from \"config\"\n\nimport { FbLogin, Logout, PasswordLogin } from \"./\"\n\nimport { logg, S, request, TwofoldContext, useApi } from \"$shared\"\nimport bodyNFT from '$src/artifacts/contracts/Body.sol/BodyNFT.json'\n\n/*\n * ropsten, _vp_ 2021-10-26\n * Dana, nude 1 (nude 3)\n */\nconst bodyAddress = '0x3e1a03a9e1682f4dd95413e0be69e5b7bccaf15d'\n\nconst BuyBtn = styled.div`\n  // border: 1px solid black;\n  padding: 5px;\n  cursor: pointer;\n`;\n\nconst Cell = styled.div`\n  display: flex;\n`;\n\nconst FlexRow = styled.div`\n  display: flex;\n\n  > * {\n    margin: auto .4em;\n  }\n`;\n\nconst _Img = styled.div`\n  // border: 1px solid red;\n\n  max-width: 100px;\n  max-height: 100px;\n\n`;\nconst Img = ({ src }) => {\n  return <_Img><img src={src} alt='' /></_Img>\n}\nconst injected = new InjectedConnector() // { supportedChainIds: [1, 3, 4, 5, 42], })\n\nconst stripePromise = loadStripe('pk_test_qr1QPmSpLdBFt1F7itdWJOj3') // @TODO: this is active, but change.\n\nconst Login = (props) => {\n  const [ active, setActive ] = useState(false) // whether the button is expanded into login form(s)\n\n  return <F>\n    { active && <FlexRow>\n                  <FbLogin />\n                  <PasswordLogin />\n                </FlexRow>\n      || <button onClick={() => setActive(true)} >Login</button>\n    }\n  </F>\n};\n\nconst W = styled.div`\n  border: 2px solid cyan;\n\n  display: flex;\n  justify-content: flex-start;\n  align-items: center;\n\n  // background: #dedede;\n  // background: white;\n  // height: 100px;\n  // width: calc(100vw - 2*${p => p.theme.borderWidth});\n  // padding: 1em;\n  // margin-bottom: ${p => p.theme.borderWidth};\n`;\n\nconst MyAccountWidget = (props) => {\n  // logg(props, 'MyAccountWidget')\n\n  const api = useApi()\n  const {\n    currentUser, setCurrentUser,\n    purchaseModalIsOpen, setPurchaseModalIsOpen,\n  } = useContext(TwofoldContext)\n  // logg(useContext(TwofoldContext), 'MyAccountWidget#usedTwofoldContext')\n\n  const stripe = useStripe()\n  const elements = useElements()\n\n  /*\n   * @TODO: avatar would be an object s.t. multiple styles/sizes are there,\n   * and it should be in a context - shared across threemap, and accountWidget.\n   */\n  const [ avatar, setAvatar ] = useState(\"\")\n\n  // buy unlocks (coins)\n  const handleSubmit = async (event) => {\n    event.preventDefault()\n\n    if (!stripe || !elements) { return }\n    const cardElement = elements.getElement(CardElement)\n    let client_secret = await api.getPayments()\n\n    const result = await stripe.confirmCardPayment(client_secret.client_secret, {\n      payment_method: {\n        card: elements.getElement(CardElement),\n      },\n    })\n\n    if (result.error) {\n      logg(result.error.message, 'error message')\n    } else {\n      if (result.paymentIntent.status === 'succeeded') {\n        let response = await api.getMyAccount()\n        setCurrentUser(response)\n        setPurchaseModalIsOpen(false)\n      }\n    }\n  }\n\n  const { active, account, library, connector, activate, deactivate } = useWeb3React()\n\n  /* useEffect(() => {\n    const fn = async () => {\n      await connect()\n      await myBodies()\n    }\n    fn()\n  }) */\n\n  async function connect() {\n    try {\n      await activate(injected)\n    } catch (ex) {\n      logg(ex, 'could not connect')\n    }\n  }\n\n  async function disconnect() {\n    try {\n      deactivate()\n    } catch (ex) {\n      console.log(ex)\n    }\n  }\n\n  // request access to the user's MetaMask account\n  const requestAccount = async () => {\n    await window.ethereum.request({ method: 'eth_requestAccounts' })\n  }\n\n  const myBodies = async () => {\n    if (window.ethereum) {\n      await requestAccount()\n      if (account) {\n        const provider = new ethers.providers.Web3Provider(window.ethereum)\n        const signer = provider.getSigner()\n        const contract = new ethers.Contract(bodyAddress, bodyNFT.abi, signer)\n        const tokensOfOwner = await contract.tokensOfOwner(account)\n\n        // @TODO: this is only first, I need to support unlimited number of bodies connected to the account.\n        const i = 0\n        const result = await contract.tokenURI(tokensOfOwner[i])\n        request.get(result).then(r => r.data.image).then(r => {\n          setAvatar(r)\n        })\n      }\n    }\n  }\n\n  logg(currentUser, 'cuUse')\n\n  return <W className=\"MyAccountWidget\" >\n\n    { /* currentUser.profile_photo_url && <Img src={currentUser.profile_photo_url} /> */ }\n    <Img src={avatar || currentUser?.profile_photo_url} />\n\n    <FlexRow>\n      <Cell>\n        { currentUser.email ? <F>\n          [ {currentUser.email} <Logout /> ]\n          [ { typeof currentUser.n_unlocks === 'undefined' ? '?' : currentUser.n_unlocks}  coins\n            <BuyBtn onClick={() => setPurchaseModalIsOpen(true) }>buy</BuyBtn> ]\n        </F> : <Login /> }\n      </Cell>\n      <Cell>\n        { /* ethers */ }\n        <div className=\"flex flex-col items-center justify-center\">\n          { active ? <F> [\n            <span>Connected with <b>{account}</b></span>\n            <button onClick={disconnect} >Disconnect</button>\n            <button onClick={myBodies} >myBodies</button> ]\n          </F> : <F>\n            [ <span>Not Connected</span> <button onClick={connect} >Connect to MetaMask</button>]\n          </F> }\n        </div>\n      </Cell>\n    </FlexRow>\n\n    <Modal isOpen={purchaseModalIsOpen} ariaHideApp={false} >\n      <h1>\n        Buy unlocks\n        <span onClick={() => { setPurchaseModalIsOpen(false) } } >[x]</span>\n      </h1>\n      <form onSubmit={handleSubmit} >\n        <CardElement />\n        <button type=\"submit\" disabled={!stripe} >Pay</button>\n      </form>\n    </Modal>\n\n  </W>\n}\n\n// no props?!\nMyAccountWidget.propTypes = {\n}\n\nconst WrappedMyAccountWidget = (props) => <Elements stripe={stripePromise}><MyAccountWidget {...props} /></Elements>;\n\nexport default WrappedMyAccountWidget\n","/*\n * components / users / index\n */\nimport { Plugins } from '@capacitor/core'\nimport { FacebookLoginResponse } from '@capacitor-community/facebook-login'\nimport React, { Fragment as F, useContext, useState, } from 'react'\nimport { ToastContainer, toast } from 'react-toastify'\nimport styled from 'styled-components'\n\nimport 'react-toastify/dist/ReactToastify.css'\n\nimport config from 'config'\nimport { Btn, C, logg, request, TwofoldContext, useApi, } from \"$shared\"\n\nexport { default as Account } from \"./Account\"\n\nconst { FacebookLogin } = Plugins\n\n\nconst FACEBOOK_PERMISSIONS = ['email']\n\nexport const FbLogin = (props) => {\n  const api = useApi()\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n\n  const doFbLogin = async () => {\n    const result = await FacebookLogin.login({ permissions: FACEBOOK_PERMISSIONS });\n    if (result.accessToken) {\n      request.post(`${config.apiOrigin}${api.longTermTokenPath}`, { accessToken: result.accessToken.token }).then((resp) => {\n        localStorage.setItem(C.jwt_token, resp.data.jwt_token)\n        localStorage.setItem(C.current_user, JSON.stringify(resp.data) )\n        setCurrentUser(resp.data)\n      }).catch((err) => {\n        logg(err, `Could not post request to ${config.apiOrigin}${api.longTermTokenPath}`)\n      })\n    } else {\n      // Canceled by user.\n      logg('canceled')\n    }\n  }\n  return <Btn onClick={doFbLogin}>FB Login</Btn>\n}\n\nexport { default as LoginModal } from \"./LoginModal\"\n\nexport const Logout = () => {\n  const { currentUser, setCurrentUser } = useContext(TwofoldContext)\n  const doLogout = () => {\n    localStorage.removeItem(C.jwt_token)\n    localStorage.removeItem(C.current_user)\n    setCurrentUser({})\n  }\n  return <Btn onClick={doLogout}>Logout</Btn>\n}\n\nconst _W = styled.div`\n  display: flex;\n\n  > * {\n    // margin: auto .4em;\n  }\n`;\n\nexport const PasswordLogin = (props) => {\n  // logg(props, 'PasswordLogin')\n\n  const api = useApi()\n  const {\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n  } = useContext(TwofoldContext)\n  const [ email, setEmail ] = useState('')\n  const [ password, setPassword ] = useState('')\n\n  const doPasswordLogin = async (email, password) => {\n    request.post(`${config.apiOrigin}${api.loginPath}`, { email, password }).then((r) => r.data).then((resp) => {\n      localStorage.setItem(C.jwt_token, resp.jwt_token)\n      localStorage.setItem(C.current_user, JSON.stringify(resp))\n      setCurrentUser(resp) // must be done *after* setting C.jwt_token\n      setLoginModalOpen(false)\n    }).catch((e) => {\n      logg(e, 'e322')\n      toast(\"Login failed\")\n      setCurrentUser(C.anonUser)\n    })\n  }\n\n  return <_W>\n    <input type='email'    value={email}    onChange={(e) => setEmail(e.target.value)    } /><br />\n    <input type='password' value={password} onChange={(e) => setPassword(e.target.value) }\n      onKeyDown={(e) => { if (e.key === 'Enter') { doPasswordLogin(email, password) } }}\n    />\n    <Btn onClick={() => doPasswordLogin(email, password)}>Password Login</Btn>\n  </_W>\n}\n\n\nexport { default as MyAccountWidget } from \"./MyAccountWidget\"\n","\n/*\n *  $shared / AppMock\n */\n\nimport { createMemoryHistory } from 'history'\nimport _Box from '@material-ui/core/Box'\nimport React, { useState } from 'react'\nimport {\n  Link, Switch, Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\nimport styled from 'styled-components'\nimport { ThemeProvider } from 'styled-components'\n\nimport { logg, S, TwofoldContext } from \"$shared\"\nimport { LoginModal } from \"$components/users\"\n\nconst AppMock = (props) => {\n  let {\n    currentUser, setCurrentUser,\n    itemToUnlock, setItemToUnlock,\n    purchaseModalIsOpen, setPurchaseModalIsOpen,\n  } = props\n  const history = createMemoryHistory()\n  history.push(\"/en/cities/travel-to/chicago\") // @TODO: move where appropriate\n\n  const [ localItemToUnlock, setLocalItemToUnlock ] = useState({})\n  const [ localCurrentUser, setLocalCurrentUser ] = useState(false)\n  const [ localPurchaseModalIsOpen, setLocalPurchaseModalIsOpen ] = useState(false)\n  if (!currentUser) {\n    currentUser = localCurrentUser\n    setCurrentUser = setLocalCurrentUser\n  }\n  if (!itemToUnlock) {\n    itemToUnlock = localItemToUnlock\n    setItemToUnlock = setLocalItemToUnlock\n  }\n  if (!purchaseModalIsOpen) {\n    purchaseModalIsOpen = localPurchasesModalIsOpen\n    setPurchaseModalIsOpen = setLocalPurchasesModalIsOpen\n  }\n\n  return <ThemeProvider theme={S.lightTheme}>\n    <Router history={history} >\n      <TwofoldContext.Provider value={{\n        // bottomDrawerOpen, setBottomDrawerOpen,\n        currentUser, setCurrentUser,\n        itemToUnlock, setItemToUnlock,\n\n        // layout, setLayout,\n        purchaseModalIsOpen, setPurchaseModalIsOpen,\n        // showUrl, setShowUrl,\n        // zoom, setZoom,\n      }} >\n        { props.children }\n        <LoginModal />\n      </TwofoldContext.Provider>\n    </Router>\n  </ThemeProvider>\n}\n\nexport default AppMock\n","\nconst AppRouter = {\n\n  cityVenuesPath: (slug) => `/en/cities/travel-to/${slug}/venues`,\n  cityPath: (slug) => `/en/cities/travel-to/${slug}`,\n\n};\n\nexport default AppRouter;\n","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useState } from 'react'\nimport styled from 'styled-components'\n\nimport {\n  C, CollapsibleContext,\n  logg,\n  S,\n  WBordered, WBorderedItem,\n} from '$shared'\n\nconst Gt = () => <span>&nbsp;&gt;&nbsp;&nbsp;</span>\n\nconst Inner = styled.div`\n  // border: 2px solid red;\n  // max-height: 100vh;\n\n  clear: left;\n`;\n\nconst Lt = () => <span>&nbsp;&lt;&nbsp;&nbsp;</span>\n\nconst Label = styled.div`\n  display: flex;\n  margin-bottom: ${p => p.theme.borderWidth};\n`;\n\nconst WTransparent = styled.div`\n  background: ${p => p.theme.colors.background};\n\n  margin: 0 0.5 1em .5em;\n  padding: 0 .5em .5em .5em;\n\n`;\nconst W = ({ children, variant, ...props }) => {\n  switch (variant) {\n    case C.variants.bordered:\n      return <WBordered {...props} >{children}</WBordered>\n    default:\n      return <WTransparent {...props} >{children}</WTransparent>\n  }\n}\n\n\n/**\n * Collapsible\n *\n * @TODO: test-driven _vp_ 2021-10-29\n */\nconst Collapsible = ({ children, ...props }) => {\n  // logg(props, 'Collapsible')\n  const { className='', config, variant, } = props\n\n  const ctx = useContext(CollapsibleContext)\n  if (!ctx) { return null }\n  const { collapsibles, setCollapsibles } = ctx\n\n  const doToggle = () => setCollapsibles({ ...collapsibles, [props.slug]: !collapsibles[props.slug] })\n\n  const collapsible = typeof config === 'undefined' ? true\n    : typeof config.collapsible === 'undefined' ? true\n      : config.collapsible\n  const folded = collapsible ? !!collapsibles[props.slug] : false\n\n  return <W variant={variant} className={`Collapsible ${className}`} >\n    { props.label &&  collapsible && <Label onClick={doToggle} >{folded ? <Lt /> : <Gt />} {props.label}</Label> }\n    { props.label && !collapsible && <Label >{props.label}</Label> }\n    { !folded && <Inner>{ children }</Inner> }\n  </W>\n}\n\nCollapsible.propTypes = {\n  className: PropTypes.string,\n  config: PropTypes.shape({\n    collapsible: PropTypes.bool,\n  }),\n  label: PropTypes.string,\n  slug: PropTypes.string.isRequired,\n  variant: PropTypes.string,\n}\nexport default Collapsible\n","import axios from \"axios\";\nimport config from \"config\";\n\nconst settings = {\n  baseURL: config.apiOrigin\n}\n\nexport default axios.create(settings);","\n/**\n * Style Constants\n */\nconst S = {\n  // Twofold layout\n  borderWidth: '10px',\n  bottomDrawerClosedHeight: '20px',\n  bottomDrawerOpenHeight: '115px',\n  breadcrumbsHeight: '30px',\n\n  thinBorderWidth: '2px',\n  thinBorderRadius: '5px',\n}\n\nconst lightTheme = {\n  ...S,\n  thinBorder: '2px solid black',\n  colors: {\n    text: 'black',\n    background: '#dedede',\n    blue: '#6aa3e9',\n    darkGrey: '#605d5d',\n    lightGrey: '#988b8b',\n    red: 'red',\n    border: 'black',\n    cardBackground: 'white'\n  }\n}\n\nconst darkTheme = {\n  ...S,\n  thinBorder: '2px solid white',\n  colors: {\n    text: 'white',\n    background: '#292929',\n    blue: '#73b0fa',\n    darkGrey: '#b3afaf',\n    lightGrey: '#4a4343',\n    red: '#eb83a8',\n    border: 'white',\n    cardBackground: '#1a1a1a'\n  }\n}\n\nexport default {\n  lightTheme,\n  darkTheme\n}","import { useLayoutEffect, useState, } from 'react'\n\nconst useWindowSize = () => {\n  const [size, setSize] = useState([0, 0]);\n  useLayoutEffect(() => {\n    function updateSize() {\n      setSize([window.innerWidth, window.innerHeight]);\n    }\n    window.addEventListener('resize', updateSize);\n    updateSize();\n    return () => window.removeEventListener('resize', updateSize);\n  }, []);\n  return size;\n}\n\nexport default useWindowSize\n","/*\n *  $shared / index\n */\n// alphabetized\nimport { arrowBack } from 'ionicons/icons'\nimport { IonIcon } from '@ionic/react'\nimport { CircularProgress as _CircularProgress } from '@material-ui/core'\nimport _Box from '@material-ui/core/Box'\nimport { ChevronLeft as _ChevronLeft, ChevronRight as _ChevronRight, Menu as _MenuIcon, } from '@material-ui/icons'\nimport React, { useEffect, useState } from 'react'\nimport {\n  Link, Switch, BrowserRouter as Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport C from \"./C\"\n\n/* A */\nimport useApi from \"./Api\"\nexport { default as useApi } from \"./Api\"\nexport { default as AppMock } from \"./AppMock\"\nexport { default as AppRouter } from \"./AppRouter\"\n\n/* B */\n\n/**\n * Back Button\n */\nconst BackIcon = styled(IonIcon)`\n  margin-right: 5px;\n  cursor: pointer;\n`;\nexport const BackBtn = () => {\n  const history = useHistory()\n  return <BackIcon onClick={history.goBack} icon={arrowBack}></BackIcon>\n}\n\n/**\n * Just your regular shadowed box. Pointer cursor. TDD\n */\nexport const Btn = styled.div`\n  border: 1px solid gray;\n  border-radius: 5px;\n\n  padding: .3em 1em;\n  cursor: pointer;\n`;\n\n\n/* C */\n\nexport { C }\nexport const ChevronLeft = styled(_ChevronLeft)`\n  color: ${(p) => p.theme.colors.text}\n`;\nexport const ChevronRight = styled(_ChevronRight)`\n  color: ${(p) => p.theme.colors.text}\n`;\n\n/**\n * A Card\n */\nexport const Card = styled(_Box)`\n  margin-bottom: 1em;\n  padding: 1em;\n  background: white;\n  cursor: ${p => p.cursor ? p.cursor : 'auto'};\n\n  display: flex;\n  flex-direction: column;\n`;\n\nexport { default as Collapsible } from \"./Collapsible\"\nexport const CollapsibleContext = React.createContext({})\n/**\n * @TODO: test-driven\n */\nexport const CollapsibleContextProvider = ({ children, ...props }) => {\n  // logg(props, 'CollapsibleContextProvider')\n\n  let defaultCollapsibles = {\n    [C.collapsible.descr]: true,\n  }\n  let tmp\n  if (tmp = localStorage.getItem(C.collapsibles)) {\n    try {\n      defaultCollapsibles = JSON.parse(tmp)\n    } catch (err) {\n      logg(err, 'Could not parse collapsibles from localStorage')\n    }\n  }\n  const [ collapsibles, _setCollapsibles ] = useState(defaultCollapsibles)\n  const setCollapsibles = (m) => {\n    localStorage.setItem(C.collapsibles, JSON.stringify(m))\n    _setCollapsibles(m)\n  }\n\n  return <CollapsibleContext.Provider value={{\n    collapsibles, setCollapsibles,\n  }} >{ children }</CollapsibleContext.Provider>\n}\n\n/* D */\n/* I */\n\n/**\n * Like the rails inflector, has methods:\n * tableize()\n */\nexport const inflector = {\n  tableize: (m) => {\n    switch(m) {\n      case 'Gallery':\n        return 'galleries'\n      default:\n      return `${m.toLowerCase()}s`\n    }\n  },\n}\n\n/* L */\n\n\n// From: https://codepen.io/charlyarg/pen/GByKja\nconst _Circle = styled.div`\n  position: fixed;\n  z-index: 999;\n  overflow: show;\n  margin: auto;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  width: 50px;\n  height: 50px;\n`;\nexport const Loading = (p) => <_Circle><_CircularProgress /></_Circle>\n\n/**\n * Usage: logg(someObject, 'label')\n *\n * This development-grade logger can be used instead of console.log() with some advantages:\n * * It encourages consistent labeling of logs. By labeling each log line, you can have dozens of log lines\n * written per action, and still know which log line comes from where.\n * The recommended label is the component name, or function name.\n * * If the label is present, the logged object is placed in the window, allowing you to inspect it in the console. The\n * label becomes the name of the object (stripped to [0-9a-zA-Z\\-_] chars). If you're logging a function, you can execute it.\n * If you log more than one thing, they can interact, allowing you to validate control flow.\n * * the logger can be turned off by making this function simply return.\n */\nconst logg = (a, b=\"\", c=null) => {\n  c = \"string\" === typeof c ? c : b.replace(/\\W/g, \"\");\n  if (c.length > 0) {\n    window[c] = a;\n  }\n\n  console.log(`+++ ${b}:`, a); // eslint-disable-line no-console\n};\n// optimized for Android (e.g. it inspects and doesn't use window)\nconst logg2 = (a, b=\"\", c=null) => {\n  console.log(`+++ ${b}:`, a.inspect); // eslint-disable-line no-console\n};\nexport { logg, logg2 };\n\n/* M */\nexport const MenuIcon = styled(_MenuIcon)`\n  color: ${(p) => p.theme.colors.text}\n`;\n\n/* P */\nexport const PurchasedIcon = () => {\n  return <div className=\"PurchasedIcon\">[purchased]</div>\n}\n\n/**\n * pretty print date\n */\nexport const pp_date = (d) => (d || \"\" ).substring(0, 10)\n\n/* R */\n\nexport { default as request } from \"./request\"\n\n/* S */\nexport { default as S } from \"./S\"\n\n/* T */\n\n/**\n * ishjs has a newer version of this. _vp_ 2022-03-05\n */\nexport const TwofoldContext = React.createContext({})\nexport const TwofoldContextProvider = ({ children, ...props }) => {\n  // logg(props, 'TwofoldContextProvider')\n  const {\n    currentUser, setCurrentUser,\n    layout, setLayout,\n    loginModalOpen, setLoginModalOpen,\n    theme, toggleTheme,\n  } = props\n\n  const api = useApi()\n\n  useEffect(() => {\n    let closure = setTimeout(async () => {\n      const result = await api.getMyAccount()\n      setCurrentUser(result)\n    }, 1 * 1000)\n    return () => clearTimeout(closure)\n  }, [currentUser.is_purchasing])\n\n  /* B */\n  // @TODO: does localStorage work like this on mobile?\n  // @TODO: try and catch\n  const [ bottomDrawerOpen, _setBottomDrawerOpen ] = useState(JSON.parse(localStorage.getItem(C.bottomDrawerOpen)))\n  const setBottomDrawerOpen = (m) => {\n    localStorage.setItem(C.bottomDrawerOpen, JSON.stringify(m))\n    _setBottomDrawerOpen(m)\n  }\n\n  /* F */\n  const [ folded, setFolded ] = useState()\n\n  /* I */\n  const [ itemToUnlock, _setItemToUnlock ] = useState({})\n  const setItemToUnlock = (item) => {\n    if (itemToUnlock.id !== item.id && !loginModalOpen) {\n      _setItemToUnlock(item)\n    }\n  }\n\n  /* M */\n  const [ mapPanelWidth, setMapPanelWidth ] = useState(null)\n  const [ mapPanelHeight, setMapPanelHeight ] = useState(null)\n\n  /* P */\n  const [ purchaseModalIsOpen, setPurchaseModalIsOpen ] = useState(false)\n\n  /* R */\n  const [ ratedConfirmation, _setRatedConfirmation ] = useState(JSON.parse(localStorage.getItem(C.ratedConfirmation)))\n  const setRatedConfirmation = (which) => {\n    localStorage.setItem(C.ratedConfirmation, JSON.stringify(which))\n    _setRatedConfirmation(which)\n  }\n\n  /* S */\n  const [ showItem, setShowItem ] = useState(false)\n  const [ showUrl, setShowUrl ] = useState(false)\n\n  /* T */\n  let tmp, defaultTwofoldPercent = 0.5\n  if (tmp = localStorage.getItem(C.twofoldPercent)) {\n    try {\n      defaultTwofoldPercent = JSON.parse(tmp)\n    } catch (err) {\n      logg(err, 'cannot get twofoldPercent from localStorage')\n    }\n  }\n  const [ twofoldPercent, setTwofoldPercent ] = useState(0.5)\n\n  /* Z */\n  const [ zoom, setZoom ] = useState(1)\n\n  return <TwofoldContext.Provider value={{\n    bottomDrawerOpen, setBottomDrawerOpen,\n\n    currentUser, setCurrentUser, // @TODO: move this to an AppWrapper context\n\n    folded, setFolded,\n\n    itemToUnlock, setItemToUnlock,\n\n    layout, setLayout,\n    loginModalOpen, setLoginModalOpen,\n\n    mapPanelHeight, setMapPanelHeight,\n    mapPanelWidth, setMapPanelWidth,\n\n    purchaseModalIsOpen, setPurchaseModalIsOpen,\n\n    ratedConfirmation, setRatedConfirmation,\n\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n\n    twofoldPercent, setTwofoldPercent,\n\n    zoom, setZoom,\n\n    theme, toggleTheme,\n  }} >{ children }</TwofoldContext.Provider>\n}\n\n/* U */\nexport { default as useWindowSize } from './useWindowSize'\n\n/* W */\n\n/**\n * Wrapper Bordered. This expects a list? _vp_ 2021-11-02\n * Used in collapsibles and MarkersList\n */\nexport const WBordered = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.cardBackground};\n  padding: .5em;\n\n  margin-bottom: 1em;\n`;\n\n/**\n * Wrapper Bordered Item. Is padded, margined.\n */\nexport const WBorderedItem = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.cardBackground};\n  color: ${p => p.theme.colors.text};\n\n  margin: 0 .5em .5em 0;\n  padding: .5em;\n\n  text-align: center;\n\n  width: 18%;\n  max-width: 140px;\n  min-width: 120px;\n`;\n\n\nexport const WidgetContainer = ({ children, ...props }) => {\n  return <WBordered {...props} >{ children }</WBordered>\n}\n\nexport const Wrapper = styled.div`\n  height: 100vh;\n`;\n\n/* Z */\n\nexport const ZoomContext = React.createContext({})\n\n\n\n","import { IonPage, IonLoading, IonContent, IonIcon as _IonIcon } from '@ionic/react';\nimport { funnel, bookmark, newspaperOutline, image, videocam } from 'ionicons/icons';\nimport React, { Fragment as F, useEffect, useState } from \"react\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport styled from 'styled-components'\n\nimport { useApi, AppRouter,\n  logg, // eslint-disable-line no-unused-vars\n  Wrapper } from \"$shared\"\nimport \"./cities.scss\"\n\nconst Counts = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  margin: 1em 0px;\n`;\n\nconst Count = styled.div`\n  // border: 1px solid red;\n\n  display: flex;\n  justify-content: center;\n\n  width: 50%;\n  text-align: center;\n  position: relative;\n  padding: 0.1em;\n`;\n\nconst IonIcon = styled(_IonIcon)`\n  font-size: 2em;\n  color: ${p=>p.theme.darkGrey};\n`;\n\nconst Number = styled.div`\n  // border: 1px solid green;\n\n  padding: 0.5em;\n\n  color: ${p=>p.theme.lightGrey};\n  font-size: 0.9em;\n  font-weight: 600;\n`;\n\nconst Cities = (props) => {\n  const [cities, setCities] = useState([]);\n  const [filteredCities, setFilteredCities] = useState([]);\n  const [showLoading, setShowLoading] = useState(false);\n  const api = useApi()\n  const history = useHistory()\n\n  useEffect(() => {\n    setShowLoading(true);\n    api.getCities().then(res => {\n      setShowLoading(false);\n      setFilteredCities(res);\n      setCities(res);\n    });\n  }, [])\n\n  const filterHandler = (ev) => {\n    let filteredCities = cities.filter(city => {\n      return city.name.toLowerCase().indexOf(ev.target.value.trim().toLowerCase()) > -1;\n    });\n    setFilteredCities(filteredCities);\n  }\n\n  return <F>\n    <Wrapper className='cities' >\n      <h1 className=\"heading\" >Cities</h1>\n\n      <div className=\"filter-section\">\n        <input className=\"filter-input\" onChange={filterHandler} />\n        <IonIcon className=\"filter-icon\" icon={funnel}></IonIcon>\n      </div>\n\n      { /* @TODO: re-add! */ }\n      { /* <div className=\"bookmark-section\">\n        <label className=\"switch\">\n          <input type=\"checkbox\" onChange={() => { }} checked />\n          <span className=\"slider round\"></span>\n        </label>\n        <span className=\"bookmark-text\">Show only bookmarked</span>\n      </div> */ }\n\n      <div className=\"container\">\n        { filteredCities.map((city, i) => <div key={i} className=\"cities\" onClick={() => history.push(AppRouter.cityPath(city.slug)) } >\n            <div className=\"img-section\">\n              <span className=\"bookmark\" >\n                <IonIcon className=\"bookmark-icon\" icon={bookmark}></IonIcon>\n              </span>\n              <img className=\"city-img\" src={city.photo} />\n              <span className=\"city-title\">{city.name}</span>\n            </div>\n            <Counts>\n              <Count>\n                { /* @TODO: wire in theme provider */ }\n                <Number >{city.n_reports}</Number>\n                <IonIcon icon={newspaperOutline}></IonIcon>\n\n              </Count>\n              <Count>\n\n                <Number >{city.n_galleries}</Number>\n                <IonIcon icon={image}></IonIcon>\n              </Count>\n              <Count>\n\n                <Number >{city.n_videos}</Number>\n                <IonIcon icon={videocam}></IonIcon>\n              </Count>\n            </Counts>\n          </div>\n        ) }\n      </div>\n      &nbsp;\n    </Wrapper>\n\n    <IonLoading\n      isOpen={showLoading}\n      onDidDismiss={() => setShowLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n\n  </F>\n}\n\nexport default Cities;\n","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { NewsitemContainer } from './'\nimport { Metaline } from \"$components/application\"\nimport { logg } from \"$shared\"\n\nimport \"./newsitems.scss\"\n\n\nconst Image = styled.div`\n  position: relative;\n  padding-top: 100%;\n  overflow: hidden;\n  z-index: 10;\n  background-position: center;\n  background-size: cover;\n  background-repeat: no-repeat;\n\n  width: 100px;\n  height: 100px;\n`;\n\nconst Image2 = styled.div`\n`;\n\nconst Images = styled.div`\n  position: relative;\n`;\n\nconst ImageLarge = styled.img`\n  width: 200px;\n`;\n\nconst ImageThumb1 = styled.img`\n  position: absolute;\n  left: 200px;\n  top: 0;\n`;\n\nconst ImageThumb2 = styled.img`\n  position: absolute;\n  left: 200px;\n  top: 100px;\n`;\n\n/**\n * TDD\n */\nconst NewsitemGallery = (props) => {\n  // logg(props, 'NewsitemGallery')\n  const { item, variant } = props\n\n  return <NewsitemContainer item={item} variant={variant} >\n    <Images >\n      { item.photos[0] && <ImageLarge src={item.photos[0].thumb_url} /> }\n      { item.photos[1] && <ImageThumb1 src={item.photos[1].thumb_url} /> }\n      { item.photos[2] && <ImageThumb2 src={item.photos[2].thumb_url} /> }\n    </Images>\n  </NewsitemContainer>\n}\n\nNewsitemGallery.propTypes = {\n  item: PropTypes.shape({\n    photos: PropTypes.array.isRequired,\n  }),\n  variant: PropTypes.string,\n}\nexport default NewsitemGallery\n","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { NewsitemContainer } from './'\nimport { Metaline } from \"$components/application\"\nimport { logg } from \"$shared\"\n\nimport \"./newsitems.scss\"\n\n\nconst Image = styled.div`\n  position: relative;\n  padding-top: 100%;\n  overflow: hidden;\n  z-index: 10;\n  background-position: center;\n  background-size: cover;\n  background-repeat: no-repeat;\n\n  width: 100px;\n  height: 100px;\n`;\n\nconst Image2 = styled.div`\n`;\n\nconst Images = styled.div`\n  position: relative;\n`;\n\nconst ImageLarge = styled.img`\n  width: 200px;\n`;\n\nconst ImageThumb1 = styled.img`\n  position: absolute;\n  left: 200px;\n  top: 0;\n`;\n\nconst ImageThumb2 = styled.img`\n  position: absolute;\n  left: 200px;\n  top: 100px;\n`;\n\n/**\n * default\n */\nconst NewsitemPhoto = (props) => {\n  // logg(props, 'NewsitemPhoto')\n  const { item, variant } = props\n\n  return <NewsitemContainer className='NewsitemPhoto' item={item} variant={variant} >\n    <Images >\n      { item.photos[0] && <ImageLarge src={item.photos[0].thumb_url} /> }\n      { item.photos[1] && <ImageThumb1 src={item.photos[1].thumb_url} /> }\n      { item.photos[2] && <ImageThumb2 src={item.photos[2].thumb_url} /> }\n    </Images>\n  </NewsitemContainer>\n}\n\nNewsitemPhoto.propTypes = {\n  item: PropTypes.shape({\n    photos: PropTypes.array.isRequired, // @TODO: this is wrong, just show one photo\n  }),\n  variant: PropTypes.string,\n}\nexport default NewsitemPhoto\n","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useEffect, useContext, useState } from \"react\"\n\nimport { useHistory } from \"react-router-dom\"\nimport styled from 'styled-components'\n\nimport { ItemIcon, NewsitemContainer } from \"./\"\nimport { Metaline, } from \"$components/application\"\nimport { Api, C, logg, request, TwofoldContext } from \"$shared\"\n\nimport \"./newsitems.scss\"\n\n\nconst NewsitemReport = (props) => {\n  // logg(props, \"NewsitemReport\");\n  const { item, variant, } = props\n  return (<NewsitemContainer item={item} variant={variant} />)\n}\n\nNewsitemReport.propTypes = {\n  item: PropTypes.object.isRequired,\n  variant: PropTypes.string,\n}\nexport default NewsitemReport\n\n","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { logg } from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport { NewsitemContainer } from \"./\"\nimport \"./newsitems.scss\"\n\n\nconst NewsitemVideo = (props) => {\n  logg(props, 'NewsitemVideo')\n  const { item, variant } = props\n\n  return <NewsitemContainer item={item} variant={variant} >\n    <div className=\"image-section\">\n      { item.youtube_id ?\n          <iframe className=\"iframe\" width=\"100%\" height=\"315\" src={`https://www.youtube.com/embed/${item.youtube_id}`} frameBorder=\"0\" allow=\"autoplay; encrypted-media\" allowFullScreen></iframe>\n          : <video width=\"100%\" preload=\"metadata\" height=\"auto\" controls>\n            <source src={item.url} type=\"video/mp4\" />\n          </video> }\n    </div>\n  </NewsitemContainer>\n}\n\nNewsitemVideo.propTypes = {\n  item: PropTypes.object.isRequired,\n  variant: PropTypes.string,\n}\nexport default NewsitemVideo","\nimport PropTypes from 'prop-types'\nimport React from \"react\"\nimport styled from 'styled-components'\n\nimport { GenericNewsitem } from \"./\"\nimport NewsitemGallery from \"$components/newsitems/NewsitemGallery\"\nimport NewsitemReport from \"$components/newsitems/NewsitemReport\"\nimport NewsitemPhoto from \"$components/newsitems/NewsitemPhoto\"\nimport NewsitemVideo from \"$components/newsitems/NewsitemVideo\"\nimport { Api, C, logg } from \"$shared\"\n\nimport \"./newsitems.scss\"\n\nconst ICONS = {\n  1: \"/assets/newsfeed/sunglass.png\",\n  2: \"/assets/newsfeed/gem_premium.png\"\n}\n\nconst W = styled.div`\n  // border: 2px solid yellow;\n  margin: ${p => p.variant === C.variants.bordered ? '.5em' : 0};\n  margin-top: 0;\n  margin-bottom: 0;\n`;\n\nconst Newsitems = (props) => {\n  // logg(props, 'Newsitems')\n  const { newsitems, variant } = props\n\n  if (!newsitems || !newsitems.length) { return <div>No Newsitems</div> }\n\n  return (\n    <W {...{ variant }} >\n      { newsitems.map((newsitem, idx) => {\n        const premium_tier = newsitem.premium_tier || 0\n        const icon = ICONS[premium_tier]\n        let item\n\n        switch (newsitem.item_type) {\n          case C.item_types.gallery:\n            item = <NewsitemGallery item={newsitem} variant={variant} />\n            break\n          case C.item_types.report:\n            item = <NewsitemReport  item={newsitem} variant={variant} />\n            break\n          case C.item_types.video:\n            item = <NewsitemVideo   item={newsitem} variant={variant} />\n            break\n            case C.item_types.photo:\n              item = <NewsitemPhoto   item={newsitem} variant={variant} />\n              break\n          default:\n            item = <GenericNewsitem item={newsitem} />\n        }\n\n        return (\n          <div key={idx} className={`items premium-${premium_tier}`}>\n            { item }\n          </div>\n        )\n      }) }\n    </W>\n  )\n}\n\nNewsitems.propTypes = {\n  newsitems: PropTypes.array.isRequired,\n  variant: PropTypes.string,\n}\nexport default Newsitems\n","\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useEffect, useContext, useState } from \"react\"\n\nimport { useHistory } from \"react-router-dom\"\nimport styled from 'styled-components'\n\nimport { ItemIcon } from \"./\"\nimport { Metaline, } from \"$components/application\"\nimport {\n  C, Card,\n  inflector,\n  logg,\n  request,\n  TwofoldContext,\n  WidgetContainer,\n} from \"$shared\"\n\n// alphabetized\n\nconst Col = styled.div`\n  display: flex;\n  flex-direction: column;\n\n  margin-left: 0.5em;\n`;\n\nconst Row = styled.div`\n  display: flex;\n  align-items: flex-start;\n`;\n\nconst Title = styled.h2`\n  margin-top: 0;\n  color: ${p=>p.theme.colors.text};\n`;\n\nconst W = (props) => {\n  const { children, navigateToItem, variant } = props\n  // @TODO: better management of navigateToItem\n\n  switch (variant) {\n    case C.variants.bordered:\n      return <WidgetContainer {...props} onClick={navigateToItem} cursor=\"pointer\" >{ children }</WidgetContainer>\n    default:\n      return <Card boxShadow={2} {...props} onClick={navigateToItem} cursor=\"pointer\" ></Card>\n  }\n}\n\n/**\n * NewsitemContainer\n */\nconst NewsitemContainer = ({ children, ...props }) => {\n  // logg(props, 'NewsitemContainer')\n  const { className, item, variant } = props\n  const { item_type, slug } = item\n\n  const history = useHistory()\n\n  const {\n    itemToUnlock, setItemToUnlock,\n    layout,\n    showItem, setShowItem,\n  } = useContext(TwofoldContext)\n\n  const navigateToItem = () => {\n    logg('navigating')\n\n    if (item.is_premium && !item.is_purchased) {\n      setItemToUnlock(item)\n    } else {\n      if (layout === C.layout_mapui) {\n        setShowItem(item)\n      } else {\n        history.push(`/en/${inflector.tableize(item_type)}/show/${slug}`)\n      }\n    }\n  }\n\n  return <W {...{ className, navigateToItem, variant }} >\n    { children }\n    <Row>\n      <ItemIcon {...item} />\n      <Col>\n        <Title>{item.name}</Title>\n        <Metaline {...item} />\n      </Col>\n    </Row>\n    <p className=\"subhead\" dangerouslySetInnerHTML={{ __html: item.subhead }} />\n  </W>\n}\n\nNewsitemContainer.propTypes = {\n  item: PropTypes.object.isRequired,\n  variant: PropTypes.string,\n}\nexport default NewsitemContainer\n","\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport styled from 'styled-components'\n\nimport { C, logg } from \"$shared\"\n\nconst W = styled.div`\n  padding: 10px;\n  width: 100px;\n  height: 100px;\n\n  box-sizing: border-box;\n`;\n\n/**\n * Displays the appropriate icon.\n *\n * @param [Boolean] props.isPurchased\n * @param [Number] props.premiumTier\n * @param [String] props.kind\n */\n export const ItemIcon = (props) => {\n  // logg(props, \"ItemIcon\")\n  const { is_purchased, item_type, premium_tier } = props\n\n  if (is_purchased) {\n    return <img className=\"icon\" src=\"/assets/icons/glasses.png\" alt='' />\n  }\n  if (premium_tier > 0) {\n    return <img className=\"icon\" src=\"/assets/icons/gem.png\" alt='' />\n  }\n  switch (item_type) {\n    case C.item_types.gallery:\n      return <W><img className=\"icon\" src=\"/assets/icons/gallery.png\" alt='' /></W>\n    case C.item_types.report:\n      return <W><img className=\"icon\" src=\"/assets/icons/report.png\" alt='' /></W>\n    case C.item_types.video:\n      return <W><img className=\"icon\" src=\"/assets/newsfeed/video_icon.svg\" alt='' /></W>\n    default:\n      return <W>[unknown kind]</W>\n  }\n}\n\nItemIcon.propTypes = {\n  is_purchased: PropTypes.bool, // .isRequired,\n  item_type: PropTypes.string.isRequired,\n  premium_tier: PropTypes.number,\n}\nexport default ItemIcon\n","/*\n * $components / newsitems / index.jsx\n */\nimport React, { Fragment as F, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { Box, inflector, logg } from \"$shared\"\n\n/* G */\n\nexport const GenericNewsitem = (props) => {\n  // logg(props, 'GenericNewsitem')\n  const { item } = props\n\n  return <F>\n    generic newsitem\n    <div dangerouslySetInnerHTML={{ __html: item.description }} />\n  </F>\n}\n\n/* N */\nexport { default as NewsitemGallery } from \"./NewsitemGallery\"\nexport { default as NewsitemPhoto } from \"./NewsitemPhoto\"\nexport { default as NewsitemReport } from \"./NewsitemReport\"\nexport { default as Newsitems } from \"./Newsitems\"\nexport { default as NewsitemContainer } from \"./NewsitemContainer\"\n\n\n\n/* I */\nexport const ICONS = {\n  1: \"/assets/newsfeed/sunglass.png\",\n  2: \"/assets/newsfeed/gem_premium.png\"\n}\n\nexport { default as ItemIcon } from \"./ItemIcon\"\n\n","import { funnel, bookmark, newspaperOutline, image, videocam } from 'ionicons/icons'\nimport { IonPage, IonContent, IonButton, IonImg, IonIcon } from \"@ionic/react\"\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { logg } from \"$shared\"\nimport { Rating } from \"$components/application\"\nimport \"./venues.scss\"\n\nconst Address = styled.p`\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  color: ${p => p.theme.darkGrey };\n  font-size: 14px;\n`;\n\nconst Col = styled.div``;\n\n// right arrow container\nconst _Ra = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n`;\nconst RightArrow = () => <_Ra><img className=\"forward-arrow\" src=\"/assets/16x16/arrow-right.png\" /></_Ra>\n\nconst Row = styled.div`\n  display: flex;\n`;\n\nconst Title = styled.div`\n  font-size: 1.5em;\n`;\n\nconst Venue = styled.div`\n  width: 100vw;\n  padding: 1em;\n  margin-bottom: 0.5em;\n  border-bottom: 1px solid #e3d3d3;\n  box-shadow: 0px 1px 5px 1px #b3aeae;\n  background-color: white;\n  position: relative;\n\n  display: flex;\n  justify-content: space-between;\n\n  img.thumb {\n    border-radius: 10px;\n  }\n\n  > div {\n    // border: 1px solid red;\n  }\n`;\n\nconst Venues = (props) => {\n  logg(props, 'Venues')\n\n  const defaultRating = 3.5\n  const [filteredVenues, setFilteredVenues] = useState(props.venues)\n\n  function filterHandler(ev) {\n    let venues = props.venues.filter(venue => {\n      return venue.name.toLowerCase().includes(ev.target.value.toLowerCase())\n    })\n    setFilteredVenues(venues)\n  }\n\n  return (\n    <div className=\"venues-section\">\n      <div>\n        <div className=\"filter-section\">\n          <input className=\"filter-input\" onChange={filterHandler} />\n          <IonIcon className=\"filter-icon\" icon={funnel}></IonIcon>\n        </div>\n      </div>\n      <div className=\"container\">\n\n        { filteredVenues.map((venue, idx) => <Venue key={idx} >\n          <Row>\n            <Col><img style={{ paddingRight: '1em' }} className='thumb' src={venue.photo} /></Col>\n            <Col>\n              <Title>{venue.name}</Title>\n              <div className=\"rating-section\">\n                <Rating rate={defaultRating}></Rating>\n                <span className=\"reviews\">5 reviews</span>\n              </div>\n              <div className=\"tags-section\">\n                { venue.tags.map((tag, idx) => <span key={idx} className=\"tags\">{tag.name}</span> )}\n              </div>\n              <p className=\"description\" dangerouslySetInnerHTML={{ __html: venue.subhead }}></p>\n              { venue.address && <Address>{venue.address}</Address> }\n            </Col>\n\n          </Row>\n          <RightArrow />\n        </Venue> )}\n\n      </div>\n    </div>\n  )\n}\n\nVenues.propTypes = {\n  venues: PropTypes.array.isRequired,\n}\nexport default Venues\n","import React, { useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport { IonPage, IonContent, IonIcon, IonLoading } from '@ionic/react'\nimport { pin, newspaperOutline, image, videocam } from 'ionicons/icons'\n\nimport { AppRouter, useApi, logg, Wrapper } from \"$shared\"\nimport { Newsitems } from \"$components/newsitems\"\nimport { Venues } from \"$components/venues\"\nimport \"./cities.scss\"\n\nconst CitiesShow = (props) => {\n  logg(props, 'CitiesShow')\n  const { match } = props\n\n  const api = useApi()\n  const history = useHistory()\n  const thisPath = AppRouter.cityPath(match.params.name)\n\n  const location = useLocation()\n\n  const [city, setCity] = useState(null)\n  const [showLoading, setShowLoading] = useState(false)\n\n  const mountedRef = useRef('init')\n  useEffect(() => {\n    setShowLoading(true)\n    api.getCity(match.params.name).then(res => {\n      if (mountedRef.current) {\n        setCity(res.data.city)\n        setShowLoading(false)\n      }\n    })\n    return () => mountedRef.current = false\n  }, [match.params.name])\n\n  // @TODO: remove this!\n  function changeMenuHandler(menu) {\n    // history.push(`${match.url}/${menu}`);\n  }\n\n  return <Wrapper>\n\n    { city && <div className='wrapper'>\n      <div className='city-show'>\n\n        <header style={{ backgroundImage: `url(${city.hero_img}}`, backgroundSize: \"contain\" }}></header>\n\n        <section className=\"section-one\">\n          <IonIcon icon={pin} className=\"location\"></IonIcon>\n          <h1 className=\"city-name\">{city.name}</h1>\n          <div className=\"status\">\n            <div className=\"status-grid\">\n              <IonIcon className=\"info-icon\" icon={newspaperOutline}></IonIcon>\n              <span className=\"numbers\">{city.n_reports}</span>\n            </div>\n            <div className=\"status-grid\">\n              <IonIcon className=\"info-icon\" icon={image}></IonIcon>\n              <span className=\"numbers\">{city.n_galleries}</span>\n            </div>\n            <div className=\"status-grid mid\">\n              <IonIcon className=\"info-icon\" icon={videocam}></IonIcon>\n              <span className=\"numbers \">{city.n_videos}</span>\n            </div>\n          </div>\n        </section>\n\n        { /* @TODO: re-add tags here! */ }\n        { /* city.tags && <section className=\"tags-section\">\n          <span className=\"btn delete-btn\" >\n            <IonIcon name=\"close\"> </IonIcon> deselect all\n          </span>\n          { city.tags.map((tag, i) => <span className=\"btn\" key={i} >{tag.name}</span>) }\n        </section> */ }\n\n        <section className=\"section-three\">\n          <div className=\"menu-option\" onClick={() => history.push(AppRouter.cityPath(match.params.name))} >\n            <img src=\"/assets/newsfeed-icon.svg\" alt=\"Newsfeed\" />\n            <p className={`${location.pathname == thisPath ? \"selected\" : \"\"} menu-item`}>Newsfeed</p>\n          </div>\n          <div className=\"menu-option\" onClick={() => history.push(AppRouter.cityVenuesPath(match.params.name))} >\n            <img src=\"/assets/venue-icon.svg\" alt=\"Venues\" />\n            <p className={`${location.pathname.includes(\"venues\") ? \"selected\" : \"\"} menu-item`}>Venues</p>\n          </div>\n        </section>\n\n\n        <Switch>\n          <Route exact path={`${match.url}/venues`} render={() => <Venues    venues={city.venues} />} />\n          <Route exact path={match.url}             render={() => <Newsitems newsitems={city.newsitems} /> } />\n        </Switch>\n\n\n      </div>\n    </div>}\n    <IonLoading\n      isOpen={showLoading}\n      onDidDismiss={() => setShowLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n\n    <br /><br /><br />\n  </Wrapper>\n}\n\nexport default CitiesShow\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\n\nimport { C, logg, request, TwofoldContext, BackBtn } from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport \"./galleries.scss\"\n\nconst GalleriesShow = (props) => {\n  logg(props, 'GalleriesShow')\n  const { match } = props\n\n  const [showLoading, setShowLoading] = useState(false) // @TODO: hmm could it be moved to TwofoldContext ?\n  const [gallery, setGallery] = useState({})\n\n  const mountedRef = useRef('init')\n\n  const {\n    currentUser, setCurrentUser,\n    itemToUnlock, setItemToUnlock,\n    loginModalOpen, setLoginModalOpen,\n  } = useContext(TwofoldContext)\n\n  const getGallery = async () => {\n    const token = localStorage.getItem(C.jwt_token)\n    await request.get(`/api/galleries/view/${match.params.slug}`, { params: { jwt_token: token } }).then(res => {\n      if (!mountedRef.current) { return }\n      const gallery = res.data.gallery\n      if (gallery.is_premium && !gallery.is_purchased) {\n        setItemToUnlock(gallery)\n      } else {\n        setGallery(res.data.gallery)\n      }\n    })\n  }\n\n  useEffect(() => {\n    getGallery()\n    return () => {\n      mountedRef.current = null\n    }\n  }, [gallery.id, itemToUnlock.id] )\n\n  return (<F>\n\n    { <div className=\"gallery-show\">\n      <div className='narrow'>\n        <h1 className=\"heading\">\n          <BackBtn />\n          <img src=\"/assets/newsfeed/photos_icon.png\" />\n          <span className=\"title\">{gallery.name}</span>\n        </h1>\n        <Metaline {...gallery} />\n\n        <div className=\"thumbs\">\n          { gallery.photos && gallery.photos.map((ph, i) =>\n            <div className='card' key={i}>\n              <div className='card-inner'>\n                <IonImg src={ph.thumb_url}></IonImg>\n              </div>\n            </div>\n          ) }\n        </div>\n        <div dangerouslySetInnerHTML={{ __html: gallery.description }}></div>\n      </div>\n      <div className=\"full-img-section\">\n        { gallery.photos && gallery.photos.map((ph, i) =>\n          <div className='item' key={i}>\n            <img src={ph.large_url} />\n          </div>\n        ) }\n      </div>\n    </div>}\n\n  </F>)\n}\n\nexport default GalleriesShow","import React, { useEffect, useState } from \"react\";\nimport { IonLoading } from \"@ionic/react\";\n\nimport request from \"$shared/request\";\nimport { logg } from \"$shared\";\nimport { Galleries } from \"./\";\nimport { NewsitemGallery } from \"$components/newsitems\";\n\nconst MyGalleries = (props) => {\n  const [galleries, setGalleries] = useState(null);\n  const [showLoading, setShowLoading] = useState(false);\n\n  useEffect(() => {\n    setShowLoading(true);\n    const token = localStorage.getItem(\"jwtToken\");\n    request.get(`/api/my/galleries`, { params: { jwt_token: token } }).then(r => {\n      logg(r.data, 'MyGalleries data')\n      setGalleries(r.data);\n      setShowLoading(false);\n    })\n  }, []);\n\n  return (<>\n    <IonLoading\n      isOpen={showLoading}\n      onDidDismiss={() => setShowLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n    { galleries && galleries.length && galleries.map((g) => <NewsitemGallery key={g.id} data={g} /> ) }\n  </>);\n}\n\nexport default MyGalleries;","\nimport {\n  IonContent, IonHeader, IonPage, IonTitle, IonToolbar, IonToggle, IonList, IonItem,\n  IonLabel, IonItemDivider,\n} from '@ionic/react'\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext } from 'react'\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport { C, logg, request, S, TwofoldContext } from \"$shared\"\nimport { MenuLeft } from \"$components/application\"\n\n/* B */\n\n// One breadcrumb\nconst B = styled.div`\n  color: ${p=> p.theme.colors.text};\n  padding: 0.5em;\n`;\n\n// The divider\nconst B1 = styled.div`\n  padding: 0.5em 0;\n`;\n\n/* D */\nconst L = styled.div`\n  color: ${p=> p.theme.colors.text};\n  margin-top: .5em;\n`;\nconst WDayNight = styled.div`\n  // border: 1px solid green;\n\n  display: flex;\n\n  margin: 0 1em;\n`;\nconst DayNightToggle = (props) => {\n  const { theme, toggleTheme } = props\n  return <WDayNight>\n    <L>Day</L>\n    <IonToggle checked={theme === C.themes.dark} onIonChange={toggleTheme} value=\"DayNight\" />\n    <L>Night</L>\n  </WDayNight>\n}\n\n\n\n/* W */\n\nconst W = styled.div`\n  border: ${p=>p.debug?'1':'0'}px solid cyan;\n\n  display: flex;\n  align-items: center;\n  z-index: 1;\n\n  height: ${p => p.theme.breadcrumbsHeight};\n`;\n\nconst WBreadcrumbs = styled.div`\n  display: flex;\n  flex-direction: row;\n  flex-grow: 1;\n`;\n\n\n/**\n * Breadcrumbs\n */\nconst Breadcrumbs = (props) => {\n  // logg(props, 'Breakcrumbs')\n  const { breadcrumbs=[] } = props\n  const { layout, toggleTheme, theme } = useContext(TwofoldContext)\n  const history = useHistory()\n\n  const out = []\n  breadcrumbs.map((b, idx) => {\n    if (idx+1 === props.breadcrumbs.length) {\n      // last one\n      out.push(<B key={idx} >{b.name}</B>)\n    } else {\n      out.push(<B\n        key={idx}\n        style={{ textDecoration: 'underline' }}\n        onClick={() => history.push(`/en/locations/show/${b.slug}`) }\n      >{b.name}</B>)\n      out.push(<B1 key={`${idx}-divider`} >&gt;</B1>)\n    }\n  })\n\n  return <W debug={config.debug} className=\"Breadcrumbs\" >\n    { layout === C.layout_mapui && <MenuLeft variant={C.variants.inline} /> }\n    <WBreadcrumbs>{ out }</WBreadcrumbs>\n    <DayNightToggle toggleTheme={toggleTheme} theme={theme} />\n  </W>\n}\n\nBreadcrumbs.propTypes = {\n  breadcrumbs: PropTypes.arrayOf(\n    PropTypes.shape({\n      name: PropTypes.string.isRequired,\n      slug: PropTypes.string.isRequired,\n    }),\n  ),\n}\nexport default Breadcrumbs\n","\nimport React, { useEffect, useState } from \"react\";\nimport styled from 'styled-components'\n\nimport config from \"config\"\nimport { useApi, Card as Box, logg, request } from \"$shared\"\n\nconst W = styled.div`\n  padding: 2em 0;\n`\n\n/**\n * Default\n */\nconst ReportsShow = (props) => {\n  logg(props, \"ReportsShow\")\n\n  let [ item, setItem ] = useState({})\n  let api = useApi()\n\n  // @TODO: refactor\n  const currentUser = JSON.parse(localStorage.getItem(\"current_user\")) || {};\n\n  // @TODO: not logged in and has access\n  const getReport = async () => {\n    logg(null, 'getting report...')\n\n    request.get(api.reportsGet(props.match.params.slug)).then(r => r.data).then(data => {\n      logg(data, 'got report')\n      setItem(data.report);\n    });\n  };\n\n  useEffect(() => {\n    getReport();\n  }, []);\n\n  // @TODO: logged in and no access\n\n  // @TODO: logged in and access\n\n  return (<W>\n    <Box boxShadow={2}>\n      <h1>Report {item.name}</h1>\n      <div className=\"description\" dangerouslySetInnerHTML={{ __html: item.description }} />\n    </Box>\n  </W>)\n}\n\n// @TODO: wrap in login HOC\nexport default ReportsShow\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { C, logg, request, S, TwofoldContext, ZoomContext } from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport { GalleriesShow } from \"$components/galleries\"\nimport { ReportsShow } from \"$components/reports\"\nimport { Newsitems } from \"$components/newsitems\"\n\n/*\n * @TODO: move to $components/application\n */\nconst ItemModal = (props) => {\n  logg(props, 'ItemModal')\n  const { item } = props\n\n  const { showItem, setShowItem } = useContext(TwofoldContext)\n\n  return <Modal isOpen={!!showItem} >\n    <h1 onClick={() => setShowItem(false)} >[x]</h1>\n    { item.item_type === C.item_types.report && <ReportsShow match={{ params: { slug: item.reportname } }} /> }\n    { item.item_type === C.item_types.gallery && <GalleriesShow match={{ params: { slug: item.slug } }} /> }\n  </Modal>\n}\n\nexport default ItemModal\n","\nimport { Toast } from \"@capacitor/toast\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport styled from 'styled-components'\n\nimport {\n  Breadcrumbs,\n  ItemModal,\n  MapPanel, MapPanelNoZoom, MarkersList,\n  RatedRestrictionModal,\n  WrappedMapPanel,\n} from \"./\"\nimport { CitiesList } from \"$components/cities\"\nimport { Newsitems } from \"$components/newsitems\"\nimport { LongLine } from \"$components/TwofoldLayout\"\nimport {\n  C, ChevronLeft, ChevronRight, Collapsible,\n  Loading, logg,\n  MenuIcon,\n  request,\n  TwofoldContext,\n  useWindowSize,\n} from \"$shared\"\n\n/* C */\n\n/* D */\n\n// @TODO: move into shared\nconst _D = styled.div`\n  // border: 1px solid red;\n\n  padding: 10px;\n`;\nconst Description = ({ item={} }) => {\n  if (!item.description) { return }\n\n  return <_D dangerouslySetInnerHTML={{ __html: item.description }} />\n}\n\n/* H */\nconst WH = styled.div`\n  // border: 1px solid cyan;\n\n  position: fixed;\n  top: 5px;\n  left: ${p => p.foldedLeft\n    ? '10px'\n    : p.foldedRight\n    ? '98%'\n    : `calc(${p.twofoldPercent*100}% - 10px)` };\n\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n\n  width: 30px;\n  height: 95%; /* @TODO: this needs to account for bottom being open */\n`;\nconst Handle = (props) => {\n  const [ w ] = useWindowSize()\n\n  const [ offsetX, setOffsetX ] = useState()\n  const [ dragging, setDragging ] = useState(false)\n\n  const foldLeft = () => {\n    if (folded === C.foldedRight) {\n      setFolded(C.foldedCenter)\n    } else {\n      setFolded(C.foldedLeft)\n    }\n  }\n\n  const foldRight = () => {\n    if (folded === C.foldedLeft) {\n      setFolded(C.foldedCenter)\n    } else {\n      setFolded(C.foldedRight)\n    }\n  }\n\n  const {\n    folded, setFolded,\n    twofoldPercent, setTwofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const onMouseDown = (e) => {\n    setDragging(true)\n    setOffsetX(e.pageX)\n  }\n\n  const onMouseMove = (e) => {\n    if (!dragging) { return }\n    if (e.clientX === 0) { return }\n    const movedBy = e.clientX - offsetX\n    if (movedBy === 0) { return }\n    const movedByPercent = movedBy/w\n    setTwofoldPercent(prev => prev + movedByPercent)\n  }\n\n  const onMouseUp = (e) => {\n    setDragging(false)\n    // document.removeEventListener('mousemove', onMouseMove)\n    // document.removeEventListener('mousedown', onMouseDown)\n  }\n\n  const foldedLeft = folded === C.foldedLeft\n  const foldedRight = folded === C.foldedRight\n\n  // draggable=\"true\"\n  return <WH className=\"Handle\" {...{ foldedLeft, foldedRight, twofoldPercent }}\n    onMouseMove={onMouseMove}\n    onMouseDown={onMouseDown}\n    onMouseLeave={onMouseUp}\n    onMouseUp={onMouseUp}\n    style={{\n      pointer: 'cursor',\n    }}\n  >\n    <MenuIcon />\n    <ChevronLeft onClick={foldLeft} />\n    <ChevronRight onClick={foldRight} />\n    { [C.foldedRight, C.foldedLeft].indexOf(folded) !== -1  && <LongLine orientation={C.vertical} /> }\n  </WH>\n}\n\n/* I */\nconst IframeModal = (props) => {\n  const { showUrl, setShowUrl } = useContext(TwofoldContext)\n\n  return (<Modal ariaHideApp={false} isOpen={!!showUrl} >\n    <span onClick={() => {  setShowUrl(false) }} >[x]</span>\n\n    <iframe height=\"100%\" style={{ width: \"100%\", height: \"100%\" }} scrolling={\"yes\"} src={props.src}\n      frameBorder=\"no\" allowtransparency=\"true\" allowFullScreen={true} >\n    </iframe>\n  </Modal>)\n}\n\n/* L */\nconst Left = styled.div`\n  background: ${p => p.theme.colors.background};\n  flex: ${p => p.foldedRight ? '99%' : `${p.twofoldPercent*100}%` };\n  overflow: hidden;\n\n  display: flex;\n  flex-direction: column;\n\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n`;\n\n\n/* R */\n\nconst Right = styled.div`\n  background: ${p => p.theme.colors.background};\n  position: relative;\n\n  padding: 0 0 0 1em;\n  flex: ${p => p.foldedRight ? '2%' : `${(1-p.twofoldPercent)*100}%` };\n  overflow-x: hidden;\n  overflox-y: auto;\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n`;\n\nconst Row = styled.div`\n  // border: 1px solid magenta;\n\n  display: flex;\n  position: relative;\n`;\n\n\n/**\n * LocationsShowDesktop\n */\nconst LocationsShowDesktop = (props) => {\n  // logg(props, 'LocationsShowDesktop')\n  const { match } = props\n\n  const [ windowWidth, windowHeight ] = useWindowSize()\n\n  const [ loading, setLoading ] = useState(false)\n  const [ location, setLocation ] = useState(null)\n  const [ markers, setMarkers ] = useState([])\n\n  const mountedRef = useRef('init')\n  const mapPanelRef = useRef(null)\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  useEffect(() => {\n    if (location) {\n      setMarkers(location.markers)\n\n      if (location.is_premium && !location.is_purchased) {\n        setItemToUnlock({ closable: false, item_type: 'Location', ...location })\n      }\n    }\n  }, [ location ])\n\n  const showToast = async (msg) => await Toast.show({ text: msg })\n\n  // Load the map\n  useEffect(() => {\n    setLoading(true)\n    const token = localStorage.getItem(\"jwt_token\")\n\n    request.get(`/api/maps/view/${match.params.slug}`, { params: { jwt_token: token } }).then(res => {\n      if (mountedRef.current === match.params.slug) { return null }\n      if (!res.data.map) {\n        setLoading(false)\n        showToast('could not get Location')\n        logg('smth fuxed')\n        return null\n      }\n\n      setLocation(res.data.map)\n      if (res.data.map.rated === C.rated.nc17 && !ratedConfirmation) { // @TODO: not test-driven, bad!\n        setRatedConfirmation(false)\n      }\n      setLoading(false)\n      // @TODO: setFlash here?! If I\"m accessing a gallery I haven't bought access to?\n    })\n\n    return () => {\n      mountedRef.current = match.params.slug\n    }\n  }, [ match.params.slug ])\n\n  // set mapPanel sizes\n  useEffect(() => {\n    if (mapPanelRef.current) {\n      setMapPanelWidth(mapPanelRef.current.offsetWidth)\n      setMapPanelHeight(mapPanelRef.current.offsetHeight)\n    }\n  }, [bottomDrawerOpen, folded, mapPanelRef.current, twofoldPercent, windowWidth, windowHeight])\n\n  const foldedLeft = folded === C.foldedLeft\n  const foldedRight = folded === C.foldedRight\n\n  return <Row>\n    { !foldedLeft && <Left\n        className='Left'\n        {...{ bottomDrawerOpen,\n          folded, foldedLeft, foldedRight,\n          twofoldPercent,\n        } }\n    >\n      { <Breadcrumbs {...location} /> }\n      { location && <WrappedMapPanel\n        map={location.map ? location.map : location}\n        ref={mapPanelRef}\n        slug={match.params.slug}\n      /> }\n    </Left> }\n\n    <Right\n        className='Right'\n        {...{\n          bottomDrawerOpen,\n          folded, foldedLeft, foldedRight,\n          twofoldPercent,\n        } }\n    >\n      <Handle />\n      { location && !foldedRight && <F>\n\n        { markers && markers.length && <Collapsible\n            config={{ collapsible: false }}\n            slug={C.collapsible.markers}\n            variant={C.variants.transparent}\n        >\n          <MarkersList markers={markers}\n            variant={C.variants.bordered}\n          />\n        </Collapsible> || null }\n\n        { location.description && <Collapsible\n            label={location.labels.description}\n            slug={C.collapsible.description}\n            variant={C.variants.bordered}\n        >\n          <Description item={location} />\n        </Collapsible> || null }\n\n        { location.newsitems && location.newsitems.length && <Newsitems\n            variant={C.variants.bordered} newsitems={location.newsitems}\n        /> || null }\n\n      </F> || null }\n    </Right>\n\n    { showUrl && <IframeModal src={showUrl} /> }\n    { showItem && <ItemModal item={showItem} /> }\n    { loading && <Loading /> }\n    { !ratedConfirmation && <RatedRestrictionModal {...{ ratedConfirmation, setRatedConfirmation, }} /> }\n\n  </Row>\n}\n\nexport default LocationsShowDesktop\n","import { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport {\n  Breadcrumbs,\n  ItemModal,\n  MapPanel, MapPanelNoZoom, MarkersList,\n  WrappedMapPanel,\n} from \"./\"\nimport { Metaline } from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\nimport {\n  C, Collapsible, CollapsibleContext,\n  Loading, logg,\n  request,\n  S,\n  TwofoldContext,\n  useWindowSize,\n  ZoomContext,\n} from \"$shared\"\n\nconst Div1 = styled.div`\n  // border: 2px solid brown;\n\n  text-align: center;\n  display: block;\n\n  position: relative; /* required for mobile, so that zoomCtrl, etc are inside the collapsible div */\n\n  overflow: scroll;\n  max-height: 80vh; // @TODO: huh?\n`;\n\nconst CollapsibleNoMargins = styled(Collapsible)`\n  margin: 0;\n  padding: 0;\n`;\n\nconst _Description = styled.div`\n  // border: 1px solid red;\n\n  padding: 10px;\n`;\nconst Description = ({ item }) => {\n  return <_Description dangerouslySetInnerHTML={{ __html: item.description }} />\n}\n\nconst MapWrapper = styled.div`\n  // border: 1px solid red;\n\n  position: relative;\n`;\n\n\n/* W */\n\nconst W = styled.div`\n  // border: 1px solid yellow;\n`;\n\n/* Z */\n\nconst ZoomCtrlRoot = styled.div`\n  // border: 1px solid orange;\n\n  position: absolute;\n  top: 0;\n  left: calc(100vw - 80px);\n  background: white;\n  padding: 5px;\n\n  display: flex;\n  flex-direction: column;\n  z-index: 10;\n`;\n\nconst ZoomCtrl = (props) => {\n  const { zoom, setZoom } = useContext(TwofoldContext)\n\n  const zoomIn = () => {\n    setZoom(zoom/2)\n  }\n  const zoomOut = () => {\n    setZoom(zoom*2)\n  }\n  const zoomReset = () => {\n    setZoom(1)\n  }\n\n  return <ZoomCtrlRoot >\n    <span onClick={zoomIn} >[+]</span>\n    <span onClick={zoomOut} >[-]</span>\n    <span onClick={zoomReset} >[1]</span>\n  </ZoomCtrlRoot>\n}\n\n/**\n * LocationsShowMobile\n *\n */\nconst LocationsShowMobile = (props) => {\n  // logg(props, 'LocationsShowMobile')\n  const { match } = props\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const [ windowWidth, windowHeight ] = useWindowSize()\n\n  const [loading, setLoading] = useState(false)\n  const [location, setLocation ] = useState(null)\n\n  const mountedRef = useRef('init')\n  const mapPanelRef = useRef(null)\n\n  useEffect(() => {\n    setLoading(true)\n    const token = localStorage.getItem(\"jwt_token\")\n    request.get(`/api/maps/view/${match.params.slug}`, { params: { jwt_token: token } }).then(res => {\n      if (mountedRef.current === match.params.slug) return null\n      setLocation(res.data.map)\n      setLoading(false)\n      // @TODO: setFlash here?! If I\"m accessing a gallery I haven't bought access to?\n    }).finally(() => {\n    })\n\n    return () => {\n      mountedRef.current = match.params.slug\n    }\n  }, [ match.params.slug ])\n\n\n  // @TODO: this can probably be much improved. Take either markers of location.map, or location itself.\n  // @TODO: why is this a redirect to /null ?!\n  let markers = []\n  if (location) {\n    markers = location.markers // location ? location.markers.length ? location.markers : location.map.markers : null\n  }\n\n  // set mapPanel sizes\n  useEffect(() => {\n    if (mapPanelRef.current) {\n      setMapPanelWidth(mapPanelRef.current.offsetWidth)\n      setMapPanelHeight(mapPanelRef.current.offsetHeight)\n    }\n  }, [bottomDrawerOpen, folded, mapPanelRef.current, twofoldPercent, windowWidth, windowHeight])\n\n  return (<W className='LocationsShowMobile' >\n\n    { loading && <i>Loading...</i> }\n\n    { location && <Breadcrumbs {...location} /> }\n    { location && <Collapsible\n        label={location.labels.map}\n        slug={C.collapsible.map}\n    >\n      <WrappedMapPanel\n        map={location.map || location}\n        ref={mapPanelRef}\n        slug={match.params.slug}\n        withZoom={false}\n      />\n    </Collapsible> }\n\n    { /* @TODO: recursively render map (not location) as appropriate all around in these collapsibles. */ }\n    { markers && markers.length && <Collapsible\n        label={location.labels.markers}\n        slug={C.collapsible.markers}\n    >\n      <MarkersList markers={markers} />\n    </Collapsible> || null }\n    { location && location.description && <Collapsible\n        config={location.config.description}\n        label={location.labels.description}\n        slug={C.collapsible.description}\n    >\n      <Description item={location} />\n    </Collapsible> || null }\n    { location && location.newsitems.length && <Collapsible\n        label={location.labels.newsitems}\n        slug=\"news-sec\"\n    >\n      <Newsitems newsitems={location.newsitems} />\n    </Collapsible> || null }\n\n    { showUrl  && <IframeModal src={showUrl} /> }\n    { showItem && <ItemModal item={showItem} /> }\n    { loading  && <Loading /> }\n\n  </W>)\n}\n\nexport default LocationsShowMobile\n","import PropTypes from 'prop-types'\nimport React, { useContext, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport { logg, TwofoldContext } from \"$shared\"\n\nconst Div1 = styled.div`\n  // border: 3px solid green;\n\n  text-align: center;\n  display: block;\n\n  position: relative;\n  overflow: auto;\n\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.theme.breadcrumbsHeight}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n\n`;\n\n/* Same size as the map image.\n * What scrolls is this div, not the image inside it.\n */\nconst Img = styled.div`\n  // border: 2px solid cyan;\n  display: inline-block;\n  position: relative;\n`;\n\nconst Root = styled.div`\n  border: ${p=>p.debug?'1':'0'}px solid red;\n\n  position: relative;\n  overflow: auto;\n\n  height: calc(100vh - ${p => `calc(2*${p.theme.borderWidth})`}\n    - ${p => p.theme.breadcrumbsHeight}\n    - ${p => p.bottomDrawerOpen ? p.theme.bottomDrawerOpenHeight : p.theme.bottomDrawerClosedHeight });\n\n`;\n\nconst ZoomCtrl = (props) => {\n  const { zoom, setZoom } = useContext(TwofoldContext)\n\n  const zoomIn = () => {\n    setZoom(zoom/2)\n  }\n  const zoomOut = () => {\n    setZoom(zoom*2)\n  }\n  const zoomReset = () => {\n    setZoom(1)\n  }\n\n  return <div style={{\n    position: 'absolute',\n    top: 0,\n    right: 0,\n    zIndex: 1,\n    background: 'white',\n    padding: '5px',\n\n    display: 'flex',\n    flexDirection: 'column',\n  }} >\n    <span onClick={zoomIn} >[+]</span>\n    <span onClick={zoomOut} >[-]</span>\n    <span onClick={zoomReset} >[1]</span>\n  </div>\n}\n\nconst MapPanel = (props) => {\n  // logg(props, 'MapPanel')\n  const { map, withZoom=true } = props\n\n  const {\n    bottomDrawerOpen, setBottomDrawerOpen,\n    showUrl, setShowUrl,\n    zoom, setZoom,\n  } = useContext(TwofoldContext)\n\n  const div1Ref = useRef(null)\n\n  const history = useHistory()\n\n  useEffect(() => {\n    // div1Ref.current.scrollIntoView({ block: 'end', inline: 'center' })\n    div1Ref.current.scroll({\n      top: 200,\n      left: 200,\n      behavior: 'smooth',\n     })\n  }, [])\n\n  const markers = []\n  map.markers.map((m, idx) => {\n    const out = <div\n      key={idx}\n      onClick={() => m.url ? setShowUrl(m.url) : history.push(`/en/locations/show/${m.slug}`) }\n      style={{\n        position: 'absolute',\n        top: zoom > 1 ? ((m.y- m.centerOffsetY )/zoom) : ((m.y )/zoom- m.centerOffsetY),\n        left: zoom > 1 ? ((m.x- m.centerOffsetX )/zoom) : ((m.x )/zoom- m.centerOffsetX),\n      }} ><img src={m.img_path} style={{\n        display: 'block',\n        maxWidth: `${m.w/zoom}px`,\n        maxHeight: `${m.h/zoom}px`,\n        width: 'auto', height: 'auto',\n      }} /></div>\n    markers.push(out)\n  })\n\n  return <Root {...{ bottomDrawerOpen }} debug={config.debug} className='MapPanel' >\n    { withZoom && <ZoomCtrl /> }\n\n    <Div1 {...{ bottomDrawerOpen }} >\n      <Img ref={div1Ref} style={{\n        width: `${map.w/zoom}px`,\n        height: `${map.h/zoom}px`,\n      }} >\n        <img\n          src={map.img_path}\n          style={{\n            width: `${map.w/zoom}px`,\n            height: `${map.h/zoom}px`,\n          }}\n        />\n        { markers }\n      </Img>\n    </Div1>\n\n  </Root>\n}\n\nMapPanel.propTypes = {\n  map: PropTypes.object.isRequired,\n  withZoom: PropTypes.bool, // @TODO: I don't like it, I'd like it to be inside a config obj.\n}\nexport default MapPanel\n\n\n","import { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport {\n  C,\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\n\n// W\nconst W0 = styled.div`\n  border: ${p => p.theme.thinBorder};\n  border-radius: ${p => p.theme.thinBorderRadius};\n  background: ${p => p.theme.colors.background};\n\n  height: 100%;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nconst W1 = styled.div`\n  display: inline-block;\n  position: relative;\n`;\n\n\n/*\n * _vp_ 2021-09 @TODO: merge this into MapPanel, have zoom={false} as a prop\n * But I couldn't do it in 10 mins... It's a bit complicated?\n *\n * _vp_ 2021-10-29 But actually this component is getting more work than the zoom one right now...\n */\nconst MapPanelNoZoom = (props) => {\n  // logg(props, 'MapPanelNoZoom')\n  const { map } = props\n\n  const history = useHistory()\n\n  const ctx = useContext(TwofoldContext)\n  const {\n    bottomDrawerOpen,\n    mapPanelWidth, mapPanelHeight,\n    zoom, setZoom,\n  } = ctx\n\n\n  // Sets the zoom (in panelNoZoom) to full-panel _vp_ 20211029\n  useEffect(() => {\n    let nextZoomByWidth = mapPanelWidth/map.w\n    let nextZoomByHeight = mapPanelHeight/map.h\n    let nextZoom = Math.min(nextZoomByWidth, nextZoomByHeight)\n    nextZoom = nextZoom + 0.0 // image should not overlap with the border... 1% slack added.\n    setZoom(nextZoom)\n  }, [ mapPanelWidth, mapPanelHeight, map.id ])\n\n\n  const markers = []\n  props.map.markers.map((m, idx) => {\n    const out = <div\n      key={idx}\n      onClick={() => history.push(`/en/locations/show/${m.slug}`) }\n      style={{\n        position: 'absolute',\n        top: m.y*zoom,\n        left: m.x*zoom,\n        zIndex: 2,\n      }} ><img src={m.img_path} style={{\n        display: 'block',\n        maxWidth: `${m.w*zoom}px`,\n        maxHeight: `${m.h*zoom}px`,\n        width: 'auto', height: 'auto',\n      }} /></div>\n    markers.push(out)\n  })\n\n  return <W0 className=\"MapPanelNoZoom\" >\n    <W1 >\n      <img\n        src={map.img_path}\n        style={{\n          width: `${map.w*zoom}px`,\n          height: `${map.h*zoom}px`,\n\n          position: 'relative',\n          zIndex: 1,\n        }}\n      />\n      { markers }\n    </W1>\n  </W0>\n}\n\nexport default MapPanelNoZoom\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport PropTypes from 'prop-types'\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport {\n  C,\n  logg, S, TwofoldContext,\n  PurchasedIcon,\n  WBordered, WBorderedItem,\n} from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\n\n/* M */\nconst _Marker = styled.div`\n  margin: 10px;\n  max-width: 20vw;\n  min-width: 120px;\n`;\nconst Marker = ({ children, variant, ...props }) => {\n  if (variant===C.variants.bordered) {\n    return <WBorderedItem {...props} >{children}</WBorderedItem>\n  } else {\n    return <_Marker {...props} >{children}</_Marker>\n  }\n}\n\n/* W */\nconst _W = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n`;\nconst W = ({ children, variant, ...props }) => {\n  if (variant===C.variants.bordered) {\n    return <WBordered {...props}>{children}</WBordered>\n  } else {\n    return <_W {...props}>{children}</_W>\n  }\n}\n\n/**\n * Default\n */\nconst MarkersList = (props) => {\n  // logg(props, 'MarkersList')\n  const { variant } = props\n\n  const history = useHistory()\n  const {\n    itemToUnlock, setItemToUnlock,\n    showUrl, setShowUrl,\n  } = useContext(TwofoldContext)\n\n  const goto = (m) => {\n    if (m.premium_tier && !m.is_purchased) {\n      setItemToUnlock({ ...m })\n    } else {\n      if (m.url) {\n        setShowUrl(m.url)\n      }\n      else {\n        history.push(`/en/locations/show/${m.slug}`)\n      }\n    }\n  }\n\n  const out = []\n  props.markers.map((m, idx) => {\n    out.push(<Marker className=\"Marker\" key={idx} variant={variant}\n      onClick={() => goto(m) }\n    >\n      <img src={m.title_img_path} /><br />\n      { m.is_purchased && <PurchasedIcon /> }\n      {m.name}\n    </Marker>)\n  })\n\n  return <W className=\"MarkersList\" >\n    {out}\n  </W>\n}\n\nMarkersList.propTypes = {\n  variant: PropTypes.string,\n}\nexport default MarkersList\n","\nimport { IonPage, IonContent, IonButton, IonImg, IonLoading } from \"@ionic/react\"\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport { Route, useLocation, useHistory, Switch } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport { C, logg, request, S, TwofoldContext, ZoomContext } from \"$shared\"\nimport { Metaline } from \"$components/application\"\nimport { GalleriesShow } from \"$components/galleries\"\nimport { ReportsShow } from \"$components/reports\"\nimport { Newsitems } from \"$components/newsitems\"\n\n/*\n * RatedRestrictionModal\n */\nconst RatedRestrictionModal = (props) => {\n  // logg(props, 'RatedRestrictionModal')\n  const { ratedConfirmation, setRatedConfirmation } = props\n\n  return <Modal isOpen={!ratedConfirmation} >\n    <p>You must be 18 years of age or older to view this content.</p>\n    <button onClick={() => setRatedConfirmation(true) } >I am over 18</button>\n    &nbsp; &nbsp;\n    <button onClick={() => window.location = 'https://disney.com' } >I am NOT over 18</button>\n  </Modal>\n}\n\nexport default RatedRestrictionModal\n","\nimport React from 'react'\nimport styled from 'styled-components'\n\nconst Crosshair = styled.div`\n// border: 2px solid yellow;\n\nwidth: 50px;\nheight: 50px;\n\nposition: absolute;\nleft: 50%;\ntop: 50%;\n\n::before {\n  content: '';\n  position: absolute;\n  border-color: white;\n  border-style: solid;\n  border-width: 0 2px 0 0;\n  height: 20px;\n  top: -10px;\n  left: -1px;\n  transform: rotate(90deg);\n\n  // margin-top: -1em;\n\n}\n::after {\n  content: '';\n  position: absolute;\n  border-color: white;\n  border-style: solid;\n  border-width: 0 2px 0 0;\n  height: 20px;\n  top: -10px;\n  left: -1px;\n\n  // margin-top: -1em;\n  // width: 0.5em;\n}\n`;\n\nexport default Crosshair\n","import {\n\tEuler, EventDispatcher, Vector3,\n} from \"three\"\n\nconst _euler = new Euler( 0, 0, 0, 'YXZ' );\nconst _vector = new Vector3();\n\nconst _changeEvent = { type: 'change' };\nconst _lockEvent = { type: 'lock' };\nconst _unlockEvent = { type: 'unlock' };\n\nconst _PI_2 = Math.PI / 2;\n\nclass PointerLockControls extends EventDispatcher {\n\n\tconstructor( camera, domElement ) {\n\n\t\tsuper();\n\n\t\tif ( domElement === undefined ) {\n\n\t\t\tconsole.warn( 'THREE.PointerLockControls: The second parameter \"domElement\" is now mandatory.' );\n\t\t\tdomElement = document.body;\n\n\t\t}\n\n\t\tthis.domElement = domElement;\n\t\tthis.isLocked = false;\n\n\t\t// Set to constrain the pitch of the camera\n\t\t// Range is 0 to Math.PI radians\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\tconst scope = this;\n\n\t\tfunction onMouseMove( event ) {\n\n\t\t\tif ( scope.isLocked === false ) return;\n\n\t\t\tconst movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\n\t\t\tconst movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\n\n\t\t\t_euler.setFromQuaternion( camera.quaternion );\n\n\t\t\t_euler.y -= movementX * 0.002;\n\t\t\t_euler.x -= movementY * 0.002;\n\n\t\t\t_euler.x = Math.max( _PI_2 - scope.maxPolarAngle, Math.min( _PI_2 - scope.minPolarAngle, _euler.x ) );\n\n\t\t\tcamera.quaternion.setFromEuler( _euler );\n\n\t\t\tscope.dispatchEvent( _changeEvent );\n\n\t\t}\n\n\t\tfunction onPointerlockChange() {\n\n\t\t\tif ( scope.domElement.ownerDocument.pointerLockElement === scope.domElement ) {\n\n\t\t\t\tscope.dispatchEvent( _lockEvent );\n\n\t\t\t\tscope.isLocked = true;\n\n\t\t\t} else {\n\n\t\t\t\tscope.dispatchEvent( _unlockEvent );\n\n\t\t\t\tscope.isLocked = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction onPointerlockError() {\n\n\t\t\tconsole.error( 'THREE.PointerLockControls: Unable to use Pointer Lock API' );\n\n\t\t}\n\n\t\tthis.connect = function () {\n\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'mousemove', onMouseMove );\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointerlockchange', onPointerlockChange );\n\t\t\tscope.domElement.ownerDocument.addEventListener( 'pointerlockerror', onPointerlockError );\n\n\t\t};\n\n\t\tthis.disconnect = function () {\n\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'mousemove', onMouseMove );\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerlockchange', onPointerlockChange );\n\t\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerlockerror', onPointerlockError );\n\n\t\t};\n\n\t\tthis.dispose = function () {\n\n\t\t\tthis.disconnect();\n\n\t\t};\n\n\t\tthis.getObject = function () { // retaining this method for backward compatibility\n\n\t\t\treturn camera;\n\n\t\t};\n\n\t\tthis.getDirection = function () {\n\n\t\t\tconst direction = new Vector3( 0, 0, - 1 );\n\n\t\t\treturn function ( v ) {\n\n\t\t\t\treturn v.copy( direction ).applyQuaternion( camera.quaternion );\n\n\t\t\t};\n\n\t\t}();\n\n\t\tthis.moveForward = function ( distance ) {\n\n\t\t\t// move forward parallel to the xz-plane\n\t\t\t// assumes camera.up is y-up\n\n\t\t\t_vector.setFromMatrixColumn( camera.matrix, 0 );\n\n\t\t\t_vector.crossVectors( camera.up, _vector );\n\n\t\t\tcamera.position.addScaledVector( _vector, distance );\n\n\t\t};\n\n\t\tthis.moveRight = function ( distance ) {\n\n\t\t\t_vector.setFromMatrixColumn( camera.matrix, 0 );\n\n\t\t\tcamera.position.addScaledVector( _vector, distance );\n\n\t\t};\n\n\t\tthis.lock = function () {\n\n\t\t\tthis.domElement.requestPointerLock();\n\n\t\t};\n\n\t\tthis.unlock = function () {\n\n\t\t\tscope.domElement.ownerDocument.exitPointerLock();\n\n\t\t};\n\n\t\tthis.connect();\n\n\t}\n\n}\n\nexport {\n\tPointerLockControls,\n}\n\nconst unlockEvent = _unlockEvent\nexport { unlockEvent }\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  border: 2px solid red;\n\n  position: relative;\n  // height: calc(100% - ${p => p.breadcrumbsHeight});\n  width: 700px;\n  height: 350px;\n\n  #Crosshair {\n    // border: 1px solid yellow;\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\n/**\n * Equirectangular\n * _vp_ 2021-11-13\n * It works, it shows the panoramic.\n *\n */\nconst Equirectangular = (props) => {\n  logg(props, 'Equirectangular')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n\n    /*\n     * Crosshair\n     * From: https://codepen.io/driezis/pen/jOPzjLG?editors=1000\n     */\n    var pMat = new THREE.ShaderMaterial({\n        uniforms: { main_color: {value: {r: 1, g: 1, b: 1}},\n                    border_color: {value: {r: 0, g: 0, b: 0.1}},\n\n                    thickness: {value:0.006},\n                    height: {value:0.13},\n                    offset: {value:0.05},\n                    border: {value:0.003},\n\n                    opacity: {value: 1},\n                    center: {value: {x: 0.5, y: 0.5}},\n                    rotation: {value: 0}\n                },\n        vertexShader: `\n                uniform float rotation;\n                uniform vec2 center;\n                #include <common>\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec2 scale;\n                    scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n                    scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n                    #ifndef USE_SIZEATTENUATION\n                        bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n                        if ( isPerspective ) scale *= - mvPosition.z;\n                    #endif\n                    vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n                    vec2 rotatedPosition;\n                    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n                    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n                    mvPosition.xy += rotatedPosition;\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n        fragmentShader: `\n            uniform vec3 main_color;\n            uniform vec3 border_color;\n            uniform float opacity;\n\n            uniform float thickness;\n            uniform float height;\n            uniform float offset;\n            uniform float border;\n\n            varying vec2 vUv;\n            void main() {\n\n                float a = (step(abs(vUv.x - 0.5), thickness)) * step(abs(vUv.y - 0.5), height + offset) * step(offset, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness)) * step(abs(vUv.x - 0.5), height + offset) * step(offset, abs(vUv.x - 0.5));\n                float b = (step(abs(vUv.x - 0.5), thickness - border)) * step(abs(vUv.y - 0.5), height + offset - border) * step(offset + border, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness - border)) * step(abs(vUv.x - 0.5), height + offset - border) * step(offset + border, abs(vUv.x - 0.5));\n                gl_FragColor = vec4( mix(border_color, main_color, b), a * opacity);\n            }\n        `,\n        transparent: true,\n    });\n    var sprite = new THREE.Sprite(pMat);\n    // scene.add(sprite);\n    // sprite.position.set(0,0,-5);\n\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    // document.addEventListener( 'keydown', onKeyDown )\n    // document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Floor\n     */\n\n    // // random\n    // // @TODO: it's not aligned to parcels the way I want\n    // let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    // floorGeometry.rotateX( - Math.PI / 2 )\n\n    // // vertex displacement\n    // let position = floorGeometry.attributes.position\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   vertex.fromBufferAttribute( position, i )\n    //   vertex.x += Math.random() * 20 - 10\n    //   vertex.y += Math.random() * 2\n    //   vertex.z += Math.random() * 20 - 10\n    //   position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    // }\n    // floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    // floorGeometry.x = -200\n    // floorGeometry.y = -200\n    // floorGeometry.z = -200\n    // position = floorGeometry.attributes.position\n    // const colorsFloor = []\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n    //   colorsFloor.push( color.r, color.g, color.b )\n    // }\n    // floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    // const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n\n\n\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    // let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    // floorGeometry.rotateX( - Math.PI / 2 )\n    // texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`) // moon floor\n    // const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    // const scenesPath = '/assets/scenes/'\n    // const objectsPath = '/assets/objects/'\n    // let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    // const texturePath = `${modelName}/${modelName}.mtl`\n    // const modelPath = `${modelName}/${modelName}.obj`\n    // const manager = new THREE.LoadingManager()\n    // const onProgress = (xhr) => {\n    //   if (xhr.lengthComputable) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }\n    // const onError = () => {}\n    // const onLoad = (materials) => {\n    //   materials.preload()\n    //   const objLoader = new OBJLoader( manager )\n    //   objLoader.setMaterials( materials )\n    //   objLoader.setPath( scenesPath)\n    //   objLoader.load( modelPath, ( object ) => {\n    //     object.traverse((child) => {\n    //       if (child.isMesh) {\n    //         child.geometry.scale(0.10, 0.10, 0.10) // @TODO: change?\n    //       }\n    //     })\n    //     object.position.x = Math.random() * 500\n    //     object.position.y = 10\n    //     object.position.z = Math.random() * 500\n\n    //     logg(object, '1st object')\n    //     scene.add( object )\n    //     markerObjects.push( object )\n    //     markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' }) // @TODO: change!\n\n    //   }, onProgress, onError )\n    // }\n    // const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setPath(scenesPath)\n    // mtlLoader.load(texturePath, onLoad)\n\n\n    /*\n     * Skybox\n     */\n    const textureLoader = new THREE.TextureLoader()\n    const assetPath = map.img_path\n    texture = textureLoader.load(assetPath, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( 700, 350 ) // aspect ratio 0.5\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} >\n      <div id=\"Crosshair\" />\n    </Blocker>\n  </F>\n}\n\nexport default Equirectangular\n","\"use strict\";\n\nfunction TouchControls({ container, camera, options, THREE, RotationPad }) {\n\n\tvar self = this;\n\tself.config = $.extend({\n\t\tspeedFactor: 0.5,\n\t\tdelta: 1,\n\t\trotationFactor: 0.002,\n\t\tmaxPitch: 55,\n\t\thitTest: true,\n\t\thitTestDistance: 40\n\t}, options);\n\n\tvar container = container;\n\tvar isRightMouseDown = false;\n\tvar rotationMatrices = [];\n\tvar hitObjects = [];\n\n\tvar moveForward = false;\n\tvar moveBackward = false;\n\tvar moveLeft = false;\n\tvar moveRight = false;\n\tvar lockMoveForward = false;\n\tvar lockMoveBackward = false;\n\tvar lockMoveLeft = false;\n\tvar lockMoveRight = false;\n\n\tvar ztouch = 1, xtouch = 1;\n\tvar PI_2 = Math.PI / 2;\n\tvar maxPitch = self.config.maxPitch * Math.PI / 180;\n\tvar velocity = new THREE.Vector3(0, 0, 0);\n\n\tvar cameraHolder = new THREE.Object3D();\n\tcameraHolder.name = \"cameraHolder\";\n\tcameraHolder.add(camera);\n\n\tself.scene = null;\n\tself.fpsBody = new THREE.Object3D();\n\tself.fpsBody.add(cameraHolder);\n\tself.enabled = true;\n\n\tself.mouse = new THREE.Vector2();\n\n\t// Creating rotation pad:\n\tself.rotationPad = new RotationPad(container);\n\t$(self.rotationPad).on(\"YawPitch\", function(event) {\n\t\tvar rotation = calculateCameraRotation(event.detail.deltaX, event.detail.deltaY);\n\t\tself.setRotation(rotation.rx, rotation.ry);\n\t});\n\n\t// Creating movement pad:\n\tself.movementPad = new MovementPad(container);\n\t$(self.movementPad).on(\"move\", function(event) {\n\t\tztouch = Math.abs(event.detail.deltaY);\n\t\txtouch = Math.abs(event.detail.deltaX);\n\n\t\tif (event.detail.deltaY == event.detail.middle) {\n\t\t\tztouch = 1;\n\t\t\tmoveForward = moveBackward = false;\n\t\t} else {\n\t\t\tif (event.detail.deltaY > event.detail.middle) {\n\t\t\t\tmoveForward = true;\n\t\t\t\tmoveBackward = false;\n\t\t\t}\n\t\t\telse if (event.detail.deltaY < event.detail.middle) {\n\t\t\t\tmoveForward = false;\n\t\t\t\tmoveBackward = true;\n\t\t\t}\n\t\t}\n\n\t\tif (event.detail.deltaX == event.detail.middle) {\n\t\t\txtouch = 1;\n\t\t\tmoveRight = moveLeft = false;\n\t\t} else {\n\t\t\tif (event.detail.deltaX < event.detail.middle) {\n\t\t\t\tmoveRight = true;\n\t\t\t\tmoveLeft = false;\n\t\t\t}\n\t\t\telse if (event.detail.deltaX > event.detail.middle) {\n\t\t\t\tmoveRight = false;\n\t\t\t\tmoveLeft = true;\n\t\t\t}\n\t\t}\n\t});\n\t$(self.movementPad).on(\"stopMove\", function(event) {\n\t\tztouch = xtouch = 1;\n\t\tmoveForward = moveBackward = moveLeft = moveRight = false;\n\t});\n\n\tcontainer.on(\"contextmenu\", onContextMenu);\n\tcontainer.on(\"mousedown\", onMouseDown);\n\tcontainer.on(\"mouseup\", onMouseUp);\n\n\t$(document).on(\"keydown\", onKeyDown);\n\t$(document).on(\"keyup\", onKeyUp);\n\t$(document).on(\"mousemove\", onMouseMove);\n\t$(document).on(\"mouseout\", onMouseOut);\n\n\tprepareRotationMatrices();\n\n\t//\n\t// Events:\n\t//\n\tfunction onContextMenu(event) {\n\t\tevent.preventDefault();\n\t};\n\n\tfunction onMouseDown(event) {\n\n\t\tif (self.enabled && event.button === 2) {\n\t\t\tisRightMouseDown = true;\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t}\n\t};\n\n\tfunction onMouseUp(event) {\n\n\t\tif (self.enabled && event.button === 2) {\n\t\t\tisRightMouseDown = false;\n\t\t}\n\t};\n\n\tfunction onMouseMove(event) {\n\n\t\tself.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\n\t\tself.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n\n\t\tif (!self.enabled || !isRightMouseDown) return;\n\n\t\tvar movementX = event.originalEvent.movementX || event.originalEvent.mozMovementX || event.originalEvent.webkitMovementX || 0;\n\t\tvar movementY = event.originalEvent.movementY || event.originalEvent.mozMovementY || event.originalEvent.webkitMovementY || 0;\n\t\tvar rotation = calculateCameraRotation(-1 * movementX, -1 * movementY);\n\n\t\t// console.log(self.mouse, \"\\n\", movementX, rotation);\n\n\t\tself.setRotation(rotation.rx, rotation.ry);\n\n\t\t// updateNavPad();\n\t};\n\n\tfunction onMouseOut(e) {\n\t\tisRightMouseDown = false;\n\t\t// self.stopMouseMoving();\n\t};\n\n\tfunction onKeyDown(e) {\n\n\t\tif (!self.enabled) return;\n\n\t\tswitch (e.keyCode) {\n\n\t\t\tcase 38: // up\n\t\t\tcase 87: // w\n\t\t\t\tmoveForward = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 37: // left\n\t\t\tcase 65: // a\n\t\t\t\tmoveLeft = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 40: // down\n\t\t\tcase 83: // s\n\t\t\t\tmoveBackward = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 39: // right\n\t\t\tcase 68: // d\n\t\t\t\tmoveRight = true;\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tfunction onKeyUp(e) {\n\n\t\tswitch (e.keyCode) {\n\n\t\t\tcase 38: // up\n\t\t\tcase 87: // w\n\t\t\t\tmoveForward = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 37: // left\n\t\t\tcase 65: // a\n\t\t\t\tmoveLeft = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 40: // down\n\t\t\tcase 83: // a\n\t\t\t\tmoveBackward = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 39: // right\n\t\t\tcase 68: // d\n\t\t\t\tmoveRight = false;\n\t\t\t\tbreak;\n\n\t\t}\n\t};\n\n\t//\n\t// Private functions:\n\t//\n\tfunction prepareRotationMatrices() {\n\n\t\tvar rotationMatrixF = new THREE.Matrix4();\n\t\trotationMatrixF.makeRotationY(0);\n\t\trotationMatrices.push(rotationMatrixF); // forward direction.\n\n\t\tvar rotationMatrixB = new THREE.Matrix4();\n\t\trotationMatrixB.makeRotationY(180 * Math.PI / 180);\n\t\trotationMatrices.push(rotationMatrixB);\n\n\t\tvar rotationMatrixL = new THREE.Matrix4();\n\t\trotationMatrixL.makeRotationY(90 * Math.PI / 180);\n\t\trotationMatrices.push(rotationMatrixL);\n\n\t\tvar rotationMatrixR = new THREE.Matrix4();\n\t\trotationMatrixR.makeRotationY((360 - 90) * Math.PI / 180);\n\t\trotationMatrices.push(rotationMatrixR);\n\t};\n\n\tfunction calculateCameraRotation(dx, dy, factor) {\n\t\tvar factor = factor ? factor : self.config.rotationFactor;\n\t\tvar ry = self.fpsBody.rotation.y - (dx * factor);\n\t\tvar rx = cameraHolder.rotation.x - (dy * factor);\n\t\trx = Math.max(-maxPitch, Math.min(maxPitch, rx));\n\n\t\treturn {\n\t\t\trx: rx,\n\t\t\try: ry\n\t\t};\n\t};\n\n\tfunction lockDirectionByIndex(index) {\n\t\tif (index == 0)\n\t\t\tself.lockMoveForward(true);\n\t\telse if (index == 1)\n\t\t\tself.lockMoveBackward(true);\n\t\telse if (index == 2)\n\t\t\tself.lockMoveLeft(true);\n\t\telse if (index == 3)\n\t\t\tself.lockMoveRight(true);\n\t}\n\n\t//\n\t// Public functions:\n\t//\n\tself.update = function() {\n\t\tif (self.config.hitTest)\n\t\t\tself.hitTest();\n\n\t\tvelocity.x += (-1 * velocity.x) * 0.75 * self.config.delta;\n\t\tvelocity.z += (-1 * velocity.z) * 0.75 * self.config.delta;\n\n\t\tif (moveForward && !lockMoveForward) velocity.z -= ztouch * self.config.speedFactor * self.config.delta;\n\t\tif (moveBackward && !lockMoveBackward) velocity.z += ztouch * self.config.speedFactor * self.config.delta;\n\n\t\tif (moveLeft && !lockMoveLeft) velocity.x -= xtouch * self.config.speedFactor * self.config.delta;\n\t\tif (moveRight && !lockMoveRight) velocity.x += xtouch * self.config.speedFactor * self.config.delta;\n\n\t\tself.fpsBody.translateX(velocity.x);\n\t\tself.fpsBody.translateY(velocity.y);\n\t\tself.fpsBody.translateZ(velocity.z);\n\t};\n\n\tself.hitTest = function() {\n\t\tself.unlockAllDirections();\n\t\thitObjects = [];\n\t\tvar cameraDirection = self.getDirection2(new THREE.Vector3(0, 0, 0)).clone();\n\n\t\tfor (var i = 0; i < 4; i++) {\n\t\t\t// Applying rotation for each direction:\n\t\t\tvar direction = cameraDirection.clone();\n\t\t\tdirection.applyMatrix4(rotationMatrices[i]);\n\n\t\t\tvar rayCaster = new THREE.Raycaster(self.fpsBody.position, direction);\n\t\t\tvar intersects = rayCaster.intersectObject(self.scene, true);\n\t\t\tif ((intersects.length > 0 && intersects[0].distance < self.config.hitTestDistance)) {\n\t\t\t\tlockDirectionByIndex(i);\n\t\t\t\thitObjects.push(intersects[0]);\n\t\t\t\t// console.log(intersects[0].object.name, i);\n\t\t\t}\n\t\t}\n\n\t\treturn hitObjects;\n\t};\n\n\tself.getDirection2 = function(v) {\n\t\tvar self = this;\n\t\tvar direction = new THREE.Vector3(0, 0, -1);\n\t\tvar rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\n\t\tvar rx = self.fpsBody.getObjectByName(\"cameraHolder\").rotation.x;;\n\t\tvar ry = self.fpsBody.rotation.y;\n\n\t\t// console.log(\"DIRECTION:\", this);\n\t\trotation.set(rx, ry, 0);\n\t\tv.copy(direction).applyEuler(rotation);\n\t\t// console.log(v);\n\t\treturn v;\n\t};\n\n\tself.getDirection = function() {\n\t\tvar self = this;\n\t\tvar rx = 0;\n\t\tvar ry = 0;\n\t\tvar direction = new THREE.Vector3(0, 0, -1);\n\t\tvar rotation = new THREE.Euler(0, 0, 0, \"YXZ\");\n\n\t\t// console.log(\"DIRECTION:\", this);\n\t\tif (self != undefined) {\n\t\t\trx = self.fpsBody.getObjectByName(\"cameraHolder\").rotation.x;\n\t\t\try = self.fpsBody.rotation.y;\n\t\t\tconsole.log(rx, ry);\n\t\t}\n\t\t// var camHolder = self.fpsBody.getObjectByName(\"cameraHolder\");\n\n\t\treturn function(v) {\n\t\t\trotation.set(rx, ry, 0);\n\t\t\tv.copy(direction).applyEuler(rotation);\n\t\t\t// console.log(v);\n\t\t\treturn v;\n\t\t}\n\t}();\n\n\tself.moveLeft = function() {\n\t\treturn moveLeft;\n\t};\n\n\tself.moveRight = function() {\n\t\treturn moveRight;\n\t};\n\n\tself.moveForward = function() {\n\t\treturn moveForward;\n\t};\n\n\tself.moveBackward = function() {\n\t\treturn moveBackward;\n\t};\n\n\tself.lockMoveForward = function(boolean) {\n\t\tlockMoveForward = boolean;\n\t};\n\n\tself.lockMoveBackward = function(boolean) {\n\t\tlockMoveBackward = boolean;\n\t};\n\n\tself.lockMoveLeft = function(boolean) {\n\t\tlockMoveLeft = boolean;\n\t};\n\n\tself.lockMoveRight = function(boolean) {\n\t\tlockMoveRight = boolean;\n\t};\n\n\tself.unlockAllDirections = function() {\n\t\tself.lockMoveForward(false);\n\t\tself.lockMoveBackward(false);\n\t\tself.lockMoveLeft(false);\n\t\tself.lockMoveRight(false);\n\t};\n};\n\nTouchControls.prototype = {\n\taddToScene: function(scene) {\n\t\tthis.scene = scene;\n\t\tscene.add(this.fpsBody);\n\t},\n\n\tsetPosition: function(x, y, z) {\n\t\tthis.fpsBody.position.set(x, y, z);\n\t},\n\n\tstopMouseMoving: function() {\n\t\tisRightMouseDown = false;\n\t},\n\n\tsetRotation: function(x, y) {\n\t\tvar camHolder = this.fpsBody.getObjectByName(\"cameraHolder\");\n\n\t\tif (x !== null)\n\t\t\tcamHolder.rotation.x = x;\n\n\t\tif (y !== null)\n\t\t\tthis.fpsBody.rotation.y = y;\n\t},\n\n\tgetHitObjects: function() {\n\t\treturn hitObjects;\n\t}\n\n};\n\nexport default TouchControls\n","import React, { useRef, } from 'react'\nimport styled from 'styled-components'\n\nconst RotationPad = (props) => {\n\t// logg(props, 'RotationPad')\n\n\tvar mouseDown = false;\n\tvar mouseStopped = false;\n\tvar mouseStopTimeout, eventRepeatTimeout;\n\tvar newLeft, newTop, distance, angle;\n\n\tconst handleRef = useRef(null)\n\tconst handleEl = handleRef.current\n\tconst regionRef = useRef(null)\n\tconst regionEl = regionRef.current\n\n\t/* Aligning pad: */\n\t// rotationPadEl.css({\n\t// \ttop: container.find(\"canvas\").height() + container.position().top - regionEl.outerHeight() - 10,\n\t// \tleft: container.find(\"canvas\").width() - regionEl.outerWidth() - 20\n\t// });\n\n\n\n\tconst regionData = {};\n\tconst handleData = {};\n\n\t// regionData.width = regionEl.outerWidth();\n\t// regionData.height = regionEl.outerHeight();\n\t// regionData.position = regionEl.position();\n\t// regionData.offset = regionEl.offset();\n\t// regionData.radius = regionData.width / 2;\n\t// regionData.centerX = regionData.position.left + regionData.radius;\n\t// regionData.centerY = regionData.position.top + regionData.radius;\n\n\t// handleData.width = handleEl.outerWidth();\n\t// handleData.height = handleEl.outerHeight();\n\t// handleData.radius = handleData.width / 2;\n\n\t// regionData.radius = regionData.width / 2 - handleData.radius;\n\n\tconst resetHandlePosition = () => {\n\t\thandleEl.animate({\n\t\t\ttop: this.regionData.centerY - handleData.radius,\n\t\t\tleft: this.regionData.centerX - handleData.radius,\n\t\t\topacity: 0.1\n\t\t}, \"fast\");\n\t}\n\n\t// Mouse events:\n\tregionEl && regionEl.on(\"mousedown\", function (event) {\n\t\tmouseDown = true;\n\t\thandleEl.css(\"opacity\", \"1.0\");\n\t\tupdate(event.pageX, event.pageY);\n\t});\n\n\t$(document).on(\"mouseup\", function () {\n\t\tmouseDown = false;\n\t\thandleEl && resetHandlePosition();\n\t});\n\n\t$(document).on(\"mousemove\", function(event) {\n\t\tif (!mouseDown) return;\n\t\tupdate(event.pageX, event.pageY);\n\t});\n\n\t//Touch events:\n\tregionEl && regionEl.on(\"touchstart\", function (event) {\n\t\tmouseDown = true;\n\t\thandleEl.css(\"opacity\", \"1.0\");\n\t\tupdate(event.originalEvent.targetTouches[0].pageX, event.originalEvent.targetTouches[0].pageY);\n\t});\n\n\t$(document).on(\"touchend touchcancel\", function () {\n\t\tmouseDown = false;\n\t\thandleEl && resetHandlePosition();\n\t});\n\n\t$(document).on(\"touchmove\", function(event) {\n\t\tif (!mouseDown) return;\n\t\tupdate(event.originalEvent.touches[0].pageX, event.originalEvent.touches[0].pageY);\n\t});\n\n\n\tfunction update(pageX, pageY) {\n\t\tnewLeft = (pageX - regionData.offset.left);\n\t\tnewTop = (pageY - regionData.offset.top);\n\n\t\t// If handle reaches the pad boundaries.\n\t\tdistance = Math.pow(regionData.centerX - newLeft, 2) + Math.pow(regionData.centerY - newTop, 2);\n\t\tif (distance > Math.pow(regionData.radius, 2)) {\n\t\t\tangle = Math.atan2((newTop - regionData.centerY), (newLeft - regionData.centerX));\n\t\t\tnewLeft = (Math.cos(angle) * regionData.radius) + regionData.centerX;\n\t\t\tnewTop = (Math.sin(angle) * regionData.radius) + regionData.centerY;\n\t\t}\n\t\tnewTop = Math.round(newTop * 10) / 10;\n\t\tnewLeft = Math.round(newLeft * 10) / 10;\n\n\t\thandleEl.css({\n\t\t\ttop: newTop - handleData.radius,\n\t\t\tleft: newLeft - handleData.radius\n\t\t});\n\t\t// console.log(newTop , newLeft);\n\n\t\t// Providing event and data for handling camera movement.\n\t\tvar deltaX = regionData.centerX - parseInt(newLeft);\n\t\tvar deltaY = regionData.centerY - parseInt(newTop);\n\t\t// Normalize x,y between -2 to 2 range.\n\t\tdeltaX = -2 + (2+2) * (deltaX - (-regionData.radius)) / (regionData.radius - (-regionData.radius));\n\t\tdeltaY = -2 + (2+2) * (deltaY - (-regionData.radius)) / (regionData.radius - (-regionData.radius));\n\t\tdeltaX = -1 * Math.round(deltaX * 10) / 10;\n\t\tdeltaY = -1 * Math.round(deltaY * 10) / 10;\n\t\t// console.log(deltaX, deltaY);\n\n\t\tsendEvent(deltaX, deltaY);\n\t}\n\n\tfunction sendEvent(dx, dy) {\n\t\tif (!mouseDown) {\n\t\t\tclearTimeout(eventRepeatTimeout);\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(eventRepeatTimeout);\n\t\teventRepeatTimeout = setTimeout(function() {\n\t\t\tsendEvent(dx, dy);\n\t\t}, 5);\n\n\t\tvar moveEvent = $.Event(\"YawPitch\", {\n\t\t\tdetail: {\n\t\t\t\t\"deltaX\": dx,\n\t\t\t\t\"deltaY\": dy\n\t\t\t},\n\t\t\tbubbles: false\n\t\t});\n\t\t$(self).trigger(moveEvent);\n\t}\n\n\thandleEl && resetHandlePosition();\n\n\treturn \t<div className=\"rotation-pad\">\n\t  <div className=\"region\" ref={regionRef} ></div>\n\t  <div className=\"handle\" ref={handleRef} ></div>\n\t</div>\n}\n\nexport default RotationPad\n","\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { PointerLockControls } from './PointerLockControls'\nimport TouchControls from \"./TouchControls\"\nimport RotationPad from \"./RotationPad\"\nimport {\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst Blocker = styled.div`\n  border: 1px dashed red;\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n\n  #Crosshair {\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\nconst W = styled.div`\n  border: 1px solid blue;\n  height: 90vh;\n`;\n\n/**\n * Equirectangular2\n * _vp_ 2021-11-15\n * Let's wire in a simple floor and full-window sizing.\n *\n * Threejs units of measure are centimeters (cm).\n *\n */\nconst Equirectangular2 = (props) => {\n  logg(props, 'Equirectangular2')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene;\n\n  var width, height;\n  var viewAngle = 45,\n    near = 1,\n    far = 10000;\n  var aspect;\n  var stats;\n  var sceneObject, intersected;\n\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const blockerRef = useRef(null)\n  const wContainerRef = useRef(null)\n  const instructionsRef = useRef(null)\n\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  useEffect(() => {\n    window.dispatchEvent(new Event('resize'));\n  }, [ bottomDrawerOpen, folded, twofoldPercent ])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 ) // @TODO: what this?\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 ) // @TODO: what this?\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Origin: axis helper\n     */\n    var axes = new THREE.AxisHelper(700)\n\t\tscene.add(axes)\n\n    const wContainer = wContainerRef.current\n\n    function addControls() {\n      var options = {\n        speedFactor: 0.5,\n        delta: 1,\n        rotationFactor: 0.002,\n        maxPitch: 55,\n        hitTest: true,\n        hitTestDistance: 40\n      };\n      controls = new TouchControls({\n        container: wContainer, camera,\n        options,\n        RotationPad: rotationPad,\n        THREE,\n      });\n      controls.setPosition(0, 35, 400);\n      controls.addToScene(scene);\n      // controls.setRotation(0.15, -0.15);\n    }\n    addControls()\n\n    /*\n     * Floor\n     */\n\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.PlaneGeometry( 100, 100, 10, 10 ) // width, height, w segments, h segments\n    // let floorGeometry = new THREE.CircleGeometry(100, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/100x100_lazer-floor.png`)\n    texture.wrapS = THREE.RepeatWrapping\n    texture.wrapT = THREE.RepeatWrapping\n    texture.repeat.set( 10, 10 )\n    const floorMaterial = new THREE.MeshPhongMaterial({\n      map: texture,\n      // transparent: true,\n    })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    // const scenesPath = '/assets/scenes/'\n    // const objectsPath = '/assets/objects/'\n    // let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    // const texturePath = `${modelName}/${modelName}.mtl`\n    // const modelPath = `${modelName}/${modelName}.obj`\n    // const manager = new THREE.LoadingManager()\n    // const onProgress = (xhr) => {\n    //   if (xhr.lengthComputable) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }\n    // const onError = () => {}\n    // const onLoad = (materials) => {\n    //   materials.preload()\n    //   const objLoader = new OBJLoader( manager )\n    //   objLoader.setMaterials( materials )\n    //   objLoader.setPath( scenesPath)\n    //   objLoader.load( modelPath, ( object ) => {\n    //     object.traverse((child) => {\n    //       if (child.isMesh) {\n    //         child.geometry.scale(0.10, 0.10, 0.10) // @TODO: change?\n    //       }\n    //     })\n    //     object.position.x = Math.random() * 500\n    //     object.position.y = 10\n    //     object.position.z = Math.random() * 500\n\n    //     logg(object, '1st object')\n    //     scene.add( object )\n    //     markerObjects.push( object )\n    //     markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' }) // @TODO: change!\n\n    //   }, onProgress, onError )\n    // }\n    // const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setPath(scenesPath)\n    // mtlLoader.load(texturePath, onLoad)\n\n\n    /*\n     * Skybox\n     */\n    const textureLoader = new THREE.TextureLoader()\n    const assetPath = map.img_path\n    texture = textureLoader.load(assetPath, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  /* From: https://threejsfundamentals.org/threejs/lessons/threejs-responsive.html */\n  function resizeRendererToDisplaySize() {\n    const canvas = renderer.domElement\n    const width = blockerRef.current.clientWidth\n    const height = blockerRef.current.clientHeight\n    const needResize = canvas.width !== width || canvas.height !== height\n    if (needResize) {\n      renderer.setSize(width, height)\n    }\n    return needResize\n  }\n  function onWindowResize() {\n    if (resizeRendererToDisplaySize()) {\n      const width = blockerRef.current.clientWidth\n      const height = blockerRef.current.clientHeight\n      camera.aspect = width / height\n      camera.updateProjectionMatrix()\n    }\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <W ref={wContainerRef} >\n    <div ref={instructionsRef} />\n    <Blocker ref={blockerRef} >\n      <div id=\"Crosshair\" />\n\n      <RotationPad />\n    </Blocker>\n  </W>\n}\n\nexport default Equirectangular2\n","\n/*\n * @TODO: this is just a copy of equirectangular2, discard\n */\n\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { PointerLockControls } from './PointerLockControls'\nimport TouchControls from \"./TouchControls\"\nimport RotationPad from \"./RotationPad\"\nimport {\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst Blocker = styled.div`\n  border: 1px dashed red;\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n\n  #Crosshair {\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\nconst W = styled.div`\n  border: 1px solid blue;\n  height: 90vh;\n`;\n\n/**\n * Equirectangular2\n * _vp_ 2021-11-15\n * Let's wire in a simple floor and full-window sizing.\n *\n * Threejs units of measure are centimeters (cm).\n *\n */\nconst Equirectangular2 = (props) => {\n  logg(props, 'Equirectangular2')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene;\n\n  var width, height;\n  var viewAngle = 45,\n    near = 1,\n    far = 10000;\n  var aspect;\n  var stats;\n  var sceneObject, intersected;\n\n\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  const blockerRef = useRef(null)\n  const wContainerRef = useRef(null)\n  const instructionsRef = useRef(null)\n\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  useEffect(() => {\n    window.dispatchEvent(new Event('resize'));\n  }, [ bottomDrawerOpen, folded, twofoldPercent ])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 ) // @TODO: what this?\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 ) // @TODO: what this?\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Origin: axis helper\n     */\n    var axes = new THREE.AxisHelper(700)\n\t\tscene.add(axes)\n\n    const wContainer = wContainerRef.current\n\n    function addControls() {\n      var options = {\n        speedFactor: 0.5,\n        delta: 1,\n        rotationFactor: 0.002,\n        maxPitch: 55,\n        hitTest: true,\n        hitTestDistance: 40\n      };\n      controls = new TouchControls({\n        container: wContainer, camera,\n        options,\n        RotationPad: rotationPad,\n        THREE,\n      });\n      controls.setPosition(0, 35, 400);\n      controls.addToScene(scene);\n      // controls.setRotation(0.15, -0.15);\n    }\n    addControls()\n\n    /*\n     * Floor\n     */\n\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.PlaneGeometry( 100, 100, 10, 10 ) // width, height, w segments, h segments\n    // let floorGeometry = new THREE.CircleGeometry(100, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/100x100_lazer-floor.png`)\n    texture.wrapS = THREE.RepeatWrapping\n    texture.wrapT = THREE.RepeatWrapping\n    texture.repeat.set( 10, 10 )\n    const floorMaterial = new THREE.MeshPhongMaterial({\n      map: texture,\n      // transparent: true,\n    })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    // const scenesPath = '/assets/scenes/'\n    // const objectsPath = '/assets/objects/'\n    // let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    // const texturePath = `${modelName}/${modelName}.mtl`\n    // const modelPath = `${modelName}/${modelName}.obj`\n    // const manager = new THREE.LoadingManager()\n    // const onProgress = (xhr) => {\n    //   if (xhr.lengthComputable) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }\n    // const onError = () => {}\n    // const onLoad = (materials) => {\n    //   materials.preload()\n    //   const objLoader = new OBJLoader( manager )\n    //   objLoader.setMaterials( materials )\n    //   objLoader.setPath( scenesPath)\n    //   objLoader.load( modelPath, ( object ) => {\n    //     object.traverse((child) => {\n    //       if (child.isMesh) {\n    //         child.geometry.scale(0.10, 0.10, 0.10) // @TODO: change?\n    //       }\n    //     })\n    //     object.position.x = Math.random() * 500\n    //     object.position.y = 10\n    //     object.position.z = Math.random() * 500\n\n    //     logg(object, '1st object')\n    //     scene.add( object )\n    //     markerObjects.push( object )\n    //     markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' }) // @TODO: change!\n\n    //   }, onProgress, onError )\n    // }\n    // const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setPath(scenesPath)\n    // mtlLoader.load(texturePath, onLoad)\n\n\n    /*\n     * Skybox\n     */\n    const textureLoader = new THREE.TextureLoader()\n    const assetPath = map.img_path\n    texture = textureLoader.load(assetPath, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  /* From: https://threejsfundamentals.org/threejs/lessons/threejs-responsive.html */\n  function resizeRendererToDisplaySize() {\n    const canvas = renderer.domElement\n    const width = blockerRef.current.clientWidth\n    const height = blockerRef.current.clientHeight\n    const needResize = canvas.width !== width || canvas.height !== height\n    if (needResize) {\n      renderer.setSize(width, height)\n    }\n    return needResize\n  }\n  function onWindowResize() {\n    if (resizeRendererToDisplaySize()) {\n      const width = blockerRef.current.clientWidth\n      const height = blockerRef.current.clientHeight\n      camera.aspect = width / height\n      camera.updateProjectionMatrix()\n    }\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <W ref={wContainerRef} >\n    <div ref={instructionsRef} />\n    <Blocker ref={blockerRef} >\n      <div id=\"Crosshair\" />\n\n      <RotationPad />\n    </Blocker>\n  </W>\n}\n\nexport default Equirectangular2\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport * as THREE from \"three\"\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  height: calc(100% - ${p => p.breadcrumbsHeight});\n`;\n\n/**\n * Excellent documentation. From: https://threejs.org/examples/#misc_controls_pointerlock\n * Right now the unit is 1cm, 1/10 of a meter.\n */\n\n\nconst Loc = (props) => {\n  let camera, controls,\n    object, objects = [],\n    raycaster, renderer,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n    /*\n    // PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n    // fov  Camera frustum vertical field of view.\n    // aspect  Camera frustum aspect ratio.\n    // near  Camera frustum near plane.\n    // far  Camera frustum far plane.\n    */\n    // camera = new THREE.PerspectiveCamera( 75, 2, 1, 100 )\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 300 )\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    // floor\n    // @TODO: it's not aligned to parcels the way I want\n    let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    floorGeometry.rotateX( - Math.PI / 2 )\n\n    // vertex displacement\n    let position = floorGeometry.attributes.position\n    for ( let i = 0, l = position.count; i < l; i ++ ) {\n      vertex.fromBufferAttribute( position, i )\n      vertex.x += Math.random() * 20 - 10\n      vertex.y += Math.random() * 2\n      vertex.z += Math.random() * 20 - 10\n      position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    }\n    floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    floorGeometry.x = -200\n    floorGeometry.y = -200\n    floorGeometry.z = -200\n    position = floorGeometry.attributes.position\n    const colorsFloor = []\n    for ( let i = 0, l = position.count; i < l; i ++ ) {\n      color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n      colorsFloor.push( color.r, color.g, color.b )\n    }\n    floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    // objects\n    /*\n    const boxGeometry = new THREE.BoxGeometry( 20, 20, 20 ).toNonIndexed()\n    position = boxGeometry.attributes.position\n    const colorsBox = []\n    for ( let i = 0, l = position.count; i < l; i ++ ) {\n      color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n      colorsBox.push( color.r, color.g, color.b )\n    }\n    boxGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsBox, 3 ) )\n    for ( let i = 0; i < 500; i ++ ) {\n      const boxMaterial = new THREE.MeshPhongMaterial( { specular: 0xffffff, flatShading: true, vertexColors: true } )\n      boxMaterial.color.setHSL( Math.random() * 0.2 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n\n      const box = new THREE.Mesh( boxGeometry, boxMaterial )\n      box.position.x = Math.floor( Math.random() * 20 - 10 ) * 20\n      box.position.y = Math.floor( Math.random() * 20 ) * 20 + 10\n      box.position.z = Math.floor( Math.random() * 20 - 10 ) * 20\n      scene.add( box )\n      objects.push( box )\n    }\n    */\n\n    // load OBJ\n\n    // manager\n\n    // this is specifically for tiny-house-1\n    const loadModel = () => {\n      object.traverse((child) => {\n        if ( child.isMesh ) {\n          child.material.map = texture\n          child.geometry.scale(10, 10, 10)\n        }\n      })\n      object.position.x = 100\n      object.position.y = 10\n      object.position.z = 100\n\n      scene.add( object )\n    }\n    const manager = new THREE.LoadingManager( loadModel )\n    manager.onProgress = function ( item, loaded, total ) {\n      console.log( item, loaded, total )\n    }\n\n    // texture\n\n    const textureLoader = new THREE.TextureLoader( manager )\n    const texture = textureLoader.load( 'textures/uv_grid_opengl.jpg' )\n\n    // model\n\n    // tiny-house-1\n    const loader = new OBJLoader( manager )\n    loader.load( '/assets/scenes/tiny-house-1/tiny-house-1.obj', ( obj ) => {\n      object = obj\n    }, ( xhr ) => {\n      if ( xhr.lengthComputable ) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }, (e) => {\n      logg(e, 'onError')\n    } )\n\n\n    // some delimiters for the first 6 parcels!\n    let geometry = new THREE.BoxGeometry( 10, 10, 10 )\n    let material = new THREE.MeshBasicMaterial( {color: 0x00ff00} )\n    let cube = new THREE.Mesh( geometry, material )\n    cube.position.x = 0\n    cube.position.y = 5\n    cube.position.z = 0\n    scene.add( cube )\n    const items = [\n      { color: 0xff0000, x: 1, y: 0, z: 0 },\n      { color: 0x00ff00, x: 0, y: 1, z: 0 },\n      { color: 0x0000ff, x: 0, y: 0, z: 1 }\n    ]\n    items.map((item, idx) => {\n      logg(item, 'item')\n      const { color, x, y, z } = item\n      geometry = new THREE.BoxGeometry( 1 + x*10, 1 + y*10, 1 + z*10 )\n      material = new THREE.MeshBasicMaterial({ color: color })\n      cube = new THREE.Mesh( geometry, material )\n      cube.position.x = x*5\n      cube.position.y = 10+y*5\n      cube.position.z = z*5\n      scene.add( cube )\n    })\n\n    const parcels = [\n      { color: 0xff0000, x: 100, y: 1, z: 100 },\n      { color: 0x00ff00, x: 100, y: 1, z: 320 },\n      { color: 0x0000ff, x: -120, y: 1, z: 320 },\n\n      { color: 0x660000, x: -120, y: 1, z: 100 },\n      { color: 0x006600, x: -120, y: 1, z: -120 },\n      { color: 0x000066, x: 100, y: 1, z: -120 },\n    ]\n    parcels.map((item, idx) => {\n      const { color, x, y, z } = item\n      const g = new THREE.BoxGeometry( 200, 2, 200 )\n      const m = new THREE.MeshBasicMaterial({color: color})\n      const p = new THREE.Mesh( g, m )\n      p.position.x = x\n      p.position.y = y\n      p.position.z = z\n      scene.add( p )\n    })\n\n    //\n\n\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    // renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setPixelRatio(1)\n    renderer.setSize( 800, 400 )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n      raycaster.ray.origin.copy( controls.getObject().position )\n      raycaster.ray.origin.y -= 10\n      const intersections = raycaster.intersectObjects( objects, false )\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} />\n  </F>\n}\n\nexport default Loc\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  border: 2px solid red;\n\n  position: relative;\n  // height: calc(100% - ${p => p.breadcrumbsHeight});\n  width: 700px;\n  height: 350px;\n\n  #Crosshair {\n    // border: 1px solid yellow;\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\n/**\n * Loc = Location\n *\n * Excellent documentation. From: https://threejs.org/examples/#misc_controls_pointerlock\n * Right now the unit is 1cm, 1/10 of a meter.\n */\nconst Loc = (props) => {\n  // logg(props, 'Loc')\n\n  const history = useHistory()\n\n  let camera, controls,\n    object, objects = [], markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n\n    /*\n     * Crosshair\n     * From: https://codepen.io/driezis/pen/jOPzjLG?editors=1000\n     */\n    var pMat = new THREE.ShaderMaterial({\n        uniforms: { main_color: {value: {r: 1, g: 1, b: 1}},\n                    border_color: {value: {r: 0, g: 0, b: 0.1}},\n\n                    thickness: {value:0.006},\n                    height: {value:0.13},\n                    offset: {value:0.05},\n                    border: {value:0.003},\n\n                    opacity: {value: 1},\n                    center: {value: {x: 0.5, y: 0.5}},\n                    rotation: {value: 0}\n                },\n        vertexShader: `\n                uniform float rotation;\n                uniform vec2 center;\n                #include <common>\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec2 scale;\n                    scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n                    scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n                    #ifndef USE_SIZEATTENUATION\n                        bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n                        if ( isPerspective ) scale *= - mvPosition.z;\n                    #endif\n                    vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n                    vec2 rotatedPosition;\n                    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n                    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n                    mvPosition.xy += rotatedPosition;\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n        fragmentShader: `\n            uniform vec3 main_color;\n            uniform vec3 border_color;\n            uniform float opacity;\n\n            uniform float thickness;\n            uniform float height;\n            uniform float offset;\n            uniform float border;\n\n            varying vec2 vUv;\n            void main() {\n\n                float a = (step(abs(vUv.x - 0.5), thickness)) * step(abs(vUv.y - 0.5), height + offset) * step(offset, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness)) * step(abs(vUv.x - 0.5), height + offset) * step(offset, abs(vUv.x - 0.5));\n                float b = (step(abs(vUv.x - 0.5), thickness - border)) * step(abs(vUv.y - 0.5), height + offset - border) * step(offset + border, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness - border)) * step(abs(vUv.x - 0.5), height + offset - border) * step(offset + border, abs(vUv.x - 0.5));\n                gl_FragColor = vec4( mix(border_color, main_color, b), a * opacity);\n            }\n        `,\n        transparent: true,\n    });\n    var sprite = new THREE.Sprite(pMat);\n    // scene.add(sprite);\n    // sprite.position.set(0,0,-5);\n\n    /*\n     * Reticle\n     */\n    // var scale = 3\n    // var cursorSize = 500\n    // var reticle = new THREE.Mesh(\n    //   new THREE.RingBufferGeometry( 0.85 * cursorSize, cursorSize, 32),\n    //   new THREE.MeshBasicMaterial({color: 0xffffff, blending: THREE.AdditiveBlending, side: THREE.DoubleSide })\n    // );\n    // reticle.position.z = -100\n    // reticle.lookAt(camera.position)\n    // camera.add(reticle)\n\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Floor\n     */\n\n    // // random\n    // // @TODO: it's not aligned to parcels the way I want\n    // let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    // floorGeometry.rotateX( - Math.PI / 2 )\n\n    // // vertex displacement\n    // let position = floorGeometry.attributes.position\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   vertex.fromBufferAttribute( position, i )\n    //   vertex.x += Math.random() * 20 - 10\n    //   vertex.y += Math.random() * 2\n    //   vertex.z += Math.random() * 20 - 10\n    //   position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    // }\n    // floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    // floorGeometry.x = -200\n    // floorGeometry.y = -200\n    // floorGeometry.z = -200\n    // position = floorGeometry.attributes.position\n    // const colorsFloor = []\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n    //   colorsFloor.push( color.r, color.g, color.b )\n    // }\n    // floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    // const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n    // moon floor\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`)\n\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    const scenesPath = '/assets/scenes/'\n    const objectsPath = '/assets/objects/'\n    let modelName = 'polycity' // 'wasyaco-reception' // 'tiny-house-2'\n    let modelName2 = 'girl'\n    const texturePath = `${modelName}/${modelName}.mtl`\n    const modelPath = `${modelName}/${modelName}.obj`\n    const modelPath2 = `${modelName2}/${modelName2}.obj`\n    const manager = new THREE.LoadingManager()\n\n    const onProgress = (xhr) => {\n      if (xhr.lengthComputable) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }\n    // onProgress = function ( item, loaded, total ) {\n    //   console.log( item, loaded, total )\n    // }\n    const onError = () => {}\n    const onLoad = (materials) => {\n      materials.preload()\n      const objLoader = new OBJLoader( manager )\n      objLoader.setMaterials( materials )\n      objLoader.setPath( scenesPath)\n      objLoader.load( modelPath, ( object ) => {\n        object.traverse((child) => {\n          if (child.isMesh) {\n            child.geometry.scale(0.10, 0.10, 0.10)\n          }\n        })\n        object.position.x = Math.random() * 500\n        object.position.y = 10\n        object.position.z = Math.random() * 500\n\n        logg(object, '1st object')\n        scene.add( object )\n        markerObjects.push( object )\n        markerObjectsIdxs.push({ uuid: object.uuid, name: 'camaro75', slug: 'construct1' })\n\n      }, onProgress, onError )\n    }\n    const onLoad2 = (materials) => {\n      // materials.preload()\n      const objLoader = new OBJLoader( manager )\n      // objLoader.setMaterials( materials )\n      objLoader.setPath( objectsPath )\n      objLoader.load( modelPath2, ( object ) => {\n        object.traverse((child) => {\n          if (child.isMesh) {\n            child.geometry.scale(10, 10, 10)\n          }\n        })\n        object.position.x = Math.random() * 500\n        object.position.y = 10\n        object.position.z = Math.random() * 500\n\n        logg(object, '2st object')\n        scene.add( object )\n        markerObjects.push( object )\n        markerObjectsIdxs.push({ uuid: object.uuid, name: 'girl', slug: 'demmitv' })\n\n      }, onProgress, onError )\n    }\n    const mtlLoader = new MTLLoader(manager)\n    // mtlLoader.setBaseUrl(scenesPath)\n    mtlLoader.setPath(scenesPath)\n    mtlLoader.load(texturePath, onLoad)\n    mtlLoader.load(texturePath, onLoad2)\n\n\n    // /* texture */\n    // const textureLoader = new THREE.TextureLoader( manager )\n    // const texture = textureLoader.load( 'textures/uv_grid_opengl.jpg' )\n\n\n    // const loader = new OBJLoader( manager )\n    // loader.load( `/assets/scenes/${modelName}/${modelName}.obj`, ( obj ) => {\n    //   object = obj\n    // }, ( xhr ) => {\n    //   if ( xhr.lengthComputable ) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }, (e) => {\n    //   logg(e, 'onError')\n    // } )\n\n\n    /*\n     * parcels\n     */\n\n    // // some delimiters for the first 6 parcels!\n    // let geometry = new THREE.BoxGeometry( 10, 10, 10 )\n    // let material = new THREE.MeshBasicMaterial( {color: 0x00ff00} )\n    // let cube = new THREE.Mesh( geometry, material )\n    // cube.position.x = 0\n    // cube.position.y = 5\n    // cube.position.z = 0\n    // // scene.add( cube )\n    // const items = [\n    //   { color: 0xff0000, x: 1, y: 0, z: 0 },\n    //   { color: 0x00ff00, x: 0, y: 1, z: 0 },\n    //   { color: 0x0000ff, x: 0, y: 0, z: 1 }\n    // ]\n    // items.map((item, idx) => {\n    //   logg(item, 'item')\n    //   const { color, x, y, z } = item\n    //   geometry = new THREE.BoxGeometry( 1 + x*10, 1 + y*10, 1 + z*10 )\n    //   material = new THREE.MeshBasicMaterial({ color: color })\n    //   cube = new THREE.Mesh( geometry, material )\n    //   cube.position.x = x*5\n    //   cube.position.y = 10+y*5\n    //   cube.position.z = z*5\n    //   // scene.add( cube )\n    // })\n\n    // const parcels = [\n    //   { color: 0xff0000, x: 100, y: 1, z: 100 },\n    //   { color: 0x00ff00, x: 100, y: 1, z: 320 },\n    //   { color: 0x0000ff, x: -120, y: 1, z: 320 },\n\n    //   { color: 0x660000, x: -120, y: 1, z: 100 },\n    //   { color: 0x006600, x: -120, y: 1, z: -120 },\n    //   { color: 0x000066, x: 100, y: 1, z: -120 },\n    // ]\n    // parcels.map((item, idx) => {\n    //   const { color, x, y, z } = item\n    //   const g = new THREE.BoxGeometry( 200, 2, 200 )\n    //   const m = new THREE.MeshBasicMaterial({color: color})\n    //   const p = new THREE.Mesh( g, m )\n    //   p.position.x = x\n    //   p.position.y = y\n    //   p.position.z = z\n    //   // scene.add( p )\n    // })\n\n\n    /*\n     * Skybox\n     */\n    const loader = new THREE.TextureLoader()\n    texture = loader.load(`/assets/textures/space-5.jpg`, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( 700, 350 ) // aspect ratio 0.5\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        // collision\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} >\n      <div id=\"Crosshair\" />\n    </Blocker>\n  </F>\n}\n\nexport default Loc\n","\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\nimport * as THREE from \"three\"\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\n\nimport { Crosshair } from \"./\"\nimport { PointerLockControls, } from './PointerLockControls'\nimport {\n  C,\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst Blocker = styled.div`\n  // border: 2px solid red;\n\n  position: relative;\n  width: 100%;\n  height: 100%;\n`;\n\n/**\n * Loc = Location\n *\n * Excellent documentation. From: https://threejs.org/examples/#misc_controls_pointerlock\n * Right now the unit is 1cm, 1/10 of a meter.\n */\nconst Loc = (props) => {\n  // logg(props, 'Loc')\n  logg([window.innerWidth, window.innerHeight], 'windowWidthHeight')\n\n  const history = useHistory()\n  const {\n    bottomDrawerOpen,\n    folded, setFolded,\n    itemToUnlock, setItemToUnlock,\n    mapPanelWidth, setMapPanelWidth,\n    mapPanelHeight, setMapPanelHeight,\n    ratedConfirmation, setRatedConfirmation,\n    showItem, setShowItem,\n    showUrl, setShowUrl,\n    twofoldPercent,\n  } = useContext(TwofoldContext)\n\n  let camera, controls,\n    glow,\n    markerObjects = [],\n    pickedObject,\n    raycaster, removedObject, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  useEffect(() => {\n    window.dispatchEvent(new Event('resize'));\n  }, [ bottomDrawerOpen, folded, twofoldPercent ])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n\n\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    const aspect = blockerRef.current.clientWidth / blockerRef.current.clientHeight\n    camera = new THREE.PerspectiveCamera( 75, aspect, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    // scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n    const onClick = (event) => {\n      // logg(event, 'onCLick')\n      // logg(pickedObject, 'pickedObject')\n\n      // @TODO: prevent lock-outs!\n      if (pickedObject) {\n        // controls.unlock()\n        // history.push(`/en/locations/show/${pickedObject.slug}`)\n      }\n    }\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n    document.addEventListener( 'click', onClick )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n\n    /*\n     * Floor\n     */\n\n    // moon floor\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`)\n\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    const scenesPath = '/assets/scenes/'\n    const objectsPath = '/assets/objects/'\n    const manager = new THREE.LoadingManager()\n\n    let importModels = [\n      // { modelName: 'wasyaco-reception-2', slug: 'construct1' },\n\n      { modelName: 'camaro75', slug: 'construct1' },\n      { modelName: 'girl',     slug: 'demmitv' },\n\n      // { modelName: 'girl-5',     slug: 'demmitv' },\n    ]\n\n    const onProgress = (xhr) => {\n      if (xhr.lengthComputable) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }\n    const onError = () => {}\n    const mtlLoader = new MTLLoader(manager)\n    mtlLoader.setPath(objectsPath)\n\n    importModels.map(({ modelName, slug }) => {\n      const texturePath = `${modelName}/${modelName}.mtl`\n      const modelPath = `${modelName}/${modelName}.obj`\n      const wrappedOnLoad = (modelPath) => {\n        return (materials) => {\n          materials.preload()\n          const objLoader = new OBJLoader( manager )\n          objLoader.setMaterials( materials )\n\n          objLoader.setPath(objectsPath)\n          objLoader.load( modelPath, ( object ) => {\n            object.traverse((child) => {\n              if (child.isMesh) {\n                child.geometry.scale(10, 10, 10)\n              }\n            })\n            object.position.x = Math.random() * 200\n            object.position.y = 10\n            object.position.z = Math.random() * 200\n\n            scene.add( object )\n            markerObjects.push({ uuid: object.uuid, name: 'camaro75', object, slug: 'construct1', })\n\n          }, onProgress, onError )\n        }\n      }\n      mtlLoader.load(texturePath, wrappedOnLoad(modelPath))\n    })\n\n\n\n\n    /*\n     * Skybox\n     */\n    const loader = new THREE.TextureLoader()\n    texture = loader.load(`/assets/textures/space-5.jpg`, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = blockerRef.current.clientWidth / blockerRef.current.clientHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( blockerRef.current.clientWidth, blockerRef.current.clientHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      // hmmm unneeded\n      // let mouse = new THREE.Vector2()\n      // mouse.x = ( cameraDirection.x / window.innerWidth ) * 2 - 1;\n\t    // mouse.y = - ( cameraDirection.y / window.innerHeight ) * 2 + 1;\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      pickedObject = null\n      scene.remove( glow )\n      if (removedObject) {\n        scene.add( removedObject )\n        removedObject = null\n      }\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects.map(m=>m.object), true )\n      if (intersections.length) {\n        const _pickedObject = intersections[0].object\n\n        // glow\n        markerObjects.map((item, idx) => {\n          if (item.uuid === _pickedObject.parent.uuid) {\n            glow = item.object.clone()\n            glow.traverse((child) => {\n              if (child.isMesh) {\n                child.material = new THREE.MeshBasicMaterial()\n                child.material.color = new THREE.Color(0Xffff00)\n              }\n            })\n            glow.position.set(_pickedObject.parent.position.x, _pickedObject.parent.position.y, _pickedObject.parent.position.z)\n            // glow.scale.multiplyScalar(1.05)\n            scene.add( glow )\n            removedObject = _pickedObject.parent.clone()\n            scene.remove( _pickedObject.parent )\n          }\n        })\n\n        /* collision @TODO */\n        if (intersections[0].distance < 5) {\n          moveForward = false\n        }\n\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker ref={blockerRef} >\n      <Crosshair />\n    </Blocker>\n  </F>\n}\n\nexport default Loc\n","\nimport React, { Fragment as F, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport * as THREE from \"three\"\n// import MTLLoader from 'three-mtl-loader' // @TODO: remove from package.json\nimport { OBJLoader } from \"three/examples/jsm/loaders/OBJLoader\"\nimport { MTLLoader } from \"three/examples/jsm/loaders/MTLLoader\"\nimport styled from 'styled-components'\n\nimport { logg, S } from \"$shared\"\nimport { PointerLockControls } from './PointerLockControls'\n\nconst Blocker = styled.div`\n  border: 2px solid red;\n\n  position: relative;\n  // height: calc(100% - ${p => p.breadcrumbsHeight});\n  width: 700px;\n  height: 350px;\n\n  #Crosshair {\n    // border: 1px solid yellow;\n    width: 50px;\n    height: 50px;\n\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    color: white;\n\n    ::before {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      transform: rotate(90deg);\n      // width: 0.5em;\n    }\n    ::after {\n      content: '';\n      position: absolute;\n      border-color: white;\n      border-style: solid;\n      border-width: 0 0.1em 0 0;\n      height: 1em;\n      top: 0em;\n      left: 0.3em;\n      // margin-top: -1em;\n      // width: 0.5em;\n    }\n  }\n`;\n\n/**\n * ThreePanelV4\n * Markers are obejcts _vp_ 2021-11-14\n *\n */\nconst ThreePanelV4 = (props) => {\n  logg(props, 'ThreePanelV4')\n  const { map } = props\n\n  const history = useHistory()\n\n  let camera, controls,\n    object, objects = [], markerObjects = [], markerObjectsIdxs = [],\n    raycaster, renderer,\n    texture,\n    scene\n\n  const blockerRef = useRef(null)\n  const instructionsRef = useRef(null)\n  useEffect(() => {\n    init()\n    animate()\n  }, [])\n\n  let moveForward = false\n  let moveBackward = false\n  let moveLeft = false\n  let moveRight = false\n  let canJump = false\n\n  let prevTime = performance.now()\n  const velocity = new THREE.Vector3()\n  const direction = new THREE.Vector3()\n  const vertex = new THREE.Vector3()\n  const color = new THREE.Color()\n\n  function init() {\n\n    /**\n     * PerspectiveCamera( fov : Number, aspect : Number, near : Number, far : Number )\n     *\n     * fov  Camera frustum vertical field of view.\n     * aspect  Camera frustum aspect ratio.\n     * near  Camera frustum near plane.\n     * far  Camera frustum far plane.\n    */\n    camera = new THREE.PerspectiveCamera( 75, 2, 1, 1000 ) // fov, aspect, near, far\n    camera.position.y = 10\n\n    scene = new THREE.Scene()\n    scene.background = new THREE.Color( 0xffffff )\n    scene.fog = new THREE.Fog( 0xffffff, 0, 750 )\n\n    const light = new THREE.HemisphereLight( 0xeeeeff, 0x777788, 0.75 )\n    light.position.set( 0.5, 1, 0.75 )\n    scene.add( light )\n\n    controls = new PointerLockControls( camera, document.body )\n\n    blockerRef.current.addEventListener( 'click', function () {\n      logg('locked controls')\n      controls.lock()\n    } )\n\n    controls.addEventListener( 'lock', function () {\n      logg('event #lock')\n      // instructions.style.display = 'none'\n      // blocker.style.display = 'none'\n    } )\n\n    controls.addEventListener( 'unlock', function () {\n      // blocker.style.display = 'block'\n      // instructions.style.display = ''\n    } )\n\n    scene.add( controls.getObject() )\n\n\n    /*\n     * Crosshair\n     * From: https://codepen.io/driezis/pen/jOPzjLG?editors=1000\n     */\n    var pMat = new THREE.ShaderMaterial({\n        uniforms: { main_color: {value: {r: 1, g: 1, b: 1}},\n                    border_color: {value: {r: 0, g: 0, b: 0.1}},\n\n                    thickness: {value:0.006},\n                    height: {value:0.13},\n                    offset: {value:0.05},\n                    border: {value:0.003},\n\n                    opacity: {value: 1},\n                    center: {value: {x: 0.5, y: 0.5}},\n                    rotation: {value: 0}\n                },\n        vertexShader: `\n                uniform float rotation;\n                uniform vec2 center;\n                #include <common>\n                varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec2 scale;\n                    scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n                    scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n                    #ifndef USE_SIZEATTENUATION\n                        bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n                        if ( isPerspective ) scale *= - mvPosition.z;\n                    #endif\n                    vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n                    vec2 rotatedPosition;\n                    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n                    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n                    mvPosition.xy += rotatedPosition;\n                    gl_Position = projectionMatrix * mvPosition;\n                }\n            `,\n        fragmentShader: `\n            uniform vec3 main_color;\n            uniform vec3 border_color;\n            uniform float opacity;\n\n            uniform float thickness;\n            uniform float height;\n            uniform float offset;\n            uniform float border;\n\n            varying vec2 vUv;\n            void main() {\n\n                float a = (step(abs(vUv.x - 0.5), thickness)) * step(abs(vUv.y - 0.5), height + offset) * step(offset, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness)) * step(abs(vUv.x - 0.5), height + offset) * step(offset, abs(vUv.x - 0.5));\n                float b = (step(abs(vUv.x - 0.5), thickness - border)) * step(abs(vUv.y - 0.5), height + offset - border) * step(offset + border, abs(vUv.y - 0.5)) + (step(abs(vUv.y - 0.5), thickness - border)) * step(abs(vUv.x - 0.5), height + offset - border) * step(offset + border, abs(vUv.x - 0.5));\n                gl_FragColor = vec4( mix(border_color, main_color, b), a * opacity);\n            }\n        `,\n        transparent: true,\n    });\n    var sprite = new THREE.Sprite(pMat);\n    // scene.add(sprite);\n    // sprite.position.set(0,0,-5);\n\n    /*\n     * Reticle\n     */\n    // var scale = 3\n    // var cursorSize = 500\n    // var reticle = new THREE.Mesh(\n    //   new THREE.RingBufferGeometry( 0.85 * cursorSize, cursorSize, 32),\n    //   new THREE.MeshBasicMaterial({color: 0xffffff, blending: THREE.AdditiveBlending, side: THREE.DoubleSide })\n    // );\n    // reticle.position.z = -100\n    // reticle.lookAt(camera.position)\n    // camera.add(reticle)\n\n\n    const onKeyDown = (event) => {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = true\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = true\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = true\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = true\n          break\n        case 'Space':\n          if ( canJump === true ) velocity.y += 350\n          canJump = false\n          break\n      }\n    }\n\n    const onKeyUp = function ( event ) {\n      switch ( event.code ) {\n        case 'ArrowUp':\n        case 'KeyW':\n          moveForward = false\n          break\n        case 'ArrowLeft':\n        case 'KeyA':\n          moveLeft = false\n          break\n        case 'ArrowDown':\n        case 'KeyS':\n          moveBackward = false\n          break\n        case 'ArrowRight':\n        case 'KeyD':\n          moveRight = false\n          break\n      }\n    }\n\n    document.addEventListener( 'keydown', onKeyDown )\n    document.addEventListener( 'keyup', onKeyUp )\n\n    raycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, 10 )\n\n    /*\n     * Floor\n     */\n\n    // // random\n    // // @TODO: it's not aligned to parcels the way I want\n    // let floorGeometry = new THREE.PlaneGeometry( 460, 680, 100, 100 )\n    // floorGeometry.rotateX( - Math.PI / 2 )\n\n    // // vertex displacement\n    // let position = floorGeometry.attributes.position\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   vertex.fromBufferAttribute( position, i )\n    //   vertex.x += Math.random() * 20 - 10\n    //   vertex.y += Math.random() * 2\n    //   vertex.z += Math.random() * 20 - 10\n    //   position.setXYZ( i, vertex.x, vertex.y, vertex.z )\n    // }\n    // floorGeometry = floorGeometry.toNonIndexed() // ensure each face has unique vertices\n    // floorGeometry.x = -200\n    // floorGeometry.y = -200\n    // floorGeometry.z = -200\n    // position = floorGeometry.attributes.position\n    // const colorsFloor = []\n    // for ( let i = 0, l = position.count; i < l; i ++ ) {\n    //   color.setHSL( Math.random() * 0.3 + 0.5, 0.75, Math.random() * 0.25 + 0.75 )\n    //   colorsFloor.push( color.r, color.g, color.b )\n    // }\n    // floorGeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colorsFloor, 3 ) )\n    // const floorMaterial = new THREE.MeshBasicMaterial( { vertexColors: true } )\n    // const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    // scene.add( floor )\n\n    // moon floor\n    texture = THREE.ImageUtils.loadTexture(`/assets/textures/moon-1.jpg`)\n\n    // let floorGeometry = new THREE.PlaneGeometry( 1000, 1000, 100, 100 ) // width, height, w segments, h segments\n    /**\n     * From: https://threejs.org/docs/#api/en/geometries/CircleGeometry\n     * CircleGeometry(radius : Float, segments : Integer, thetaStart : Float, thetaLength : Float)\n     *\n     * radius  Radius of the circle, default = 1.\n     * segments  Number of segments (triangles), minimum = 3, default = 8.\n     * thetaStart  Start angle for first segment, default = 0 (three o'clock position).\n     * thetaLength  The central angle, often called theta, of the circular sector. The default is 2*Pi, which makes for a complete circle.\n     */\n    let floorGeometry = new THREE.CircleGeometry(1000, 32) // radius, segments, thetaStart, thetaLength\n    floorGeometry.rotateX( - Math.PI / 2 )\n    const floorMaterial = new THREE.MeshBasicMaterial({ map: texture })\n    const floor = new THREE.Mesh( floorGeometry, floorMaterial )\n    scene.add( floor )\n\n    /*\n     * Model Import\n     */\n    const scenesPath = '/assets/scenes/'\n    const objectsPath = '/assets/objects/'\n    const texturesPath = '/assets/textures/'\n    const manager = new THREE.LoadingManager()\n    const mtlLoader = new MTLLoader(manager)\n    mtlLoader.setPath(texturesPath)\n    const onProgress = (xhr) => {\n      if (xhr.lengthComputable) {\n        const percentComplete = xhr.loaded / xhr.total * 100\n        console.log( Math.round( percentComplete, 2 ) + '% downloaded' )\n      }\n    }\n    const onError = () => {}\n\n\n    map.markers.map((marker, idx) => {\n      let modelName = marker.slug\n      const texturePath = `${modelName}/${modelName}.mtl`\n      const modelPath = `${modelName}/${modelName}.obj`\n      const wrappedOnLoad = (modelPath, modelName) => {\n        return (materials) => {\n          materials.preload()\n          const objLoader = new OBJLoader( manager )\n          objLoader.setMaterials( materials )\n          objLoader.setPath( objectsPath )\n          objLoader.load( modelPath, ( object ) => {\n            object.traverse((child) => {\n              if (child.isMesh) {\n                child.geometry.scale(10, 10, 10) // @TODO change, girl-6 accepts 1,1,1\n              }\n            })\n            object.position.x = Math.random() * 100\n            object.position.y = 10\n            object.position.z = Math.random() * 100\n\n            // object.rotateX( - Math.PI / 2 ) // girl-6 only.\n\n            logg(object, 'loaded obj')\n\n            scene.add( object )\n            markerObjects.push( object )\n            markerObjectsIdxs.push({ uuid: object.uuid, name: modelName })\n\n          }, onProgress, onError )\n        }\n      }\n      mtlLoader.load(texturePath, wrappedOnLoad(modelPath, modelName))\n    })\n\n    // /* texture */\n    // const textureLoader = new THREE.TextureLoader( manager )\n    // const texture = textureLoader.load( 'textures/uv_grid_opengl.jpg' )\n\n\n    // const loader = new OBJLoader( manager )\n    // loader.load( `/assets/scenes/${modelName}/${modelName}.obj`, ( obj ) => {\n    //   object = obj\n    // }, ( xhr ) => {\n    //   if ( xhr.lengthComputable ) {\n    //     const percentComplete = xhr.loaded / xhr.total * 100\n    //     console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' )\n    //   }\n    // }, (e) => {\n    //   logg(e, 'onError')\n    // } )\n\n\n    /*\n     * parcels\n     */\n\n    // // some delimiters for the first 6 parcels!\n    // let geometry = new THREE.BoxGeometry( 10, 10, 10 )\n    // let material = new THREE.MeshBasicMaterial( {color: 0x00ff00} )\n    // let cube = new THREE.Mesh( geometry, material )\n    // cube.position.x = 0\n    // cube.position.y = 5\n    // cube.position.z = 0\n    // // scene.add( cube )\n    // const items = [\n    //   { color: 0xff0000, x: 1, y: 0, z: 0 },\n    //   { color: 0x00ff00, x: 0, y: 1, z: 0 },\n    //   { color: 0x0000ff, x: 0, y: 0, z: 1 }\n    // ]\n    // items.map((item, idx) => {\n    //   logg(item, 'item')\n    //   const { color, x, y, z } = item\n    //   geometry = new THREE.BoxGeometry( 1 + x*10, 1 + y*10, 1 + z*10 )\n    //   material = new THREE.MeshBasicMaterial({ color: color })\n    //   cube = new THREE.Mesh( geometry, material )\n    //   cube.position.x = x*5\n    //   cube.position.y = 10+y*5\n    //   cube.position.z = z*5\n    //   // scene.add( cube )\n    // })\n\n    // const parcels = [\n    //   { color: 0xff0000, x: 100, y: 1, z: 100 },\n    //   { color: 0x00ff00, x: 100, y: 1, z: 320 },\n    //   { color: 0x0000ff, x: -120, y: 1, z: 320 },\n\n    //   { color: 0x660000, x: -120, y: 1, z: 100 },\n    //   { color: 0x006600, x: -120, y: 1, z: -120 },\n    //   { color: 0x000066, x: 100, y: 1, z: -120 },\n    // ]\n    // parcels.map((item, idx) => {\n    //   const { color, x, y, z } = item\n    //   const g = new THREE.BoxGeometry( 200, 2, 200 )\n    //   const m = new THREE.MeshBasicMaterial({color: color})\n    //   const p = new THREE.Mesh( g, m )\n    //   p.position.x = x\n    //   p.position.y = y\n    //   p.position.z = z\n    //   // scene.add( p )\n    // })\n\n\n    /*\n     * Skybox\n     */\n    const loader = new THREE.TextureLoader()\n    texture = loader.load(`/assets/textures/space-5.jpg`, () => {\n      const rt = new THREE.WebGLCubeRenderTarget(texture.image.height)\n      rt.fromEquirectangularTexture(renderer, texture)\n      scene.background = rt.texture\n    });\n\n\n    /*\n     * and render\n     */\n    renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setPixelRatio( window.devicePixelRatio )\n    renderer.setSize( 700, 350 ) // aspect ratio 0.5\n    blockerRef.current.appendChild( renderer.domElement )\n    window.addEventListener( 'resize', onWindowResize )\n\n  }\n\n  function onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    renderer.setSize( window.innerWidth, window.innerHeight )\n  }\n\n  function animate() {\n    requestAnimationFrame( animate )\n    const time = performance.now()\n    if ( controls.isLocked === true ) {\n\n      var cameraDirection = controls.getDirection(new THREE.Vector3(0, 0, 0)).clone()\n\n      /* for standing on things */\n      // raycaster.ray.origin.copy( controls.getObject().position )\n      // raycaster.ray.origin.y -= 10\n\n      raycaster = new THREE.Raycaster( camera.position, cameraDirection )\n      const intersections = raycaster.intersectObjects( markerObjects, true )\n      if (intersections.length) {\n        const pickedObject = intersections[0].object\n\n        /* collision */\n        // if (intersections[0].distance < 5) {\n        //   moveForward = false\n        // }\n      }\n\n      const onObject = intersections.length > 0\n      const delta = ( time - prevTime ) / 1000\n      velocity.x -= velocity.x * 10.0 * delta\n      velocity.z -= velocity.z * 10.0 * delta\n      velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass\n      direction.z = Number( moveForward ) - Number( moveBackward )\n      direction.x = Number( moveRight ) - Number( moveLeft )\n      direction.normalize(); // this ensures consistent movements in all directions\n      if ( moveForward || moveBackward ) velocity.z -= direction.z * 400.0 * delta\n      if ( moveLeft || moveRight ) velocity.x -= direction.x * 400.0 * delta\n      if ( onObject === true ) {\n        velocity.y = Math.max( 0, velocity.y )\n        canJump = true\n      }\n      controls.moveRight( - velocity.x * delta )\n      controls.moveForward( - velocity.z * delta )\n      controls.getObject().position.y += ( velocity.y * delta ); // new behavior\n      if ( controls.getObject().position.y < 10 ) {\n        velocity.y = 0\n        controls.getObject().position.y = 10\n        canJump = true\n      }\n    }\n    prevTime = time\n\n    renderer.render( scene, camera )\n  }\n\n  return <F>\n    <div ref={instructionsRef} />\n    <Blocker {...S} ref={blockerRef} >\n      <div id=\"Crosshair\" />\n    </Blocker>\n  </F>\n}\n\nexport default ThreePanelV4\n","\n\nimport { CircularProgress as _CircularProgress } from '@material-ui/core'\nimport { ChevronLeft, ChevronRight, Menu as MenuIcon, } from '@material-ui/icons'\nimport React, { Fragment as F, useContext, useEffect, useRef, useState } from \"react\"\nimport Modal from \"react-modal\"\nimport styled from 'styled-components'\n\nimport {\n  Breadcrumbs,\n  ItemModal,\n  MapPanel, MapPanelNoZoom, MarkersList,\n} from \"./\"\nimport {\n  Equirectangular, Equirectangular2, Equirectangular4,\n  ThreePanelV1, ThreePanelV2, ThreePanelV3, ThreePanelV4,\n} from \"$components/locations3\"\nimport { Newsitems } from \"$components/newsitems\"\nimport { LongLine } from \"$components/TwofoldLayout\"\nimport {\n  C, Collapsible,\n  logg,\n  request,\n  TwofoldContext,\n  useWindowSize,\n} from \"$shared\"\n\n/* W */\nconst W = styled.div`\n  overflow: hidden;\n\n  flex-grow: 1;\n`;\n\n/**\n * Renders either MapPanel (W really, a simple wrapper), MapPanelNoZoom, or ThreePanelV1\n * or some other MapPanel.\n */\nconst WrappedMapPanel = React.forwardRef((props, ref) => {\n  // logg(props.map, 'WrappedMapPanel')\n\n  switch (props.map.config.map_panel_type) {\n\n    case C.map_panel_types.Equirectangular:\n      // return <W ref={ref} className=\"Equirectangular\" ><Equirectangular {...props} /></W>\n      // return <W ref={ref} className=\"Equirectangular2\" ><Equirectangular2 {...props} /></W>\n      return <W ref={ref} className=\"Equirectangular4\" ><Equirectangular4 {...props} /></W>\n\n    case C.map_panel_types.MapPanelNoZoom:\n      return <W ref={ref} className=\"WrappedMapPanel\" ><MapPanelNoZoom withZoom={false} {...props} /></W>\n\n    case C.map_panel_types.ThreePanelV1:\n      switch (props.slug) {\n        case 'threev1':\n          return <W><ThreePanelV1 {...props} /></W>\n        case 'threev2':\n          return <W><ThreePanelV2 {...props} /></W>\n          case 'threev3':\n            return <W><ThreePanelV3 {...props} /></W>\n\n        default:\n          logg(props.slug, `this 3d panel is not implemented`)\n          return <W ref={ref} className=\"WrappedMapPanel\" ><MapPanel {...props} /></W>\n      }\n\n    case C.map_panel_types.ThreePanelV4: // markers are objects\n      return <W><ThreePanelV4 {...props} /></W>\n\n    default:\n      return <W ref={ref} className=\"WrappedMapPanel\" ><MapPanel {...props} /></W>\n  }\n})\nexport default WrappedMapPanel\n\n","\nimport PropTypes from 'prop-types'\nimport React, { useContext, useEffect, useRef } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport config from 'config'\nimport {\n  logg,\n  TwofoldContext,\n} from \"$shared\"\n\nconst W = styled.div`\n  position: absolute;\n  top: 0;\n  right: 0;\n  z-index: 1;\n  background: white;\n  padding: 5px;\n\n  display: flex;\n  flex-direction: column;\n`;\n\n/**\n * ZoomCtrl\n */\nconst ZoomCtrl = (props) => {\n  logg(props, 'ZoomCtrl')\n\n  const { zoom, setZoom } = useContext(TwofoldContext)\n\n  const zoomIn = () => {\n    setZoom(zoom/2)\n  }\n  const zoomOut = () => {\n    setZoom(zoom*2)\n  }\n  const zoomReset = () => {\n    setZoom(1)\n  }\n\n  return <W className='ZoomCtrl' >\n    <span onClick={zoomIn} >[+]</span>\n    <span onClick={zoomOut} >[-]</span>\n    <span onClick={zoomReset} >[1]</span>\n  </W>\n}\n\nexport default ZoomCtrl\n","\nimport PropTypes from 'prop-types'\nimport { Grid } from '@material-ui/core'\nimport React, { Fragment as F, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, useApi, } from \"$shared\"\n\nconst Label = styled.div``;\n\nconst Features = ({ features, label, ...props }) => {\n  logg(props, 'Features')\n\n  const out = []\n  features.map((f) => {\n    if (f.inner_html) {\n      out.push(<Grid item sm={3} dangerouslySetInnerHTML={{ __html: f.inner_html }} />)\n    }\n  })\n\n  return <F>\n    {label && <Label>{label}</Label>}\n    <Grid style={{ marginBottom: '1em' }} container spacing={2}>\n      { out }\n    </Grid>\n  </F>\n}\n\nFeatures.propTypes = {\n  features: PropTypes.arrayOf(PropTypes.shape({\n    inner_html: PropTypes.string,\n  }) ),\n  label: PropTypes.string,\n}\nexport default Features","import { IonPage, IonLoading, IonContent } from '@ionic/react'\nimport React, { Fragment as F, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, useApi, } from \"$shared\"\nimport { Features } from \"./\"\nimport {\n  MainHeader,\n} from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\n\nconst _Hero = styled.div`\n  height: 370px;\n  text-align: center;\n\n  img {\n    max-width: 100%;\n  }\n`\nconst Hero = () => <_Hero><img className=\"image\" src=\"/assets/hero.png\" /></_Hero>\n\nconst Root = styled.div`\n  margin: 0;\n  padding-bottom: 1em;\n`\n\nconst SitesShow = (props) => {\n  logg(props, 'SitesShow')\n\n  let [ site, setSite ] = useState({ features: [], newsitems: [] })\n  let [ loading, setLoading ] = useState(false)\n\n  const api = useApi()\n  const mountedRef = useRef('init')\n\n  useEffect(() => {\n    api.applicationHome().then(data => {\n      if (!mountedRef.current) { return null }\n      logg(data, 'setSite')\n      setSite(data)\n      setLoading(false)\n    })\n    return () => { mountedRef.current = false }\n  }, [])\n\n  return <F>\n    <Root>\n      { /* <Hero /> */ }\n      <MainHeader />\n\n      <Features features={site.features} />\n      <Newsitems newsitems={site.newsitems} />\n    </Root>\n    <IonLoading\n      isOpen={loading}\n      onDidDismiss={() => setLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n  </F>\n}\n\nexport default SitesShow\n","import { IonPage, IonLoading, IonContent } from '@ionic/react'\nimport React, { Fragment as F, useEffect, useRef, useState } from \"react\"\nimport styled from 'styled-components'\n\nimport { C, logg, useApi, } from \"$shared\"\nimport { Features } from \"./\"\nimport {\n  BottomDrawer,\n  MainHeader, Menu, MenuBottom, MenuLeft,\n  UnlockModal\n} from \"$components/application\"\nimport { Newsitems } from \"$components/newsitems\"\n\nconst _Hero = styled.div`\n  height: 370px;\n  text-align: center;\n\n  img {\n    max-width: 100%;\n  }\n`\nconst Hero = () => <_Hero><img className=\"image\" src=\"/assets/hero.png\" /></_Hero>\n\nconst Root = styled.div`\n  margin: 0;\n  padding-bottom: 1em;\n`\n\n// Currently a homepage, like a wp page.\nconst SitesShow1 = (props) => {\n  logg(props, 'SitesShow')\n\n  let [ site, setSite ] = useState({ features: [], newsitems: [] })\n  let [ artTag, setArtTag ] = useState({ features: [] })\n  let [ homeRow1Tag, setHomeRow1Tag ] = useState({ features: [] })\n  let [ interestingLocationsTag, setInterestingLocationsTag ] = useState({ features: [] })\n  let [ loading, setLoading ] = useState(false)\n\n\n  const api = useApi()\n  const mountedRef = useRef('init')\n\n  // loads all data\n  useEffect(() => {\n    // setLoading(true)\n\n    api.applicationHome().then(data => {\n      if (!mountedRef.current) { return null }\n      logg(data, 'setSite')\n      setSite(data)\n      // setLoading(false)\n    })\n\n    api.getTag({ slug: 'interesting-locations' }).then(data => {\n      if (!mountedRef.current) { return null }\n      logg(data, 'setInterestingLocations')\n      setInterestingLocationsTag(data)\n      // setLoading(false)\n    })\n\n    api.getTag({ slug: 'home-row-1' }).then(data => {\n      if (!mountedRef.current) { return null }\n      setHomeRow1Tag(data)\n    })\n\n    api.getTag({ slug: 'art' }).then(data => {\n      if (!mountedRef.current) { return null }\n      setArtTag(data)\n    })\n\n    return () => { mountedRef.current = false }\n  }, [])\n\n  return <F>\n    <Root>\n\n      <MainHeader />\n      { /* <Hero /> */ }\n\n      <Features features={interestingLocationsTag.features} label=\"Interesting Locations\" />\n      <Features features={homeRow1Tag.features} label=\"Interesting Tags\" />\n      <Features features={artTag.features} label=\"art\" />\n      <Newsitems newsitems={site.newsitems} />\n    </Root>\n    <IonLoading\n      isOpen={loading}\n      onDidDismiss={() => setLoading(false)}\n      message={'Please wait...'}\n      duration={5000}\n    />\n  </F>\n}\n\nexport default SitesShow1\n","import { IonPage, IonContent, IonIcon, IonLoading } from '@ionic/react';\nimport { Container, Grid, GridList } from '@material-ui/core';\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { useEffect, useState } from \"react\";\nimport styled from 'styled-components'\nimport config from \"config\";\n\nimport { useApi, logg, request } from \"$shared\";\n\nconst useStyles = makeStyles((theme) => ({\n\n  paper: {\n    padding: theme.spacing(2),\n    textAlign: 'center',\n    color: theme.palette.text.secondary,\n  },\n  redBorder: {\n    border: '1px solid red',\n  },\n  root: {\n    flexGrow: 1,\n    overflow: 'scroll',\n    height: '100vh',\n  },\n\n}));\n\nconst VideoItem = styled.div`\n  border-bottom: 1px solid red;\n`;\n\nconst Video = (props) => {\n  logg(props, 'Video');\n  const api = useApi()\n\n  const { item: video } = props;\n\n  return <VideoItem key={props.idx} >\n    <h5>Video {video.name}</h5>\n    <p>created {video.created_at}</p>\n    <video controls preload=\"metadata\" type=\"video/mp4\" src={video.video_url}\n      style={{ maxWidth: '500px', maxHeight: '90vh' }} ></video>\n  </VideoItem>;\n};\n\nconst Videos = () => {\n  logg(config, 'Videos component');\n  console.log(JSON.stringify(config));\n\n  const [videos, setVideos] = useState([]);\n\n  const jwtToken = localStorage.getItem(\"jwtToken\");\n\n  const classes = useStyles();\n  const api = useApi()\n\n  useEffect(() => {\n    logg('posting...');\n    request.post(api.myVideosPath, { jwtToken: jwtToken }).then(r => r.data\n      ).then(({ videos }) => {\n        logg(videos, 'data')\n        setVideos(videos);\n      })\n  }, []);\n\n  return <Container maxWidth=\"md\">\n    <Grid container className={classes.root} >\n      <Grid item xs={12} >\n        <h2>My Videos</h2>\n      </Grid>\n      <Grid item xs={12}>\n        { videos && videos.map((v, idx) => <Video key={idx} item={v} ></Video> ) }\n      </Grid>\n    </Grid>\n  </Container>;\n\n};\n\nexport default Videos;\n","\n\nimport { Container as _Container, Grid, GridList } from '@material-ui/core'\nimport React, { Fragment as F, useEffect, useRef, useState } from 'react'\nimport {\n  Link, Switch, BrowserRouter as Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\nimport { ToastContainer, toast } from 'react-toastify'\n\nimport styled from 'styled-components'\n\nimport '@ionic/react/css/core.css'\nimport '@ionic/react/css/normalize.css'\nimport '@ionic/react/css/structure.css'\nimport '@ionic/react/css/typography.css'\nimport '@ionic/react/css/padding.css'\nimport '@ionic/react/css/float-elements.css'\nimport '@ionic/react/css/text-alignment.css'\nimport '@ionic/react/css/text-transformation.css'\nimport '@ionic/react/css/flex-utils.css'\nimport '@ionic/react/css/display.css'\n\nimport './theme/variables.css'\nimport 'react-toastify/dist/ReactToastify.css'\n\nimport config from \"config\"\nimport {\n  BottomDrawer,\n  MainHeader, Menu, MenuBottom, MenuLeft,\n  UnlockModal\n} from \"$components/application\"\nimport MapuiLayout from \"$components/application/MapuiLayout\"\nimport { CitiesList, CitiesShow } from \"$components/cities\"\n// @TODO: MyGalleries doesn't look right...\nimport { GalleriesShow, MyGalleries } from \"$components/galleries\"\nimport { LocationsShowDesktop } from \"$components/locations\"\nimport Three from \"$components/locations3/ThreePanelV1\"\nimport { ReportsShow } from \"$components/reports\"\n// import { SitesShow } from '$components/sites'\nimport SitesShow from '$components/sites/SitesShow1'\nimport { Account, LoginModal } from \"$components/users\"\nimport { Videos } from \"$components/videos\"\nimport {\n  C, CollapsibleContext, CollapsibleContextProvider,\n  Debug, logg, request, TwofoldContext, TwofoldContextProvider , useApi,\n} from \"$shared\"\n\nconst Root = styled.div`\n  // border: 1px solid #741741;\n\n  background: ${p => p.theme.colors.background};\n  height: 100vh;\n  overflow: auto;\n`;\n\n\nconst AppDesktop = (props) => {\n  // logg(props, 'AppDesktop')\n  const {\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n  } = props\n\n  const api = useApi()\n\n  const [ layout, setLayout ] = useState(C.layout_onecol)\n\n  const Container = (props) => {\n    switch(layout) {\n      case C.layout_onecol:\n        // main case\n        return <_Container maxWidth=\"md\" {...props} />\n      case C.layout_mapui:\n        return <MapuiLayout {...props} />\n    }\n  }\n\n  const Route = (props) => {\n    useEffect(() => {\n      if (props.layout) {\n        setLayout(props.layout)\n      } else {\n        setLayout(C.layout_onecol)\n      }\n    }, [props.layout])\n\n    return <_Route {...props} />\n  }\n\n  return (<Router>\n\n\n    <TwofoldContextProvider {...props} {...{ layout, setLayout }} >\n      <CollapsibleContextProvider >\n        <Root>\n\n          { /* This no more, if I want it to look like Financial Times */ }\n          { /* layout === C.layout_onecol && <MenuLeft variant={C.variants.floating} /> */ }\n          { /* <MainHeader /> */ }\n\n          <Container >\n            <Switch id=\"main\" main >\n\n              <Redirect exact from=\"/\" to={config.homeLocation} />\n              <Route exact path=\"/en\" ><SitesShow /></Route>\n\n              <Route exact path=\"/en/account\" component={Account} />\n              <Route exact path=\"/en/account/my/videos\" component={Videos} />\n              <Route exact path=\"/en/account/my/galleries\" component={MyGalleries} />\n\n              <Route exact path=\"/en/cities\"                 component={CitiesList} />\n              <Route       path=\"/en/cities/travel-to/:name\" component={CitiesShow} />\n\n              <Route exact path=\"/en/galleries/show/:slug\" component={GalleriesShow} />\n\n              <Route exact path=\"/en/reports/show/:slug\" component={ReportsShow} />\n\n              <Route exact path=\"/en/locations/show/:slug\" component={LocationsShowDesktop} layout={C.layout_mapui} />\n\n            </Switch>\n          </Container>\n        </Root>\n\n        <BottomDrawer />\n        <UnlockModal />\n        <LoginModal />\n        <ToastContainer />\n\n      </CollapsibleContextProvider>\n    </TwofoldContextProvider>\n  </Router>)\n}\n\nexport default AppDesktop\n","import { Container as _Container, Grid, GridList } from '@material-ui/core'\n\nimport React, { Fragment as F, useEffect, useState } from 'react'\nimport Modal from \"react-modal\"\nimport {\n  Switch, BrowserRouter as Router, Redirect, Route as _Route,\n} from 'react-router-dom'\nimport styled from 'styled-components'\n\nimport '@ionic/react/css/core.css'\nimport '@ionic/react/css/normalize.css'\nimport '@ionic/react/css/structure.css'\nimport '@ionic/react/css/typography.css'\nimport '@ionic/react/css/padding.css'\nimport '@ionic/react/css/float-elements.css'\nimport '@ionic/react/css/text-alignment.css'\nimport '@ionic/react/css/text-transformation.css'\nimport '@ionic/react/css/flex-utils.css'\nimport '@ionic/react/css/display.css'\nimport './theme/variables.css'\n\nimport config from \"config\"\nimport { BottomDrawer, Menu, MenuBottom, MenuLeft, UnlockModal } from \"$components/application\"\nimport { MapuiMobileLayout } from \"$components/application\"\nimport { CitiesList, CitiesShow } from \"$components/cities\"\nimport { GalleriesShow } from \"$components/galleries\"\nimport { LocationsShowMobile } from \"$components/locations\"\nimport { ReportsShow } from \"$components/reports\"\nimport { SitesShow } from '$components/sites'\nimport { Account, LoginModal } from \"$components/users\"\nimport { Videos } from \"$components/videos\"\nimport { Galleries, MyGalleries } from \"$components/galleries\"\nimport { useApi, C, CollapsibleContextProvider, Debug, logg, request, TwofoldContextProvider } from \"$shared\"\n\nconst Root = styled.div`\n\n\n  background: #dedede;\n  height: 100vh;\n  overflow: auto;\n`;\n\nconst __Container = styled(_Container)`\n\n  padding: 0;\n  height: 100vh;\n  overflow: scroll;\n`;\n\nconst AppMobile = (props) => {\n  logg(props, 'AppMobile')\n  const { currentUser, setCurrentUser } = props\n\n  const [ layout, setLayout ] = useState(C.layout_onecol)\n  const [ bottomDrawerOpen, setBottomDrawerOpen ] = React.useState(false)\n  const [ itemToUnlock, setItemToUnlock ] = React.useState(false)\n  const [ zoom, setZoom ] = useState(1)\n  const api = useApi()\n\n  const Container = (props) => {\n    switch(layout) {\n      case C.layout_onecol:\n        return <__Container maxWidth=\"md\" {...props} />\n      case C.layout_mapui:\n        // This is true right now (2021-10-20) for mobile even when it's one column\n        return <MapuiMobileLayout {...props} {...{ bottomDrawerOpen, setBottomDrawerOpen }} />\n    }\n  }\n\n  const Route = (props) => {\n    useEffect(() => {\n      if (props.layout) {\n        setLayout(props.layout)\n      } else {\n        setLayout(C.layout_onecol)\n      }\n    }, [props.layout])\n\n    return <_Route {...props} />\n  }\n\n  const doUnlock = async () => {\n    // @TODO: check how many unlocks I have, and offer to purchase more if not enough.\n    const path = api.doUnlock({ kind: 'Report', id: itemToUnlock.report_id });\n    const result = await request.post(`${config.apiOrigin}${path}`);\n    logg(result, 'result of unlocking')\n  };\n\n  return (<Router>\n    <TwofoldContextProvider {...props} {...{ layout, setLayout }} >\n      <CollapsibleContextProvider >\n        { layout === C.layout_onecol && <MenuLeft variant={C.variants.floating} /> }\n        <Root className=\"Root\" >\n\n          <Container className=\"Container\" >\n            <Switch id=\"main\" main >\n\n              <Redirect exact from=\"/\" to={config.homeLocation} />\n              <Route exact path=\"/en\" ><SitesShow /></Route>\n\n              <Route exact path=\"/en/account\" component={Account} />\n              <Route exact path=\"/en/account/my/videos\" component={Videos} />\n              <Route exact path=\"/en/account/my/galleries\" component={MyGalleries} />\n\n              <Route exact path=\"/en/cities\"                 component={CitiesList} />\n              <Route       path=\"/en/cities/travel-to/:name\" component={CitiesShow} />\n\n              <Route exact path=\"/en/galleries/show/:slug\" component={GalleriesShow} />\n\n              <Route exact path=\"/en/reports/show/:slug\" component={ReportsShow} />\n\n              <Route exact path=\"/en/locations/show/:slug\" component={LocationsShowMobile} layout={C.layout_mapui} />\n\n            </Switch>\n          </Container>\n        </Root>\n\n        <BottomDrawer />\n        <UnlockModal />\n        <LoginModal />\n\n      </CollapsibleContextProvider>\n    </TwofoldContextProvider>\n  </Router>)\n}\n\nexport default AppMobile\n","\nimport { Device } from '@capacitor/device'\nimport React, { useContext, useEffect, useRef, useState, } from 'react'\nimport { ThemeProvider } from 'styled-components'\n\nimport config from 'config'\nimport { C, logg, request, S, useApi } from \"$shared\"\nimport AppDesktop from './AppDesktop'\nimport AppMobile from './AppMobile'\n\n/**\n * Choses mobile vs desktop\n */\nconst AppWrapper = (props) => {\n  // logg(props, 'AppWrapper')\n  const api = useApi()\n\n\n  const [ currentUser, setCurrentUser ] = useState(false)\n  const [ loginModalOpen, setLoginModalOpen ] = useState(false)\n  const mountedRef = useRef('init')\n  useEffect(() => {\n    const fn = async () => {\n      const jwtToken = localStorage.getItem(C.jwt_token)\n      await request.get(`${config.apiOrigin}${api.myAccount()}?jwt_token=${jwtToken}`).then((r) => {\n        if (!mountedRef.current) { return }\n        setCurrentUser(r.data)\n      }).catch((e) => {\n        logg(e, 'e12')\n        if (e.message === \"Request failed with status code 401\") {\n          if (config.requireLogin || typeof config.requireLogin === 'undefined') {\n            setLoginModalOpen(true)\n          }\n        }\n      })\n    }\n    fn()\n    return () => mountedRef.current = null\n  }, [currentUser]) // @TODO: currentUser here is appropriate?\n\n\n  const [ os, setOs ] = useState(null)\n  // info.operatingSystem === 'ios' || 'android'\n  const fn = async () => {\n    let info = await Device.getInfo()\n    setOs(info.operatingSystem)\n  }\n  fn()\n\n  const [theme, setTheme] = useState(window.localStorage.getItem(C.theme) || C.themes.light)\n  const toggleTheme = (e) => {\n    if (theme === C.themes.light) {\n      window.localStorage.setItem(C.theme, C.themes.dark)\n      setTheme(C.themes.dark)\n    } else {\n      window.localStorage.setItem(C.theme, C.themes.light)\n      setTheme(C.themes.light)\n    }\n  }\n\n  const childProps = {\n    currentUser, setCurrentUser,\n    loginModalOpen, setLoginModalOpen,\n    theme, toggleTheme,\n  }\n\n  if (!os) { return null }\n  return <ThemeProvider theme={theme == C.themes.light ? S.lightTheme: S.darkTheme} >\n    { \"ios android\".includes(os) ?\n      <AppMobile {...childProps} />\n      : <AppDesktop {...childProps} /> }\n  </ThemeProvider>\n}\n\nexport default AppWrapper\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport AppWrapper from './AppWrapper'\nimport * as serviceWorker from './serviceWorker'\nimport {\n  Link, Switch, BrowserRouter as Router, Redirect, Route as _Route, useHistory, withRouter\n} from 'react-router-dom'\n\nReactDOM.render(<AppWrapper />, document.getElementById('root'))\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n\n\n\n"],"sourceRoot":""}